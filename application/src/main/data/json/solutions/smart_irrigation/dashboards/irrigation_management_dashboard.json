{
  "title": "Irrigation Management",
  "image": null,
  "mobileHide": false,
  "mobileOrder": null,
  "configuration": {
    "description": "",
    "widgets": {
      "9096bb98-7d8a-5888-e77b-7f02c846c922": {
        "isSystemType": true,
        "bundleAlias": "charts",
        "typeAlias": "basic_timeseries",
        "type": "timeseries",
        "title": "New widget",
        "image": null,
        "description": null,
        "sizeX": 8,
        "sizeY": 5,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "name": null,
              "entityAliasId": "cd737d26-3068-aae0-d370-c93f8e7e1a00",
              "filterId": null,
              "dataKeys": [
                {
                  "name": "avgMoisture",
                  "type": "timeseries",
                  "label": "avgMoisture",
                  "color": "#2196f3",
                  "settings": {},
                  "_hash": 0.8744305724481565
                }
              ],
              "latestDataKeys": []
            }
          ],
          "timewindow": {
            "realtime": {
              "timewindowMs": 60000
            }
          },
          "showTitle": true,
          "backgroundColor": "#fff",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "8px",
          "settings": {
            "shadowSize": 4,
            "fontColor": "#545454",
            "fontSize": 10,
            "xaxis": {
              "showLabels": true,
              "color": "#545454"
            },
            "yaxis": {
              "showLabels": true,
              "color": "#545454"
            },
            "grid": {
              "color": "#545454",
              "tickColor": "#DDDDDD",
              "verticalLines": true,
              "horizontalLines": true,
              "outlineWidth": 1
            },
            "legend": {
              "show": true,
              "position": "nw",
              "backgroundColor": "#f0f0f0",
              "backgroundOpacity": 0.85,
              "labelBoxBorderColor": "rgba(1, 1, 1, 0.45)"
            },
            "decimals": 1,
            "stack": false,
            "tooltipIndividual": false
          },
          "title": "New Timeseries Line Chart",
          "dropShadow": true,
          "enableFullscreen": true,
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400
          },
          "useDashboardTimewindow": true
        },
        "row": 0,
        "col": 0,
        "id": "9096bb98-7d8a-5888-e77b-7f02c846c922"
      },
      "c5f8412d-2ffb-4c44-7a7f-223ceea08d84": {
        "isSystemType": true,
        "bundleAlias": "maps_v2",
        "typeAlias": "openstreetmap",
        "type": "latest",
        "title": "New widget",
        "image": null,
        "description": null,
        "sizeX": 8.5,
        "sizeY": 6,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "name": null,
              "entityAliasId": "cd737d26-3068-aae0-d370-c93f8e7e1a00",
              "filterId": null,
              "dataKeys": [
                {
                  "name": "name",
                  "type": "entityField",
                  "label": "Name",
                  "color": "#f44336",
                  "settings": {},
                  "_hash": 0.848379539472371
                },
                {
                  "name": "perimeter",
                  "type": "attribute",
                  "label": "perimeter",
                  "color": "#ffc107",
                  "settings": {},
                  "_hash": 0.7803202333041441
                }
              ]
            }
          ],
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY"
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1664882134048,
                "endTimeMs": 1664968534048
              },
              "quickInterval": "CURRENT_DAY"
            },
            "aggregation": {
              "type": "AVG",
              "limit": 25000
            }
          },
          "showTitle": true,
          "backgroundColor": "#fff",
          "color": "rgba(0,0,0,0.87)",
          "padding": "8px",
          "settings": {
            "provider": "openstreet-map",
            "gmApiKey": "AIzaSyDoEx2kaGz3PxwbI9T7ccTSg5xjdw8Nw8Q",
            "gmDefaultMapType": "roadmap",
            "mapProvider": "OpenStreetMap.Mapnik",
            "useCustomProvider": true,
            "customProviderTileUrl": "https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",
            "mapProviderHere": "HERE.normalDay",
            "credentials": {
              "app_id": "AhM6TzD9ThyK78CT3ptx",
              "app_code": "p6NPiITB3Vv0GMUFnkLOOg"
            },
            "mapImageUrl": "data:image/svg+xml;base64,PHN2ZyBpZD0ic3ZnMiIgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGhlaWdodD0iMTAwIiB3aWR0aD0iMTAwIiB2ZXJzaW9uPSIxLjEiIHhtbG5zOmNjPSJodHRwOi8vY3JlYXRpdmVjb21tb25zLm9yZy9ucyMiIHhtbG5zOmRjPSJodHRwOi8vcHVybC5vcmcvZGMvZWxlbWVudHMvMS4xLyIgdmlld0JveD0iMCAwIDEwMCAxMDAiPgogPGcgaWQ9ImxheWVyMSIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMCAtOTUyLjM2KSI+CiAgPHJlY3QgaWQ9InJlY3Q0Njg0IiBzdHJva2UtbGluZWpvaW49InJvdW5kIiBoZWlnaHQ9Ijk5LjAxIiB3aWR0aD0iOTkuMDEiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiB5PSI5NTIuODYiIHg9Ii40OTUwNSIgc3Ryb2tlLXdpZHRoPSIuOTkwMTAiIGZpbGw9IiNlZWUiLz4KICA8dGV4dCBpZD0idGV4dDQ2ODYiIHN0eWxlPSJ3b3JkLXNwYWNpbmc6MHB4O2xldHRlci1zcGFjaW5nOjBweDt0ZXh0LWFuY2hvcjptaWRkbGU7dGV4dC1hbGlnbjpjZW50ZXIiIGZvbnQtd2VpZ2h0PSJib2xkIiB4bWw6c3BhY2U9InByZXNlcnZlIiBmb250LXNpemU9IjEwcHgiIGxpbmUtaGVpZ2h0PSIxMjUlIiB5PSI5NzAuNzI4MDkiIHg9IjQ5LjM5NjQ3NyIgZm9udC1mYW1pbHk9IlJvYm90byIgZmlsbD0iIzY2NjY2NiI+PHRzcGFuIGlkPSJ0c3BhbjQ2OTAiIHg9IjUwLjY0NjQ3NyIgeT0iOTcwLjcyODA5Ij5JbWFnZSBiYWNrZ3JvdW5kIDwvdHNwYW4+PHRzcGFuIGlkPSJ0c3BhbjQ2OTIiIHg9IjQ5LjM5NjQ3NyIgeT0iOTgzLjIyODA5Ij5pcyBub3QgY29uZmlndXJlZDwvdHNwYW4+PC90ZXh0PgogIDxyZWN0IGlkPSJyZWN0NDY5NCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgaGVpZ2h0PSIxOS4zNiIgd2lkdGg9IjY5LjM2IiBzdHJva2U9IiMwMDAiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgeT0iOTkyLjY4IiB4PSIxNS4zMiIgc3Ryb2tlLXdpZHRoPSIuNjM5ODYiIGZpbGw9Im5vbmUiLz4KIDwvZz4KPC9zdmc+Cg==",
            "tmApiKey": "84d6d83e0e51e481e50454ccbe8986b",
            "tmDefaultMapType": "roadmap",
            "latKeyName": "1",
            "lngKeyName": "1",
            "xPosKeyName": "xPos",
            "yPosKeyName": "yPos",
            "defaultCenterPosition": "0,0",
            "disableScrollZooming": false,
            "disableDoubleClickZooming": false,
            "disableZoomControl": false,
            "fitMapBounds": true,
            "useDefaultCenterPosition": false,
            "mapPageSize": 16384,
            "markerOffsetX": 0.5,
            "markerOffsetY": 1,
            "posFunction": "return {x: origXPos, y: origYPos};",
            "draggableMarker": false,
            "showLabel": true,
            "useLabelFunction": false,
            "label": "${entityName}",
            "showTooltip": true,
            "showTooltipAction": "click",
            "autocloseTooltip": true,
            "useTooltipFunction": false,
            "tooltipPattern": "<b>${entityName}</b><br/><br/><b>Latitude:</b> ${latitude:7}<br/><b>Longitude:</b> ${longitude:7}<br/><b>Temperature:</b> ${temperature} Â°C<br/><small>See advanced settings for details</small>",
            "tooltipOffsetX": 0,
            "tooltipOffsetY": -1,
            "color": "#fe7569",
            "useColorFunction": true,
            "colorFunction": "var type = dsData[dsIndex]['Type'];\nif (type == 'colorpin') {\n\tvar temperature = dsData[dsIndex]['temperature'];\n\tif (typeof temperature !== undefined) {\n\t    var percent = (temperature + 60)/120 * 100;\n\t    return tinycolor.mix('blue', 'red', percent).toHexString();\n\t}\n\treturn 'blue';\n}\n",
            "useMarkerImageFunction": false,
            "markerImageSize": 34,
            "markerImages": [],
            "showPolygon": true,
            "polygonKeyName": "perimeter",
            "editablePolygon": false,
            "showPolygonLabel": true,
            "usePolygonLabelFunction": false,
            "polygonLabel": "${entityName}",
            "showPolygonTooltip": false,
            "polygonColor": "#3388ff",
            "polygonOpacity": 0.2,
            "usePolygonColorFunction": false,
            "polygonStrokeColor": "#3388ff",
            "polygonStrokeOpacity": 1,
            "polygonStrokeWeight": 3,
            "usePolygonStrokeColorFunction": false,
            "showCircle": false,
            "circleKeyName": "perimeter",
            "editableCircle": false,
            "showCircleLabel": false,
            "useCircleLabelFunction": false,
            "circleLabel": "${entityName}",
            "showCircleTooltip": false,
            "showCircleTooltipAction": "click",
            "autoCloseCircleTooltip": true,
            "useCircleTooltipFunction": false,
            "circleTooltipPattern": "<b>${entityName}</b><br/><br/><b>TimeStamp:</b> ${ts:7}",
            "circleFillColor": "#3388ff",
            "circleFillColorOpacity": 0.2,
            "useCircleFillColorFunction": false,
            "circleStrokeColor": "#3388ff",
            "circleStrokeOpacity": 1,
            "circleStrokeWeight": 3,
            "useCircleStrokeColorFunction": false,
            "useClusterMarkers": false,
            "zoomOnClick": true,
            "maxClusterRadius": 80,
            "animate": true,
            "spiderfyOnMaxZoom": false,
            "showCoverageOnHover": true,
            "chunkedLoading": false,
            "removeOutsideVisibleBounds": true
          },
          "title": "Fields",
          "dropShadow": true,
          "enableFullscreen": true,
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400
          },
          "useDashboardTimewindow": true,
          "showLegend": false,
          "widgetStyle": {},
          "actions": {
            "markerClick": [
              {
                "name": "Field details",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "openDashboardState",
                "targetDashboardStateId": "field",
                "setEntityId": true,
                "stateEntityParamName": null,
                "openRightLayout": false,
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "6feadbe9-7088-fccc-2cbc-dcde695df002"
              }
            ]
          },
          "showTitleIcon": false,
          "titleTooltip": "",
          "enableDataExport": true,
          "widgetCss": "",
          "pageSize": 1024,
          "noDataDisplayMessage": ""
        },
        "row": 0,
        "col": 0,
        "id": "c5f8412d-2ffb-4c44-7a7f-223ceea08d84"
      },
      "a6b597ee-cb21-ee9f-dc98-8673f1d976f1": {
        "isSystemType": true,
        "bundleAlias": "cards",
        "typeAlias": "entities_table",
        "type": "latest",
        "title": "New widget",
        "image": null,
        "description": null,
        "sizeX": 7.5,
        "sizeY": 6.5,
        "config": {
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY"
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1664882134048,
                "endTimeMs": 1664968534048
              },
              "quickInterval": "CURRENT_DAY"
            },
            "aggregation": {
              "type": "NONE",
              "limit": 200
            }
          },
          "showTitle": true,
          "backgroundColor": "rgb(255, 255, 255)",
          "color": "rgba(0,0,0,0.87)",
          "padding": "4px",
          "settings": {
            "entitiesTitle": "Irrigation Schedule",
            "enableSearch": true,
            "enableSelectColumnDisplay": true,
            "enableStickyHeader": true,
            "enableStickyAction": true,
            "reserveSpaceForHiddenAction": "true",
            "displayEntityName": false,
            "displayEntityLabel": false,
            "displayEntityType": false,
            "displayPagination": true,
            "defaultPageSize": 10,
            "defaultSortOrder": "name",
            "useRowStyleFunction": false
          },
          "title": "New Entities table",
          "dropShadow": false,
          "enableFullscreen": false,
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400,
            "padding": "5px 10px 5px 10px"
          },
          "useDashboardTimewindow": false,
          "showLegend": false,
          "datasources": [
            {
              "type": "entity",
              "name": null,
              "entityAliasId": "4ed5e77d-3c18-a442-e616-14f73013a686",
              "filterId": null,
              "dataKeys": [
                {
                  "name": "name",
                  "type": "entityField",
                  "label": "Name",
                  "color": "#8bc34a",
                  "settings": {
                    "columnWidth": "120px",
                    "useCellStyleFunction": true,
                    "cellStyleFunction": "return {\n  fontWeight: 600\n}\n",
                    "useCellContentFunction": true,
                    "cellContentFunction": "return '<span style=\"background: rgba(111, 116, 242, 0.08); border-radius: 16px; padding: 4px 8px; color: #5553AF;\">'+value+'</span>';",
                    "defaultColumnVisibility": "visible",
                    "columnSelectionToDisplay": "enabled",
                    "columnExportOption": "onlyVisible"
                  },
                  "_hash": 0.6933423282312259,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                },
                {
                  "name": "schedule",
                  "type": "entityField",
                  "label": "Start day",
                  "color": "#4caf50",
                  "settings": {
                    "columnWidth": "60px",
                    "useCellStyleFunction": false,
                    "useCellContentFunction": true,
                    "cellContentFunction": "var schedule = JSON.parse(value);\nvar dateFormat;\nif (new Date().getYear() === new Date(schedule.startTime).getYear()) {\n    dateFormat = 'd MMM';\n} else {\n    dateFormat = 'd MMM yyyy';\n}\nreturn ctx.date.transform(schedule.startTime, dateFormat);",
                    "defaultColumnVisibility": "visible",
                    "columnSelectionToDisplay": "enabled",
                    "columnExportOption": "onlyVisible"
                  },
                  "_hash": 0.04733952880745074,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                },
                {
                  "name": "schedule",
                  "type": "entityField",
                  "label": "Start time",
                  "color": "#f44336",
                  "settings": {
                    "columnWidth": "60px",
                    "useCellStyleFunction": true,
                    "cellStyleFunction": "return {\n  fontWeight: 600\n}\n",
                    "useCellContentFunction": true,
                    "cellContentFunction": "var schedule = JSON.parse(value);\nvar time = ctx.date.transform(schedule.startTime, 'HH:mm');\nreturn '<span style=\"background: rgba(111, 116, 242, 0.08); border-radius: 16px; padding: 4px 8px; color: #5553AF;\">'+time+'</span>';\n",
                    "defaultColumnVisibility": "visible",
                    "columnSelectionToDisplay": "enabled",
                    "columnExportOption": "onlyVisible"
                  },
                  "_hash": 0.1466902034288322,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                },
                {
                  "name": "schedule",
                  "type": "entityField",
                  "label": "Repeat",
                  "color": "#9c27b0",
                  "settings": {
                    "columnWidth": "120px",
                    "useCellStyleFunction": false,
                    "useCellContentFunction": true,
                    "cellContentFunction": "var schedulerWeekday =\n  [\n    'scheduler.sunday',\n    'scheduler.monday',\n    'scheduler.tuesday',\n    'scheduler.wednesday',\n    'scheduler.thursday',\n    'scheduler.friday',\n    'scheduler.saturday'\n  ];\nvar schedule = JSON.parse(value);\nif (schedule.repeat) {\n    var type = schedule.repeat.type;\n    if (type === 'DAILY') {\n        return ctx.translate.instant('scheduler.daily');\n    } else if (type === 'EVERY_N_DAYS') {\n        return ctx.translate.instant('scheduler.every-n-days-text', {days: schedule.repeat.days});\n    } else if (type === 'MONTHLY') {\n        return ctx.translate.instant('scheduler.monthly');\n    } else if (type === 'EVERY_N_WEEKS') {\n        return ctx.translate.instant('scheduler.every-n-weeks-text', {weeks: schedule.repeat.weeks});\n    } else if (type === 'YEARLY') {\n        return ctx.translate.instant('scheduler.scheduler.yearly');\n    } else if (type === 'TIMER') {\n        var timeUnit = schedule.repeat.timeUnit;\n        var timeUnitRepeatText;\n        if (timeUnit === 'HOURS') {\n            timeUnitRepeatText = 'scheduler.every-hour';\n        } else if (timeUnit === 'MINUTES') {\n            timeUnitRepeatText = 'scheduler.every-minute';\n        } else {\n            timeUnitRepeatText = 'scheduler.every-second';\n        }\n        return ctx.translate.instant(timeUnitRepeatText, {count: schedule.repeat.repeatInterval});\n    } else {\n        var text = ctx.translate.instant('scheduler.weekly') + ' ' + ctx.translate.instant('scheduler.on') + ' ';\n        text += schedule.repeat.repeatOn.map((day) => ctx.translate.instant(schedulerWeekday[day])).join(', ');\n        return text;\n    }\n} else {\n    return '&#8212;';\n}\n",
                    "defaultColumnVisibility": "visible",
                    "columnSelectionToDisplay": "enabled",
                    "columnExportOption": "onlyVisible"
                  },
                  "_hash": 0.8312570330048112,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                },
                {
                  "name": "schedule",
                  "type": "entityField",
                  "label": "End day",
                  "color": "#ffc107",
                  "settings": {
                    "columnWidth": "60px",
                    "useCellStyleFunction": false,
                    "useCellContentFunction": true,
                    "cellContentFunction": "var schedule = JSON.parse(value);\nif (schedule.repeat && schedule.repeat.endsOn) {\n    var dateFormat;\n    if (new Date().getYear() === new Date(schedule.repeat.endsOn).getYear()) {\n        dateFormat = 'd MMM';\n    } else {\n        dateFormat = 'd MMM yyyy';\n    }\n    return ctx.date.transform(schedule.repeat.endsOn, dateFormat);\n} else {\n    return '&#8212;';\n}\n",
                    "defaultColumnVisibility": "visible",
                    "columnSelectionToDisplay": "enabled",
                    "columnExportOption": "onlyVisible"
                  },
                  "_hash": 0.17195353755002496,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                },
                {
                  "name": "configuration",
                  "type": "entityField",
                  "label": "Duration",
                  "color": "#2196f3",
                  "settings": {
                    "columnWidth": "80px",
                    "useCellStyleFunction": true,
                    "cellStyleFunction": "return {\n  fontWeight: 600\n}",
                    "useCellContentFunction": true,
                    "cellContentFunction": "var configuration = JSON.parse(value);\nvar duration;\nif (configuration.msgBody && configuration.msgBody.durationInMinutes) {\n    duration = configuration.msgBody.durationInMinutes + ' min';\n} else {\n    duration = '&#8212;';\n}\n\nreturn '<span style=\"background: rgba(111, 116, 242, 0.08); border-radius: 16px; padding: 4px 8px;  color: #5553AF;\">'+duration+'</span>';\n",
                    "defaultColumnVisibility": "visible",
                    "columnSelectionToDisplay": "enabled",
                    "columnExportOption": "onlyVisible"
                  },
                  "_hash": 0.6115695527306177,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                },
                {
                  "name": "configuration",
                  "type": "entityField",
                  "label": "Volume",
                  "color": "#607d8b",
                  "settings": {
                    "columnWidth": "80px",
                    "useCellStyleFunction": true,
                    "cellStyleFunction": "return {\n  fontWeight: 600\n}",
                    "useCellContentFunction": true,
                    "cellContentFunction": "var configuration = JSON.parse(value);\nvar volume;\nif (configuration.msgBody && configuration.msgBody.volumeInLitters) {\n    volume = configuration.msgBody.volumeInLitters + ' l';\n} else {\n    volume = '&#8212;';\n}\n\nreturn '<span style=\"background: rgba(111, 116, 242, 0.08); border-radius: 16px; padding: 4px 8px; color: #5553AF;\">'+volume+'</span>';\n",
                    "defaultColumnVisibility": "visible",
                    "columnSelectionToDisplay": "enabled",
                    "columnExportOption": "onlyVisible"
                  },
                  "_hash": 0.17406314101781595,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ]
            }
          ],
          "displayTimewindow": true,
          "showTitleIcon": false,
          "titleTooltip": "",
          "enableDataExport": false,
          "widgetStyle": {},
          "widgetCss": "",
          "pageSize": 1024,
          "noDataDisplayMessage": "",
          "actions": {
            "headerButton": [
              {
                "name": "Create irrigation schedule",
                "icon": "add",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "customPretty",
                "customHtml": "<form #addSchedulerEventForm=\"ngForm\" [formGroup]=\"addSchedulerEventFormGroup\"\n      (ngSubmit)=\"save()\" class=\"sf-scheduler-event-form\">\n    <mat-toolbar fxLayout=\"row\" color=\"primary\">\n        <h2>Create irrigation schedule</h2>\n        <span fxFlex></span>\n        <button mat-icon-button (click)=\"cancel()\" type=\"button\">\n            <mat-icon class=\"material-icons\">close</mat-icon>\n        </button>\n    </mat-toolbar>\n    <mat-progress-bar color=\"warn\" mode=\"indeterminate\" *ngIf=\"isLoading$ | async\">\n    </mat-progress-bar>\n    <div style=\"height: 4px;\" *ngIf=\"!(isLoading$ | async)\"></div>\n    <div mat-dialog-content fxLayout=\"column\">\n        <div fxLayout=\"row\" fxLayoutGap=\"8px\" fxLayout.xs=\"column\"  fxLayoutGap.xs=\"0\">\n            <mat-form-field fxFlex class=\"mat-block\">\n                <mat-label>Name</mat-label>\n                <input matInput formControlName=\"name\" required>\n                <mat-error *ngIf=\"addSchedulerEventFormGroup.get('name').hasError('required')\">\n                    Name is required.\n                </mat-error>\n            </mat-form-field>\n        </div>\n        <span class=\"title-modal\">Start</span>\n        <div fxLayout=\"row\" fxLayoutGap=\"8px\" fxLayout.xs=\"column\"  fxLayoutGap.xs=\"0\">\n            <mat-form-field appearance=\"fill\">\n                <mat-label>Date</mat-label>\n                <mat-datetimepicker-toggle [for]=\"startDatePicker\" matSuffix></mat-datetimepicker-toggle>\n                <mat-datetimepicker (opened)=\"datePickerOpened()\" #startDatePicker type=\"date\" openOnFocus=\"true\"></mat-datetimepicker>\n                <input required matInput formControlName=\"startDate\" [matDatetimepicker]=\"startDatePicker\">\n            </mat-form-field>\n            <mat-form-field appearance=\"fill\">\n                <mat-label>Time</mat-label>\n                <mat-datetimepicker-toggle [for]=\"startTimePicker\" matSuffix></mat-datetimepicker-toggle>\n                <mat-datetimepicker (opened)=\"datePickerOpened()\" #startTimePicker type=\"time\" openOnFocus=\"true\"></mat-datetimepicker>\n                <input required matInput formControlName=\"startTime\" [matDatetimepicker]=\"startTimePicker\">\n            </mat-form-field>\n        </div>\n        <span class=\"title-modal\">Stop irrigation condition</span>\n        <mat-button-toggle-group formControlName=\"condition\" aria-label=\"Condition\">\n            <mat-button-toggle fxFlex value=\"consumption\">Consumption</mat-button-toggle>\n            <mat-button-toggle fxFlex value=\"duration\">Duration</mat-button-toggle>\n        </mat-button-toggle-group>\n        <section *ngIf=\"addSchedulerEventFormGroup.get('condition').value === 'consumption'\" fxLayout=\"column\">\n            <label class=\"tb-small\" style=\"padding-top: 12px; padding-bottom: 12px;\">Stop irrigation when the amount of water used reaches specified value</label>\n            <mat-form-field appearance=\"fill\">\n                <mat-label>Liters</mat-label>\n                <input required matInput formControlName=\"volumeInLitters\" type=\"number\" min=\"1\" step=\"1\">\n                <mat-error *ngIf=\"addSchedulerEventFormGroup.get('volumeInLitters').hasError('required')\">\n                      Volume in litters is required.\n                </mat-error>\n                <mat-error *ngIf=\"addSchedulerEventFormGroup.get('volumeInLitters').hasError('min')\">\n                      Volume in litters must be greater than 0.\n                </mat-error>\n            </mat-form-field>\n        </section>\n        <section *ngIf=\"addSchedulerEventFormGroup.get('condition').value === 'duration'\" fxLayout=\"column\">\n            <label class=\"tb-small\" style=\"padding-top: 12px; padding-bottom: 12px;\">Stop irrigation after the specified time</label>\n            <mat-form-field appearance=\"fill\">\n                <mat-label>Duration, min</mat-label>\n                <input required matInput formControlName=\"durationInMinutes\" type=\"number\" min=\"1\" step=\"1\">\n                <mat-error *ngIf=\"addSchedulerEventFormGroup.get('durationInMinutes').hasError('required')\">\n                      Duration is required.\n                </mat-error>\n                <mat-error *ngIf=\"addSchedulerEventFormGroup.get('durationInMinutes').hasError('min')\">\n                      Duration must be greater than 0.\n                </mat-error>\n            </mat-form-field>\n        </section>\n        <mat-slide-toggle formControlName=\"repeat\" style=\"padding-bottom: 48px;\">\n            Repeat\n        </mat-slide-toggle>\n        <section *ngIf=\"addSchedulerEventFormGroup.get('repeat').value\" fxLayout=\"column\">\n            <mat-form-field appearance=\"fill\">\n              <mat-label translate>scheduler.repeats</mat-label>\n              <mat-select matInput formControlName=\"repeatType\" required>\n                <mat-option *ngFor=\"let repeatType of schedulerRepeatTypeValues\" [value]=\"repeatType\">\n                  {{ schedulerRepeatTypes[repeatType] | translate }}\n                </mat-option>\n              </mat-select>\n            </mat-form-field>\n            <mat-form-field appearance=\"fill\" *ngIf=\"addSchedulerEventFormGroup.get('repeatType').value === 'EVERY_N_DAYS'\" style=\"padding-bottom: 16px;\">\n              <mat-label translate>scheduler.repeat-every-n-days</mat-label>\n              <input type=\"number\" min=\"1\" step=\"1\" matInput formControlName=\"days\" required>\n              <mat-error *ngIf=\"addSchedulerEventFormGroup.get('days').hasError('required')\">\n                {{ 'scheduler.repeat-days-required' | translate }}\n              </mat-error>\n              <mat-error *ngIf=\"addSchedulerEventFormGroup.get('days').hasError('min')\">\n                {{ 'scheduler.invalid-repeat-days-value' | translate }}\n              </mat-error>\n            </mat-form-field>\n            <mat-form-field appearance=\"fill\" *ngIf=\"addSchedulerEventFormGroup.get('repeatType').value === 'EVERY_N_WEEKS'\" style=\"padding-bottom: 16px;\">\n              <mat-label translate>scheduler.repeat-every-n-weeks</mat-label>\n              <input type=\"number\" min=\"1\" step=\"1\" matInput formControlName=\"weeks\" required>\n              <mat-error *ngIf=\"addSchedulerEventFormGroup.get('weeks').hasError('required')\">\n                {{ 'scheduler.repeat-weeks-required' | translate }}\n              </mat-error>\n              <mat-error *ngIf=\"addSchedulerEventFormGroup.get('days').hasError('min')\">\n                {{ 'scheduler.invalid-repeat-weeks-value' | translate }}\n              </mat-error>\n            </mat-form-field>\n            <section *ngIf=\"addSchedulerEventFormGroup.get('repeatType').value === 'TIMER'\"\n                 formGroupName=\"timerRepeat\"\n                 fxLayout=\"column\">\n              <label translate class=\"tb-small\" style=\"padding-bottom: 8px;\">scheduler.repeat-every</label>\n              <div fxLayout=\"column\" fxLayout.gt-sm=\"row\" fxLayoutGap=\"8px\">\n                <mat-form-field appearance=\"fill\" fxFlex=\"50\">\n                  <mat-label>Interval</mat-label>\n                  <input type=\"number\" min=\"0\" stype=\"any\" matInput formControlName=\"repeatInterval\" required>\n                  <mat-error *ngIf=\"addSchedulerEventFormGroup.get('timerRepeat.repeatInterval').hasError('required')\">\n                    {{ 'scheduler.time-interval-required' | translate }}\n                  </mat-error>\n                </mat-form-field>\n                <mat-form-field appearance=\"fill\" fxFlex=\"50\">\n                  <mat-label>Time unit</mat-label>\n                  <mat-select matInput formControlName=\"timeUnit\" required>\n                    <mat-option *ngFor=\"let timeUnit of schedulerTimeUnitValues\" [value]=\"timeUnit\">\n                      {{ schedulerTimeUnits[timeUnit] | translate }}\n                    </mat-option>\n                  </mat-select>\n                  <mat-error *ngIf=\"addSchedulerEventFormGroup.get('timerRepeat.timeUnit').hasError('required')\">\n                    {{ 'scheduler.time-unit-required' | translate }}\n                  </mat-error>\n                </mat-form-field>\n              </div>\n            </section>\n            <section *ngIf=\"addSchedulerEventFormGroup.get('repeatType').value === 'WEEKLY'\"\n                            formArrayName=\"weeklyRepeat\"\n                            fxLayout=\"column\" style=\"padding-bottom: 16px;\">\n                <label translate class=\"tb-small\">scheduler.repeat-on</label>\n                <span style=\"height: 16px;\"></span>\n                <div fxLayout=\"row\" fxLayoutGap=\"16px\">\n                    <ng-container *ngFor=\"let key of weeklyRepeatsKeys\">\n                        <button type=\"button\"\n                                mat-button\n                                class=\"weekly-repeat\"\n                                [color]=\"weeklyRepeatControl(key).value ? 'primary' : ''\"\n                                [ngClass]=\"{ 'mat-stroked-button': !weeklyRepeatControl(key).value, 'mat-raised-button': weeklyRepeatControl(key).value, 'no-border': weeklyRepeatControl(key).value }\"\n                                (click)=\"toggleWeeklyRepeat(key)\"\n                                matTooltip=\"{{ weeklyRepeats[key].tooltip | translate }}\"\n                                matTooltipPosition=\"above\">\n                            {{ weeklyRepeats[key].label | translate }}\n                        </button>\n                    </ng-container>\n                </div>    \n            </section>    \n            <section fxLayout=\"row\" fxLayoutAlign=\"start start\">\n              <mat-form-field appearance=\"fill\">\n                <mat-label>End date</mat-label>\n                <mat-datetimepicker-toggle [for]=\"endDatePicker\" matSuffix></mat-datetimepicker-toggle>\n                <mat-datetimepicker (opened)=\"datePickerOpened()\" #endDatePicker type=\"date\" openOnFocus=\"true\"></mat-datetimepicker>\n                <input required matInput formControlName=\"endsOnDate\" [matDatetimepicker]=\"endDatePicker\" [errorStateMatcher]=\"endsOnDateMatcher\">\n                <mat-error *ngIf=\"addSchedulerEventFormGroup.hasError('endsOnDateValidator')\">\n                  Invalid date.\n                </mat-error>\n              </mat-form-field>\n            </section>\n        </section>\n    </div>\n    <div mat-dialog-actions fxLayout=\"row\" fxLayoutAlign=\"end center\">\n        <button mat-button color=\"primary\"\n                type=\"button\"\n                [disabled]=\"(isLoading$ | async)\"\n                (click)=\"cancel()\" cdkFocusInitial>\n            Cancel\n        </button>\n        <button mat-button mat-raised-button color=\"primary\"\n                type=\"submit\"\n                [disabled]=\"(isLoading$ | async) || addSchedulerEventForm.invalid || !addSchedulerEventForm.dirty\">\n            Create\n        </button>\n    </div>\n</form>\n",
                "customCss": ".sf-scheduler-event-form .mat-toolbar.mat-primary {\n    background: #fff;\n    color: rgba(0, 0, 0, 0.87);\n}\n\n.sf-scheduler-event-form .mat-button.mat-primary, .sf-scheduler-event-form .mat-icon-button.mat-primary, .sf-scheduler-event-form .mat-stroked-button.mat-primary {\n    color: #5553AF;\n}\n\n.sf-scheduler-event-form .mat-fab.mat-primary, .sf-scheduler-event-form .mat-flat-button.mat-primary, .sf-scheduler-event-form .mat-mini-fab.mat-primary, .sf-scheduler-event-form .mat-raised-button.mat-primary {\n    color: #fff;\n}\n\n.sf-scheduler-event-form .mat-fab.mat-primary, .sf-scheduler-event-form .mat-flat-button.mat-primary, .sf-scheduler-event-form .mat-mini-fab.mat-primary, .sf-scheduler-event-form .mat-raised-button.mat-primary {\n    background-color: #6F74F2;\n}\n\n.sf-scheduler-event-form .mat-button.mat-primary .mat-button-focus-overlay, .sf-scheduler-event-form .mat-icon-button.mat-primary .mat-button-focus-overlay, .sf-scheduler-event-form .mat-stroked-button.mat-primary .mat-button-focus-overlay {\n    background-color: #6F74F2;\n}\n\n.sf-scheduler-event-form .mat-form-field.mat-focused .mat-form-field-label {\n    color: #5553AF;\n}\n\n.sf-scheduler-event-form .mat-form-field.mat-focused .mat-form-field-ripple {\n    background-color: #6F74F2;\n}\n\n.sf-scheduler-event-form .mat-slide-toggle.mat-checked .mat-ripple-element, .sf-scheduler-event-form .mat-slide-toggle.mat-checked .mat-slide-toggle-thumb {\n    background-color: #6F74F2;\n}\n\n.sf-scheduler-event-form .mat-slide-toggle.mat-checked .mat-slide-toggle-bar {\n    background-color: rgba(111, 116, 242, 0.54);\n}\n\n.sf-scheduler-event-form .mat-datetimepicker-calendar-header {\n    background-color: #6F74F2;\n}\n\n.sf-scheduler-event-form .mat-datetimepicker-calendar-body-cell-content.mat-datetimepicker-calendar-body-selected {\n    background-color: #6F74F2;\n}\n\n.sf-scheduler-event-form .mat-datetimepicker-clock-cell.mat-datetimepicker-clock-cell-selected {\n    background-color: #8689f4;\n}\n\n.sf-scheduler-event-form .mat-datetimepicker-clock-center, .sf-scheduler-event-form .mat-datetimepicker-clock-hand, .sf-scheduler-event-form .mat-datetimepicker-clock-hand:before {\n    background-color: #6F74F2;\n}\n\n.sf-scheduler-event-form .mat-datetimepicker-calendar-body-cell-content.mat-datetimepicker-calendar-body-today:not(.mat-datetimepicker-calendar-body-selected) {\n    border-color: #6F74F2;\n}\n\n.sf-scheduler-event-form .mat-icon {\n    color: #868D9C;\n}\n\n.sf-scheduler-event-form .title-modal {\n    font-weight: 500;\n    font-size: 16px;\n    line-height: 130%;\n    color: #868D9C;\n    padding-bottom: 8px;\n}\n\n.sf-scheduler-event-form .mat-button-toggle-group-appearance-standard, .sf-scheduler-event-form .mat-button-toggle-standalone.mat-button-toggle-appearance-standard {\n    border: none;\n}\n\n.sf-scheduler-event-form .mat-button-toggle {\n    background: rgba(0, 0, 0, 0.06);\n    height: 32px;\n    align-items: center;\n    display: flex;\n}\n\n.sf-scheduler-event-form .mat-button-toggle-checked .mat-button-toggle-button {\n    background-color: #fff;\n    border-radius: 4px;\n    margin-left: 2px;\n    margin-right: 2px;\n}\n\n.sf-scheduler-event-form .mat-button-toggle-appearance-standard .mat-button-toggle-label-content {\n    line-height: 28px;\n    font-size: 14px;\n}\n\n.sf-scheduler-event-form .mat-button-toggle-group-appearance-standard .mat-button-toggle+.mat-button-toggle {\n    border-left: none;\n}\n\n.sf-scheduler-event-form .mat-button-toggle-checked.mat-button-toggle-appearance-standard:not(.mat-button-toggle-disabled):hover .mat-button-toggle-focus-overlay {\n    opacity: .01;\n}\n\n.sf-scheduler-event-form .mat-button.weekly-repeat {\n    padding: 0 15px;\n    min-width: 0;\n}\n\n.sf-scheduler-event-form .mat-button.weekly-repeat.no-border {\n    padding: 0 16px;\n}\n",
                "customFunction": "let $injector = widgetContext.$scope.$injector;\nlet customDialog = $injector.get(widgetContext.servicesMap.get('customDialog'));\nlet schedulerEventService = $injector.get(widgetContext.servicesMap.get('schedulerEventService'));\n\nopenAddSchedulerEventDialog();\n\nfunction openAddSchedulerEventDialog() {\n    customDialog.customDialog(htmlTemplate, AddSchedulerEventDialogController).subscribe();\n}\n\n\nfunction AddSchedulerEventDialogController(instance) {\n    let vm = instance;\n\n    var currentDate = new Date();\n    var startDate = new Date(\n      currentDate.getFullYear(),\n      currentDate.getMonth(),\n      currentDate.getDate());\n    var startTime = new Date(\n      currentDate.getFullYear(),\n      currentDate.getMonth(),\n      currentDate.getDate(),\n      0,0,0,0);\n\n    vm.schedulerRepeatTypes = {\n        'DAILY': 'scheduler.daily',\n        'EVERY_N_DAYS': 'scheduler.every-n-days',\n        'WEEKLY': 'scheduler.weekly',\n        'EVERY_N_WEEKS': 'scheduler.every-n-weeks',\n        'MONTHLY': 'scheduler.monthly',\n        'YEARLY': 'scheduler.yearly',\n        'TIMER': 'scheduler.timer'\n    };\n\n      \n    vm.schedulerRepeatTypeValues = Object.keys(vm.schedulerRepeatTypes);\n    \n    vm.schedulerTimeUnits = {\n        'HOURS': 'scheduler.hours',\n        'MINUTES': 'scheduler.minutes',\n        'SECONDS': 'scheduler.seconds'\n    };\n\n      \n    vm.schedulerTimeUnitValues = Object.keys(vm.schedulerTimeUnits);\n    \n    vm.weeklyRepeats = {\n      0: { label: 'scheduler.sunday-label', tooltip: 'scheduler.repeat-on-sunday' },  \n      1: { label: 'scheduler.monday-label', tooltip: 'scheduler.repeat-on-monday' },\n      2: { label: 'scheduler.tuesday-label', tooltip: 'scheduler.repeat-on-tuesday' },\n      3: { label: 'scheduler.wednesday-label', tooltip: 'scheduler.repeat-on-wednesday' },\n      4: { label: 'scheduler.thursday-label', tooltip: 'scheduler.repeat-on-thursday' },\n      5: { label: 'scheduler.friday-label', tooltip: 'scheduler.repeat-on-friday' },\n      6: { label: 'scheduler.saturday-label', tooltip: 'scheduler.repeat-on-saturday' },\n    };\n    \n    vm.weeklyRepeatsKeys = Object.keys(vm.weeklyRepeats);\n    \n    vm.weeklyRepeatControl  = function(index) {\n        return vm.addSchedulerEventFormGroup.get('weeklyRepeat').at(index);\n    }\n    \n    vm.toggleWeeklyRepeat = function(key) {\n        const control = vm.weeklyRepeatControl(key);\n        control.setValue(!control.value);\n        vm.addSchedulerEventFormGroup.get('weeklyRepeat').markAsDirty();\n    }\n    \n    vm.createDefaultWeeklyRepeat = function(startDate, weeklyRepeat) {\n        if (!weeklyRepeat) {\n          weeklyRepeat = [];\n          for (let i = 0; i < 7; i++) {\n            weeklyRepeat[i] = false;\n          }\n        }\n        if (typeof startDate !== 'undefined' && startDate !== null) {\n          const setCurrentDate = weeklyRepeat.filter(repeat => repeat).length === 0;\n          if (setCurrentDate) {\n            const day = moment(startDate).day();\n            weeklyRepeat[day] = true;\n          }\n        }\n        return weeklyRepeat;\n    }\n    \n    vm.endsOnDateValidator = function(startDate, endsOnDate) {\n        return (group) => {\n          if (group.controls[endsOnDate].status === 'VALID') {\n            if (group.controls[startDate].value.getTime() > group.controls[endsOnDate].value.getTime()) {\n              return { endsOnDateValidator: true };\n            }\n          }\n          return null;\n        };\n    };\n    \n    vm.endsOnDateMatcher = {\n        isErrorState: function(control) {\n            const invalidCtrl = control && !!(control.invalid);\n            const invalidParent = control && !!(control.parent &&\n            control.parent.invalid && control.parent.hasError('endsOnDateValidator'));\n            return (invalidCtrl || invalidParent);\n        }\n    };\n    \n    vm.datePickerOpened = function() {\n      $('.mat-datetimepicker-popup').addClass('sf-scheduler-event-form');\n    };\n\n\n    vm.addSchedulerEventFormGroup = vm.fb.group({\n      name: ['', [vm.validators.required]],\n      startDate: [startDate, [vm.validators.required]],\n      startTime: [startTime, [vm.validators.required]],\n      condition: ['consumption', []],\n      volumeInLitters: [1000, [vm.validators.required, vm.validators.min(1)]],\n      durationInMinutes: [30, [vm.validators.required, vm.validators.min(1)]],\n      repeat: [null, []],\n      repeatType: [null, [vm.validators.required]],\n      weeklyRepeat: vm.fb.array(vm.createDefaultWeeklyRepeat()),\n      endsOnDate: [null, [vm.validators.required]],\n      days: [null, [vm.validators.min(1), vm.validators.required]],\n      weeks: [null, [vm.validators.min(1), vm.validators.required]],\n      timerRepeat: vm.fb.group(\n        {\n          repeatInterval: [null, [vm.validators.required, vm.validators.min(0)]],\n          timeUnit: [null, [vm.validators.required]]\n        }\n      )\n    },\n    {\n        validator: vm.endsOnDateValidator('startDate', 'endsOnDate')\n    });\n    \n    vm.addSchedulerEventFormGroup.get('repeat').valueChanges.subscribe((repeat) => {\n      if (repeat) {\n        vm.addSchedulerEventFormGroup.get('repeatType').patchValue('DAILY', {emitEvent: false});\n        const startDate = vm.addSchedulerEventFormGroup.get('startDate').value;\n        const endsOnDate = new Date(\n          startDate.getFullYear(),\n          startDate.getMonth(),\n          startDate.getDate() + 5);\n        vm.addSchedulerEventFormGroup.get('endsOnDate').patchValue(endsOnDate, {emitEvent: false});\n      }\n      vm.updateEnabledState();\n    });\n    \n    vm.addSchedulerEventFormGroup.get('repeatType').valueChanges.subscribe((repeatType) => {\n      if (repeatType === 'WEEKLY') {\n          const startDate = vm.addSchedulerEventFormGroup.get('startDate').value;\n          vm.addSchedulerEventFormGroup.get('weeklyRepeat').patchValue(vm.createDefaultWeeklyRepeat(startDate), {emitEvent: false});\n      }\n      vm.updateEnabledState();\n    });\n    \n    vm.addSchedulerEventFormGroup.get('weeklyRepeat').valueChanges.subscribe((weeklyRepeat) => {\n      const startDate = vm.addSchedulerEventFormGroup.get('startDate').value;\n      vm.addSchedulerEventFormGroup.get('weeklyRepeat').patchValue(vm.createDefaultWeeklyRepeat(startDate, weeklyRepeat),\n        {emitEvent: false});\n    });\n    \n    vm.addSchedulerEventFormGroup.get('condition').valueChanges.subscribe(() => {\n      vm.updateEnabledState();\n    });\n\n    vm.cancel = function() {\n        vm.dialogRef.close(null);\n    };\n    \n    vm.updateEnabledState = function() {\n        vm.addSchedulerEventFormGroup.enable({emitEvent: false});\n        const repeat = vm.addSchedulerEventFormGroup.get('repeat').value;\n        const condition = vm.addSchedulerEventFormGroup.get('condition').value;\n        if (!repeat) {\n            vm.addSchedulerEventFormGroup.get('repeatType').disable({emitEvent: false});\n            vm.addSchedulerEventFormGroup.get('weeklyRepeat').disable({emitEvent: false});\n            vm.addSchedulerEventFormGroup.get('endsOnDate').disable({emitEvent: false});\n            vm.addSchedulerEventFormGroup.get('timerRepeat').disable({emitEvent: false});\n            vm.addSchedulerEventFormGroup.get('days').disable({emitEvent: false});\n            vm.addSchedulerEventFormGroup.get('weeks').disable({emitEvent: false});\n        } else {\n            const repeatType = vm.addSchedulerEventFormGroup.get('repeatType').value;\n            if (repeatType !== 'WEEKLY') {\n                vm.addSchedulerEventFormGroup.get('weeklyRepeat').disable({emitEvent: false});\n            }\n            if (repeatType !== 'TIMER') {\n                vm.addSchedulerEventFormGroup.get('timerRepeat').disable({emitEvent: false});\n            }\n            if (repeatType !== 'EVERY_N_DAYS') {\n                vm.addSchedulerEventFormGroup.get('days').disable({emitEvent: false});\n            }\n            if (repeatType !== 'EVERY_N_WEEKS') {\n                vm.addSchedulerEventFormGroup.get('weeks').disable({emitEvent: false});\n            }\n        }\n        if (condition === 'consumption') {\n            vm.addSchedulerEventFormGroup.get('durationInMinutes').disable({emitEvent: false});\n        } else {\n            vm.addSchedulerEventFormGroup.get('volumeInLitters').disable({emitEvent: false});\n        }\n        \n        vm.addSchedulerEventFormGroup.get('repeatType').updateValueAndValidity({emitEvent: false});\n        vm.addSchedulerEventFormGroup.get('weeklyRepeat').updateValueAndValidity({emitEvent: false});\n        vm.addSchedulerEventFormGroup.get('endsOnDate').updateValueAndValidity({emitEvent: false});\n        vm.addSchedulerEventFormGroup.get('timerRepeat').updateValueAndValidity({emitEvent: false});\n        vm.addSchedulerEventFormGroup.get('days').updateValueAndValidity({emitEvent: false});\n        vm.addSchedulerEventFormGroup.get('weeks').updateValueAndValidity({emitEvent: false});\n        vm.addSchedulerEventFormGroup.get('durationInMinutes').updateValueAndValidity({emitEvent: false});\n        vm.addSchedulerEventFormGroup.get('volumeInLitters').updateValueAndValidity({emitEvent: false});\n    };\n    \n    vm.save = function() {\n        vm.addSchedulerEventFormGroup.markAsPristine();\n        saveSchedulerEventObservable().subscribe(\n            function () {\n                widgetContext.updateAliases();\n                vm.dialogRef.close(null);\n            }\n        );\n    };\n    \n    vm.updateEnabledState();\n\n    function saveSchedulerEventObservable() {\n        const formValues = vm.addSchedulerEventFormGroup.value;\n        let schedulerEvent = {\n            name: formValues.name,\n            type: 'Irrigation',\n            originatorId: widgetContext.stateController.getStateParams().entityId,\n            schedule: {\n                timezone: moment.tz.guess()\n            },\n            configuration: {\n                msgType: 'SF_START_IRRIGATION',\n                msgBody: {}\n            }\n        };\n        const startDateValue = formValues.startDate;\n        const startTimeValue = formValues.startTime;\n        const startTime = new Date(\n            startDateValue.getFullYear(),\n            startDateValue.getMonth(),\n            startDateValue.getDate(),\n            startTimeValue.getHours(),\n            startTimeValue.getMinutes(),\n            startTimeValue.getSeconds()\n        );\n        schedulerEvent.schedule.startTime = startTime.getTime();\n        if (formValues.repeat) {\n            schedulerEvent.schedule.repeat = {\n                type: formValues.repeatType,\n                endsOn: formValues.endsOnDate.getTime()\n            };\n            if (formValues.repeatType === 'WEEKLY') {\n                schedulerEvent.schedule.repeat.repeatOn = [];\n                for (let i = 0; i < 7; i++) {\n                    if (formValues.weeklyRepeat[i]) {\n                        schedulerEvent.schedule.repeat.repeatOn.push(i);\n                    }\n                }\n            } else if (formValues.repeatType === 'TIMER') {\n                schedulerEvent.schedule.repeat.repeatInterval = formValues.timerRepeat.repeatInterval;\n                schedulerEvent.schedule.repeat.timeUnit = formValues.timerRepeat.timeUnit;\n            } else if (formValues.repeatType === 'EVERY_N_DAYS') {\n                schedulerEvent.schedule.repeat.days = formValues.days;\n            } else if (formValues.repeatType === 'EVERY_N_WEEKS') {\n                schedulerEvent.schedule.repeat.weeks = formValues.weeks;\n            }\n        }\n        const condition = formValues.condition;\n        if (condition === 'consumption') {\n            schedulerEvent.configuration.msgBody.volumeInLitters = formValues.volumeInLitters;\n        } else {\n            schedulerEvent.configuration.msgBody.durationInMinutes = formValues.durationInMinutes;\n        }\n        return schedulerEventService.saveSchedulerEvent(schedulerEvent);\n    }\n\n}\n",
                "customResources": [],
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "0055529f-4ce0-f8c3-12b6-c466af22b063"
              }
            ],
            "actionCellButton": [
              {
                "name": "Edit irrigation schedule",
                "icon": "edit",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "customPretty",
                "customHtml": "<form #addSchedulerEventForm=\"ngForm\" [formGroup]=\"editSchedulerEventFormGroup\"\n      (ngSubmit)=\"save()\" class=\"sf-scheduler-event-form\">\n    <mat-toolbar fxLayout=\"row\" color=\"primary\">\n        <h2>Edit irrigation schedule '{{ entityName }}'</h2>\n        <span fxFlex></span>\n        <button mat-icon-button (click)=\"cancel()\" type=\"button\">\n            <mat-icon class=\"material-icons\">close</mat-icon>\n        </button>\n    </mat-toolbar>\n    <mat-progress-bar color=\"warn\" mode=\"indeterminate\" *ngIf=\"isLoading$ | async\">\n    </mat-progress-bar>\n    <div style=\"height: 4px;\" *ngIf=\"!(isLoading$ | async)\"></div>\n    <div mat-dialog-content fxLayout=\"column\">\n        <div fxLayout=\"row\" fxLayoutGap=\"8px\" fxLayout.xs=\"column\"  fxLayoutGap.xs=\"0\">\n            <mat-form-field fxFlex class=\"mat-block\">\n                <mat-label>Name</mat-label>\n                <input matInput formControlName=\"name\" required>\n                <mat-error *ngIf=\"editSchedulerEventFormGroup.get('name').hasError('required')\">\n                    Name is required.\n                </mat-error>\n            </mat-form-field>\n        </div>\n        <span class=\"title-modal\">Start</span>\n        <div fxLayout=\"row\" fxLayoutGap=\"8px\" fxLayout.xs=\"column\"  fxLayoutGap.xs=\"0\">\n            <mat-form-field appearance=\"fill\">\n                <mat-label>Date</mat-label>\n                <mat-datetimepicker-toggle [for]=\"startDatePicker\" matSuffix></mat-datetimepicker-toggle>\n                <mat-datetimepicker (opened)=\"datePickerOpened()\" #startDatePicker type=\"date\" openOnFocus=\"true\"></mat-datetimepicker>\n                <input required matInput formControlName=\"startDate\" [matDatetimepicker]=\"startDatePicker\">\n            </mat-form-field>\n            <mat-form-field appearance=\"fill\">\n                <mat-label>Time</mat-label>\n                <mat-datetimepicker-toggle [for]=\"startTimePicker\" matSuffix></mat-datetimepicker-toggle>\n                <mat-datetimepicker (opened)=\"datePickerOpened()\" #startTimePicker type=\"time\" openOnFocus=\"true\"></mat-datetimepicker>\n                <input required matInput formControlName=\"startTime\" [matDatetimepicker]=\"startTimePicker\">\n            </mat-form-field>\n        </div>\n        <span class=\"title-modal\">Stop irrigation condition</span>\n        <mat-button-toggle-group formControlName=\"condition\" aria-label=\"Condition\">\n            <mat-button-toggle fxFlex value=\"consumption\">Consumption</mat-button-toggle>\n            <mat-button-toggle fxFlex value=\"duration\">Duration</mat-button-toggle>\n        </mat-button-toggle-group>\n        <section *ngIf=\"editSchedulerEventFormGroup.get('condition').value === 'consumption'\" fxLayout=\"column\">\n            <label class=\"tb-small\" style=\"padding-top: 12px; padding-bottom: 12px;\">Stop irrigation when the amount of water used reaches specified value</label>\n            <mat-form-field appearance=\"fill\">\n                <mat-label>Liters</mat-label>\n                <input required matInput formControlName=\"volumeInLitters\" type=\"number\" min=\"1\" step=\"1\">\n                <mat-error *ngIf=\"editSchedulerEventFormGroup.get('volumeInLitters').hasError('required')\">\n                      Volume in litters is required.\n                </mat-error>\n                <mat-error *ngIf=\"editSchedulerEventFormGroup.get('volumeInLitters').hasError('min')\">\n                      Volume in litters must be greater than 0.\n                </mat-error>\n            </mat-form-field>\n        </section>\n        <section *ngIf=\"editSchedulerEventFormGroup.get('condition').value === 'duration'\" fxLayout=\"column\">\n            <label class=\"tb-small\" style=\"padding-top: 12px; padding-bottom: 12px;\">Stop irrigation after the specified time</label>\n            <mat-form-field appearance=\"fill\">\n                <mat-label>Duration, min</mat-label>\n                <input required matInput formControlName=\"durationInMinutes\" type=\"number\" min=\"1\" step=\"1\">\n                <mat-error *ngIf=\"editSchedulerEventFormGroup.get('durationInMinutes').hasError('required')\">\n                      Duration is required.\n                </mat-error>\n                <mat-error *ngIf=\"editSchedulerEventFormGroup.get('durationInMinutes').hasError('min')\">\n                      Duration must be greater than 0.\n                </mat-error>\n            </mat-form-field>\n        </section>\n        <mat-slide-toggle formControlName=\"repeat\" style=\"padding-bottom: 48px;\">\n            Repeat\n        </mat-slide-toggle>\n        <section *ngIf=\"editSchedulerEventFormGroup.get('repeat').value\" fxLayout=\"column\">\n            <mat-form-field appearance=\"fill\">\n              <mat-label translate>scheduler.repeats</mat-label>\n              <mat-select matInput formControlName=\"repeatType\" required>\n                <mat-option *ngFor=\"let repeatType of schedulerRepeatTypeValues\" [value]=\"repeatType\">\n                  {{ schedulerRepeatTypes[repeatType] | translate }}\n                </mat-option>\n              </mat-select>\n            </mat-form-field>\n            <mat-form-field appearance=\"fill\" *ngIf=\"editSchedulerEventFormGroup.get('repeatType').value === 'EVERY_N_DAYS'\" style=\"padding-bottom: 16px;\">\n              <mat-label translate>scheduler.repeat-every-n-days</mat-label>\n              <input type=\"number\" min=\"1\" step=\"1\" matInput formControlName=\"days\" required>\n              <mat-error *ngIf=\"editSchedulerEventFormGroup.get('days').hasError('required')\">\n                {{ 'scheduler.repeat-days-required' | translate }}\n              </mat-error>\n              <mat-error *ngIf=\"editSchedulerEventFormGroup.get('days').hasError('min')\">\n                {{ 'scheduler.invalid-repeat-days-value' | translate }}\n              </mat-error>\n            </mat-form-field>\n            <mat-form-field appearance=\"fill\" *ngIf=\"editSchedulerEventFormGroup.get('repeatType').value === 'EVERY_N_WEEKS'\" style=\"padding-bottom: 16px;\">\n              <mat-label translate>scheduler.repeat-every-n-weeks</mat-label>\n              <input type=\"number\" min=\"1\" step=\"1\" matInput formControlName=\"weeks\" required>\n              <mat-error *ngIf=\"editSchedulerEventFormGroup.get('weeks').hasError('required')\">\n                {{ 'scheduler.repeat-weeks-required' | translate }}\n              </mat-error>\n              <mat-error *ngIf=\"editSchedulerEventFormGroup.get('days').hasError('min')\">\n                {{ 'scheduler.invalid-repeat-weeks-value' | translate }}\n              </mat-error>\n            </mat-form-field>\n            <section *ngIf=\"editSchedulerEventFormGroup.get('repeatType').value === 'TIMER'\"\n                 formGroupName=\"timerRepeat\"\n                 fxLayout=\"column\">\n              <label translate class=\"tb-small\" style=\"padding-bottom: 8px;\">scheduler.repeat-every</label>\n              <div fxLayout=\"column\" fxLayout.gt-sm=\"row\" fxLayoutGap=\"8px\">\n                <mat-form-field appearance=\"fill\" fxFlex=\"50\">\n                  <mat-label>Interval</mat-label>\n                  <input type=\"number\" min=\"0\" stype=\"any\" matInput formControlName=\"repeatInterval\" required>\n                  <mat-error *ngIf=\"editSchedulerEventFormGroup.get('timerRepeat.repeatInterval').hasError('required')\">\n                    {{ 'scheduler.time-interval-required' | translate }}\n                  </mat-error>\n                </mat-form-field>\n                <mat-form-field appearance=\"fill\" fxFlex=\"50\">\n                  <mat-label>Time unit</mat-label>\n                  <mat-select matInput formControlName=\"timeUnit\" required>\n                    <mat-option *ngFor=\"let timeUnit of schedulerTimeUnitValues\" [value]=\"timeUnit\">\n                      {{ schedulerTimeUnits[timeUnit] | translate }}\n                    </mat-option>\n                  </mat-select>\n                  <mat-error *ngIf=\"editSchedulerEventFormGroup.get('timerRepeat.timeUnit').hasError('required')\">\n                    {{ 'scheduler.time-unit-required' | translate }}\n                  </mat-error>\n                </mat-form-field>\n              </div>\n            </section>\n            <section *ngIf=\"editSchedulerEventFormGroup.get('repeatType').value === 'WEEKLY'\"\n                            formArrayName=\"weeklyRepeat\"\n                            fxLayout=\"column\" style=\"padding-bottom: 16px;\">\n                <label translate class=\"tb-small\">scheduler.repeat-on</label>\n                <span style=\"height: 16px;\"></span>\n                <div fxLayout=\"row\" fxLayoutGap=\"16px\">\n                    <ng-container *ngFor=\"let key of weeklyRepeatsKeys\">\n                        <button type=\"button\"\n                                mat-button\n                                class=\"weekly-repeat\"\n                                [color]=\"weeklyRepeatControl(key).value ? 'primary' : ''\"\n                                [ngClass]=\"{ 'mat-stroked-button': !weeklyRepeatControl(key).value, 'mat-raised-button': weeklyRepeatControl(key).value, 'no-border': weeklyRepeatControl(key).value }\"\n                                (click)=\"toggleWeeklyRepeat(key)\"\n                                matTooltip=\"{{ weeklyRepeats[key].tooltip | translate }}\"\n                                matTooltipPosition=\"above\">\n                            {{ weeklyRepeats[key].label | translate }}\n                        </button>\n                    </ng-container>\n                </div>    \n            </section>    \n            <section fxLayout=\"row\" fxLayoutAlign=\"start start\">\n              <mat-form-field appearance=\"fill\">\n                <mat-label>End date</mat-label>\n                <mat-datetimepicker-toggle [for]=\"endDatePicker\" matSuffix></mat-datetimepicker-toggle>\n                <mat-datetimepicker (opened)=\"datePickerOpened()\" #endDatePicker type=\"date\" openOnFocus=\"true\"></mat-datetimepicker>\n                <input required matInput formControlName=\"endsOnDate\" [matDatetimepicker]=\"endDatePicker\" [errorStateMatcher]=\"endsOnDateMatcher\">\n                <mat-error *ngIf=\"editSchedulerEventFormGroup.hasError('endsOnDateValidator')\">\n                  Invalid date.\n                </mat-error>\n              </mat-form-field>\n            </section>\n        </section>\n    </div>\n    <div mat-dialog-actions fxLayout=\"row\" fxLayoutAlign=\"end center\">\n        <button mat-button color=\"primary\"\n                type=\"button\"\n                [disabled]=\"(isLoading$ | async)\"\n                (click)=\"cancel()\" cdkFocusInitial>\n            Cancel\n        </button>\n        <button mat-button mat-raised-button color=\"primary\"\n                type=\"submit\"\n                [disabled]=\"(isLoading$ | async) || addSchedulerEventForm.invalid || !addSchedulerEventForm.dirty\">\n            Save\n        </button>\n    </div>\n</form>\n",
                "customCss": ".sf-scheduler-event-form .mat-toolbar.mat-primary {\n    background: #fff;\n    color: rgba(0, 0, 0, 0.87);\n}\n\n.sf-scheduler-event-form .mat-button.mat-primary, .sf-scheduler-event-form .mat-icon-button.mat-primary, .sf-scheduler-event-form .mat-stroked-button.mat-primary {\n    color: #5553AF;\n}\n\n.sf-scheduler-event-form .mat-fab.mat-primary, .sf-scheduler-event-form .mat-flat-button.mat-primary, .sf-scheduler-event-form .mat-mini-fab.mat-primary, .sf-scheduler-event-form .mat-raised-button.mat-primary {\n    color: #fff;\n}\n\n.sf-scheduler-event-form .mat-fab.mat-primary, .sf-scheduler-event-form .mat-flat-button.mat-primary, .sf-scheduler-event-form .mat-mini-fab.mat-primary, .sf-scheduler-event-form .mat-raised-button.mat-primary {\n    background-color: #6F74F2;\n}\n\n.sf-scheduler-event-form .mat-button.mat-primary .mat-button-focus-overlay, .sf-scheduler-event-form .mat-icon-button.mat-primary .mat-button-focus-overlay, .sf-scheduler-event-form .mat-stroked-button.mat-primary .mat-button-focus-overlay {\n    background-color: #6F74F2;\n}\n\n.sf-scheduler-event-form .mat-form-field.mat-focused .mat-form-field-label {\n    color: #5553AF;\n}\n\n.sf-scheduler-event-form .mat-form-field.mat-focused .mat-form-field-ripple {\n    background-color: #6F74F2;\n}\n\n.sf-scheduler-event-form .mat-slide-toggle.mat-checked .mat-ripple-element, .sf-scheduler-event-form .mat-slide-toggle.mat-checked .mat-slide-toggle-thumb {\n    background-color: #6F74F2;\n}\n\n.sf-scheduler-event-form .mat-slide-toggle.mat-checked .mat-slide-toggle-bar {\n    background-color: rgba(111, 116, 242, 0.54);\n}\n\n.sf-scheduler-event-form .mat-datetimepicker-calendar-header {\n    background-color: #6F74F2;\n}\n\n.sf-scheduler-event-form .mat-datetimepicker-calendar-body-cell-content.mat-datetimepicker-calendar-body-selected {\n    background-color: #6F74F2;\n}\n\n.sf-scheduler-event-form .mat-datetimepicker-clock-cell.mat-datetimepicker-clock-cell-selected {\n    background-color: #8689f4;\n}\n\n.sf-scheduler-event-form .mat-datetimepicker-clock-center, .sf-scheduler-event-form .mat-datetimepicker-clock-hand, .sf-scheduler-event-form .mat-datetimepicker-clock-hand:before {\n    background-color: #6F74F2;\n}\n\n.sf-scheduler-event-form .mat-datetimepicker-calendar-body-cell-content.mat-datetimepicker-calendar-body-today:not(.mat-datetimepicker-calendar-body-selected) {\n    border-color: #6F74F2;\n}\n\n.sf-scheduler-event-form .mat-icon {\n    color: #868D9C;\n}\n\n.sf-scheduler-event-form .title-modal {\n    font-weight: 500;\n    font-size: 16px;\n    line-height: 130%;\n    color: #868D9C;\n    padding-bottom: 8px;\n}\n\n.sf-scheduler-event-form .mat-button-toggle-group-appearance-standard, .sf-scheduler-event-form .mat-button-toggle-standalone.mat-button-toggle-appearance-standard {\n    border: none;\n}\n\n.sf-scheduler-event-form .mat-button-toggle {\n    background: rgba(0, 0, 0, 0.06);\n    height: 32px;\n    align-items: center;\n    display: flex;\n}\n\n.sf-scheduler-event-form .mat-button-toggle-checked .mat-button-toggle-button {\n    background-color: #fff;\n    border-radius: 4px;\n    margin-left: 2px;\n    margin-right: 2px;\n}\n\n.sf-scheduler-event-form .mat-button-toggle-appearance-standard .mat-button-toggle-label-content {\n    line-height: 28px;\n    font-size: 14px;\n}\n\n.sf-scheduler-event-form .mat-button-toggle-group-appearance-standard .mat-button-toggle+.mat-button-toggle {\n    border-left: none;\n}\n\n.sf-scheduler-event-form .mat-button-toggle-checked.mat-button-toggle-appearance-standard:not(.mat-button-toggle-disabled):hover .mat-button-toggle-focus-overlay {\n    opacity: .01;\n}\n\n.sf-scheduler-event-form .mat-button.weekly-repeat {\n    padding: 0 15px;\n    min-width: 0;\n}\n\n.sf-scheduler-event-form .mat-button.weekly-repeat.no-border {\n    padding: 0 16px;\n}\n",
                "customFunction": "let $injector = widgetContext.$scope.$injector;\nlet customDialog = $injector.get(widgetContext.servicesMap.get('customDialog'));\nlet schedulerEventService = $injector.get(widgetContext.servicesMap.get('schedulerEventService'));\n\nopenEditSchedulerEventDialog();\n\nfunction openEditSchedulerEventDialog() {\n    customDialog.customDialog(htmlTemplate, EditSchedulerEventDialogController).subscribe();\n}\n\n\nfunction EditSchedulerEventDialogController(instance) {\n    let vm = instance;\n    \n    vm.entityName = entityName;\n    \n    vm.schedulerEvent = null;\n\n    var currentDate = new Date();\n    var startDate = new Date(\n      currentDate.getFullYear(),\n      currentDate.getMonth(),\n      currentDate.getDate());\n    var startTime = new Date(\n      currentDate.getFullYear(),\n      currentDate.getMonth(),\n      currentDate.getDate(),\n      0,0,0,0);\n\n    vm.schedulerRepeatTypes = {\n        'DAILY': 'scheduler.daily',\n        'EVERY_N_DAYS': 'scheduler.every-n-days',\n        'WEEKLY': 'scheduler.weekly',\n        'EVERY_N_WEEKS': 'scheduler.every-n-weeks',\n        'MONTHLY': 'scheduler.monthly',\n        'YEARLY': 'scheduler.yearly',\n        'TIMER': 'scheduler.timer'\n    };\n\n      \n    vm.schedulerRepeatTypeValues = Object.keys(vm.schedulerRepeatTypes);\n    \n    vm.schedulerTimeUnits = {\n        'HOURS': 'scheduler.hours',\n        'MINUTES': 'scheduler.minutes',\n        'SECONDS': 'scheduler.seconds'\n    };\n\n      \n    vm.schedulerTimeUnitValues = Object.keys(vm.schedulerTimeUnits);\n    \n    vm.weeklyRepeats = {\n      0: { label: 'scheduler.sunday-label', tooltip: 'scheduler.repeat-on-sunday' },  \n      1: { label: 'scheduler.monday-label', tooltip: 'scheduler.repeat-on-monday' },\n      2: { label: 'scheduler.tuesday-label', tooltip: 'scheduler.repeat-on-tuesday' },\n      3: { label: 'scheduler.wednesday-label', tooltip: 'scheduler.repeat-on-wednesday' },\n      4: { label: 'scheduler.thursday-label', tooltip: 'scheduler.repeat-on-thursday' },\n      5: { label: 'scheduler.friday-label', tooltip: 'scheduler.repeat-on-friday' },\n      6: { label: 'scheduler.saturday-label', tooltip: 'scheduler.repeat-on-saturday' },\n    };\n    \n    vm.weeklyRepeatsKeys = Object.keys(vm.weeklyRepeats);\n    \n    vm.weeklyRepeatControl  = function(index) {\n        return vm.editSchedulerEventFormGroup.get('weeklyRepeat').at(index);\n    }\n    \n    vm.toggleWeeklyRepeat = function(key) {\n        const control = vm.weeklyRepeatControl(key);\n        control.setValue(!control.value);\n        vm.editSchedulerEventFormGroup.get('weeklyRepeat').markAsDirty();\n    }\n    \n    vm.createDefaultWeeklyRepeat = function(startDate, weeklyRepeat) {\n        if (!weeklyRepeat) {\n          weeklyRepeat = [];\n          for (let i = 0; i < 7; i++) {\n            weeklyRepeat[i] = false;\n          }\n        }\n        if (typeof startDate !== 'undefined' && startDate !== null) {\n          const setCurrentDate = weeklyRepeat.filter(repeat => repeat).length === 0;\n          if (setCurrentDate) {\n            const day = moment(startDate).day();\n            weeklyRepeat[day] = true;\n          }\n        }\n        return weeklyRepeat;\n    }\n    \n    vm.endsOnDateValidator = function(startDate, endsOnDate) {\n        return (group) => {\n          if (group.controls[endsOnDate].status === 'VALID') {\n            if (group.controls[startDate].value.getTime() > group.controls[endsOnDate].value.getTime()) {\n              return { endsOnDateValidator: true };\n            }\n          }\n          return null;\n        };\n    };\n    \n    vm.endsOnDateMatcher = {\n        isErrorState: function(control) {\n            const invalidCtrl = control && !!(control.invalid);\n            const invalidParent = control && !!(control.parent &&\n            control.parent.invalid && control.parent.hasError('endsOnDateValidator'));\n            return (invalidCtrl || invalidParent);\n        }\n    };\n    \n    vm.datePickerOpened = function() {\n      $('.mat-datetimepicker-popup').addClass('sf-scheduler-event-form');\n    };\n\n\n    vm.editSchedulerEventFormGroup = vm.fb.group({\n      name: ['', [vm.validators.required]],\n      startDate: [startDate, [vm.validators.required]],\n      startTime: [startTime, [vm.validators.required]],\n      condition: ['consumption', []],\n      volumeInLitters: [1000, [vm.validators.required, vm.validators.min(1)]],\n      durationInMinutes: [30, [vm.validators.required, vm.validators.min(1)]],\n      repeat: [null, []],\n      repeatType: [null, [vm.validators.required]],\n      weeklyRepeat: vm.fb.array(vm.createDefaultWeeklyRepeat()),\n      endsOnDate: [null, [vm.validators.required]],\n      days: [null, [vm.validators.min(1), vm.validators.required]],\n      weeks: [null, [vm.validators.min(1), vm.validators.required]],\n      timerRepeat: vm.fb.group(\n        {\n          repeatInterval: [null, [vm.validators.required, vm.validators.min(0)]],\n          timeUnit: [null, [vm.validators.required]]\n        }\n      )\n    },\n    {\n        validator: vm.endsOnDateValidator('startDate', 'endsOnDate')\n    });\n    \n    vm.editSchedulerEventFormGroup.get('repeat').valueChanges.subscribe((repeat) => {\n      if (repeat) {\n        vm.editSchedulerEventFormGroup.get('repeatType').patchValue('DAILY', {emitEvent: false});\n        const startDate = vm.editSchedulerEventFormGroup.get('startDate').value;\n        const endsOnDate = new Date(\n          startDate.getFullYear(),\n          startDate.getMonth(),\n          startDate.getDate() + 5);\n        vm.editSchedulerEventFormGroup.get('endsOnDate').patchValue(endsOnDate, {emitEvent: false});\n      }\n      vm.updateEnabledState();\n    });\n    \n    vm.editSchedulerEventFormGroup.get('repeatType').valueChanges.subscribe((repeatType) => {\n      if (repeatType === 'WEEKLY') {\n          const startDate = vm.editSchedulerEventFormGroup.get('startDate').value;\n          vm.editSchedulerEventFormGroup.get('weeklyRepeat').patchValue(vm.createDefaultWeeklyRepeat(startDate), {emitEvent: false});\n      }\n      vm.updateEnabledState();\n    });\n    \n    vm.editSchedulerEventFormGroup.get('weeklyRepeat').valueChanges.subscribe((weeklyRepeat) => {\n      const startDate = vm.editSchedulerEventFormGroup.get('startDate').value;\n      vm.editSchedulerEventFormGroup.get('weeklyRepeat').patchValue(vm.createDefaultWeeklyRepeat(startDate, weeklyRepeat),\n        {emitEvent: false});\n    });\n    \n    vm.editSchedulerEventFormGroup.get('condition').valueChanges.subscribe(() => {\n      vm.updateEnabledState();\n    });\n\n    vm.cancel = function() {\n        vm.dialogRef.close(null);\n    };\n    \n    vm.updateEnabledState = function() {\n        vm.editSchedulerEventFormGroup.enable({emitEvent: false});\n        const repeat = vm.editSchedulerEventFormGroup.get('repeat').value;\n        const condition = vm.editSchedulerEventFormGroup.get('condition').value;\n        if (!repeat) {\n            vm.editSchedulerEventFormGroup.get('repeatType').disable({emitEvent: false});\n            vm.editSchedulerEventFormGroup.get('weeklyRepeat').disable({emitEvent: false});\n            vm.editSchedulerEventFormGroup.get('endsOnDate').disable({emitEvent: false});\n            vm.editSchedulerEventFormGroup.get('timerRepeat').disable({emitEvent: false});\n            vm.editSchedulerEventFormGroup.get('days').disable({emitEvent: false});\n            vm.editSchedulerEventFormGroup.get('weeks').disable({emitEvent: false});\n        } else {\n            const repeatType = vm.editSchedulerEventFormGroup.get('repeatType').value;\n            if (repeatType !== 'WEEKLY') {\n                vm.editSchedulerEventFormGroup.get('weeklyRepeat').disable({emitEvent: false});\n            }\n            if (repeatType !== 'TIMER') {\n                vm.editSchedulerEventFormGroup.get('timerRepeat').disable({emitEvent: false});\n            }\n            if (repeatType !== 'EVERY_N_DAYS') {\n                vm.editSchedulerEventFormGroup.get('days').disable({emitEvent: false});\n            }\n            if (repeatType !== 'EVERY_N_WEEKS') {\n                vm.editSchedulerEventFormGroup.get('weeks').disable({emitEvent: false});\n            }\n        }\n        if (condition === 'consumption') {\n            vm.editSchedulerEventFormGroup.get('durationInMinutes').disable({emitEvent: false});\n        } else {\n            vm.editSchedulerEventFormGroup.get('volumeInLitters').disable({emitEvent: false});\n        }\n        \n        vm.editSchedulerEventFormGroup.get('repeatType').updateValueAndValidity({emitEvent: false});\n        vm.editSchedulerEventFormGroup.get('weeklyRepeat').updateValueAndValidity({emitEvent: false});\n        vm.editSchedulerEventFormGroup.get('endsOnDate').updateValueAndValidity({emitEvent: false});\n        vm.editSchedulerEventFormGroup.get('timerRepeat').updateValueAndValidity({emitEvent: false});\n        vm.editSchedulerEventFormGroup.get('days').updateValueAndValidity({emitEvent: false});\n        vm.editSchedulerEventFormGroup.get('weeks').updateValueAndValidity({emitEvent: false});\n        vm.editSchedulerEventFormGroup.get('durationInMinutes').updateValueAndValidity({emitEvent: false});\n        vm.editSchedulerEventFormGroup.get('volumeInLitters').updateValueAndValidity({emitEvent: false});\n    };\n    \n    vm.save = function() {\n        vm.editSchedulerEventFormGroup.markAsPristine();\n        saveSchedulerEventObservable().subscribe(\n            function () {\n                widgetContext.updateAliases();\n                vm.dialogRef.close(null);\n            }\n        );\n    };\n    \n    loadSchedulerEvent();\n\n    function saveSchedulerEventObservable() {\n        const formValues = vm.editSchedulerEventFormGroup.value;\n        vm.schedulerEvent.name = formValues.name;\n        vm.schedulerEvent.schedule = { timezone: moment.tz.guess() };\n        const startDateValue = formValues.startDate;\n        const startTimeValue = formValues.startTime;\n        const startTime = new Date(\n            startDateValue.getFullYear(),\n            startDateValue.getMonth(),\n            startDateValue.getDate(),\n            startTimeValue.getHours(),\n            startTimeValue.getMinutes(),\n            startTimeValue.getSeconds()\n        );\n        vm.schedulerEvent.schedule.startTime = startTime.getTime();\n        if (formValues.repeat) {\n            vm.schedulerEvent.schedule.repeat = {\n                type: formValues.repeatType,\n                endsOn: formValues.endsOnDate.getTime()\n            };\n            if (formValues.repeatType === 'WEEKLY') {\n                vm.schedulerEvent.schedule.repeat.repeatOn = [];\n                for (let i = 0; i < 7; i++) {\n                    if (formValues.weeklyRepeat[i]) {\n                        vm.schedulerEvent.schedule.repeat.repeatOn.push(i);\n                    }\n                }\n            } else if (formValues.repeatType === 'TIMER') {\n                vm.schedulerEvent.schedule.repeat.repeatInterval = formValues.timerRepeat.repeatInterval;\n                vm.schedulerEvent.schedule.repeat.timeUnit = formValues.timerRepeat.timeUnit;\n            } else if (formValues.repeatType === 'EVERY_N_DAYS') {\n                vm.schedulerEvent.schedule.repeat.days = formValues.days;\n            } else if (formValues.repeatType === 'EVERY_N_WEEKS') {\n                vm.schedulerEvent.schedule.repeat.weeks = formValues.weeks;\n            }\n        } else {\n            delete vm.schedulerEvent.repeat;\n        }\n        const condition = formValues.condition;\n        vm.schedulerEvent.configuration.msgBody = {};\n        if (condition === 'consumption') {\n            vm.schedulerEvent.configuration.msgBody.volumeInLitters = formValues.volumeInLitters;\n        } else {\n            vm.schedulerEvent.configuration.msgBody.durationInMinutes = formValues.durationInMinutes;\n        }\n        return schedulerEventService.saveSchedulerEvent(vm.schedulerEvent);\n    }\n    \n    function loadSchedulerEvent() {\n        schedulerEventService.getSchedulerEvent(entityId.id).subscribe(\n            function (schedulerEvent) {\n                vm.schedulerEvent = schedulerEvent;\n                vm.editSchedulerEventFormGroup.get('name').patchValue(vm.schedulerEvent.name, {emitEvent: false});\n                \n                var startDateValue = new Date(vm.schedulerEvent.schedule.startTime);\n                var startDate = new Date(\n                  startDateValue.getFullYear(),\n                  startDateValue.getMonth(),\n                  startDateValue.getDate());\n                var startTime = new Date(\n                  startDateValue.getFullYear(),\n                  startDateValue.getMonth(),\n                  startDateValue.getDate(),\n                  startDateValue.getHours(),\n                  startDateValue.getMinutes(),\n                  startDateValue.getSeconds()\n                  ,0);\n                vm.editSchedulerEventFormGroup.get('startDate').patchValue(startDate, {emitEvent: false});\n                vm.editSchedulerEventFormGroup.get('startTime').patchValue(startTime, {emitEvent: false});\n                if (typeof vm.schedulerEvent.configuration.msgBody.volumeInLitters !== 'undefined' && \n                    vm.schedulerEvent.configuration.msgBody.volumeInLitters !== null) {\n                    vm.editSchedulerEventFormGroup.get('condition').patchValue('consumption', {emitEvent: false});\n                    vm.editSchedulerEventFormGroup.get('volumeInLitters').patchValue(vm.schedulerEvent.configuration.msgBody.volumeInLitters, {emitEvent: false});\n                } else {\n                    vm.editSchedulerEventFormGroup.get('condition').patchValue('duration', {emitEvent: false});\n                    vm.editSchedulerEventFormGroup.get('durationInMinutes').patchValue(vm.schedulerEvent.configuration.msgBody.durationInMinutes, {emitEvent: false});\n                }\n                if (vm.schedulerEvent.schedule.repeat) {\n                    vm.editSchedulerEventFormGroup.get('repeat').patchValue(true, {emitEvent: false});\n                    vm.editSchedulerEventFormGroup.get('repeatType').patchValue(vm.schedulerEvent.schedule.repeat.type, {emitEvent: false});\n                    if (vm.schedulerEvent.schedule.repeat.type === 'WEEKLY' && vm.schedulerEvent.schedule.repeat.repeatOn) {\n                        const weeklyRepeat = vm.createDefaultWeeklyRepeat();\n                        vm.schedulerEvent.schedule.repeat.repeatOn.forEach((repeatOn) => {\n                            weeklyRepeat[repeatOn] = true;\n                        });\n                        vm.editSchedulerEventFormGroup.get('weeklyRepeat').patchValue(weeklyRepeat, {emitEvent: false});\n                    } else if (vm.schedulerEvent.schedule.repeat.type === 'TIMER') {\n                        vm.editSchedulerEventFormGroup.get('timerRepeat').patchValue({\n                            repeatInterval: vm.schedulerEvent.schedule.repeat.repeatInterval,\n                            timeUnit: vm.schedulerEvent.schedule.repeat.timeUnit\n                        }, {emitEvent: false});\n                    } else if (vm.schedulerEvent.schedule.repeat.type === 'EVERY_N_DAYS') {\n                        vm.editSchedulerEventFormGroup.get('days').patchValue(vm.schedulerEvent.schedule.repeat.days, {emitEvent: false});\n                    } else if (vm.schedulerEvent.schedule.repeat.type === 'EVERY_N_WEEKS') {\n                        vm.editSchedulerEventFormGroup.get('weeks').patchValue(vm.schedulerEvent.schedule.repeat.weeks, {emitEvent: false});\n                    }\n                    vm.editSchedulerEventFormGroup.get('endsOnDate').patchValue(new Date(vm.schedulerEvent.schedule.repeat.endsOn), {emitEvent: false});\n                } else {\n                    vm.editSchedulerEventFormGroup.get('repeat').patchValue(false, {emitEvent: false});\n                }\n                \n                vm.updateEnabledState();\n            }\n        );\n    }\n\n}\n",
                "customResources": [],
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "2b9ed19c-fc5c-f3fa-c5e2-561e0ac941f4"
              },
              {
                "name": "Delete irrigation schedule",
                "icon": "delete",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "customPretty",
                "customHtml": "",
                "customCss": ".sf-scheduler-delete-dialog .mat-button.mat-primary, .sf-scheduler-delete-dialog .mat-icon-button.mat-primary, .sf-scheduler-delete-dialog .mat-stroked-button.mat-primary {\n    color: #5553AF;\n}\n\n.sf-scheduler-delete-dialog .mat-fab.mat-primary, .sf-scheduler-delete-dialog .mat-flat-button.mat-primary, .sf-scheduler-delete-dialog .mat-mini-fab.mat-primary, .sf-scheduler-delete-dialog .mat-raised-button.mat-primary {\n    color: #fff;\n}\n\n.sf-scheduler-delete-dialog .mat-fab.mat-primary, .sf-scheduler-delete-dialog .mat-flat-button.mat-primary, .sf-scheduler-delete-dialog .mat-mini-fab.mat-primary, .sf-scheduler-delete-dialog .mat-raised-button.mat-primary {\n    background-color: #6F74F2;\n}\n\n.sf-scheduler-delete-dialog .mat-button.mat-primary .mat-button-focus-overlay, .sf-scheduler-delete-dialog .mat-icon-button.mat-primary .mat-button-focus-overlay, .sf-scheduler-delete-dialog .mat-stroked-button.mat-primary .mat-button-focus-overlay {\n    background-color: #6F74F2;\n}\n",
                "customFunction": "let $injector = widgetContext.$scope.$injector;\nlet dialogs = $injector.get(widgetContext.servicesMap.get('dialogs'));\n\nlet schedulerEventService = $injector.get(widgetContext.servicesMap.get('schedulerEventService'));\n\nopenDeleteEntityDialog();\n\nfunction openDeleteEntityDialog() {\n    let title = 'Delete irrigation schedule \\'' +\n                 entityName + '\\'';\n    let content = 'Are you sure you want to delete the irrigation schedule \\'' + entityName + '\\'?';\n    dialogs.confirm(title, content, 'Cancel', 'Delete').subscribe(\n        function(result) {\n            if (result) {\n                deleteEntity();\n            }\n        }\n    );\n    $('tb-confirm-dialog').addClass('sf-scheduler-delete-dialog');\n}\n\nfunction deleteEntity() {\n    deleteEntityObservable(entityId).subscribe(\n        function success() {\n            widgetContext.updateAliases();\n        },\n        function fail() {\n            showErrorDialog();\n        }\n    );\n}\n\nfunction deleteEntityObservable(entityId) {\n    return schedulerEventService.deleteSchedulerEvent(entityId.id);\n}\n\nfunction showErrorDialog() {\n    let title = 'Error';\n    let content = 'An error occurred while deleting the irrigation schedule. Please try again.';\n    dialogs.alert(title, content, 'CLOSE').subscribe(\n        function(result) {}\n    );\n}\n",
                "customResources": [],
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "d25bf90c-9b6f-d98f-a4f0-420772761047"
              }
            ]
          }
        },
        "row": 0,
        "col": 0,
        "id": "a6b597ee-cb21-ee9f-dc98-8673f1d976f1"
      },
      "8ce15aad-9ab2-55ce-2628-a663814d27b1": {
        "isSystemType": true,
        "bundleAlias": "cards",
        "typeAlias": "entities_table",
        "type": "latest",
        "title": "New widget",
        "image": null,
        "description": null,
        "sizeX": 7.5,
        "sizeY": 6.5,
        "config": {
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY"
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1664882134049,
                "endTimeMs": 1664968534049
              },
              "quickInterval": "CURRENT_DAY"
            },
            "aggregation": {
              "type": "NONE",
              "limit": 200
            }
          },
          "showTitle": true,
          "backgroundColor": "rgb(255, 255, 255)",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "4px",
          "settings": {
            "entitiesTitle": "Fields",
            "enableSearch": true,
            "enableSelectColumnDisplay": true,
            "enableStickyHeader": true,
            "enableStickyAction": true,
            "reserveSpaceForHiddenAction": "true",
            "displayEntityName": true,
            "entityNameColumnTitle": "Name",
            "displayEntityLabel": false,
            "displayEntityType": false,
            "displayPagination": true,
            "defaultPageSize": 10,
            "defaultSortOrder": "entityName",
            "useRowStyleFunction": false
          },
          "title": "New Entities table",
          "dropShadow": false,
          "enableFullscreen": false,
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400,
            "padding": "5px 10px 5px 10px"
          },
          "useDashboardTimewindow": false,
          "showLegend": false,
          "datasources": [
            {
              "type": "entity",
              "name": null,
              "entityAliasId": "cd737d26-3068-aae0-d370-c93f8e7e1a00",
              "filterId": null,
              "dataKeys": [
                {
                  "name": "label",
                  "type": "entityField",
                  "label": "Label",
                  "color": "#2196f3",
                  "settings": {},
                  "_hash": 0.7427597097428846
                },
                {
                  "name": "cropType",
                  "type": "attribute",
                  "label": "Crop type",
                  "color": "#4caf50",
                  "settings": {},
                  "_hash": 0.45735173845667054,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ]
            }
          ],
          "displayTimewindow": true,
          "actions": {
            "rowClick": [
              {
                "name": "Field details",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "openDashboardState",
                "targetDashboardStateId": "field",
                "setEntityId": true,
                "stateEntityParamName": null,
                "openRightLayout": false,
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "9fac49b3-0e6b-9beb-56a7-6da9cec34984"
              }
            ],
            "headerButton": [
              {
                "name": "Create field",
                "icon": "add",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "customPretty",
                "customHtml": "<form #addFieldForm=\"ngForm\" [formGroup]=\"addFieldFormGroup\"\n      (ngSubmit)=\"submit()\" class=\"sf-field-form\">\n    <mat-toolbar fxLayout=\"row\" color=\"primary\">\n        <h2>{{ step === 1 ? 'Add field' : 'Setup field polygon' }}</h2>\n        <span fxFlex></span>\n        <button mat-icon-button (click)=\"cancel()\" type=\"button\">\n            <mat-icon class=\"material-icons\">close</mat-icon>\n        </button>\n    </mat-toolbar>\n    <mat-progress-bar color=\"warn\" mode=\"indeterminate\" *ngIf=\"isLoading$ | async\">\n    </mat-progress-bar>\n    <div style=\"height: 4px;\" *ngIf=\"!(isLoading$ | async)\"></div>\n    <div mat-dialog-content fxLayout=\"column\">\n        <section *ngIf=\"step === 1\" fxLayout=\"column\">\n            <div fxLayout=\"row\" fxLayoutGap=\"8px\" fxLayout.xs=\"column\"  fxLayoutGap.xs=\"0\">\n                <mat-form-field fxFlex class=\"mat-block\">\n                    <mat-label>Field Name</mat-label>\n                    <input matInput formControlName=\"name\" required>\n                    <mat-error *ngIf=\"addFieldFormGroup.get('name').hasError('required')\">\n                        Field name is required.\n                    </mat-error>\n                </mat-form-field>\n                <mat-form-field fxFlex class=\"mat-block\">\n                    <mat-label>Label</mat-label>\n                    <input matInput formControlName=\"label\">\n                </mat-form-field>\n            </div>\n            <mat-form-field appearance=\"fill\">\n              <mat-label>Crop type</mat-label>\n              <mat-select matInput formControlName=\"cropType\" required>\n                <mat-option *ngFor=\"let cropType of cropTypes\" [value]=\"cropType\">\n                  {{ cropType }}\n                </mat-option>\n              </mat-select>\n              <mat-error *ngIf=\"addFieldFormGroup.get('cropType').hasError('required')\">\n                    Crop type is required.\n              </mat-error>\n            </mat-form-field>\n        </section>\n        <section *ngIf=\"step === 2\" fxLayout=\"column\">\n            <tb-dashboard-state \n                style=\"height: 400px; width: 400px;\"\n                [ctx]=\"widgetContext\"\n                stateId=\"setup_field_polygon\"\n                [entityId]=\"field.id\">\n            </tb-dashboard-state>\n        </section>\n    </div>\n    <div mat-dialog-actions fxLayout=\"row\" fxLayoutAlign=\"end center\">\n        <button *ngIf=\"step === 1\" mat-button color=\"primary\"\n                type=\"button\"\n                [disabled]=\"(isLoading$ | async)\"\n                (click)=\"cancel()\" cdkFocusInitial>\n            Cancel\n        </button>\n        <button *ngIf=\"step === 1\" mat-button mat-raised-button color=\"primary\"\n                type=\"button\"\n                (click)=\"next()\"\n                [disabled]=\"(isLoading$ | async) || addFieldFormGroup.invalid\">\n            Next\n        </button>\n        <button *ngIf=\"step === 2\" mat-button color=\"primary\"\n                type=\"button\"\n                [disabled]=\"(isLoading$ | async)\"\n                (click)=\"back()\" cdkFocusInitial>\n            Back\n        </button>\n        <button *ngIf=\"step === 2\" mat-button mat-raised-button color=\"primary\"\n                type=\"submit\"\n                [disabled]=\"(isLoading$ | async) || addFieldFormGroup.invalid || !hasPolygon\">\n            Create\n        </button>\n    </div>\n</form>\n",
                "customCss": ".sf-field-form .mat-toolbar.mat-primary {\n    background: #fff;\n    color: rgba(0, 0, 0, 0.87);\n}\n\n.sf-field-form .mat-button.mat-primary, .sf-field-form .mat-icon-button.mat-primary, .sf-field-form .mat-stroked-button.mat-primary {\n    color: #5553AF;\n}\n\n.sf-field-form .mat-fab.mat-primary, .sf-field-form .mat-flat-button.mat-primary, .sf-field-form .mat-mini-fab.mat-primary, .sf-field-form .mat-raised-button.mat-primary {\n    color: #fff;\n}\n\n.sf-field-form .mat-fab.mat-primary, .sf-field-form .mat-flat-button.mat-primary, .sf-field-form .mat-mini-fab.mat-primary, .sf-field-form .mat-raised-button.mat-primary {\n    background-color: #6F74F2;\n}\n\n.sf-field-form .mat-button.mat-primary .mat-button-focus-overlay, .sf-field-form .mat-icon-button.mat-primary .mat-button-focus-overlay, .sf-field-form .mat-stroked-button.mat-primary .mat-button-focus-overlay {\n    background-color: #6F74F2;\n}\n\n.sf-field-form .mat-form-field.mat-focused .mat-form-field-label {\n    color: #5553AF;\n}\n\n.sf-field-form .mat-form-field.mat-focused .mat-form-field-ripple {\n    background-color: #6F74F2;\n}\n\n.sf-field-form .mat-slide-toggle.mat-checked .mat-ripple-element, .sf-field-form .mat-slide-toggle.mat-checked .mat-slide-toggle-thumb {\n    background-color: #6F74F2;\n}\n\n.sf-field-form .mat-slide-toggle.mat-checked .mat-slide-toggle-bar {\n    background-color: rgba(111, 116, 242, 0.54);\n}\n\n.sf-field-form .mat-datetimepicker-calendar-header {\n    background-color: #6F74F2;\n}\n\n.sf-field-form .mat-datetimepicker-calendar-body-cell-content.mat-datetimepicker-calendar-body-selected {\n    background-color: #6F74F2;\n}\n\n.sf-field-form .mat-datetimepicker-clock-cell.mat-datetimepicker-clock-cell-selected {\n    background-color: #8689f4;\n}\n\n.sf-field-form .mat-datetimepicker-clock-center, .sf-field-form .mat-datetimepicker-clock-hand, .sf-field-form .mat-datetimepicker-clock-hand:before {\n    background-color: #6F74F2;\n}\n\n.sf-field-form .mat-datetimepicker-calendar-body-cell-content.mat-datetimepicker-calendar-body-today:not(.mat-datetimepicker-calendar-body-selected) {\n    border-color: #6F74F2;\n}\n\n.sf-field-form .mat-icon {\n    color: #868D9C;\n}\n\n.sf-field-form .title-modal {\n    font-weight: 500;\n    font-size: 16px;\n    line-height: 130%;\n    color: #868D9C;\n    padding-bottom: 8px;\n}\n\n.sf-field-form .mat-button-toggle-group-appearance-standard, .sf-field-form .mat-button-toggle-standalone.mat-button-toggle-appearance-standard {\n    border: none;\n}\n\n.sf-field-form .mat-button-toggle {\n    background: rgba(0, 0, 0, 0.06);\n    height: 32px;\n    align-items: center;\n    display: flex;\n}\n\n.sf-field-form .mat-button-toggle-checked .mat-button-toggle-button {\n    background-color: #fff;\n    border-radius: 4px;\n    margin-left: 2px;\n    margin-right: 2px;\n}\n\n.sf-field-form .mat-button-toggle-appearance-standard .mat-button-toggle-label-content {\n    line-height: 28px;\n    font-size: 14px;\n}\n\n.sf-field-form .mat-button-toggle-group-appearance-standard .mat-button-toggle+.mat-button-toggle {\n    border-left: none;\n}\n\n.sf-field-form .mat-button-toggle-checked.mat-button-toggle-appearance-standard:not(.mat-button-toggle-disabled):hover .mat-button-toggle-focus-overlay {\n    opacity: .01;\n}\n\n.sf-field-form .mat-button.weekly-repeat {\n    padding: 0 15px;\n    min-width: 0;\n}\n\n.sf-field-form .mat-button.weekly-repeat.no-border {\n    padding: 0 16px;\n}\n",
                "customFunction": "let $injector = widgetContext.$scope.$injector;\nlet customDialog = $injector.get(widgetContext.servicesMap.get('customDialog'));\nlet assetService = $injector.get(widgetContext.servicesMap.get('assetService'));\nlet entityGroupService = $injector.get(widgetContext.servicesMap.get('entityGroupService'));\nlet attributeService = $injector.get(widgetContext.servicesMap.get('attributeService'));\n\nopenAddFieldDialog();\n\nfunction openAddFieldDialog() {\n    customDialog.customDialog(htmlTemplate, AddFieldDialogController).subscribe();\n}\n\nfunction AddFieldDialogController(instance) {\n    let vm = instance;\n    \n    vm.cropTypes = ['rice', 'wheat', \n    'sugarcane', 'maize (corn)', 'soybean oil', 'palm oil', 'potatoes',\n    'cassava', 'legume pulses', 'sunflower seed oil', 'rape and mustard oil',\n    'other vegetables', 'other fruits', 'sorghum', 'millet', 'groundnuts', 'beans',\n    'sweet potatoes', 'bananas', 'various nuts', 'soybeans', 'cottonseed oil',\n    'groundnut oil', 'yams'];\n    \n    vm.widgetContext = widgetContext;\n    vm.step = 1;\n    vm.field = null;\n    \n    vm.hasPolygon = false;\n    vm.polygonSubscription = null;\n\n\n    vm.addFieldFormGroup = vm.fb.group({\n      name: ['', [vm.validators.required]],\n      label: [null],\n      cropType: ['wheat', [vm.validators.required]]\n    });\n\n    vm.cancel = function() {\n        cancelPolygonSubscription();\n        deleteEntityObservable().subscribe(\n            function () {\n                widgetContext.updateAliases();\n                vm.dialogRef.close(null);\n            }\n        );\n    };\n\n    vm.next = function() {\n        vm.addFieldFormGroup.markAsPristine();\n        saveEntityObservable().subscribe(\n            function (entity) {\n                vm.field = entity;\n                widgetContext.rxjs.forkJoin([\n                    saveAttributes(entity.id),\n                ]).subscribe(\n                    function () {\n                        createPolygonSubscription().subscribe(\n                            function() {\n                                vm.step = 2;\n                            }\n                        );\n                    }\n                );\n            }\n        );\n    };\n    \n    vm.back = function() {\n        cancelPolygonSubscription();\n        vm.step = 1;\n    }\n    \n    vm.submit = function() {\n        widgetContext.updateAliases();\n        vm.dialogRef.close(null);\n    }\n    \n    function createPolygonSubscription() {\n        var subscriptionInfo = {\n            type: 'entity',\n            entityType: vm.field.id.entityType,\n            entityId: vm.field.id.id,\n            attributes: [{ name: 'perimeter' }]\n        };\n        var options = {\n            callbacks: {\n                onDataUpdated: function(subscription) {\n                    checkHasPolygon(subscription.data);\n                }\n            }\n        };\n        return widgetContext.subscriptionApi.createSubscriptionFromInfo(\n                            'latest', [ subscriptionInfo ], options, false, true).pipe(\n            widgetContext.rxjs.tap(function(polygonSubscription) {\n                vm.polygonSubscription = polygonSubscription;\n            })\n        );\n        \n    }\n    \n    function checkHasPolygon(data) {\n        var datasourceData = data[0].data;\n        var keyData = datasourceData[0];\n        var value = keyData[1];\n        if (value && Array.isArray(JSON.parse(value))) {\n            vm.hasPolygon = true;\n        } else {\n            vm.hasPolygon = false;\n        }\n    }\n    \n    function cancelPolygonSubscription() {\n        if (vm.polygonSubscription) {\n            widgetContext.subscriptionApi.removeSubscription(vm.polygonSubscription.id);\n            vm.polygonSubscription = null;\n        }\n    }\n\n    function saveEntityObservable() {\n        return getOrCreateSmartIrrigationAssetGroup().pipe(\n          widgetContext.rxjs.switchMap((smartIrrigation) => {\n            const formValues = vm.addFieldFormGroup.value;\n            let field = {\n                name: formValues.name,\n                type: 'SI Field',\n                label: formValues.label\n            };\n            if (vm.field) {\n                field.id = vm.field.id;\n            }\n            return assetService.saveAsset(field, smartIrrigation.id.id);\n          })\n        );\n    }\n    \n    function deleteEntityObservable() {\n        if (vm.field) {\n            return assetService.deleteAsset(vm.field.id.id);\n        } else {\n            return widgetContext.rxjs.of(null);\n        }\n    }\n\n    function saveAttributes(entityId) {\n        let cropType = vm.addFieldFormGroup.get('cropType').value;\n        let attributesArray = [{key: 'cropType', value: cropType}];\n        return attributeService.saveEntityAttributes(entityId, \"SERVER_SCOPE\", attributesArray);\n    }\n    \n    function getOrCreateSmartIrrigationAssetGroup() {\n      return getEntityGroupByName(\"Smart Irrigation\", \"ASSET\").pipe(\n          widgetContext.rxjs.switchMap((group) => {\n              if (group) {\n                  return widgetContext.rxjs.of(group);\n              } else {\n                  var smartIrrigation = {\n                    type: 'ASSET',\n                    name: 'Smart Irrigation'\n                  };\n                  return entityGroupService.saveEntityGroup(smartIrrigation);\n              }\n          })\n      );\n    }\n    \n    function getEntityGroupByName(groupName, groupType) {\n      var entityGroupsPageLink = widgetContext.pageLink(10, 0, groupName);\n      return entityGroupService.getEntityGroupsByPageLink(entityGroupsPageLink, groupType, {ignoreLoading: true}).pipe(\n          widgetContext.rxjs.map((data) => {\n            if (data.data.length) {\n                return data.data.find((group) => group.name === groupName);\n            } else {\n                return null;\n            }\n          })\n      );\n    }\n\n}\n",
                "customResources": [],
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "5b9d0130-b8ab-4103-0223-90a4530d425f"
              }
            ],
            "actionCellButton": [
              {
                "name": "Edit field",
                "icon": "edit",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "customPretty",
                "customHtml": "<!--=======================================================================-->\n<!--=====  There are two example templates: for edit and add entity   =====-->\n<!--=======================================================================-->\n<!--========================  Edit entity example  ========================-->\n<!--=======================================================================-->\n<!-- -->\n<!--<form #editEntityForm=\"ngForm\" [formGroup]=\"editEntityFormGroup\"-->\n<!--      (ngSubmit)=\"save()\"  class=\"edit-entity-form\">-->\n<!--    <mat-toolbar fxLayout=\"row\" color=\"primary\">-->\n<!--        <h2>Edit {{entityType.toLowerCase()}} {{entityName}}</h2>-->\n<!--        <span fxFlex></span>-->\n<!--        <button mat-icon-button (click)=\"cancel()\" type=\"button\">-->\n<!--            <mat-icon class=\"material-icons\">close</mat-icon>-->\n<!--        </button>-->\n<!--    </mat-toolbar>-->\n<!--    <mat-progress-bar color=\"warn\" mode=\"indeterminate\" *ngIf=\"isLoading$ | async\">-->\n<!--    </mat-progress-bar>-->\n<!--    <div style=\"height: 4px;\" *ngIf=\"!(isLoading$ | async)\"></div>-->\n<!--    <div mat-dialog-content fxLayout=\"column\">-->\n<!--        <div fxLayout=\"row\" fxLayoutGap=\"8px\" fxLayout.xs=\"column\"  fxLayoutGap.xs=\"0\">-->\n<!--            <mat-form-field fxFlex class=\"mat-block\">-->\n<!--                <mat-label>Entity Name</mat-label>-->\n<!--                <input matInput formControlName=\"entityName\" required readonly=\"\">-->\n<!--            </mat-form-field>-->\n<!--            <mat-form-field fxFlex class=\"mat-block\">-->\n<!--                <mat-label>Entity Label</mat-label>-->\n<!--                <input matInput formControlName=\"entityLabel\">-->\n<!--            </mat-form-field>-->\n<!--        </div>-->\n<!--        <div fxLayout=\"row\" fxLayoutGap=\"8px\" fxLayout.xs=\"column\"  fxLayoutGap.xs=\"0\">-->\n<!--            <mat-form-field fxFlex class=\"mat-block\">-->\n<!--                <mat-label>Entity Type</mat-label>-->\n<!--                <input matInput formControlName=\"entityType\" readonly>-->\n<!--            </mat-form-field>-->\n<!--            <mat-form-field fxFlex class=\"mat-block\">-->\n<!--                <mat-label>Type</mat-label>-->\n<!--                <input matInput formControlName=\"type\" readonly>-->\n<!--            </mat-form-field>-->\n<!--        </div>-->\n<!--        <div formGroupName=\"attributes\" fxLayout=\"column\">-->\n<!--            <div fxLayout=\"row\" fxLayoutGap=\"8px\" fxLayout.xs=\"column\"  fxLayoutGap.xs=\"0\">-->\n<!--                <mat-form-field fxFlex class=\"mat-block\">-->\n<!--                    <mat-label>Latitude</mat-label>-->\n<!--                    <input type=\"number\" step=\"any\" matInput formControlName=\"latitude\">-->\n<!--                </mat-form-field>-->\n<!--                <mat-form-field fxFlex class=\"mat-block\">-->\n<!--                    <mat-label>Longitude</mat-label>-->\n<!--                    <input type=\"number\" step=\"any\" matInput formControlName=\"longitude\">-->\n<!--                </mat-form-field>-->\n<!--            </div>-->\n<!--            <div fxLayout=\"row\" fxLayoutGap=\"8px\" fxLayout.xs=\"column\"  fxLayoutGap.xs=\"0\">-->\n<!--                <mat-form-field fxFlex class=\"mat-block\">-->\n<!--                    <mat-label>Address</mat-label>-->\n<!--                    <input matInput formControlName=\"address\">-->\n<!--                </mat-form-field>-->\n<!--                <mat-form-field fxFlex class=\"mat-block\">-->\n<!--                    <mat-label>Owner</mat-label>-->\n<!--                    <input matInput formControlName=\"owner\">-->\n<!--                </mat-form-field>-->\n<!--            </div>-->\n<!--            <div fxLayout=\"row\" fxLayoutGap=\"8px\" fxLayout.xs=\"column\"  fxLayoutGap.xs=\"0\">-->\n<!--                <mat-form-field fxFlex class=\"mat-block\">-->\n<!--                    <mat-label>Integer Value</mat-label>-->\n<!--                    <input type=\"number\" step=\"1\" matInput formControlName=\"number\">-->\n<!--                    <mat-error *ngIf=\"editEntityFormGroup.get('attributes.number').hasError('pattern')\">-->\n<!--                        Invalid integer value.-->\n<!--                    </mat-error>-->\n<!--                </mat-form-field>-->\n<!--                <div class=\"boolean-value-input\" fxLayout=\"column\" fxLayoutAlign=\"center start\" fxFlex>-->\n<!--                    <label class=\"checkbox-label\">Boolean Value</label>-->\n<!--                    <mat-checkbox formControlName=\"booleanValue\" style=\"margin-bottom: 40px;\">-->\n<!--                        {{ (editEntityFormGroup.get('attributes.booleanValue').value ? \"value.true\" : \"value.false\") | translate }}-->\n<!--                    </mat-checkbox>-->\n<!--                </div>-->\n<!--            </div>-->\n<!--        </div>-->\n<!--        <div class=\"relations-list old-relations\">-->\n<!--            <div class=\"mat-body-1\" style=\"padding-bottom: 10px; color: rgba(0,0,0,0.57);\">Relations</div>-->\n<!--            <div class=\"body\" [fxShow]=\"oldRelations().length\">-->\n<!--                <div class=\"row\" fxLayout=\"row\" fxLayoutAlign=\"start center\" formArrayName=\"oldRelations\" -->\n<!--                     *ngFor=\"let relation of oldRelations().controls; let i = index;\">-->\n<!--                    <div [formGroupName]=\"i\" class=\"mat-elevation-z2\" fxFlex fxLayout=\"row\" style=\"padding: 5px 0 5px 5px;\">-->\n<!--                        <div fxFlex fxLayout=\"column\">-->\n<!--                            <div fxLayout=\"row\" fxLayoutGap=\"8px\" fxLayout.xs=\"column\"  fxLayoutGap.xs=\"0\">-->\n<!--                                <mat-form-field class=\"mat-block\" style=\"min-width: 100px;\">-->\n<!--                                    <mat-label>Direction</mat-label>-->\n<!--                                    <mat-select formControlName=\"direction\" name=\"direction\">-->\n<!--                                        <mat-option *ngFor=\"let direction of entitySearchDirection | keyvalue\" [value]=\"direction.value\">-->\n<!--                                            {{ (\"relation.search-direction.\" + direction.value) | translate}}-->\n<!--                                        </mat-option>-->\n<!--                                    </mat-select>-->\n<!--                                    <mat-error *ngIf=\"relation.get('direction').hasError('required')\">-->\n<!--                                        Relation direction is required.-->\n<!--                                    </mat-error>-->\n<!--                                </mat-form-field>-->\n<!--                                <tb-relation-type-autocomplete-->\n<!--                                        fxFlex class=\"mat-block\"-->\n<!--                                        formControlName=\"relationType\"-->\n<!--                                        required=\"true\">-->\n<!--                                </tb-relation-type-autocomplete>-->\n<!--                            </div>-->\n<!--                            <div fxLayout=\"row\" fxLayout.xs=\"column\">-->\n<!--                                <tb-entity-select-->\n<!--                                        fxFlex class=\"mat-block\"-->\n<!--                                        required=\"true\"-->\n<!--                                        formControlName=\"relatedEntity\">-->\n<!--                                </tb-entity-select>-->\n<!--                            </div>-->\n<!--                        </div>-->\n<!--                        <div fxLayout=\"column\" fxLayoutAlign=\"center center\">-->\n<!--                            <button mat-icon-button color=\"primary\"-->\n<!--                                    aria-label=\"Remove\"-->\n<!--                                    type=\"button\"-->\n<!--                                    (click)=\"removeOldRelation(i)\"-->\n<!--                                    matTooltip=\"Remove relation\"-->\n<!--                                    matTooltipPosition=\"above\">-->\n<!--                                <mat-icon>close</mat-icon>-->\n<!--                            </button>-->\n<!--                        </div>-->\n<!--                    </div>-->\n<!--                </div>-->\n<!--            </div>-->\n<!--        </div>-->\n<!--        <div class=\"relations-list\">-->\n<!--            <div class=\"mat-body-1\" style=\"padding-bottom: 10px; color: rgba(0,0,0,0.57);\">New Relations</div>-->\n<!--            <div class=\"body\" [fxShow]=\"relations().length\">-->\n<!--                <div class=\"row\" fxLayout=\"row\" fxLayoutAlign=\"start center\" formArrayName=\"relations\" *ngFor=\"let relation of relations().controls; let i = index;\">-->\n<!--                    <div [formGroupName]=\"i\" class=\"mat-elevation-z2\" fxFlex fxLayout=\"row\" style=\"padding: 5px 0 5px 5px;\">-->\n<!--                        <div fxFlex fxLayout=\"column\">-->\n<!--                            <div fxLayout=\"row\" fxLayoutGap=\"8px\" fxLayout.xs=\"column\"  fxLayoutGap.xs=\"0\">-->\n<!--                                <mat-form-field class=\"mat-block\" style=\"min-width: 100px;\">-->\n<!--                                    <mat-label>Direction</mat-label>-->\n<!--                                    <mat-select formControlName=\"direction\" name=\"direction\">-->\n<!--                                        <mat-option *ngFor=\"let direction of entitySearchDirection | keyvalue\" [value]=\"direction.value\">-->\n<!--                                            {{ (\"relation.search-direction.\" + direction.value) | translate}}-->\n<!--                                        </mat-option>-->\n<!--                                    </mat-select>-->\n<!--                                    <mat-error *ngIf=\"relation.get('direction').hasError('required')\">-->\n<!--                                        Relation direction is required.-->\n<!--                                    </mat-error>-->\n<!--                                </mat-form-field>-->\n<!--                                <tb-relation-type-autocomplete-->\n<!--                                        fxFlex class=\"mat-block\"-->\n<!--                                        formControlName=\"relationType\"-->\n<!--                                        [required]=\"true\">-->\n<!--                                </tb-relation-type-autocomplete>-->\n<!--                            </div>-->\n<!--                            <div fxLayout=\"row\" fxLayout.xs=\"column\">-->\n<!--                                <tb-entity-select-->\n<!--                                        fxFlex class=\"mat-block\"-->\n<!--                                        [required]=\"true\"-->\n<!--                                        formControlName=\"relatedEntity\">-->\n<!--                                </tb-entity-select>-->\n<!--                            </div>-->\n<!--                        </div>-->\n<!--                        <div fxLayout=\"column\" fxLayoutAlign=\"center center\">-->\n<!--                            <button mat-icon-button color=\"primary\"-->\n<!--                                    aria-label=\"Remove\"-->\n<!--                                    type=\"button\"-->\n<!--                                    (click)=\"removeRelation(i)\"-->\n<!--                                    matTooltip=\"Remove relation\"-->\n<!--                                    matTooltipPosition=\"above\">-->\n<!--                                <mat-icon>close</mat-icon>-->\n<!--                            </button>-->\n<!--                        </div>-->\n<!--                    </div>-->\n<!--                </div>-->\n<!--            </div>-->\n<!--            <div>-->\n<!--                <button mat-raised-button color=\"primary\"-->\n<!--                        type=\"button\"-->\n<!--                        (click)=\"addRelation()\"-->\n<!--                        matTooltip=\"Add Relation\"-->\n<!--                        matTooltipPosition=\"above\">-->\n<!--                    Add-->\n<!--                </button>-->\n<!--            </div>-->\n<!--        </div>-->\n<!--    </div>-->\n<!--    <div mat-dialog-actions fxLayout=\"row\" fxLayoutAlign=\"end center\">-->\n<!--        <button mat-button color=\"primary\"-->\n<!--                type=\"button\"-->\n<!--                [disabled]=\"(isLoading$ | async)\"-->\n<!--                (click)=\"cancel()\" cdkFocusInitial>-->\n<!--            Cancel-->\n<!--        </button>-->\n<!--        <button mat-button mat-raised-button color=\"primary\"-->\n<!--                type=\"submit\"-->\n<!--                [disabled]=\"(isLoading$ | async) || editEntityForm.invalid || !editEntityForm.dirty\">-->\n<!--            Save-->\n<!--        </button>-->\n<!--    </div>-->\n<!--</form>-->\n<!---->\n<!--========================================================================-->\n<!--=========================  Add entity example  =========================-->\n<!--========================================================================-->\n<!---->\n<!--<form #addEntityForm=\"ngForm\" [formGroup]=\"addEntityFormGroup\"-->\n<!--      (ngSubmit)=\"save()\" class=\"add-entity-form\">-->\n<!--    <mat-toolbar fxLayout=\"row\" color=\"primary\">-->\n<!--        <h2>Add entity</h2>-->\n<!--        <span fxFlex></span>-->\n<!--        <button mat-icon-button (click)=\"cancel()\" type=\"button\">-->\n<!--            <mat-icon class=\"material-icons\">close</mat-icon>-->\n<!--        </button>-->\n<!--    </mat-toolbar>-->\n<!--    <mat-progress-bar color=\"warn\" mode=\"indeterminate\" *ngIf=\"isLoading$ | async\">-->\n<!--    </mat-progress-bar>-->\n<!--    <div style=\"height: 4px;\" *ngIf=\"!(isLoading$ | async)\"></div>-->\n<!--    <div mat-dialog-content fxLayout=\"column\">-->\n<!--        <div fxLayout=\"row\" fxLayoutGap=\"8px\" fxLayout.xs=\"column\"  fxLayoutGap.xs=\"0\">-->\n<!--            <mat-form-field fxFlex class=\"mat-block\">-->\n<!--                <mat-label>Entity Name</mat-label>-->\n<!--                <input matInput formControlName=\"entityName\" required>-->\n<!--                <mat-error *ngIf=\"addEntityFormGroup.get('entityName').hasError('required')\">-->\n<!--                    Entity name is required.-->\n<!--                </mat-error>-->\n<!--            </mat-form-field>-->\n<!--            <mat-form-field fxFlex class=\"mat-block\">-->\n<!--                <mat-label>Entity Label</mat-label>-->\n<!--                <input matInput formControlName=\"entityLabel\" >-->\n<!--            </mat-form-field>-->\n<!--        </div>-->\n<!--        <div fxLayout=\"row\" fxLayoutGap=\"8px\" fxLayout.xs=\"column\"  fxLayoutGap.xs=\"0\">-->\n<!--            <tb-entity-type-select-->\n<!--                    class=\"mat-block\"-->\n<!--                    formControlName=\"entityType\"-->\n<!--                    [showLabel]=\"true\"-->\n<!--                    [allowedEntityTypes]=\"allowedEntityTypes\"-->\n<!--            ></tb-entity-type-select>-->\n<!--            <tb-entity-subtype-autocomplete-->\n<!--                    fxFlex *ngIf=\"addEntityFormGroup.get('entityType').value == 'ASSET'\"-->\n<!--                    class=\"mat-block\"-->\n<!--                    formControlName=\"type\"-->\n<!--                    [required]=\"true\"-->\n<!--                    [entityType]=\"'ASSET'\"-->\n<!--            ></tb-entity-subtype-autocomplete>-->\n<!--            <tb-entity-subtype-autocomplete-->\n<!--                    fxFlex *ngIf=\"addEntityFormGroup.get('entityType').value != 'ASSET'\"-->\n<!--                    class=\"mat-block\"-->\n<!--                    formControlName=\"type\"-->\n<!--                    [required]=\"true\"-->\n<!--                    [entityType]=\"'DEVICE'\"-->\n<!--            ></tb-entity-subtype-autocomplete>-->\n<!--        </div>-->\n<!--        <div formGroupName=\"attributes\" fxLayout=\"column\">-->\n<!--            <div fxLayout=\"row\" fxLayoutGap=\"8px\" fxLayout.xs=\"column\"  fxLayoutGap.xs=\"0\">-->\n<!--                <mat-form-field fxFlex class=\"mat-block\">-->\n<!--                    <mat-label>Latitude</mat-label>-->\n<!--                    <input type=\"number\" step=\"any\" matInput formControlName=\"latitude\">-->\n<!--                </mat-form-field>-->\n<!--                <mat-form-field fxFlex class=\"mat-block\">-->\n<!--                    <mat-label>Longitude</mat-label>-->\n<!--                    <input type=\"number\" step=\"any\" matInput formControlName=\"longitude\">-->\n<!--                </mat-form-field>-->\n<!--            </div>-->\n<!--            <div fxLayout=\"row\" fxLayoutGap=\"8px\" fxLayout.xs=\"column\"  fxLayoutGap.xs=\"0\">-->\n<!--                <mat-form-field fxFlex class=\"mat-block\">-->\n<!--                    <mat-label>Address</mat-label>-->\n<!--                    <input matInput formControlName=\"address\">-->\n<!--                </mat-form-field>-->\n<!--                <mat-form-field fxFlex class=\"mat-block\">-->\n<!--                    <mat-label>Owner</mat-label>-->\n<!--                    <input matInput formControlName=\"owner\">-->\n<!--                </mat-form-field>-->\n<!--            </div>-->\n<!--            <div fxLayout=\"row\" fxLayoutGap=\"8px\" fxLayout.xs=\"column\"  fxLayoutGap.xs=\"0\">-->\n<!--                <mat-form-field fxFlex class=\"mat-block\">-->\n<!--                    <mat-label>Integer Value</mat-label>-->\n<!--                    <input type=\"number\" step=\"1\" matInput formControlName=\"number\">-->\n<!--                    <mat-error *ngIf=\"addEntityFormGroup.get('attributes.number').hasError('pattern')\">-->\n<!--                        Invalid integer value.-->\n<!--                    </mat-error>-->\n<!--                </mat-form-field>-->\n<!--                <div class=\"boolean-value-input\" fxLayout=\"column\" fxLayoutAlign=\"center start\" fxFlex>-->\n<!--                    <label class=\"checkbox-label\">Boolean Value</label>-->\n<!--                    <mat-checkbox formControlName=\"booleanValue\" style=\"margin-bottom: 40px;\">-->\n<!--                        {{ (addEntityFormGroup.get('attributes.booleanValue').value ? \"value.true\" : \"value.false\") | translate }}-->\n<!--                    </mat-checkbox>-->\n<!--                </div>-->\n<!--            </div>-->\n<!--        </div>-->\n<!--        <div class=\"relations-list\">-->\n<!--            <div class=\"mat-body-1\" style=\"padding-bottom: 10px; color: rgba(0,0,0,0.57);\">Relations</div>-->\n<!--            <div class=\"body\" [fxShow]=\"relations().length\">-->\n<!--                <div class=\"row\" fxLayout=\"row\" fxLayoutAlign=\"start center\" formArrayName=\"relations\" *ngFor=\"let relation of relations().controls; let i = index;\">-->\n<!--                    <div [formGroupName]=\"i\" class=\"mat-elevation-z2\" fxFlex fxLayout=\"row\" style=\"padding: 5px 0 5px 5px;\">-->\n<!--                        <div fxFlex fxLayout=\"column\">-->\n<!--                            <div fxLayout=\"row\" fxLayoutGap=\"8px\" fxLayout.xs=\"column\"  fxLayoutGap.xs=\"0\">-->\n<!--                                <mat-form-field class=\"mat-block\" style=\"min-width: 100px;\">-->\n<!--                                    <mat-label>Direction</mat-label>-->\n<!--                                    <mat-select formControlName=\"direction\" name=\"direction\">-->\n<!--                                        <mat-option *ngFor=\"let direction of entitySearchDirection | keyvalue\" [value]=\"direction.value\">-->\n<!--                                            {{ (\"relation.search-direction.\" + direction.value) | translate}}-->\n<!--                                        </mat-option>-->\n<!--                                    </mat-select>-->\n<!--                                    <mat-error *ngIf=\"relation.get('direction').hasError('required')\">-->\n<!--                                        Relation direction is required.-->\n<!--                                    </mat-error>-->\n<!--                                </mat-form-field>-->\n<!--                                <tb-relation-type-autocomplete-->\n<!--                                        fxFlex class=\"mat-block\"-->\n<!--                                        formControlName=\"relationType\"-->\n<!--                                        [required]=\"true\">-->\n<!--                                </tb-relation-type-autocomplete>-->\n<!--                            </div>-->\n<!--                            <div fxLayout=\"row\" fxLayout.xs=\"column\">-->\n<!--                                <tb-entity-select-->\n<!--                                        fxFlex class=\"mat-block\"-->\n<!--                                        [required]=\"true\"-->\n<!--                                        formControlName=\"relatedEntity\">-->\n<!--                                </tb-entity-select>-->\n<!--                            </div>-->\n<!--                        </div>-->\n<!--                        <div fxLayout=\"column\" fxLayoutAlign=\"center center\">-->\n<!--                            <button mat-icon-button color=\"primary\"-->\n<!--                                    aria-label=\"Remove\"-->\n<!--                                    type=\"button\"-->\n<!--                                    (click)=\"removeRelation(i)\"-->\n<!--                                    matTooltip=\"Remove relation\"-->\n<!--                                    matTooltipPosition=\"above\">-->\n<!--                                <mat-icon>close</mat-icon>-->\n<!--                            </button>-->\n<!--                        </div>-->\n<!--                    </div>-->\n<!--                </div>-->\n<!--            </div>-->\n<!--            <div>-->\n<!--                <button mat-raised-button color=\"primary\"-->\n<!--                        type=\"button\"-->\n<!--                        (click)=\"addRelation()\"-->\n<!--                        matTooltip=\"Add Relation\"-->\n<!--                        matTooltipPosition=\"above\">-->\n<!--                    Add-->\n<!--                </button>-->\n<!--            </div>-->\n<!--        </div>-->\n<!--    </div>-->\n<!--    <div mat-dialog-actions fxLayout=\"row\" fxLayoutAlign=\"end center\">-->\n<!--        <button mat-button color=\"primary\"-->\n<!--                type=\"button\"-->\n<!--                [disabled]=\"(isLoading$ | async)\"-->\n<!--                (click)=\"cancel()\" cdkFocusInitial>-->\n<!--            Cancel-->\n<!--        </button>-->\n<!--        <button mat-button mat-raised-button color=\"primary\"-->\n<!--                type=\"submit\"-->\n<!--                [disabled]=\"(isLoading$ | async) || addEntityForm.invalid || !addEntityForm.dirty\">-->\n<!--            Create-->\n<!--        </button>-->\n<!--    </div>-->\n<!--</form>-->\n",
                "customCss": "/*=======================================================================*/\n/*==========  There are two examples: for edit and add entity  ==========*/\n/*=======================================================================*/\n/*========================  Edit entity example  ========================*/\n/*=======================================================================*/\n/*\n.edit-entity-form .boolean-value-input {\n    padding-left: 5px;\n}\n\n.edit-entity-form .boolean-value-input .checkbox-label {\n    margin-bottom: 8px;\n    color: rgba(0,0,0,0.54);\n    font-size: 12px;\n}\n\n.relations-list .header {\n    padding-right: 5px;\n    padding-bottom: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .header .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n    font-size: 12px;\n    font-weight: 700;\n    color: rgba(0, 0, 0, .54);\n    white-space: nowrap;\n}\n\n.relations-list .mat-form-field-infix {\n    width: auto !important;\n}\n\n.relations-list .body {\n    padding-right: 5px;\n    padding-bottom: 15px;\n    padding-left: 5px;\n}\n\n.relations-list .body .row {\n    padding-top: 5px;\n}\n\n.relations-list .body .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .body .md-button {\n    margin: 0;\n}\n*/\n/*========================================================================*/\n/*=========================  Add entity example  =========================*/\n/*========================================================================*/\n/*\n.add-entity-form .boolean-value-input {\n    padding-left: 5px;\n}\n\n.add-entity-form .boolean-value-input .checkbox-label {\n    margin-bottom: 8px;\n    color: rgba(0,0,0,0.54);\n    font-size: 12px;\n}\n\n.relations-list .header {\n    padding-right: 5px;\n    padding-bottom: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .header .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n    font-size: 12px;\n    font-weight: 700;\n    color: rgba(0, 0, 0, .54);\n    white-space: nowrap;\n}\n\n.relations-list .mat-form-field-infix {\n    width: auto !important;\n}\n\n.relations-list .body {\n    padding-right: 5px;\n    padding-bottom: 15px;\n    padding-left: 5px;\n}\n\n.relations-list .body .row {\n    padding-top: 5px;\n}\n\n.relations-list .body .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .body .md-button {\n    margin: 0;\n}\n*/\n",
                "customFunction": "/*=======================================================================*/\n/*=====  There are three examples: for delete, edit and add entity  =====*/\n/*=======================================================================*/\n/*=======================  Delete entity example  =======================*/\n/*=======================================================================*/\n//\n//let $injector = widgetContext.$scope.$injector;\n//let dialogs = $injector.get(widgetContext.servicesMap.get('dialogs'));\n//let assetService = $injector.get(widgetContext.servicesMap.get('assetService'));\n//let deviceService = $injector.get(widgetContext.servicesMap.get('deviceService'));\n//\n//openDeleteEntityDialog();\n//\n//function openDeleteEntityDialog() {\n//    let title = 'Delete ' + entityId.entityType.toLowerCase() + ' ' +\n//                 entityName;\n//    let content = 'Are you sure you want to delete the ' +\n//                  entityId.entityType.toLowerCase() + ' ' + entityName + '?';\n//    dialogs.confirm(title, content, 'Cancel', 'Delete').subscribe(\n//        function(result) {\n//            if (result) {\n//                deleteEntity();\n//            }\n//        }\n//    );\n//}\n//\n//function deleteEntity() {\n//    deleteEntityObservable(entityId).subscribe(\n//        function success() {\n//            widgetContext.updateAliases();\n//        },\n//        function fail() {\n//            showErrorDialog();\n//        }\n//    );\n//}\n//\n//function deleteEntityObservable(entityId) {\n//    if (entityId.entityType == \"ASSET\") {\n//        return assetService.deleteAsset(entityId.id);\n//    } else if (entityId.entityType == \"DEVICE\") {\n//        return deviceService.deleteDevice(entityId.id);\n//    }\n//}\n//\n//function showErrorDialog() {\n//    let title = 'Error';\n//    let content = 'An error occurred while deleting the entity. Please try again.';\n//    dialogs.alert(title, content, 'CLOSE').subscribe(\n//        function(result) {}\n//    );\n//}\n//\n/*=======================================================================*/\n/*========================  Edit entity example  ========================*/\n/*=======================================================================*/\n//\n//let $injector = widgetContext.$scope.$injector;\n//let customDialog = $injector.get(widgetContext.servicesMap.get('customDialog'));\n//let entityService = $injector.get(widgetContext.servicesMap.get('entityService'));\n//let assetService = $injector.get(widgetContext.servicesMap.get('assetService'));\n//let deviceService = $injector.get(widgetContext.servicesMap.get('deviceService'));\n//let attributeService = $injector.get(widgetContext.servicesMap.get('attributeService'));\n//let entityRelationService = $injector.get(widgetContext.servicesMap.get('entityRelationService'));\n//\n//openEditEntityDialog();\n//\n//function openEditEntityDialog() {\n//    customDialog.customDialog(htmlTemplate, EditEntityDialogController).subscribe();\n//}\n//\n//function EditEntityDialogController(instance) {\n//    let vm = instance;\n//\n//    vm.entityName = entityName;\n//    vm.entityType = entityId.entityType;\n//    vm.entitySearchDirection = {\n//        from: \"FROM\",\n//        to: \"TO\"\n//    };\n//    vm.attributes = {};\n//    vm.oldRelationsData = [];\n//    vm.relationsToDelete = [];\n//    vm.entity = {};\n//\n//    vm.editEntityFormGroup = vm.fb.group({\n//        entityName: ['', [vm.validators.required]],\n//        entityType: [null],\n//        entityLabel: [null],\n//        type: ['', [vm.validators.required]],\n//        attributes: vm.fb.group({\n//            latitude: [null],\n//            longitude: [null],\n//            address: [null],\n//            owner: [null],\n//            number: [null, [vm.validators.pattern(/^-?[0-9]+$/)]],\n//            booleanValue: [false]\n//        }),\n//        oldRelations: vm.fb.array([]),\n//        relations: vm.fb.array([])\n//    });\n//\n//    getEntityInfo();\n//\n//    vm.cancel = function() {\n//        vm.dialogRef.close(null);\n//    };\n//\n//    vm.relations = function() {\n//        return vm.editEntityFormGroup.get('relations');\n//    };\n//\n//    vm.oldRelations = function() {\n//        return vm.editEntityFormGroup.get('oldRelations');\n//    };\n//\n//    vm.addRelation = function() {\n//        vm.relations().push(vm.fb.group({\n//            relatedEntity: [null, [vm.validators.required]],\n//            relationType: [null, [vm.validators.required]],\n//            direction: [null, [vm.validators.required]]\n//        }));\n//    };\n//\n//    function addOldRelation() {\n//        vm.oldRelations().push(vm.fb.group({\n//            relatedEntity: [{value: null, disabled: true}, [vm.validators.required]],\n//            relationType: [{value: null, disabled: true}, [vm.validators.required]],\n//            direction: [{value: null, disabled: true}, [vm.validators.required]]\n//        }));\n//    }\n//\n//    vm.removeRelation = function(index) {\n//        vm.relations().removeAt(index);\n//        vm.relations().markAsDirty();\n//    };\n//\n//    vm.removeOldRelation = function(index) {\n//        vm.oldRelations().removeAt(index);\n//        vm.relationsToDelete.push(vm.oldRelationsData[index]);\n//        vm.oldRelations().markAsDirty();\n//    };\n//\n//    vm.save = function() {\n//        vm.editEntityFormGroup.markAsPristine();\n//        widgetContext.rxjs.forkJoin([\n//            saveAttributes(entityId),\n//            saveRelations(entityId),\n//            saveEntity()\n//        ]).subscribe(\n//            function () {\n//                widgetContext.updateAliases();\n//                vm.dialogRef.close(null);\n//            }\n//        );\n//    };\n//\n//    function getEntityAttributes(attributes) {\n//        for (var i = 0; i < attributes.length; i++) {\n//            vm.attributes[attributes[i].key] = attributes[i].value;\n//        }\n//    }\n//\n//    function getEntityRelations(relations) {\n//        let relationsFrom = relations[0];\n//        let relationsTo = relations[1];\n//        for (let i=0; i < relationsFrom.length; i++) {\n//            let relation = {\n//                direction: 'FROM',\n//                relationType: relationsFrom[i].type,\n//                relatedEntity: relationsFrom[i].to\n//            };\n//            vm.oldRelationsData.push(relation);\n//            addOldRelation();\n//        }\n//        for (let i=0; i < relationsTo.length; i++) {\n//            let relation = {\n//                direction: 'TO',\n//                relationType: relationsTo[i].type,\n//                relatedEntity: relationsTo[i].from\n//            };\n//            vm.oldRelationsData.push(relation);\n//            addOldRelation();\n//        }\n//    }\n//\n//    function getEntityInfo() {\n//         widgetContext.rxjs.forkJoin([\n//             entityRelationService.findInfoByFrom(entityId),\n//             entityRelationService.findInfoByTo(entityId),\n//             attributeService.getEntityAttributes(entityId, 'SERVER_SCOPE'),\n//             entityService.getEntity(entityId.entityType, entityId.id)\n//         ]).subscribe(\n//             function (data) {\n//                 getEntityRelations(data.slice(0,2));\n//                 getEntityAttributes(data[2]);\n//                 vm.entity = data[3];\n//                 vm.editEntityFormGroup.patchValue({\n//                     entityName: vm.entity.name,\n//                     entityType: vm.entityType,\n//                     entityLabel: vm.entity.label,\n//                     type: vm.entity.type,\n//                     attributes: vm.attributes,\n//                     oldRelations: vm.oldRelationsData\n//                 }, {emitEvent: false});\n//             }\n//         );\n//     }\n//\n//    function saveEntity() {\n//        const formValues = vm.editEntityFormGroup.value;\n//        if (vm.entity.label !== formValues.entityLabel){\n//            vm.entity.label = formValues.entityLabel;\n//            if (formValues.entityType == 'ASSET') {\n//                return assetService.saveAsset(vm.entity);\n//            } else if (formValues.entityType == 'DEVICE') {\n//                return deviceService.saveDevice(vm.entity);\n//            }\n//        }\n//        return widgetContext.rxjs.of([]);\n//    }\n//\n//    function saveAttributes(entityId) {\n//        let attributes = vm.editEntityFormGroup.get('attributes').value;\n//        let attributesArray = [];\n//        for (let key in attributes) {\n//            if (attributes[key] !== vm.attributes[key]) {\n//                attributesArray.push({key: key, value: attributes[key]});\n//            }\n//        }\n//        if (attributesArray.length > 0) {\n//            return attributeService.saveEntityAttributes(entityId, \"SERVER_SCOPE\", attributesArray);\n//        }\n//        return widgetContext.rxjs.of([]);\n//    }\n//\n//    function saveRelations(entityId) {\n//        let relations = vm.editEntityFormGroup.get('relations').value;\n//        let tasks = [];\n//        for(let i=0; i < relations.length; i++) {\n//            let relation = {\n//                type: relations[i].relationType,\n//                typeGroup: 'COMMON'\n//            };\n//            if (relations[i].direction == 'FROM') {\n//                relation.to = relations[i].relatedEntity;\n//                relation.from = entityId;\n//            } else {\n//                relation.to = entityId;\n//                relation.from = relations[i].relatedEntity;\n//            }\n//            tasks.push(entityRelationService.saveRelation(relation));\n//        }\n//        for (let i=0; i < vm.relationsToDelete.length; i++) {\n//            let relation = {\n//                type: vm.relationsToDelete[i].relationType\n//            };\n//            if (vm.relationsToDelete[i].direction == 'FROM') {\n//                relation.to = vm.relationsToDelete[i].relatedEntity;\n//                relation.from = entityId;\n//            } else {\n//                relation.to = entityId;\n//                relation.from = vm.relationsToDelete[i].relatedEntity;\n//            }\n//            tasks.push(entityRelationService.deleteRelation(relation.from, relation.type, relation.to));\n//        }\n//        if (tasks.length > 0) {\n//            return widgetContext.rxjs.forkJoin(tasks);\n//        }\n//        return widgetContext.rxjs.of([]);\n//    }\n//}\n//\n/*========================================================================*/\n/*=========================  Add entity example  =========================*/\n/*========================================================================*/\n//\n//let $injector = widgetContext.$scope.$injector;\n//let customDialog = $injector.get(widgetContext.servicesMap.get('customDialog'));\n//let assetService = $injector.get(widgetContext.servicesMap.get('assetService'));\n//let deviceService = $injector.get(widgetContext.servicesMap.get('deviceService'));\n//let attributeService = $injector.get(widgetContext.servicesMap.get('attributeService'));\n//let entityRelationService = $injector.get(widgetContext.servicesMap.get('entityRelationService'));\n//\n//openAddEntityDialog();\n//\n//function openAddEntityDialog() {\n//    customDialog.customDialog(htmlTemplate, AddEntityDialogController).subscribe();\n//}\n//\n//function AddEntityDialogController(instance) {\n//    let vm = instance;\n//\n//    vm.allowedEntityTypes = ['ASSET', 'DEVICE'];\n//    vm.entitySearchDirection = {\n//        from: \"FROM\",\n//        to: \"TO\"\n//    }\n//\n//    vm.addEntityFormGroup = vm.fb.group({\n//      entityName: ['', [vm.validators.required]],\n//      entityType: ['DEVICE'],\n//      entityLabel: [null],\n//      type: ['', [vm.validators.required]],\n//      attributes: vm.fb.group({\n//          latitude: [null],\n//          longitude: [null],\n//          address: [null],\n//          owner: [null],\n//          number: [null, [vm.validators.pattern(/^-?[0-9]+$/)]],\n//          booleanValue: [null]\n//      }),\n//      relations: vm.fb.array([])\n//    });\n//\n//    vm.cancel = function() {\n//        vm.dialogRef.close(null);\n//    };\n//\n//    vm.relations = function() {\n//        return vm.addEntityFormGroup.get('relations');\n//    };\n//\n//    vm.addRelation = function() {\n//        vm.relations().push(vm.fb.group({\n//          relatedEntity: [null, [vm.validators.required]],\n//          relationType: [null, [vm.validators.required]],\n//          direction: [null, [vm.validators.required]]\n//        }));\n//    };\n//\n//    vm.removeRelation = function(index) {\n//        vm.relations().removeAt(index);\n//        vm.relations().markAsDirty();\n//    };\n//\n//    vm.save = function() {\n//        vm.addEntityFormGroup.markAsPristine();\n//        saveEntityObservable().subscribe(\n//            function (entity) {\n//                widgetContext.rxjs.forkJoin([\n//                    saveAttributes(entity.id),\n//                    saveRelations(entity.id)\n//                ]).subscribe(\n//                    function () {\n//                        widgetContext.updateAliases();\n//                        vm.dialogRef.close(null);\n//                    }\n//                );\n//            }\n//        );\n//    };\n//\n//    function saveEntityObservable() {\n//        const formValues = vm.addEntityFormGroup.value;\n//        let entity = {\n//            name: formValues.entityName,\n//            type: formValues.type,\n//            label: formValues.entityLabel\n//        };\n//        if (formValues.entityType == 'ASSET') {\n//            return assetService.saveAsset(entity);\n//        } else if (formValues.entityType == 'DEVICE') {\n//            return deviceService.saveDevice(entity);\n//        }\n//    }\n//\n//    function saveAttributes(entityId) {\n//        let attributes = vm.addEntityFormGroup.get('attributes').value;\n//        let attributesArray = [];\n//        for (let key in attributes) {\n//            if(attributes[key] !== null) {\n//                attributesArray.push({key: key, value: attributes[key]});\n//            }\n//        }\n//        if (attributesArray.length > 0) {\n//            return attributeService.saveEntityAttributes(entityId, \"SERVER_SCOPE\", attributesArray);\n//        }\n//        return widgetContext.rxjs.of([]);\n//    }\n//\n//    function saveRelations(entityId) {\n//        let relations = vm.addEntityFormGroup.get('relations').value;\n//        let tasks = [];\n//        for(let i=0; i < relations.length; i++) {\n//            let relation = {\n//                type: relations[i].relationType,\n//                typeGroup: 'COMMON'\n//            };\n//            if (relations[i].direction == 'FROM') {\n//                relation.to = relations[i].relatedEntity;\n//                relation.from = entityId;\n//            } else {\n//                relation.to = entityId;\n//                relation.from = relations[i].relatedEntity;\n//            }\n//            tasks.push(entityRelationService.saveRelation(relation));\n//        }\n//        if (tasks.length > 0) {\n//            return widgetContext.rxjs.forkJoin(tasks);\n//        }\n//        return widgetContext.rxjs.of([]);\n//    }\n//}\n",
                "customResources": [],
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "440ca790-1b01-c774-c4f9-065a2aaa2dce"
              },
              {
                "name": "Delete field",
                "icon": "delete",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "customPretty",
                "customHtml": "",
                "customCss": ".sf-field-delete-dialog .mat-button.mat-primary, .sf-field-delete-dialog .mat-icon-button.mat-primary, .sf-field-delete-dialog .mat-stroked-button.mat-primary {\n    color: #5553AF;\n}\n\n.sf-field-delete-dialog .mat-fab.mat-primary, .sf-field-delete-dialog .mat-flat-button.mat-primary, .sf-field-delete-dialog .mat-mini-fab.mat-primary, .sf-field-delete-dialog .mat-raised-button.mat-primary {\n    color: #fff;\n}\n\n.sf-field-delete-dialog .mat-fab.mat-primary, .sf-field-delete-dialog .mat-flat-button.mat-primary, .sf-field-delete-dialog .mat-mini-fab.mat-primary, .sf-field-delete-dialog .mat-raised-button.mat-primary {\n    background-color: #6F74F2;\n}\n\n.sf-field-delete-dialog .mat-button.mat-primary .mat-button-focus-overlay, .sf-field-delete-dialog .mat-icon-button.mat-primary .mat-button-focus-overlay, .sf-field-delete-dialog .mat-stroked-button.mat-primary .mat-button-focus-overlay {\n    background-color: #6F74F2;\n}\n",
                "customFunction": "let $injector = widgetContext.$scope.$injector;\nlet dialogs = $injector.get(widgetContext.servicesMap.get('dialogs'));\n\nlet assetService = $injector.get(widgetContext.servicesMap.get('assetService'));\n\nopenDeleteEntityDialog();\n\nfunction openDeleteEntityDialog() {\n    let title = 'Delete field \\'' +\n                 entityName + '\\'';\n    let content = 'Are you sure you want to delete the field \\'' + entityName + '\\'?';\n    dialogs.confirm(title, content, 'Cancel', 'Delete').subscribe(\n        function(result) {\n            if (result) {\n                deleteEntity();\n            }\n        }\n    );\n    $('tb-confirm-dialog').addClass('sf-field-delete-dialog');\n}\n\nfunction deleteEntity() {\n    deleteEntityObservable(entityId).subscribe(\n        function success() {\n            widgetContext.updateAliases();\n        },\n        function fail() {\n            showErrorDialog();\n        }\n    );\n}\n\nfunction deleteEntityObservable(entityId) {\n    return assetService.deleteAsset(entityId.id);\n}\n\nfunction showErrorDialog() {\n    let title = 'Error';\n    let content = 'An error occurred while deleting the field. Please try again.';\n    dialogs.alert(title, content, 'CLOSE').subscribe(\n        function(result) {}\n    );\n}\n",
                "customResources": [],
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "76de68f0-6177-7d13-0fb7-5af0f56b25dc"
              }
            ]
          },
          "showTitleIcon": false,
          "titleTooltip": "",
          "enableDataExport": false,
          "widgetStyle": {},
          "widgetCss": "",
          "pageSize": 1024,
          "noDataDisplayMessage": ""
        },
        "row": 0,
        "col": 0,
        "id": "8ce15aad-9ab2-55ce-2628-a663814d27b1"
      },
      "8fcd3aed-58d0-0cad-cf63-3a08e1be40a9": {
        "isSystemType": true,
        "bundleAlias": "cards",
        "typeAlias": "entities_table",
        "type": "latest",
        "title": "New widget",
        "image": null,
        "description": null,
        "sizeX": 7.5,
        "sizeY": 6.5,
        "config": {
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY"
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1664882134049,
                "endTimeMs": 1664968534049
              },
              "quickInterval": "CURRENT_DAY"
            },
            "aggregation": {
              "type": "NONE",
              "limit": 200
            }
          },
          "showTitle": true,
          "backgroundColor": "rgb(255, 255, 255)",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "4px",
          "settings": {
            "entitiesTitle": "Sensors",
            "enableSearch": true,
            "enableSelectColumnDisplay": true,
            "enableStickyHeader": true,
            "enableStickyAction": true,
            "reserveSpaceForHiddenAction": "true",
            "displayEntityName": false,
            "displayEntityLabel": false,
            "displayEntityType": false,
            "displayPagination": false,
            "defaultSortOrder": "name",
            "useRowStyleFunction": false
          },
          "title": "New Entities table",
          "dropShadow": false,
          "enableFullscreen": false,
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400,
            "padding": "5px 10px 5px 10px"
          },
          "useDashboardTimewindow": false,
          "showLegend": false,
          "datasources": [
            {
              "type": "entity",
              "name": null,
              "entityAliasId": "aa55618a-278a-0776-832d-fa1fe5769a2a",
              "filterId": null,
              "dataKeys": [
                {
                  "name": "name",
                  "type": "entityField",
                  "label": "Name",
                  "color": "#2196f3",
                  "settings": {
                    "columnWidth": "30%",
                    "useCellStyleFunction": false,
                    "useCellContentFunction": false,
                    "defaultColumnVisibility": "visible",
                    "columnSelectionToDisplay": "enabled",
                    "columnExportOption": "onlyVisible"
                  },
                  "_hash": 0.964011137179303,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                },
                {
                  "name": "moisture",
                  "type": "timeseries",
                  "label": "moisture",
                  "color": "#4caf50",
                  "settings": {
                    "columnWidth": "50%",
                    "useCellStyleFunction": false,
                    "useCellContentFunction": true,
                    "cellContentFunction": "var percent = value + '%';\nvar percentText = value.toFixed(0) + '%';\nreturn '<div style=\"width: 100%; max-width: 100px; height: 16px; background: linear-gradient(to right, rgba(111, 116, 242, 0.16) '+percent+', rgba(111, 116, 242, 0.08) '+percent+'); border-radius: 5.21053px;\"><span style=\"padding-left: 4px; font-weight: 600; font-size: 13px; color: #5553AF;\">'+percentText+'</span></div>';",
                    "defaultColumnVisibility": "visible",
                    "columnSelectionToDisplay": "enabled",
                    "columnExportOption": "onlyVisible"
                  },
                  "_hash": 0.9864372687388072,
                  "aggregationType": "NONE",
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                },
                {
                  "name": "active",
                  "type": "attribute",
                  "label": "active",
                  "color": "#f44336",
                  "settings": {
                    "columnWidth": "20%",
                    "useCellStyleFunction": false,
                    "useCellContentFunction": true,
                    "cellContentFunction": "var text = value ? 'On' : 'Off';\nvar color = value ? '#198038' : 'red';\nreturn '<div><span style=\"width: 4px; height: 4px; border-radius: 2px; background: '+color+'; display: inline-block; vertical-align: middle;\"></span><span style=\"padding-left: 8px;\">'+text+'</span></div>';",
                    "defaultColumnVisibility": "visible",
                    "columnSelectionToDisplay": "enabled",
                    "columnExportOption": "onlyVisible"
                  },
                  "_hash": 0.49788361286301885,
                  "aggregationType": null,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ]
            }
          ],
          "displayTimewindow": true,
          "showTitleIcon": false,
          "titleTooltip": "",
          "enableDataExport": true,
          "widgetStyle": {},
          "widgetCss": ".mat-header-row {\n    display: none;\n}\n\nmat-row, .mat-cell {\n    border-bottom: none;\n}",
          "pageSize": 1024,
          "noDataDisplayMessage": ""
        },
        "row": 0,
        "col": 0,
        "id": "8fcd3aed-58d0-0cad-cf63-3a08e1be40a9"
      },
      "7cfc3255-f459-6eb9-000e-70fef5afbcdb": {
        "isSystemType": true,
        "bundleAlias": "maps_v2",
        "typeAlias": "openstreetmap",
        "type": "latest",
        "title": "New widget",
        "image": null,
        "description": null,
        "sizeX": 8.5,
        "sizeY": 6,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "name": null,
              "entityAliasId": "39927380-423a-872a-0843-de34f99264ad",
              "filterId": null,
              "dataKeys": [
                {
                  "name": "name",
                  "type": "entityField",
                  "label": "Name",
                  "color": "#f44336",
                  "settings": {},
                  "_hash": 0.848379539472371
                },
                {
                  "name": "perimeter",
                  "type": "attribute",
                  "label": "perimeter",
                  "color": "#ffc107",
                  "settings": {},
                  "_hash": 0.7803202333041441
                }
              ]
            }
          ],
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY"
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1664882134049,
                "endTimeMs": 1664968534049
              },
              "quickInterval": "CURRENT_DAY"
            },
            "aggregation": {
              "type": "AVG",
              "limit": 25000
            }
          },
          "showTitle": false,
          "backgroundColor": "#fff",
          "color": "rgba(0,0,0,0.87)",
          "padding": "8px",
          "settings": {
            "provider": "openstreet-map",
            "gmApiKey": "AIzaSyDoEx2kaGz3PxwbI9T7ccTSg5xjdw8Nw8Q",
            "gmDefaultMapType": "roadmap",
            "mapProvider": "OpenStreetMap.Mapnik",
            "useCustomProvider": true,
            "customProviderTileUrl": "https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",
            "mapProviderHere": "HERE.normalDay",
            "credentials": {
              "app_id": "AhM6TzD9ThyK78CT3ptx",
              "app_code": "p6NPiITB3Vv0GMUFnkLOOg"
            },
            "mapImageUrl": "data:image/svg+xml;base64,PHN2ZyBpZD0ic3ZnMiIgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGhlaWdodD0iMTAwIiB3aWR0aD0iMTAwIiB2ZXJzaW9uPSIxLjEiIHhtbG5zOmNjPSJodHRwOi8vY3JlYXRpdmVjb21tb25zLm9yZy9ucyMiIHhtbG5zOmRjPSJodHRwOi8vcHVybC5vcmcvZGMvZWxlbWVudHMvMS4xLyIgdmlld0JveD0iMCAwIDEwMCAxMDAiPgogPGcgaWQ9ImxheWVyMSIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMCAtOTUyLjM2KSI+CiAgPHJlY3QgaWQ9InJlY3Q0Njg0IiBzdHJva2UtbGluZWpvaW49InJvdW5kIiBoZWlnaHQ9Ijk5LjAxIiB3aWR0aD0iOTkuMDEiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiB5PSI5NTIuODYiIHg9Ii40OTUwNSIgc3Ryb2tlLXdpZHRoPSIuOTkwMTAiIGZpbGw9IiNlZWUiLz4KICA8dGV4dCBpZD0idGV4dDQ2ODYiIHN0eWxlPSJ3b3JkLXNwYWNpbmc6MHB4O2xldHRlci1zcGFjaW5nOjBweDt0ZXh0LWFuY2hvcjptaWRkbGU7dGV4dC1hbGlnbjpjZW50ZXIiIGZvbnQtd2VpZ2h0PSJib2xkIiB4bWw6c3BhY2U9InByZXNlcnZlIiBmb250LXNpemU9IjEwcHgiIGxpbmUtaGVpZ2h0PSIxMjUlIiB5PSI5NzAuNzI4MDkiIHg9IjQ5LjM5NjQ3NyIgZm9udC1mYW1pbHk9IlJvYm90byIgZmlsbD0iIzY2NjY2NiI+PHRzcGFuIGlkPSJ0c3BhbjQ2OTAiIHg9IjUwLjY0NjQ3NyIgeT0iOTcwLjcyODA5Ij5JbWFnZSBiYWNrZ3JvdW5kIDwvdHNwYW4+PHRzcGFuIGlkPSJ0c3BhbjQ2OTIiIHg9IjQ5LjM5NjQ3NyIgeT0iOTgzLjIyODA5Ij5pcyBub3QgY29uZmlndXJlZDwvdHNwYW4+PC90ZXh0PgogIDxyZWN0IGlkPSJyZWN0NDY5NCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgaGVpZ2h0PSIxOS4zNiIgd2lkdGg9IjY5LjM2IiBzdHJva2U9IiMwMDAiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgeT0iOTkyLjY4IiB4PSIxNS4zMiIgc3Ryb2tlLXdpZHRoPSIuNjM5ODYiIGZpbGw9Im5vbmUiLz4KIDwvZz4KPC9zdmc+Cg==",
            "tmApiKey": "84d6d83e0e51e481e50454ccbe8986b",
            "tmDefaultMapType": "roadmap",
            "latKeyName": "1",
            "lngKeyName": "1",
            "xPosKeyName": "xPos",
            "yPosKeyName": "yPos",
            "defaultZoomLevel": 14,
            "defaultCenterPosition": "49.348472, 32.108611",
            "disableScrollZooming": false,
            "disableDoubleClickZooming": false,
            "disableZoomControl": false,
            "fitMapBounds": false,
            "useDefaultCenterPosition": true,
            "mapPageSize": 16384,
            "markerOffsetX": 0.5,
            "markerOffsetY": 1,
            "posFunction": "return {x: origXPos, y: origYPos};",
            "draggableMarker": false,
            "showLabel": true,
            "useLabelFunction": false,
            "label": "${entityName}",
            "showTooltip": true,
            "showTooltipAction": "click",
            "autocloseTooltip": true,
            "useTooltipFunction": false,
            "tooltipPattern": "<b>${entityName}</b><br/><br/><b>Latitude:</b> ${latitude:7}<br/><b>Longitude:</b> ${longitude:7}<br/><b>Temperature:</b> ${temperature} Â°C<br/><small>See advanced settings for details</small>",
            "tooltipOffsetX": 0,
            "tooltipOffsetY": -1,
            "color": "#fe7569",
            "useColorFunction": true,
            "colorFunction": "var type = dsData[dsIndex]['Type'];\nif (type == 'colorpin') {\n\tvar temperature = dsData[dsIndex]['temperature'];\n\tif (typeof temperature !== undefined) {\n\t    var percent = (temperature + 60)/120 * 100;\n\t    return tinycolor.mix('blue', 'red', percent).toHexString();\n\t}\n\treturn 'blue';\n}\n",
            "useMarkerImageFunction": false,
            "markerImageSize": 34,
            "markerImages": [],
            "showPolygon": true,
            "polygonKeyName": "perimeter",
            "editablePolygon": true,
            "showPolygonLabel": true,
            "usePolygonLabelFunction": false,
            "polygonLabel": "${entityName}",
            "showPolygonTooltip": false,
            "showPolygonTooltipAction": "click",
            "autoClosePolygonTooltip": true,
            "usePolygonTooltipFunction": false,
            "polygonTooltipPattern": "<b>${entityName}</b><br/><br/><b>TimeStamp:</b> ${ts:7}",
            "polygonColor": "#3388ff",
            "polygonOpacity": 0.2,
            "usePolygonColorFunction": false,
            "polygonStrokeColor": "#3388ff",
            "polygonStrokeOpacity": 1,
            "polygonStrokeWeight": 3,
            "usePolygonStrokeColorFunction": false,
            "showCircle": false,
            "circleKeyName": "perimeter",
            "editableCircle": false,
            "showCircleLabel": false,
            "useCircleLabelFunction": false,
            "circleLabel": "${entityName}",
            "showCircleTooltip": false,
            "showCircleTooltipAction": "click",
            "autoCloseCircleTooltip": true,
            "useCircleTooltipFunction": false,
            "circleTooltipPattern": "<b>${entityName}</b><br/><br/><b>TimeStamp:</b> ${ts:7}",
            "circleFillColor": "#3388ff",
            "circleFillColorOpacity": 0.2,
            "useCircleFillColorFunction": false,
            "circleStrokeColor": "#3388ff",
            "circleStrokeOpacity": 1,
            "circleStrokeWeight": 3,
            "useCircleStrokeColorFunction": false,
            "snappable": false,
            "initDragMode": true,
            "hideAllControlButton": false,
            "hideDrawControlButton": false,
            "hideEditControlButton": false,
            "hideRemoveControlButton": false,
            "useClusterMarkers": false,
            "zoomOnClick": true,
            "maxClusterRadius": 80,
            "animate": true,
            "spiderfyOnMaxZoom": false,
            "showCoverageOnHover": true,
            "chunkedLoading": false,
            "removeOutsideVisibleBounds": true
          },
          "title": "Fields",
          "dropShadow": false,
          "enableFullscreen": false,
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400
          },
          "useDashboardTimewindow": true,
          "showLegend": false,
          "widgetStyle": {},
          "actions": {
            "markerClick": []
          },
          "showTitleIcon": false,
          "titleTooltip": "",
          "enableDataExport": false,
          "widgetCss": "",
          "pageSize": 1024,
          "noDataDisplayMessage": ""
        },
        "row": 0,
        "col": 0,
        "id": "7cfc3255-f459-6eb9-000e-70fef5afbcdb"
      }
    },
    "states": {
      "default": {
        "name": "Irrigation Management",
        "root": true,
        "layouts": {
          "main": {
            "widgets": {
              "9096bb98-7d8a-5888-e77b-7f02c846c922": {
                "sizeX": 10,
                "sizeY": 6,
                "row": 6,
                "col": 0
              },
              "c5f8412d-2ffb-4c44-7a7f-223ceea08d84": {
                "sizeX": 12,
                "sizeY": 6,
                "row": 0,
                "col": 0
              },
              "8ce15aad-9ab2-55ce-2628-a663814d27b1": {
                "sizeX": 7,
                "sizeY": 6,
                "row": 0,
                "col": 12
              }
            },
            "gridSettings": {
              "backgroundColor": "#eeeeee",
              "columns": 24,
              "margin": 10,
              "backgroundSizeMode": "100%",
              "autoFillHeight": true,
              "backgroundImageUrl": null,
              "mobileAutoFillHeight": false,
              "mobileRowHeight": 70
            }
          }
        }
      },
      "field": {
        "name": "${entityName}",
        "root": false,
        "layouts": {
          "main": {
            "widgets": {
              "a6b597ee-cb21-ee9f-dc98-8673f1d976f1": {
                "sizeX": 13,
                "sizeY": 5,
                "row": 0,
                "col": 0
              },
              "8fcd3aed-58d0-0cad-cf63-3a08e1be40a9": {
                "sizeX": 11,
                "sizeY": 5,
                "row": 0,
                "col": 13
              }
            },
            "gridSettings": {
              "backgroundColor": "#eeeeee",
              "columns": 24,
              "margin": 10,
              "backgroundSizeMode": "100%",
              "autoFillHeight": true,
              "backgroundImageUrl": null,
              "mobileAutoFillHeight": false,
              "mobileRowHeight": 70
            }
          }
        }
      },
      "setup_field_polygon": {
        "name": "Setup field polygon",
        "root": false,
        "layouts": {
          "main": {
            "widgets": {
              "7cfc3255-f459-6eb9-000e-70fef5afbcdb": {
                "sizeX": 24,
                "sizeY": 10,
                "row": 0,
                "col": 0
              }
            },
            "gridSettings": {
              "backgroundColor": "#eeeeee",
              "columns": 24,
              "margin": 0,
              "backgroundSizeMode": "100%",
              "autoFillHeight": true,
              "backgroundImageUrl": null,
              "mobileAutoFillHeight": true,
              "mobileRowHeight": 70
            }
          }
        }
      }
    },
    "entityAliases": {
      "cd737d26-3068-aae0-d370-c93f8e7e1a00": {
        "id": "cd737d26-3068-aae0-d370-c93f8e7e1a00",
        "alias": "Fields",
        "filter": {
          "type": "assetType",
          "resolveMultiple": true,
          "assetType": "SI Field",
          "assetNameFilter": ""
        }
      },
      "39927380-423a-872a-0843-de34f99264ad": {
        "id": "39927380-423a-872a-0843-de34f99264ad",
        "alias": "Current field",
        "filter": {
          "type": "stateEntity",
          "resolveMultiple": false,
          "stateEntityParamName": null,
          "defaultStateEntity": null
        }
      },
      "4ed5e77d-3c18-a442-e616-14f73013a686": {
        "id": "4ed5e77d-3c18-a442-e616-14f73013a686",
        "alias": "Irrigation schedule",
        "filter": {
          "type": "schedulerEvent",
          "resolveMultiple": true,
          "originatorStateEntity": true,
          "stateEntityParamName": null,
          "defaultStateEntity": null,
          "originator": null,
          "eventType": "Irrigation"
        }
      },
      "aa55618a-278a-0776-832d-fa1fe5769a2a": {
        "id": "aa55618a-278a-0776-832d-fa1fe5769a2a",
        "alias": "Moisture Sensors",
        "filter": {
          "type": "deviceSearchQuery",
          "resolveMultiple": true,
          "rootStateEntity": true,
          "stateEntityParamName": null,
          "defaultStateEntity": null,
          "rootEntity": null,
          "direction": "FROM",
          "maxLevel": 1,
          "fetchLastLevelOnly": false,
          "relationType": null,
          "deviceTypes": [
            "Soil Moisture Sensor"
          ]
        }
      }
    },
    "filters": {},
    "timewindow": {
      "hideInterval": false,
      "hideLastInterval": false,
      "hideQuickInterval": false,
      "hideAggregation": false,
      "hideAggInterval": false,
      "hideTimezone": false,
      "selectedTab": 0,
      "realtime": {
        "realtimeType": 0,
        "timewindowMs": 604800000,
        "quickInterval": "CURRENT_DAY",
        "interval": 1800000
      },
      "aggregation": {
        "type": "AVG",
        "limit": 25000
      }
    },
    "settings": {
      "stateControllerId": "entity",
      "showTitle": false,
      "showDashboardsSelect": false,
      "showEntitiesSelect": false,
      "showDashboardTimewindow": false,
      "showDashboardExport": true,
      "toolbarAlwaysOpen": true,
      "titleColor": "rgba(0,0,0,0.870588)",
      "showDashboardLogo": false,
      "dashboardLogoUrl": null,
      "hideToolbar": false,
      "showFilters": false,
      "showUpdateDashboardImage": false,
      "dashboardCss": ".tb-widget-container > .tb-widget {\n    border-radius: 8px;\n    box-shadow: 0px 4px 10px rgba(23, 33, 90, 0.08);\n}\n\n.tb-dashboard-content {\n    background: linear-gradient(0deg, rgba(111, 116, 242, 0.04), rgba(111, 116, 242, 0.04)), #FFFFFF !important;\n}\n\n.tb-dashboard-page .tb-widget-container > .tb-widget {\n    color: #868D9C !important;\n}\n\n.tb-dashboard-page .tb-widget-container > .tb-widget .tb-table-widget .mat-table .mat-header-cell {\n    color: #868D9C !important;\n}\n\n.tb-dashboard-page .tb-widget-container > .tb-widget .tb-table-widget .mat-table .mat-cell {\n    color: #868D9C !important;\n}\n\n.tb-dashboard-page .tb-widget-container > .tb-widget .tb-table-widget .mat-table .mat-header-cell .mat-sort-header-arrow {\n    color: #868D9C !important;\n}\n\n.tb-dashboard-page .tb-widget-container > .tb-widget .tb-table-widget .mat-input-element::placeholder {\n    color: #868D9C !important;\n}\n\n.tb-dashboard-page .tb-widget-container > .tb-widget .tb-table-widget .mat-input-element::-moz-placeholder {\n    color: #868D9C !important;\n}\n\n.tb-dashboard-page .tb-widget-container > .tb-widget .tb-table-widget .mat-input-element::-webkit-input-placeholder {\n    color: #868D9C !important;\n}\n\n.tb-dashboard-page .tb-widget-container > .tb-widget .tb-table-widget .mat-input-element:-ms-input-placeholder {\n    color: #868D9C !important;\n}\n\n.tb-dashboard-page .tb-widget-container > .tb-widget .tb-table-widget .mat-table .mat-cell .mat-checkbox-frame,.tb-dashboard-page .tb-widget-container > .tb-widget .tb-table-widget .mat-table .mat-header-cell .mat-checkbox-frame {\n    border-color : #868D9C !important;\n}\n\n.tb-dashboard-page .tb-widget-container > .tb-widget .tb-table-widget .mat-table .mat-cell button.mat-icon-button mat-icon {\n    color: #868D9C !important;\n}\n\n.tb-dashboard-page .tb-widget-container > .tb-widget .tb-table-widget .mat-paginator {\n    color: #868D9C !important;\n}\n\n\n.tb-dashboard-page .tb-widget-container > .tb-widget .tb-table-widget .mat-paginator button.mat-icon-button {\n    color: #868D9C !important;\n}\n\n.tb-dashboard-page .tb-widget-container > .tb-widget .tb-table-widget .mat-paginator .mat-select-value {\n    color: #868D9C !important;\n}\n"
    }
  },
  "externalId": null,
  "name": "Irrigation Management"
}