{
  "type": "SCRIPT",
  "name": "Filter Segment Flowing",
  "entityId": {
    "id": "eea395b0-7c0a-11ef-baac-dd7fa92789f4",
    "entityType": "ASSET"
  },
  "debugSettings": {
    "failuresEnabled": true,
    "allEnabled": false,
    "allEnabledUntil": 1740995914127
  },
  "configurationVersion": 0,
  "configuration": {
    "type": "SCRIPT",
    "arguments": {
      "mainIntakeValveOpened": {
        "refEntityId": {
          "entityType": "DEVICE",
          "id": "eea71820-7c0a-11ef-baac-dd7fa92789f4"
        },
        "refEntityKey": {
          "key": "opened",
          "type": "TS_LATEST"
        },
        "defaultValue": "0"
      },
      "poolDrainValveOpened": {
        "refEntityId": {
          "entityType": "DEVICE",
          "id": "eec156e0-7c0a-11ef-baac-dd7fa92789f4"
        },
        "refEntityKey": {
          "key": "opened",
          "type": "TS_LATEST"
        },
        "defaultValue": "0"
      },
      "poolWeirValveOpened": {
        "refEntityId": {
          "entityType": "DEVICE",
          "id": "eebf0cf0-7c0a-11ef-baac-dd7fa92789f4"
        },
        "refEntityKey": {
          "key": "opened",
          "type": "TS_LATEST"
        },
        "defaultValue": "0"
      },
      "waterLevel": {
        "refEntityId": {
          "entityType": "DEVICE",
          "id": "eec352b0-7c0a-11ef-baac-dd7fa92789f4"
        },
        "refEntityKey": {
          "key": "waterLevel",
          "type": "TS_LATEST"
        },
        "defaultValue": "0"
      },
      "waterPumpActive": {
        "refEntityId": {
          "entityType": "DEVICE",
          "id": "eeaa2560-7c0a-11ef-baac-dd7fa92789f4"
        },
        "refEntityKey": {
          "key": "active",
          "type": "ATTRIBUTE",
          "scope": "SERVER_SCOPE"
        },
        "defaultValue": "false"
      },
      "waterPumpOutgoingValveOpened": {
        "refEntityId": {
          "entityType": "DEVICE",
          "id": "eec54e80-7c0a-11ef-baac-dd7fa92789f4"
        },
        "refEntityKey": {
          "key": "opened",
          "type": "TS_LATEST"
        },
        "defaultValue": "0"
      },
      "waterPumpRunning": {
        "refEntityId": {
          "entityType": "DEVICE",
          "id": "eeaa2560-7c0a-11ef-baac-dd7fa92789f4"
        },
        "refEntityKey": {
          "key": "running",
          "type": "TS_LATEST"
        },
        "defaultValue": "0"
      }
    },
    "expression": "var filterSegmentFlowing = waterPumpActive && calculateFilterSegment();\n\nreturn {\n    \"filterSegmentFlowing\": filterSegmentFlowing\n};\n\nfunction calculateFilterSegment() {\n    if (!(waterPumpOutgoingValveOpened == 1 && waterPumpRunning == 1)) {\n        return false;\n    }\n    \n    return (\n        (poolDrainValveOpened == 1 && waterLevel > 0) ||\n        (poolWeirValveOpened == 1 && waterLevel > 89) ||\n        mainIntakeValveOpened == 1\n    );\n}",
    "output": {
      "type": "ATTRIBUTES",
      "scope": "SERVER_SCOPE"
    }
  }
}
