{
  "title": "Smart Supermarket Administration",
  "image": null,
  "mobileHide": false,
  "mobileOrder": null,
  "configuration": {
    "description": "",
    "widgets": {
      "777ded27-e3b8-d901-ca42-3079a23f7a12": {
        "type": "latest",
        "sizeX": 7.5,
        "sizeY": 6.5,
        "config": {
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 86400000,
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideQuickInterval": false
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1678197897861,
                "endTimeMs": 1678284297861
              },
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideFixedInterval": false,
              "hideQuickInterval": false
            },
            "aggregation": {
              "type": "NONE",
              "limit": 200
            }
          },
          "showTitle": true,
          "backgroundColor": "rgb(255, 255, 255)",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "4px",
          "settings": {
            "enableSearch": true,
            "displayPagination": true,
            "defaultPageSize": 10,
            "defaultSortOrder": "entityName",
            "displayEntityName": true,
            "displayEntityType": false,
            "enableSelectColumnDisplay": true,
            "enableStickyHeader": true,
            "enableStickyAction": true,
            "reserveSpaceForHiddenAction": "true",
            "entitiesTitle": "Retail companies",
            "entityNameColumnTitle": "Name",
            "displayEntityLabel": false,
            "useRowStyleFunction": false
          },
          "title": "Retail companies",
          "dropShadow": true,
          "enableFullscreen": false,
          "titleStyle": {
            "fontSize": "24px",
            "fontWeight": 700,
            "padding": "5px 10px 5px 10px",
            "height": "60px"
          },
          "useDashboardTimewindow": false,
          "showLegend": false,
          "datasources": [
            {
              "type": "entity",
              "name": null,
              "entityAliasId": "04917190-aea7-e407-e308-4598f1671a71",
              "filterId": null,
              "dataKeys": [
                {
                  "name": "address",
                  "type": "attribute",
                  "label": "Address",
                  "color": "#2196f3",
                  "settings": {
                    "columnWidth": "70%",
                    "useCellStyleFunction": false,
                    "cellStyleFunction": "",
                    "useCellContentFunction": false,
                    "cellContentFunction": "",
                    "defaultColumnVisibility": "visible",
                    "columnSelectionToDisplay": "enabled",
                    "columnExportOption": "onlyVisible"
                  },
                  "_hash": 0.1345774127559587,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ]
            }
          ],
          "actions": {
            "rowClick": [
              {
                "name": "Manage supermarkets",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "openDashboardState",
                "targetDashboardStateId": "supermarkets",
                "setEntityId": true,
                "stateEntityParamName": null,
                "openRightLayout": false,
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "5e50c296-0eac-8841-a69a-1cbbfe04d1c5"
              }
            ],
            "actionCellButton": [
              {
                "name": "Manage devices",
                "icon": "devices_other",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "openDashboardState",
                "targetDashboardStateId": "devices",
                "setEntityId": true,
                "stateEntityParamName": null,
                "openRightLayout": false,
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "1ff495e4-f4af-3172-63c3-14c96faf3307"
              },
              {
                "name": "Manage supermarkets",
                "icon": "shopping_cart_checkout",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "openDashboardState",
                "targetDashboardStateId": "supermarkets",
                "setEntityId": true,
                "stateEntityParamName": null,
                "openRightLayout": false,
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "ef986bd4-8ab7-fde5-79e7-52b3bb257474"
              },
              {
                "name": "Manage users",
                "icon": "people",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "openDashboard",
                "targetDashboardStateId": null,
                "setEntityId": true,
                "stateEntityParamName": null,
                "openNewBrowserTab": false,
                "targetDashboardId": "f4952600-0959-11f0-946a-51d518a49b05",
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "347536c1-e013-249a-c93e-acc1706de1bb"
              },
              {
                "name": "Edit company",
                "icon": "edit",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "customPretty",
                "customHtml": "<form #addEntityForm=\"ngForm\" [formGroup]=\"editCompanyFormGroup\"\n      (ngSubmit)=\"save()\" class=\"add-entity-form\" style=\"width: 600px;\">\n  <mat-toolbar class=\"flex flex-row\" color=\"primary\">\n    <h2>Edit company</h2>\n    <span class=\"flex-1\"></span>\n    <button mat-icon-button (click)=\"cancel()\" type=\"button\">\n      <mat-icon class=\"material-icons\">close</mat-icon>\n    </button>\n  </mat-toolbar>\n  <mat-progress-bar color=\"warn\" mode=\"indeterminate\" *ngIf=\"isLoading$ | async\">\n  </mat-progress-bar>\n  <div style=\"height: 4px;\" *ngIf=\"!(isLoading$ | async)\"></div>\n  <div mat-dialog-content class=\"flex flex-col\">\n    <mat-form-field class=\"mat-block flex-1\">\n      <mat-label>Company title</mat-label>\n      <input matInput formControlName=\"title\" required>\n      <mat-error *ngIf=\"editCompanyFormGroup.get('title').hasError('required')\">\n        Company title is required.\n      </mat-error>\n      <mat-error *ngIf=\"editCompanyFormGroup.get('title').hasError('maxlength')\">\n        {{ 'customer.title-max-length' | translate }}\n      </mat-error>\n    </mat-form-field>\n    <tb-contact [parentForm]=\"editCompanyFormGroup\" [isEdit]=\"true\"></tb-contact>\n  </div>\n  <div mat-dialog-actions class=\"flex flex-row items-center justify-end\">\n    <button mat-button color=\"primary\"\n            type=\"button\"\n            [disabled]=\"(isLoading$ | async)\"\n            (click)=\"cancel()\" cdkFocusInitial>\n      Cancel\n    </button>\n    <button mat-button mat-raised-button color=\"primary\"\n            type=\"submit\"\n            [disabled]=\"(isLoading$ | async) || editCompanyFormGroup.invalid || !editCompanyFormGroup.dirty\">\n      Save company\n    </button>\n  </div>\n</form>\n",
                "customCss": "/*=======================================================================*/\n/*==========  There are two examples: for edit and add entity  ==========*/\n/*=======================================================================*/\n/*========================  Edit entity example  ========================*/\n/*=======================================================================*/\n/*\n.edit-entity-form .boolean-value-input {\n    padding-left: 5px;\n}\n\n.edit-entity-form .boolean-value-input .checkbox-label {\n    margin-bottom: 8px;\n    color: rgba(0,0,0,0.54);\n    font-size: 12px;\n}\n\n.relations-list .header {\n    padding-right: 5px;\n    padding-bottom: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .header .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n    font-size: 12px;\n    font-weight: 700;\n    color: rgba(0, 0, 0, .54);\n    white-space: nowrap;\n}\n\n.relations-list .mat-form-field-infix {\n    width: auto !important;\n}\n\n.relations-list .body {\n    padding-right: 5px;\n    padding-bottom: 15px;\n    padding-left: 5px;\n}\n\n.relations-list .body .row {\n    padding-top: 5px;\n}\n\n.relations-list .body .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .body .md-button {\n    margin: 0;\n}\n*/\n/*========================================================================*/\n/*=========================  Add entity example  =========================*/\n/*========================================================================*/\n/*\n.add-entity-form .boolean-value-input {\n    padding-left: 5px;\n}\n\n.add-entity-form .boolean-value-input .checkbox-label {\n    margin-bottom: 8px;\n    color: rgba(0,0,0,0.54);\n    font-size: 12px;\n}\n\n.relations-list .header {\n    padding-right: 5px;\n    padding-bottom: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .header .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n    font-size: 12px;\n    font-weight: 700;\n    color: rgba(0, 0, 0, .54);\n    white-space: nowrap;\n}\n\n.relations-list .mat-form-field-infix {\n    width: auto !important;\n}\n\n.relations-list .body {\n    padding-right: 5px;\n    padding-bottom: 15px;\n    padding-left: 5px;\n}\n\n.relations-list .body .row {\n    padding-top: 5px;\n}\n\n.relations-list .body .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .body .md-button {\n    margin: 0;\n}\n*/\n",
                "customFunction": "const POSTAL_CODE_PATTERNS = {\n  'United States': '(\\\\d{5}([\\\\-]\\\\d{4})?)',\n  'Australia': '[0-9]{4}',\n  'Austria': '[0-9]{4}',\n  'Belgium': '[0-9]{4}',\n  'Brazil': '[0-9]{5}[\\\\-]?[0-9]{3}',\n  'Canada': '^(?!.*[DFIOQU])[A-VXY][0-9][A-Z][ -]?[0-9][A-Z][0-9]$',\n  'Denmark': '[0-9]{3,4}',\n  'Faroe Islands': '[0-9]{3,4}',\n  'Netherlands': '[1-9][0-9]{3}\\\\s?[a-zA-Z]{2}',\n  'Germany': '[0-9]{5}',\n  'Hungary': '[0-9]{4}',\n  'Italy': '[0-9]{5}',\n  'Japan': '\\\\d{3}-\\\\d{4}',\n  'Luxembourg': '(L\\\\s*(-|—|–))\\\\s*?[\\\\d]{4}',\n  'Poland': '[0-9]{2}\\\\-[0-9]{3}',\n  'Spain': '((0[1-9]|5[0-2])|[1-4][0-9])[0-9]{3}',\n  'Sweden': '\\\\d{3}\\\\s?\\\\d{2}',\n  'United Kingdom': '[A-Za-z]{1,2}[0-9Rr][0-9A-Za-z]? [0-9][ABD-HJLNP-UW-Zabd-hjlnp-uw-z]{2}'\n};\n\nlet $injector = widgetContext.$scope.$injector;\nlet customDialog = $injector.get(widgetContext.servicesMap.get('customDialog'));\nlet customerService = $injector.get(widgetContext.servicesMap.get('customerService'));\nlet entityGroupService = $injector.get(widgetContext.servicesMap.get('entityGroupService'));\nlet attributeService = $injector.get(widgetContext.servicesMap.get('attributeService'));\n\nopenEditCompanyDialog();\n\nfunction openEditCompanyDialog() {\n  customDialog.customDialog(htmlTemplate, EditCompanyDialogController).subscribe();\n}\n\nfunction EditCompanyDialogController(instance) {\n  let vm = instance;\n  \n  vm.customer = {};\n\n  vm.editCompanyFormGroup = vm.fb.group({\n    title: ['', [vm.validators.required, vm.validators.maxLength(255)]]\n  });\n  \n  vm.editCompanyFormGroup.addControl('country', vm.fb.control('', []));\n  vm.editCompanyFormGroup.addControl('city', vm.fb.control('', []));\n  vm.editCompanyFormGroup.addControl('state', vm.fb.control('', []));\n  vm.editCompanyFormGroup.addControl('zip', vm.fb.control('',\n      zipValidators('')\n  ));\n  vm.editCompanyFormGroup.addControl('address', vm.fb.control('', []));\n  vm.editCompanyFormGroup.addControl('address2', vm.fb.control('', []));\n  vm.editCompanyFormGroup.addControl('phone', vm.fb.control('', []));\n  vm.editCompanyFormGroup.addControl('email', vm.fb.control('', [vm.validators.email]));\n  \n  \n  vm.editCompanyFormGroup.get('country').valueChanges.subscribe(\n      (country) => {\n        vm.editCompanyFormGroup.get('zip').setValidators(zipValidators(country));\n        vm.editCompanyFormGroup.get('zip').updateValueAndValidity({onlySelf: true});\n        vm.editCompanyFormGroup.get('zip').markAsTouched({onlySelf: true});\n      }\n  );\n  \n  getCompany();\n\n\n  vm.cancel = function () {\n    vm.dialogRef.close(null);\n  };\n  \n  vm.save = function () {\n    vm.editCompanyFormGroup.markAsPristine();\n    saveCompanyObservable().subscribe(\n      function (customer) {\n          widgetContext.rxjs.forkJoin([\n              saveAttributes(customer)\n          ]).subscribe(\n              function () {\n                widgetContext.updateAliases();\n                vm.dialogRef.close(null);\n              }\n        );\n      }\n    );\n  };\n  \n  function getCompany() {\n      customerService.getCustomer(entityId.id).subscribe(\n          (customer) => {\n                vm.customer = customer;          \n                vm.editCompanyFormGroup.patchValue({\n                  title: vm.customer.title,\n                  country: vm.customer.country,\n                  city: vm.customer.city,\n                  state: vm.customer.state,\n                  zip: vm.customer.zip,\n                  address: vm.customer.address,\n                  address2: vm.customer.address2,\n                  phone: vm.customer.phone,\n                  email: vm.customer.email\n                }, {emitEvent: false});\n                vm.editCompanyFormGroup.get('zip').setValidators(zipValidators(vm.customer.country));\n                vm.editCompanyFormGroup.get('zip').updateValueAndValidity({onlySelf: true});\n          }\n    );\n  }\n  \n  function zipValidators(country) {\n    const zipValidators = [];\n    if (country && POSTAL_CODE_PATTERNS[country]) {\n      const postalCodePattern = POSTAL_CODE_PATTERNS[country];\n      zipValidators.push(vm.validators.pattern(postalCodePattern));\n    }\n    return zipValidators;\n  }\n\n  function saveCompanyObservable() {\n      const formValues = vm.editCompanyFormGroup.value;\n      vm.customer.title = formValues.title;\n      vm.customer.country = formValues.country;\n      vm.customer.city = formValues.city;\n      vm.customer.state = formValues.state;\n      vm.customer.zip = formValues.zip;\n      vm.customer.address = formValues.address;\n      vm.customer.address2 = formValues.address2;\n      vm.customer.phone = formValues.phone;\n      vm.customer.email = formValues.email;\n      return customerService.saveCustomer(vm.customer);\n  }\n  \n  function saveAttributes(customer) {\n    let attributesArray = [\n        {\n            key: 'type',\n            value: 'retail'\n        },\n        {\n            key: 'address',\n            value: getAddressValue(customer)\n        }\n    ];\n    return attributeService.saveEntityAttributes(customer.id, \"SERVER_SCOPE\", attributesArray);\n  }\n  \n  function getAddressValue(customer) {\n      var address = '';\n      if (customer.address) {\n          address += customer.address;\n      }\n      if (customer.address2) {\n          address += (address ? ', ' : '') + customer.address2;\n      }\n      if (customer.city) {\n          address += (address ? ', ' : '') + customer.city;\n      }\n      if (customer.state) {\n          address += (address ? ', ' : '') + customer.state;\n      }\n      if (customer.zip) {\n          address += (customer.state ? ' ' : (address ? ', ' : '')) + customer.zip;\n      }\n      if (customer.country) {\n          address += (address ? ', ' : '') + customer.country;\n      }\n      return address;\n  }\n}\n",
                "customResources": [],
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "449af9be-1767-a18a-2e1b-cfba5b6ee674"
              },
              {
                "name": "Delete company",
                "icon": "delete",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "customFunction": "var $injector = widgetContext.$scope.$injector;\nvar dialogs = $injector.get(widgetContext.servicesMap.get('dialogs'));\nvar customerService = $injector.get(widgetContext.servicesMap.get('customerService'));\n\nopenDeleteCustomerDialog();\n\nfunction openDeleteCustomerDialog() {\n  var title = 'Are you sure you want to delete the company ' + entityName + '?';\n  var content = 'Be careful, after the confirmation, the company and all related data will become unrecoverable!';\n  dialogs.confirm(title, content, 'Cancel', 'Delete').subscribe(\n    function(result) {\n      if (result) {\n        deleteCustomer();\n      }\n    }\n  );\n}\n\nfunction deleteCustomer() {\n  customerService.deleteCustomer(entityId.id).subscribe(\n    function() {\n      widgetContext.updateAliases();\n    }\n  );\n}\n",
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "b8747e47-5bc7-db5a-8f81-816c24eec09a"
              }
            ],
            "headerButton": [
              {
                "name": "Add company",
                "icon": "add",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "customPretty",
                "customHtml": "<form #addEntityForm=\"ngForm\" [formGroup]=\"addCompanyFormGroup\"\n      (ngSubmit)=\"save()\" class=\"add-entity-form\" style=\"width: 600px;\">\n  <mat-toolbar class=\"flex flex-row\" color=\"primary\">\n    <h2>Add company</h2>\n    <span class=\"flex-1\"></span>\n    <button mat-icon-button (click)=\"cancel()\" type=\"button\">\n      <mat-icon class=\"material-icons\">close</mat-icon>\n    </button>\n  </mat-toolbar>\n  <mat-progress-bar color=\"warn\" mode=\"indeterminate\" *ngIf=\"isLoading$ | async\">\n  </mat-progress-bar>\n  <div style=\"height: 4px;\" *ngIf=\"!(isLoading$ | async)\"></div>\n  <div mat-dialog-content class=\"flex flex-col\">\n    <mat-form-field class=\"mat-block flex-1\">\n      <mat-label>Company title</mat-label>\n      <input matInput formControlName=\"title\" required>\n      <mat-error *ngIf=\"addCompanyFormGroup.get('title').hasError('required')\">\n        Company title is required.\n      </mat-error>\n      <mat-error *ngIf=\"addCompanyFormGroup.get('title').hasError('maxlength')\">\n        {{ 'customer.title-max-length' | translate }}\n      </mat-error>\n    </mat-form-field>\n    <tb-contact [parentForm]=\"addCompanyFormGroup\" [isEdit]=\"true\"></tb-contact>\n  </div>\n  <div mat-dialog-actions class=\"flex flex-row items-center justify-end\">\n    <button mat-button color=\"primary\"\n            type=\"button\"\n            [disabled]=\"(isLoading$ | async)\"\n            (click)=\"cancel()\" cdkFocusInitial>\n      Cancel\n    </button>\n    <button mat-button mat-raised-button color=\"primary\"\n            type=\"submit\"\n            [disabled]=\"(isLoading$ | async) || addCompanyFormGroup.invalid || !addCompanyFormGroup.dirty\">\n      Add company\n    </button>\n  </div>\n</form>\n",
                "customCss": "/*=======================================================================*/\n/*==========  There are two examples: for edit and add entity  ==========*/\n/*=======================================================================*/\n/*========================  Edit entity example  ========================*/\n/*=======================================================================*/\n/*\n.edit-entity-form .boolean-value-input {\n    padding-left: 5px;\n}\n\n.edit-entity-form .boolean-value-input .checkbox-label {\n    margin-bottom: 8px;\n    color: rgba(0,0,0,0.54);\n    font-size: 12px;\n}\n\n.relations-list .header {\n    padding-right: 5px;\n    padding-bottom: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .header .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n    font-size: 12px;\n    font-weight: 700;\n    color: rgba(0, 0, 0, .54);\n    white-space: nowrap;\n}\n\n.relations-list .mat-form-field-infix {\n    width: auto !important;\n}\n\n.relations-list .body {\n    padding-right: 5px;\n    padding-bottom: 15px;\n    padding-left: 5px;\n}\n\n.relations-list .body .row {\n    padding-top: 5px;\n}\n\n.relations-list .body .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .body .md-button {\n    margin: 0;\n}\n*/\n/*========================================================================*/\n/*=========================  Add entity example  =========================*/\n/*========================================================================*/\n/*\n.add-entity-form .boolean-value-input {\n    padding-left: 5px;\n}\n\n.add-entity-form .boolean-value-input .checkbox-label {\n    margin-bottom: 8px;\n    color: rgba(0,0,0,0.54);\n    font-size: 12px;\n}\n\n.relations-list .header {\n    padding-right: 5px;\n    padding-bottom: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .header .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n    font-size: 12px;\n    font-weight: 700;\n    color: rgba(0, 0, 0, .54);\n    white-space: nowrap;\n}\n\n.relations-list .mat-form-field-infix {\n    width: auto !important;\n}\n\n.relations-list .body {\n    padding-right: 5px;\n    padding-bottom: 15px;\n    padding-left: 5px;\n}\n\n.relations-list .body .row {\n    padding-top: 5px;\n}\n\n.relations-list .body .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .body .md-button {\n    margin: 0;\n}\n*/\n",
                "customFunction": "const POSTAL_CODE_PATTERNS = {\n  'United States': '(\\\\d{5}([\\\\-]\\\\d{4})?)',\n  'Australia': '[0-9]{4}',\n  'Austria': '[0-9]{4}',\n  'Belgium': '[0-9]{4}',\n  'Brazil': '[0-9]{5}[\\\\-]?[0-9]{3}',\n  'Canada': '^(?!.*[DFIOQU])[A-VXY][0-9][A-Z][ -]?[0-9][A-Z][0-9]$',\n  'Denmark': '[0-9]{3,4}',\n  'Faroe Islands': '[0-9]{3,4}',\n  'Netherlands': '[1-9][0-9]{3}\\\\s?[a-zA-Z]{2}',\n  'Germany': '[0-9]{5}',\n  'Hungary': '[0-9]{4}',\n  'Italy': '[0-9]{5}',\n  'Japan': '\\\\d{3}-\\\\d{4}',\n  'Luxembourg': '(L\\\\s*(-|—|–))\\\\s*?[\\\\d]{4}',\n  'Poland': '[0-9]{2}\\\\-[0-9]{3}',\n  'Spain': '((0[1-9]|5[0-2])|[1-4][0-9])[0-9]{3}',\n  'Sweden': '\\\\d{3}\\\\s?\\\\d{2}',\n  'United Kingdom': '[A-Za-z]{1,2}[0-9Rr][0-9A-Za-z]? [0-9][ABD-HJLNP-UW-Zabd-hjlnp-uw-z]{2}'\n};\n\nlet $injector = widgetContext.$scope.$injector;\nlet customDialog = $injector.get(widgetContext.servicesMap.get('customDialog'));\nlet customerService = $injector.get(widgetContext.servicesMap.get('customerService'));\nlet entityGroupService = $injector.get(widgetContext.servicesMap.get('entityGroupService'));\nlet roleService = $injector.get(widgetContext.servicesMap.get('roleService'));\nlet attributeService = $injector.get(widgetContext.servicesMap.get('attributeService'));\n\nopenAddCompanyDialog();\n\nfunction openAddCompanyDialog() {\n  customDialog.customDialog(htmlTemplate, AddCompanyDialogController).subscribe();\n}\n\nfunction AddCompanyDialogController(instance) {\n  let vm = instance;\n\n  vm.addCompanyFormGroup = vm.fb.group({\n    title: ['', [vm.validators.required, vm.validators.maxLength(255)]]\n  });\n  \n  vm.addCompanyFormGroup.addControl('country', vm.fb.control('', []));\n  vm.addCompanyFormGroup.addControl('city', vm.fb.control('', []));\n  vm.addCompanyFormGroup.addControl('state', vm.fb.control('', []));\n  vm.addCompanyFormGroup.addControl('zip', vm.fb.control('',\n      zipValidators('')\n  ));\n  vm.addCompanyFormGroup.addControl('address', vm.fb.control('', []));\n  vm.addCompanyFormGroup.addControl('address2', vm.fb.control('', []));\n  vm.addCompanyFormGroup.addControl('phone', vm.fb.control('', []));\n  vm.addCompanyFormGroup.addControl('email', vm.fb.control('', [vm.validators.email]));\n  \n  \n  vm.addCompanyFormGroup.get('country').valueChanges.subscribe(\n      (country) => {\n        vm.addCompanyFormGroup.get('zip').setValidators(zipValidators(country));\n        vm.addCompanyFormGroup.get('zip').updateValueAndValidity({onlySelf: true});\n        vm.addCompanyFormGroup.get('zip').markAsTouched({onlySelf: true});\n      }\n  );\n\n\n  vm.cancel = function () {\n    vm.dialogRef.close(null);\n  };\n  \n  vm.save = function () {\n    vm.addCompanyFormGroup.markAsPristine();\n    saveCompanyObservable().subscribe(\n      function (customer) {\n          widgetContext.rxjs.forkJoin([\n              saveAttributes(customer),\n              saveUserGroups(customer.id)\n          ]).subscribe(\n              function () {\n                widgetContext.updateAliases();\n                vm.dialogRef.close(null);\n              }\n        );\n      }\n    );\n  };\n  \n  function zipValidators(country) {\n    const zipValidators = [];\n    if (country && POSTAL_CODE_PATTERNS[country]) {\n      const postalCodePattern = POSTAL_CODE_PATTERNS[country];\n      zipValidators.push(vm.validators.pattern(postalCodePattern));\n    }\n    return zipValidators;\n  }\n\n  function saveCompanyObservable() {\n      return getOrCreateSmartRetailCustomerGroup().pipe(\n          widgetContext.rxjs.switchMap((smartRetail) => {\n              const formValues = vm.addCompanyFormGroup.value;\n              let customer = {\n                  title: formValues.title,\n                  country: formValues.country,\n                  city: formValues.city,\n                  state: formValues.state,\n                  zip: formValues.zip,\n                  address: formValues.address,\n                  address2: formValues.address2,\n                  phone: formValues.phone,\n                  email: formValues.email\n              };\n              return customerService.saveCustomer(customer, smartRetail.id.id);\n          })\n      );\n  }\n  \n  function getOrCreateSmartRetailCustomerGroup() {\n      return getEntityGroupByName(\"Smart Retail\", \"CUSTOMER\").pipe(\n          widgetContext.rxjs.switchMap((group) => {\n              if (group) {\n                  return widgetContext.rxjs.of(group);\n              } else {\n                  var smartRetail = {\n                    type: 'CUSTOMER',\n                    name: 'Smart Retail'\n                  };\n                  return entityGroupService.saveEntityGroup(smartRetail);\n              }\n          })\n      );\n  }\n  \n  function saveUserGroups(customerId) {\n      \n      return widgetContext.rxjs.forkJoin([\n         getRoleByName(\"Smart Retail Read Only\", \"GROUP\"),\n         getRoleByName(\"Smart Retail User\", \"GENERIC\"),\n         getRoleByName(\"Smart Retail Administrator\", \"GENERIC\"),\n         getEntityGroupByName(\"Supermarket Users Shared\", \"DASHBOARD\"),\n         getEntityGroupByName(\"Supermarket Administrators Shared\", \"DASHBOARD\")\n      ]).pipe(widgetContext.rxjs.switchMap((data) => {\n          \n            var smartRetailReadOnlyGroupRole = data[0];\n            var smartRetailUserGenericRole = data[1];\n            var smartRetailAdministratorGenericRole = data[2];\n            var smartSupermarketSharedGroup = data[3];\n            var smartSupermarketGroup = data[4];\n            \n            var smartRetailUsers = {\n              type: 'USER',\n              name: 'Smart Retail Users',\n              ownerId: customerId\n            };\n            \n            var smartRetailAdministrators = {\n              type: 'USER',\n              name: 'Smart Retail Administrators',\n              ownerId: customerId\n            };\n    \n            return widgetContext.rxjs.forkJoin([\n                entityGroupService.saveEntityGroup(smartRetailUsers),\n                entityGroupService.saveEntityGroup(smartRetailAdministrators)\n            ]).pipe(widgetContext.rxjs.switchMap((data) => {\n                var smartRetailUsersGroup = data[0];\n                var smartRetailAdministratorsGroup = data[1];\n                const tasks = [];\n\n                if (smartRetailReadOnlyGroupRole) {\n                    if (smartSupermarketSharedGroup) {\n                        let smartSupermarketSharedGroupPermissionForUsers = {\n                            userGroupId: smartRetailUsersGroup.id,\n                            roleId: smartRetailReadOnlyGroupRole.id,\n                            entityGroupId: smartSupermarketSharedGroup.id,\n                            entityGroupType: smartSupermarketSharedGroup.type\n                        };\n                        let smartSupermarketSharedGroupPermissionForAdmins = {\n                            userGroupId: smartRetailAdministratorsGroup.id,\n                            roleId: smartRetailReadOnlyGroupRole.id,\n                            entityGroupId: smartSupermarketSharedGroup.id,\n                            entityGroupType: smartSupermarketSharedGroup.type\n                        };\n                        tasks.push(roleService.saveGroupPermission(smartSupermarketSharedGroupPermissionForUsers));\n                        tasks.push(roleService.saveGroupPermission(smartSupermarketSharedGroupPermissionForAdmins));\n                    }\n                    if (smartSupermarketGroup) {\n                        let smartSupermarketGroupPermissionForAdmins = {\n                            userGroupId: smartRetailAdministratorsGroup.id,\n                            roleId: smartRetailReadOnlyGroupRole.id,\n                            entityGroupId: smartSupermarketGroup.id,\n                            entityGroupType: smartSupermarketGroup.type\n                        };\n                        tasks.push(roleService.saveGroupPermission(smartSupermarketGroupPermissionForAdmins));\n                    }\n                }\n\n                if (smartRetailUserGenericRole) {\n                    let smartRetailUserGenericPermission = {\n                        userGroupId: smartRetailUsersGroup.id,\n                        roleId: smartRetailUserGenericRole.id\n                    };\n                    tasks.push(roleService.saveGroupPermission(smartRetailUserGenericPermission));\n                }\n\n                if (smartRetailAdministratorGenericRole) {\n                    let smartRetailAdminGenericPermission = {\n                        userGroupId: smartRetailAdministratorsGroup.id,\n                        roleId: smartRetailAdministratorGenericRole.id\n                    };\n                    tasks.push(roleService.saveGroupPermission(smartRetailAdminGenericPermission));\n                }\n                \n                if (tasks.length) {\n                    return widgetContext.rxjs.forkJoin(tasks);\n                } else {\n                    return widgetContext.rxjs.of(null);\n                }\n            }));\n          \n      }));\n      \n  }\n  \n  function getRoleByName(roleName, type) {\n      var rolesPageLink = widgetContext.pageLink(10, 0, roleName);\n      return roleService.getRoles(rolesPageLink, type, {ignoreLoading: true}).pipe(\n          widgetContext.rxjs.map((data) => {\n            if (data.data.length) {\n                return data.data.find((role) => role.name === roleName);\n            } else {\n                return null;\n            }\n          })\n      );\n  }\n  \n  function getEntityGroupByName(groupName, groupType) {\n      var entityGroupsPageLink = widgetContext.pageLink(10, 0, groupName);\n      return entityGroupService.getEntityGroupsByPageLink(entityGroupsPageLink, groupType, {ignoreLoading: true}).pipe(\n          widgetContext.rxjs.map((data) => {\n            if (data.data.length) {\n                return data.data.find((group) => group.name === groupName);\n            } else {\n                return null;\n            }\n          })\n      );\n  }\n  \n  function saveAttributes(customer) {\n    let attributesArray = [\n        {\n            key: 'address',\n            value: getAddressValue(customer)\n        }\n    ];\n    return attributeService.saveEntityAttributes(customer.id, \"SERVER_SCOPE\", attributesArray);\n  }\n  \n  function getAddressValue(customer) {\n      var address = '';\n      if (customer.address) {\n          address += customer.address;\n      }\n      if (customer.address2) {\n          address += (address ? ', ' : '') + customer.address2;\n      }\n      if (customer.city) {\n          address += (address ? ', ' : '') + customer.city;\n      }\n      if (customer.state) {\n          address += (address ? ', ' : '') + customer.state;\n      }\n      if (customer.zip) {\n          address += (customer.state ? ' ' : (address ? ', ' : '')) + customer.zip;\n      }\n      if (customer.country) {\n          address += (address ? ', ' : '') + customer.country;\n      }\n      return address;\n  }\n}\n",
                "customResources": [],
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "f089248b-5725-30f6-58dd-64e50dfb0496"
              }
            ]
          },
          "showTitleIcon": false,
          "titleTooltip": "",
          "enableDataExport": false,
          "widgetStyle": {},
          "widgetCss": "",
          "noDataDisplayMessage": ""
        },
        "row": 0,
        "col": 0,
        "id": "777ded27-e3b8-d901-ca42-3079a23f7a12",
        "typeFullFqn": "system.cards.entities_table"
      },
      "c2559a58-e82d-3250-7e35-f520ced0d916": {
        "type": "latest",
        "sizeX": 5,
        "sizeY": 3.5,
        "config": {
          "datasources": [],
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideQuickInterval": false
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1678197897861,
                "endTimeMs": 1678284297861
              },
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideFixedInterval": false,
              "hideQuickInterval": false
            },
            "aggregation": {
              "type": "AVG",
              "limit": 25000
            }
          },
          "showTitle": false,
          "backgroundColor": "#fff",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "0px",
          "settings": {
            "markdownTextFunction": "return '# Some title\\n - Entity name: ' + data[0]['entityName'];",
            "useMarkdownTextFunction": false,
            "markdownTextPattern": "<div style=\"width: 100%; height: 100%; padding: 0;\">\n   <tb-dashboard-state *ngIf=\"ctx.currentUser.authority === 'TENANT_ADMIN'\" [ctx]=\"ctx\" [syncParentStateParams]=\"true\" stateId=\"retail_companies\"></tb-dashboard-state>\n   <tb-dashboard-state *ngIf=\"ctx.currentUser.authority === 'CUSTOMER_USER'\" [ctx]=\"ctx\" [syncParentStateParams]=\"true\" stateId=\"supermarkets\"></tb-dashboard-state>\n</div>"
          },
          "title": "New Markdown/HTML Card",
          "showTitleIcon": false,
          "iconColor": "rgba(0, 0, 0, 0.87)",
          "iconSize": "24px",
          "titleTooltip": "",
          "dropShadow": true,
          "enableFullscreen": false,
          "widgetStyle": {},
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400
          },
          "showLegend": false,
          "enableDataExport": false,
          "widgetCss": "",
          "noDataDisplayMessage": ""
        },
        "row": 0,
        "col": 0,
        "id": "c2559a58-e82d-3250-7e35-f520ced0d916",
        "typeFullFqn": "system.cards.markdown_card"
      },
      "28303a0b-d427-6d9e-0ee1-ae2c3f344769": {
        "type": "latest",
        "sizeX": 5,
        "sizeY": 3.5,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "name": null,
              "entityAliasId": "7add11d8-cbf7-fd15-6b12-d5df058f11fa",
              "filterId": null,
              "dataKeys": []
            }
          ],
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideQuickInterval": false
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1678197897861,
                "endTimeMs": 1678284297861
              },
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideFixedInterval": false,
              "hideQuickInterval": false
            },
            "aggregation": {
              "type": "AVG",
              "limit": 25000
            }
          },
          "showTitle": false,
          "backgroundColor": "#fff",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "8px",
          "settings": {
            "useMarkdownTextFunction": false,
            "markdownTextPattern": "<div class=\"main-layout flex size-full flex-col\">\n  <div class=\"flex flex-row\">\n    <tb-dashboard-state [ctx]=\"ctx\" [syncParentStateParams]=\"true\" class=\"flex-1\" style=\"height: 80px;\" stateId='edit_supermarket_title'></tb-dashboard-state>\n  </div>\n  <div class=\"flex flex-row\">\n    <tb-dashboard-state [ctx]=\"ctx\" [syncParentStateParams]=\"true\" class=\"flex-1\" style=\"height: 200px;\" stateId='edit_supermarket_floorplan'></tb-dashboard-state>\n  </div>\n  <div class=\"flex flex-row\">\n    <tb-dashboard-state [ctx]=\"ctx\" [syncParentStateParams]=\"true\" class=\"flex-1\" style=\"height: 80px;\" stateId='edit_supermarket_address'></tb-dashboard-state>\n  </div>\n  <tb-dashboard-state [ctx]=\"ctx\" [syncParentStateParams]=\"true\" class=\"flex-1\" stateId='edit_supermarket_location'></tb-dashboard-state>\n</div>",
            "applyDefaultMarkdownStyle": false,
            "markdownCss": ".tb-markdown-view .tb-progress-cover, .tb-markdown-view .mat-drawer-container {\n    background-color: #fff;\n}\n.tb-markdown-view div, .tb-markdown-view p {\n    line-height: normal;\n}\n\n.tb-markdown-view .mat-toolbar.mat-primary div {\n    color: var(--tb-primary-contrast-500);\n}\n"
          },
          "title": "New Markdown/HTML Card",
          "showTitleIcon": false,
          "iconColor": "rgba(0, 0, 0, 0.87)",
          "iconSize": "24px",
          "titleTooltip": "",
          "dropShadow": false,
          "enableFullscreen": false,
          "widgetStyle": {},
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400
          },
          "showLegend": false,
          "enableDataExport": false,
          "widgetCss": "",
          "noDataDisplayMessage": "",
          "actions": {
            "elementClick": [
              {
                "name": "save-title",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "customFunction": "const targetElement = $($event.target).closest('#save-title', widgetContext.$container[0]);\n\nvar title = $(targetElement).attr('data-title');\n\nwidgetContext.assetService.getAsset(entityId.id, {ignoreLoading: true}).subscribe((supermarket) => {\n    supermarket.name = title;\n    widgetContext.assetService.saveAsset(supermarket, null, {ignoreLoading: true}).subscribe(() => {\n       var stateParams = widgetContext.stateController.getStateParams();\n       stateParams.selectedSupermarket.entityName = title;\n       widgetContext.stateController.updateState(null, stateParams);\n       /*if (widgetContext.parentDashboard) {\n           widgetContext.parentDashboard.aliasController.updateAliases();\n       }\n       widgetContext.updateAliases();*/\n    });\n});\n",
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "088a4799-8551-7ab4-892f-2a08d6d40a7c"
              }
            ]
          }
        },
        "row": 0,
        "col": 0,
        "id": "28303a0b-d427-6d9e-0ee1-ae2c3f344769",
        "typeFullFqn": "system.cards.markdown_card"
      },
      "4a524a3c-2b87-903c-6256-47a5df398ba5": {
        "type": "latest",
        "sizeX": 7.5,
        "sizeY": 6.5,
        "config": {
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 86400000,
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideQuickInterval": false
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1678197897861,
                "endTimeMs": 1678284297861
              },
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideFixedInterval": false,
              "hideQuickInterval": false
            },
            "aggregation": {
              "type": "NONE",
              "limit": 200
            }
          },
          "showTitle": true,
          "backgroundColor": "rgb(255, 255, 255)",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "4px",
          "settings": {
            "enableSearch": true,
            "displayPagination": true,
            "defaultPageSize": 10,
            "defaultSortOrder": "entityName",
            "displayEntityName": true,
            "displayEntityType": false,
            "enableSelectColumnDisplay": true,
            "enableStickyHeader": true,
            "enableStickyAction": true,
            "reserveSpaceForHiddenAction": "true",
            "entitiesTitle": "Supermarkets",
            "entityNameColumnTitle": "Name",
            "displayEntityLabel": false,
            "useRowStyleFunction": false
          },
          "title": "Supermarkets",
          "dropShadow": false,
          "enableFullscreen": false,
          "titleStyle": {
            "fontSize": "24px",
            "fontWeight": 700,
            "padding": "5px 10px 5px 10px",
            "height": "60px"
          },
          "useDashboardTimewindow": false,
          "showLegend": false,
          "datasources": [
            {
              "type": "entity",
              "name": null,
              "entityAliasId": "1c348dad-e738-a4db-5e7e-4c0271790ab7",
              "filterId": null,
              "dataKeys": [
                {
                  "name": "address",
                  "type": "attribute",
                  "label": "Address",
                  "color": "#2196f3",
                  "settings": {
                    "columnWidth": "70%",
                    "useCellStyleFunction": false,
                    "cellStyleFunction": "",
                    "useCellContentFunction": false,
                    "cellContentFunction": "",
                    "defaultColumnVisibility": "visible",
                    "columnSelectionToDisplay": "enabled",
                    "columnExportOption": "onlyVisible"
                  },
                  "_hash": 0.1345774127559587,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ]
            }
          ],
          "actions": {
            "rowClick": [
              {
                "name": "Select supermarket",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "updateDashboardState",
                "targetDashboardStateId": null,
                "setEntityId": true,
                "stateEntityParamName": "selectedSupermarket",
                "openRightLayout": false,
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "5e50c296-0eac-8841-a69a-1cbbfe04d1c5"
              }
            ],
            "actionCellButton": [
              {
                "name": "Open supermarket devices",
                "icon": "devices_other",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "openDashboardState",
                "targetDashboardStateId": "supermarket_devices",
                "setEntityId": true,
                "stateEntityParamName": "selectedSupermarket",
                "openRightLayout": false,
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "71c478b6-a4b1-e569-e99a-85d5562cc721"
              },
              {
                "name": "Delete supermarket",
                "icon": "delete",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "customFunction": "var $injector = widgetContext.$scope.$injector;\nvar dialogs = $injector.get(widgetContext.servicesMap.get('dialogs'));\nvar assetService = $injector.get(widgetContext.servicesMap.get('assetService'));\nvar entityRelationService = $injector.get(widgetContext.servicesMap.get('entityRelationService'));\nvar entityGroupService = $injector.get(widgetContext.servicesMap.get('entityGroupService'));\nlet attributeService = $injector.get(widgetContext.servicesMap.get('attributeService'));\n\nopenDeleteSupermarketDialog();\n\nfunction openDeleteSupermarketDialog() {\n  var title = 'Are you sure you want to delete the supermarket ' + entityName + '?';\n  var content = 'Be careful, after the confirmation, the supermarket will be deleted and all related devices will be unassigned!';\n  dialogs.confirm(title, content, 'Cancel', 'Delete').subscribe(\n    function(result) {\n      if (result) {\n        deleteSupermarket();\n      }\n    }\n  );\n}\n\nfunction deleteSupermarket() {\n  var customerId;\n  if (widgetContext.currentUser.authority === 'TENANT_ADMIN') {\n       customerId = widgetContext.stateController.getStateParams().entityId;\n  } else {\n       customerId = { id: widgetContext.currentUser.customerId, entityType: 'CUSTOMER'};\n  }\n  var relatedDevicesQuery = {\n      parameters: {\n          rootId: entityId.id,\n          rootType: entityId.entityType,\n          direction: 'FROM'\n      },\n      filters: [{ relationType: 'Contains', entityTypes: ['DEVICE'] }]\n  };\n  entityRelationService.findByQuery(relatedDevicesQuery).subscribe((relatedDevicesRelations) => {\n      var removeDevicesObservable;\n      if (relatedDevicesRelations.length) {\n          removeDevicesObservable = getUnassignedDevicesGroup(customerId).pipe(\n              widgetContext.rxjs.switchMap((unassignedDevicesGroup) => {\n                  var removeDevicesObservables = [];\n                  relatedDevicesRelations.forEach((deviceRelation) => {\n                     removeDevicesObservables.push(removeDevice(deviceRelation.to, unassignedDevicesGroup.id.id));\n                  });\n                  return widgetContext.rxjs.forkJoin(removeDevicesObservables);\n              })\n          );\n      } else {\n          removeDevicesObservable = widgetContext.rxjs.of(null);\n      }\n      removeDevicesObservable.subscribe(() => {\n          assetService.deleteAsset(entityId.id).subscribe(\n            function() {\n                widgetContext.updateAliases();\n            }\n          );\n      });\n  });\n}\n\nfunction removeDevice(deviceId, unassignedDevicesGroupId) {\n    return widgetContext.rxjs.forkJoin([\n        entityGroupService.addEntityToEntityGroup(unassignedDevicesGroupId, deviceId.id),\n        deleteSupermarketToDeviceRelation(deviceId),\n        removePositionAttributes(deviceId)\n    ]);\n}\n\nfunction getUnassignedDevicesGroup(customerId) {\n    return entityGroupService.getEntityGroupsByOwnerId(customerId.entityType, customerId.id, 'DEVICE').pipe(\n        widgetContext.rxjs.switchMap((deviceEntityGroups) => {\n            return getOrCreateUnassignedDevicesGroup(customerId, deviceEntityGroups);\n        })\n    );\n}\n\nfunction getOrCreateUnassignedDevicesGroup(customerId, groups) {\n  var unassignedDevicesGroup = groups.find(group => group.name === 'Unassigned Supermarket Devices');\n  if (unassignedDevicesGroup) {\n      return widgetContext.rxjs.of(unassignedDevicesGroup);\n  } else {\n      unassignedDevicesGroup = {\n          type: 'DEVICE',\n          name: 'Unassigned Supermarket Devices',\n          ownerId: customerId\n      };\n      return entityGroupService.saveEntityGroup(unassignedDevicesGroup);\n  }\n}\n\nfunction deleteSupermarketToDeviceRelation(deviceId) {\n    return entityRelationService.deleteRelation(entityId, 'Contains', deviceId);\n}\n\nfunction removePositionAttributes(entityId) {\n    return attributeService.deleteEntityAttributes(entityId, \"SERVER_SCOPE\", [{key: 'xPos'},{key: 'yPos'}]);\n}",
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "338d9fd7-c752-eb0e-4687-2c2e32ca1a32"
              }
            ],
            "headerButton": [
              {
                "name": "Add supermarket",
                "icon": "add",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "customPretty",
                "customHtml": "<form #addEntityForm=\"ngForm\" [formGroup]=\"addSupermarketFormGroup\"\n      (ngSubmit)=\"save()\" class=\"add-entity-form\" style=\"width: 350px;\">\n  <mat-toolbar class=\"flex flex-row\" color=\"primary\">\n    <h2>Add supermarket</h2>\n    <span class=\"flex-1\"></span>\n    <button mat-icon-button (click)=\"cancel()\" type=\"button\">\n      <mat-icon class=\"material-icons\">close</mat-icon>\n    </button>\n  </mat-toolbar>\n  <mat-progress-bar color=\"warn\" mode=\"indeterminate\" *ngIf=\"isLoading$ | async\">\n  </mat-progress-bar>\n  <div style=\"height: 4px;\" *ngIf=\"!(isLoading$ | async)\"></div>\n  <div mat-dialog-content class=\"flex flex-col\">\n    <div class=\"flex flex-row gap-2 xs:flex-col xs:gap-0\">\n      <mat-form-field class=\"mat-block flex-1\">\n        <mat-label>Supermarket title</mat-label>\n        <input matInput formControlName=\"name\" required>\n        <mat-error *ngIf=\"addSupermarketFormGroup.get('name').hasError('required')\">\n          Supermarket title is required.\n        </mat-error>\n      </mat-form-field>\n    </div>\n  </div>\n  <div mat-dialog-actions class=\"flex flex-row items-center justify-end\">\n    <button mat-button color=\"primary\"\n            type=\"button\"\n            [disabled]=\"(isLoading$ | async)\"\n            (click)=\"cancel()\" cdkFocusInitial>\n      Cancel\n    </button>\n    <button mat-button mat-raised-button color=\"primary\"\n            type=\"submit\"\n            [disabled]=\"(isLoading$ | async) || addSupermarketFormGroup.invalid || !addSupermarketFormGroup.dirty\">\n      Add supermarket\n    </button>\n  </div>\n</form>\n",
                "customCss": "/*=======================================================================*/\n/*==========  There are two examples: for edit and add entity  ==========*/\n/*=======================================================================*/\n/*========================  Edit entity example  ========================*/\n/*=======================================================================*/\n/*\n.edit-entity-form .boolean-value-input {\n    padding-left: 5px;\n}\n\n.edit-entity-form .boolean-value-input .checkbox-label {\n    margin-bottom: 8px;\n    color: rgba(0,0,0,0.54);\n    font-size: 12px;\n}\n\n.relations-list .header {\n    padding-right: 5px;\n    padding-bottom: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .header .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n    font-size: 12px;\n    font-weight: 700;\n    color: rgba(0, 0, 0, .54);\n    white-space: nowrap;\n}\n\n.relations-list .mat-form-field-infix {\n    width: auto !important;\n}\n\n.relations-list .body {\n    padding-right: 5px;\n    padding-bottom: 15px;\n    padding-left: 5px;\n}\n\n.relations-list .body .row {\n    padding-top: 5px;\n}\n\n.relations-list .body .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .body .md-button {\n    margin: 0;\n}\n*/\n/*========================================================================*/\n/*=========================  Add entity example  =========================*/\n/*========================================================================*/\n/*\n.add-entity-form .boolean-value-input {\n    padding-left: 5px;\n}\n\n.add-entity-form .boolean-value-input .checkbox-label {\n    margin-bottom: 8px;\n    color: rgba(0,0,0,0.54);\n    font-size: 12px;\n}\n\n.relations-list .header {\n    padding-right: 5px;\n    padding-bottom: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .header .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n    font-size: 12px;\n    font-weight: 700;\n    color: rgba(0, 0, 0, .54);\n    white-space: nowrap;\n}\n\n.relations-list .mat-form-field-infix {\n    width: auto !important;\n}\n\n.relations-list .body {\n    padding-right: 5px;\n    padding-bottom: 15px;\n    padding-left: 5px;\n}\n\n.relations-list .body .row {\n    padding-top: 5px;\n}\n\n.relations-list .body .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .body .md-button {\n    margin: 0;\n}\n*/\n",
                "customFunction": "let $injector = widgetContext.$scope.$injector;\nlet customDialog = $injector.get(widgetContext.servicesMap.get('customDialog'));\nlet assetService = $injector.get(widgetContext.servicesMap.get('assetService'));\nlet entityGroupService = $injector.get(widgetContext.servicesMap.get('entityGroupService'));\nlet attributeService = $injector.get(widgetContext.servicesMap.get('attributeService'));\nlet entityRelationService = $injector.get(widgetContext.servicesMap.get('entityRelationService'));\n\nopenAddSupermarketDialog();\n\nfunction openAddSupermarketDialog() {\n  customDialog.customDialog(htmlTemplate, AddSupermarketDialogController).subscribe();\n}\n\nfunction AddSupermarketDialogController(instance) {\n  let vm = instance;\n\n  vm.addSupermarketFormGroup = vm.fb.group({\n    name: ['', [vm.validators.required]]\n  });\n\n  vm.cancel = function () {\n    vm.dialogRef.close(null);\n  };\n  \n  vm.save = function () {\n    var customerId;\n    if (widgetContext.currentUser.authority === 'TENANT_ADMIN') {\n        customerId = widgetContext.stateController.getStateParams().entityId;\n    } else {\n        customerId = { id: widgetContext.currentUser.customerId, entityType: 'CUSTOMER'};\n    }\n    vm.addSupermarketFormGroup.markAsPristine();\n    saveSupermarketObservable(customerId).subscribe(\n      function (supermarket) {\n          widgetContext.rxjs.forkJoin([\n              saveCustomerToSupermarketRelation(customerId, supermarket.id),\n              saveAttributes(supermarket.id)\n          ]).subscribe(\n              function () {\n                var params = widgetContext.stateController.getStateParams();\n                var selectedSupermarket = params['selectedSupermarket'];\n                params['selectedSupermarket'] = { entityId: supermarket.id, entityName: supermarket.name, entityLabel: '' };\n                widgetContext.updateAliases();\n                vm.dialogRef.close(null);\n              }\n        );\n      }\n    );\n  };\n\n  function saveSupermarketObservable(customerId) {\n    return getSupermarketsGroup(customerId).pipe(\n        widgetContext.rxjs.switchMap((supermarketsGroup) => {\n            const formValues = vm.addSupermarketFormGroup.value;\n            let supermarket = {\n              name: formValues.name,\n              type: 'supermarket',\n              customerId: customerId\n            };\n            return assetService.saveAsset(supermarket, supermarketsGroup.id.id)\n        })\n    );\n  }\n  \n  function getSupermarketsGroup(customerId) {\n      return entityGroupService.getEntityGroupsByOwnerId(customerId.entityType, customerId.id, 'ASSET').pipe(\n          widgetContext.rxjs.switchMap((entityGroups) => {\n              var supermarketsGroup = entityGroups.find(group => group.name === 'Supermarkets');\n              if (supermarketsGroup) {\n                  return widgetContext.rxjs.of(supermarketsGroup);\n              } else {\n                  supermarketsGroup = {\n                      type: 'ASSET',\n                      name: 'Supermarkets',\n                      ownerId: customerId\n                  };\n                  return entityGroupService.saveEntityGroup(supermarketsGroup);\n              }\n          })\n      );\n  }\n\n  function saveCustomerToSupermarketRelation(customerId, supermarketId) {\n      var relation = {\n          from: customerId,\n          to: supermarketId,\n          typeGroup: 'COMMON',\n          type: 'Owns'\n      };\n      return entityRelationService.saveRelation(relation);\n  }\n  \n  function saveAttributes(entityId) {\n    let attributesArray = [\n        {\n            key: 'latitude',\n            value: 37.780108\n        },\n        {\n            key: 'longitude',\n            value: -122.447053\n        },\n        {\n            key: 'address',\n            value: 'N/A'\n        },\n        {\n            key: 'state',\n            value: 'normal'\n        },\n        {\n            key: 'floorplan',\n            value: 'data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KPCEtLSBDcmVhdGVkIHdpdGggSW5rc2NhcGUgKGh0dHA6Ly93d3cuaW5rc2NhcGUub3JnLykgLS0+Cjxzdmcgd2lkdGg9IjMwMCIgaGVpZ2h0PSIzMDAiIHZlcnNpb249IjEuMSIgdmlld0JveD0iMCAwIDc5LjM3NSA3OS4zNzUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CiA8cmVjdCB4PSIyLjcwMTkiIHk9IjIuNzAxOSIgd2lkdGg9IjczLjk3MSIgaGVpZ2h0PSI3My45NzEiIGZpbGw9IiNmZmYiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIiBzdHJva2Utd2lkdGg9Ii4xMTIxIiBzdHlsZT0icGFpbnQtb3JkZXI6bWFya2VycyBmaWxsIHN0cm9rZSIvPgogPGcgdHJhbnNmb3JtPSJtYXRyaXgoLjI2NDU4IDAgMCAuMjY0NTggMi42MzUgLTIuODgzNCkiIHN0cm9rZS13aWR0aD0iMXB4IiBzdHlsZT0ic2hhcGUtaW5zaWRlOnVybCgjcmVjdDQ4MzYpO3doaXRlLXNwYWNlOnByZSIgYXJpYS1sYWJlbD0iICAgTm8gcGxhbiBjb25maWd1cmVkIj4KICA8cGF0aCBkPSJtMTAxLjY3IDExOC4yOXYyOC40MzhoLTMuNzg5MWwtMTQuMzE2LTIxLjkzNHYyMS45MzRoLTMuNzY5NXYtMjguNDM4aDMuNzY5NWwxNC4zNzUgMjEuOTkydi0yMS45OTJ6Ii8+CiAgPHBhdGggZD0ibTEwNi44MyAxMzUuOTVxMC00LjU4OTggMi41NzgxLTcuNjU2MiAyLjU3ODEtMy4wODU5IDcuMDExNy0zLjA4NTl0Ny4wMTE3IDMuMDI3M3EyLjU3ODEgMy4wMDc4IDIuNjM2NyA3LjUxOTV2MC42NDQ1M3EwIDQuNTg5OC0yLjU5NzcgNy42NTYyLTIuNTc4MSAzLjA2NjQtNy4wMTE3IDMuMDY2NC00LjQ1MzEgMC03LjA1MDgtMy4wNjY0LTIuNTc4MS0zLjA2NjQtMi41NzgxLTcuNjU2MnptMy42MTMzIDAuNDQ5MjJxMCAzLjE0NDUgMS40ODQ0IDUuNDQ5MiAxLjUwMzkgMi4zMDQ3IDQuNTMxMiAyLjMwNDcgMi45NDkyIDAgNC40NTMxLTIuMjY1NiAxLjUwMzktMi4yODUyIDEuNTIzNC01LjQyOTd2LTAuNTA3ODFxMC0zLjEwNTUtMS41MDM5LTUuNDI5Ny0xLjUwMzktMi4zNDM4LTQuNTExNy0yLjM0MzgtMi45ODgzIDAtNC40OTIyIDIuMzQzOC0xLjQ4NDQgMi4zMjQyLTEuNDg0NCA1LjQyOTd6Ii8+CiAgPHBhdGggZD0ibTE1MC4xNyAxNDcuMTJxLTMuODA4NiAwLTYuMDM1Mi0yLjQ0MTR2MTAuMTc2aC0zLjYzMjh2LTI5LjI1OGgzLjMyMDNsMC4xNzU3OCAyLjMyNDJxMi4yMjY2LTIuNzE0OCA2LjExMzMtMi43MTQ4IDQuMDAzOSAwIDYuMTMyOCAyLjk2ODggMi4xMjg5IDIuOTY4OCAyLjEyODkgNy44MTI1djAuNDEwMTZxMCA0LjYyODktMi4xNDg0IDcuNjc1OC0yLjEyODkgMy4wNDY5LTYuMDU0NyAzLjA0Njl6bS0xLjExMzMtMTguODY3cS0zLjI4MTIgMC00LjkyMTkgMi45MTAydjEwLjExN3ExLjY2MDIgMi44NzExIDQuOTYwOSAyLjg3MTEgMi45Mjk3IDAgNC4yNzczLTIuMzA0NyAxLjM2NzItMi4zMDQ3IDEuMzY3Mi01LjQ0OTJ2LTAuNDEwMTZxMC0zLjE0NDUtMS4zNjcyLTUuNDI5Ny0xLjM0NzYtMi4zMDQ3LTQuMzE2NC0yLjMwNDd6Ii8+CiAgPHBhdGggZD0ibTE2Ni45MSAxMTYuNzN2MzBoLTMuNjMyOHYtMzB6Ii8+CiAgPHBhdGggZD0ibTE4NS43NSAxNDYuNzNxLTAuMzUxNTctMC43NjE3Mi0wLjUwNzgyLTIuMjI2Ni0xLjAxNTYgMS4wNzQyLTIuNTM5MSAxLjg1NTUtMS41MjM0IDAuNzYxNzItMy40NzY2IDAuNzYxNzItMy4yNDIyIDAtNS4xOTUzLTEuODE2NC0xLjk1MzEtMS44MTY0LTEuOTUzMS00LjQ1MzEgMC0zLjM5ODQgMi41NzgxLTUuMTU2MiAyLjU3ODEtMS43NzczIDYuOTMzNi0xLjc3NzNoMy41NzQydi0xLjY3OTdxMC0xLjg3NS0xLjEzMjgtMi45ODgzLTEuMTEzMy0xLjEzMjgtMy4zMjAzLTEuMTMyOC0yLjA1MDggMC0zLjMyMDMgMS4wMTU2LTEuMjUgMC45OTYxLTEuMjUgMi4zMjQyaC0zLjYxMzNxMC0yLjI2NTYgMi4yODUyLTQuMjU3OCAyLjI4NTItMS45OTIyIDYuMTEzMy0xLjk5MjIgMy40Mzc1IDAgNS42NDQ1IDEuNzU3OCAyLjIwNyAxLjc1NzggMi4yMDcgNS4zMTI1djkuNDkyMnEwIDIuOTI5NyAwLjc0MjE5IDQuNjQ4NHYwLjMxMjV6bS01Ljk5NjEtMi43NzM0cTEuOTUzMSAwIDMuMzc4OS0wLjk3NjU2IDEuNDQ1My0wLjk3NjU2IDIuMDMxMi0yLjE2OHYtNC4zNTU1aC0zLjM1OTRxLTYuMDkzOCAwLjExNzE5LTYuMDkzOCAzLjkwNjIgMCAxLjUwMzkgMS4wMTU2IDIuNTU4NiAxLjAxNTYgMS4wMzUyIDMuMDI3MyAxLjAzNTJ6Ii8+CiAgPHBhdGggZD0ibTIwMy4yMyAxMjguMjVxLTEuNzM4MyAwLTMuMDY2NCAwLjkzNzUtMS4zMjgxIDAuOTM3NS0yLjA4OTggMi40NDE0djE1LjA5OGgtMy42MTMzdi0yMS4xMzNoMy40MThsMC4xMTcxOSAyLjYzNjdxMi40MDIzLTMuMDI3MyA2LjMwODYtMy4wMjczIDMuMTA1NSAwIDQuOTIxOSAxLjczODMgMS44MzU5IDEuNzM4MyAxLjg1NTUgNS44Mzk4djEzLjk0NWgtMy42MzI4di0xMy44ODdxMC0yLjQ4MDUtMS4wOTM4LTMuNTM1Mi0xLjA3NDItMS4wNTQ3LTMuMTI1LTEuMDU0N3oiLz4KICA8cGF0aCBkPSJtNTcuOTQxIDE5NC4xNXExLjkzMzYgMCAzLjM3ODktMS4xNTIzIDEuNDY0OC0xLjE1MjMgMS42MDE2LTIuOTQ5MmgzLjQzNzVxLTAuMTM2NzIgMi44MzItMi41OTc3IDQuOTYwOS0yLjQ2MDkgMi4xMDk0LTUuODIwMyAyLjEwOTQtNC43NjU2IDAtNy4wODk4LTMuMTQ0NS0yLjMwNDctMy4xNDQ1LTIuMzA0Ny03LjQwMjN2LTAuODIwMzFxMC00LjI1NzggMi4zMDQ3LTcuNDAyNCAyLjMyNDItMy4xNDQ1IDcuMDg5OC0zLjE0NDUgMy43MTA5IDAgNS45OTYxIDIuMjA3IDIuMjg1MiAyLjE4NzUgMi40MjE5IDUuNDQ5MmgtMy40Mzc1cS0wLjEzNjcyLTEuOTUzMS0xLjQ4NDQtMy4zMjAzLTEuMzI4MS0xLjM2NzItMy40OTYxLTEuMzY3Mi0yLjIyNjYgMC0zLjQ5NjEgMS4xMzI4LTEuMjUgMS4xMzI4LTEuNzc3MyAyLjg3MTEtMC41MDc4MSAxLjczODMtMC41MDc4MSAzLjU3NDJ2MC44MjAzMXEwIDEuODU1NSAwLjUwNzgxIDMuNTkzOCAwLjUwNzgxIDEuNzM4MyAxLjc1NzggMi44NzExIDEuMjY5NSAxLjExMzMgMy41MTU2IDEuMTEzM3oiLz4KICA8cGF0aCBkPSJtNjkuNDY1IDE4NS45NXEwLTQuNTg5OCAyLjU3ODEtNy42NTYyIDIuNTc4MS0zLjA4NTkgNy4wMTE3LTMuMDg1OSA0LjQzMzYgMCA3LjAxMTcgMy4wMjczIDIuNTc4MSAzLjAwNzggMi42MzY3IDcuNTE5NXYwLjY0NDUzcTAgNC41ODk4LTIuNTk3NyA3LjY1NjItMi41NzgxIDMuMDY2NC03LjAxMTcgMy4wNjY0LTQuNDUzMSAwLTcuMDUwOC0zLjA2NjQtMi41NzgxLTMuMDY2NC0yLjU3ODEtNy42NTYyem0zLjYxMzMgMC40NDkyMnEwIDMuMTQ0NSAxLjQ4NDQgNS40NDkyIDEuNTAzOSAyLjMwNDcgNC41MzEyIDIuMzA0NyAyLjk0OTIgMCA0LjQ1MzEtMi4yNjU2IDEuNTAzOS0yLjI4NTIgMS41MjM0LTUuNDI5N3YtMC41MDc4MXEwLTMuMTA1NS0xLjUwMzktNS40Mjk3LTEuNTAzOS0yLjM0MzgtNC41MTE3LTIuMzQzOC0yLjk4ODMgMC00LjQ5MjIgMi4zNDM4LTEuNDg0NCAyLjMyNDItMS40ODQ0IDUuNDI5N3oiLz4KICA8cGF0aCBkPSJtMTAyIDE3OC4yNXEtMS43MzgzIDAtMy4wNjY0IDAuOTM3NS0xLjMyODEgMC45Mzc1LTIuMDg5OCAyLjQ0MTR2MTUuMDk4aC0zLjYxMzN2LTIxLjEzM2gzLjQxOGwwLjExNzE5IDIuNjM2N3EyLjQwMjMtMy4wMjczIDYuMzA4Ni0zLjAyNzMgMy4xMDU1IDAgNC45MjE5IDEuNzM4MyAxLjgzNTkgMS43MzgzIDEuODU1NSA1LjgzOTh2MTMuOTQ1aC0zLjYzMjh2LTEzLjg4N3EwLTIuNDgwNS0xLjA5MzgtMy41MzUyLTEuMDc0Mi0xLjA1NDctMy4xMjUtMS4wNTQ3eiIvPgogIDxwYXRoIGQ9Im0xMjQuNDYgMTc4LjM3aC00LjMxNjR2MTguMzU5aC0zLjYxMzN2LTE4LjM1OWgtMy4zMzk4di0yLjc3MzRoMy4zMzk4di0xLjgzNTlxMC0zLjU5MzggMi4wNzAzLTUuNTA3OCAyLjA3MDMtMS45MzM2IDUuNjY0MS0xLjkzMzYgMi4xODc1IDAgNS41MjczIDEuMTkxNGwtMC42MDU0NiAzLjA0NjlxLTIuNTM5MS0wLjk5NjA5LTQuNjY4LTAuOTk2MDktMi4zMjQyIDAtMy4zNTk0IDEuMDU0Ny0xLjAxNTYgMS4wMzUyLTEuMDE1NiAzLjE0NDV2MS44MzU5aDQuMzE2NHptNy4xMDk0LTIuNzczNHYyMS4xMzNoLTMuNjEzM3YtMjEuMTMzeiIvPgogIDxwYXRoIGQ9Im0xNDUuNTIgMjA1LjA3cS0xLjY0MDYgMC00LjAyMzQtMC44MDA3OC0yLjM4MjgtMC44MDA3OC0zLjgwODYtMi44NzExbDEuODk0NS0yLjE0ODRxMi4zNDM4IDIuODUxNiA1LjY2NDEgMi44NTE2IDIuNTU4NiAwIDQuMDgyLTEuNDQ1MyAxLjUyMzQtMS40MjU4IDEuNTIzNC00LjE5OTJ2LTEuODU1NXEtMi4xNDg0IDIuNTE5NS01LjkxOCAyLjUxOTUtMy44MDg2IDAtNi4wNTQ3LTMuMDQ2OS0yLjI0NjEtMy4wNDY5LTIuMjQ2MS03LjY3NTh2LTAuNDEwMTZxMC00Ljg0MzggMi4yMjY2LTcuODEyNSAyLjI0NjEtMi45Njg4IDYuMTEzMy0yLjk2ODggMy44ODY3IDAgNi4wMzUyIDIuNzM0NGwwLjE3NTc4LTIuMzQzOGgzLjI4MTJ2MjAuNjg0cTAgNC4xOTkyLTIuNSA2LjQ4NDQtMi41IDIuMzA0Ny02LjQ0NTMgMi4zMDQ3em0tNS4yNzM0LTE4LjY3MnEwIDMuMTQ0NSAxLjMwODYgNS40MTAyIDEuMzI4MSAyLjI0NjEgNC4yNTc4IDIuMjQ2MSAzLjQzNzUgMCA1LjAzOTEtMy4xMjV2LTkuNjI4OXEtMC42ODM1OS0xLjMwODYtMS44OTQ1LTIuMTY4LTEuMjEwOS0wLjg3ODktMy4xMDU1LTAuODc4OS0yLjk0OTIgMC00LjI3NzMgMi4zMDQ3LTEuMzI4MSAyLjI4NTItMS4zMjgxIDUuNDI5N3oiLz4KICA8cGF0aCBkPSJtMTczLjA2IDE5Ni43My0wLjA3ODEtMi4wODk4cS0yLjA3MDMgMi40ODA1LTYuMTcxOSAyLjQ4MDUtMy4xMDU1IDAtNS4wMTk1LTEuODM1OS0xLjkxNDEtMS44MzU5LTEuOTE0MS02LjA1NDd2LTEzLjYzM2gzLjYxMzN2MTMuNjcycTAgMi44NTE2IDEuMTkxNCAzLjgyODEgMS4yMTA5IDAuOTU3MDMgMi42OTUzIDAuOTU3MDMgNC4wODIgMCA1LjUwNzgtMy4wNjY0di0xNS4zOTFoMy42MzI4djIxLjEzM3oiLz4KICA8cGF0aCBkPSJtMTkwLjQ0IDE3OC42OHEtMy41MzUyIDAtNC44MjQyIDMuMDQ2OXYxNWgtMy42MTMzdi0yMS4xMzNoMy41MTU2bDAuMDc4MSAyLjQyMTlxMS43MzgzLTIuODEyNSA1LjAxOTUtMi44MTI1IDEuMDE1NiAwIDEuNjAxNiAwLjI3MzQ0bC0wLjAxOTUgMy4zNTk0cS0wLjgwMDc4LTAuMTU2MjUtMS43NTc4LTAuMTU2MjV6Ii8+CiAgPHBhdGggZD0ibTIxMS45MSAxOTMuMDRxLTEuMDM1MiAxLjU2MjUtMi45Mjk3IDIuODMyLTEuODk0NSAxLjI1LTUuMDE5NSAxLjI1LTQuNDE0MSAwLTcuMDcwMy0yLjg3MTEtMi42MzY3LTIuODcxMS0yLjYzNjctNy4zNDM4di0wLjgyMDMxcTAtMy40NTcgMS4zMDg2LTUuODc4OSAxLjMyODEtMi40NDE0IDMuNDM3NS0zLjcxMDkgMi4xMDk0LTEuMjg5MSA0LjQ5MjItMS4yODkxIDQuNTMxMiAwIDYuNjAxNiAyLjk2ODggMi4wODk4IDIuOTQ5MiAyLjA4OTggNy4zODI4djEuNjIxMWgtMTQuMjk3cTAuMDc4MSAyLjkxMDIgMS43MTg4IDQuOTYwOSAxLjY2MDIgMi4wMzEyIDQuNTUwOCAyLjAzMTIgMS45MTQxIDAgMy4yNDIyLTAuNzgxMjUgMS4zMjgxLTAuNzgxMjUgMi4zMjQyLTIuMDg5OHptLTguNDE4LTE0Ljg2M3EtMi4xNDg0IDAtMy42MzI4IDEuNTYyNS0xLjQ4NDQgMS41NjI1LTEuODU1NSA0LjQ5MjJoMTAuNTY2di0wLjI3MzQ0cS0wLjEzNjcyLTIuMTA5NC0xLjIzMDUtMy45NDUzLTEuMDc0Mi0xLjgzNTktMy44NDc3LTEuODM1OXoiLz4KICA8cGF0aCBkPSJtMjMwLjAzIDE5Ni43My0wLjE3NTc4LTIuMjY1NnEtMi4xNjggMi42NTYyLTYuMDM1MiAyLjY1NjItMy43MTA5IDAtNS45OTYxLTMuMDA3OC0yLjI4NTItMy4wMDc4LTIuMzI0Mi03LjU1ODZ2LTAuNTY2NDFxMC00Ljg0MzggMi4yODUyLTcuODEyNSAyLjMwNDctMi45Njg4IDYuMDc0Mi0yLjk2ODggMy43MzA1IDAgNS44NTk0IDIuNXYtMTAuOTc3aDMuNjMyOHYzMHptLTEwLjg5OC0xMC4zMzJxMCAzLjE0NDUgMS4zMjgxIDUuNDEwMiAxLjMyODEgMi4yNDYxIDQuMjU3OCAyLjI0NjEgMy4zNTk0IDAgNS0zLjA2NjR2LTkuNzI2NnEtMS42MjExLTMuMDA3OC00Ljk2MDktMy4wMDc4LTIuOTQ5MiAwLTQuMjk2OSAyLjMwNDctMS4zMjgxIDIuMjg1Mi0xLjMyODEgNS40Mjk3eiIvPgogPC9nPgo8L3N2Zz4K'\n        }\n    ];\n    return attributeService.saveEntityAttributes(entityId, \"SERVER_SCOPE\", attributesArray);\n  }\n}\n",
                "customResources": [],
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "e965b8a1-a6ac-5ae4-fd79-2b7220b91ed1"
              }
            ]
          },
          "showTitleIcon": false,
          "titleTooltip": "",
          "enableDataExport": false,
          "widgetStyle": {},
          "widgetCss": "",
          "noDataDisplayMessage": ""
        },
        "row": 0,
        "col": 0,
        "id": "4a524a3c-2b87-903c-6256-47a5df398ba5",
        "typeFullFqn": "system.cards.entities_table"
      },
      "ab845ee8-ff10-b684-3652-cb49e2d9acbe": {
        "type": "latest",
        "sizeX": 5,
        "sizeY": 3.5,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "name": null,
              "entityAliasId": "7add11d8-cbf7-fd15-6b12-d5df058f11fa",
              "filterId": null,
              "dataKeys": []
            }
          ],
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideQuickInterval": false
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1678197897861,
                "endTimeMs": 1678284297861
              },
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideFixedInterval": false,
              "hideQuickInterval": false
            },
            "aggregation": {
              "type": "AVG",
              "limit": 25000
            }
          },
          "showTitle": false,
          "backgroundColor": "#fff",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "4px",
          "settings": {
            "markdownTextFunction": "var supermarketState;\nif (data && data.length && data[0]['entityId']) {\n  supermarketState = true;\n} else {\n  supermarketState = false;\n}\n\nvar typeSvg = '<svg width=\"20\" height=\"20\" viewBox=\"0 0 20 20\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">' +\n  '<path d=\"m13.636 10.8c0.59978 0 1.1276-0.32788 1.3995-0.82369l2.8629-5.1901c0.29589-0.5278-0.087968-1.1836-0.69574-1.1836h-11.836l-0.75172-1.5994h-2.615v1.5994h1.5994l2.8789' +\n  ' 6.0697-1.0796 1.9513c-0.58378 1.0716 0.18393 2.3751 1.3995 2.3751h9.5964v-1.5994h-9.5964l0.87967-1.5994zm-7.5092-5.5979h9.7164l-2.2072 3.9985h-5.6139zm0.67175 9.5964c-0.87967' +\n  ' 0-1.5914 0.71973-1.5914 1.5994s0.71174 1.5994 1.5914 1.5994 1.5994-0.71973 1.5994-1.5994-0.71973-1.5994-1.5994-1.5994zm7.997 0c-0.87967 0-1.5914 0.71973-1.5914 1.5994s0.71174' +\n  ' 1.5994 1.5914 1.5994 1.5994-0.71973 1.5994-1.5994-0.71973-1.5994-1.5994-1.5994z\" stroke-width=\".7997\" fill=\"#212121\"/>' +\n  '</svg>';\nvar encodedTypeSvg = encodeURIComponent(typeSvg);\nvar typeSvgUrl = 'data:image/svg+xml,' + encodedTypeSvg;\n\nvar header = '<div class=\"header flex flex-row items-stretch justify-start gap-2\">' +\n  '<div class=\"flex flex-col items-stretch justify-center\"><button id=\"go-back\" matTooltip=\"Go back\" type=\"button\" mat-icon-button><mat-icon>arrow_back</mat-icon></button></div>' +\n  '<div class=\"flex flex-col items-stretch justify-center\"><img style=\"vertical-align: middle;\" class=\"title-icon mat-icon\" src=\"'+ typeSvgUrl +'\"></div>' +\n  '<div class=\"flex flex-1 flex-col items-stretch justify-center\">' +\n  '<div class=\"title\">Edit Supermarket: {{ ctx.stateController.getStateParams().selectedSupermarket?.entityName }}</div>' +\n  '</div>' +\n  '<div class=\"flex flex-col items-stretch justify-start\"><button id=\"supermarket-devices\" type=\"button\" mat-raised-button color=\"primary\"><mat-icon class=\"tb-mat-20\">devices_other</mat-icon><span>Supermarket devices</span></button></div>' +\n  '<div class=\"flex flex-col items-stretch justify-start\"><button id=\"delete-supermarket\" type=\"button\" mat-raised-button color=\"accent\"><mat-icon class=\"tb-mat-20\">delete</mat-icon><span>Delete</span></button></div>' +\n  '</div>';\n\nreturn '<div class=\"main-layout flex size-full flex-col\">' +\n  (supermarketState\n    ? (header +\n      '<tb-dashboard-state class=\"flex-1\" [ctx]=\"ctx\" [syncParentStateParams]=\"true\" stateId=\"edit_supermarket_card\"></tb-dashboard-state>')\n    : '<tb-dashboard-state class=\"flex-1\" [ctx]=\"ctx\" [syncParentStateParams]=\"true\" stateId=\"supermarkets_card\"></tb-dashboard-state>') +\n  '</div>';",
            "useMarkdownTextFunction": true,
            "markdownCss": ".tb-markdown-view .tb-progress-cover, .tb-markdown-view .mat-drawer-container {\n    background-color: #fff;\n}\n.tb-markdown-view div, .tb-markdown-view p {\n    line-height: normal;\n}\n\n.tb-markdown-view > div {\n    padding: 0;\n}\n\n.tb-markdown-view table {\n    border: none;\n    border-radius: 0px;\n    overflow: auto;\n}\n\n.tb-markdown-view .mat-toolbar.mat-primary div {\n    color: var(--tb-primary-contrast-500);\n}\n\n.tb-markdown-view .tb-widget-container > .tb-widget .tb-table-widget mat-toolbar {\n    height: 65px;\n    max-height: 65px;\n}\n\n\n.tb-markdown-view .tb-widget-container > .tb-widget.tb-has-timewindow .tb-table-widget mat-toolbar {\n    height: 100px;\n    max-height: 100px;\n}\n\n.main-layout .header {\n    height: 60px;\n    margin: 4px;\n} \n\n.main-layout .header .mat-icon.title-icon {\n    width: 40px;\n    height: 40px;\n}\n\n.main-layout .header .title {\n    font-size: 18px;\n    font-weight: 500;\n    color: #28232D;\n}\n\n.main-layout .header .subtitle {\n    font-size: 13px;\n    font-weight: normal;\n    color: #757575;\n}\n",
            "markdownTextPattern": "<div class=\"main-layout flex size-full flex-col\">\n  <section *ngIf=\"ctx.stateController.getStateParams().selectedSupermarket\" class=\"flex flex-1 flex-col\">\n    <h5 class=\"market-title\">{{ ctx.stateController.getStateParams().selectedSupermarket.entityName }}</h5>\n    <tb-dashboard-state class=\"flex-1\" [ctx]=\"ctx\" [syncParentStateParams]=\"true\" stateId=\"devices_card\"></tb-dashboard-state>\n  </section>\n  <tb-dashboard-state *ngIf=\"!ctx.stateController.getStateParams().selectedSupermarket\" class=\"flex-1\" [ctx]=\"ctx\" stateId=\"supermarkets_card\"></tb-dashboard-state>\n  <mat-divider style=\"margin-top: 10px; margin-bottom: 10px;\"></mat-divider>\n  <tb-dashboard-state *ngIf=\"ctx.stateController.getStateParams().selectedSupermarket\" class=\"flex-1\" [ctx]=\"ctx\" [syncParentStateParams]=\"true\" stateId=\"supermarket_alarms\"></tb-dashboard-state>\n  <tb-dashboard-state *ngIf=\"!ctx.stateController.getStateParams().selectedSupermarket\" class=\"flex-1\" [ctx]=\"ctx\" [syncParentStateParams]=\"false\" stateId=\"supermarkets_alarms\"></tb-dashboard-state>\n</div>"
          },
          "title": "New Markdown/HTML Card",
          "showTitleIcon": false,
          "iconColor": "rgba(0, 0, 0, 0.87)",
          "iconSize": "24px",
          "titleTooltip": "",
          "dropShadow": true,
          "enableFullscreen": false,
          "widgetStyle": {},
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400
          },
          "showLegend": false,
          "enableDataExport": false,
          "widgetCss": ".tb-widget-title {\n    align-items: stretch !important;\n    flex: 1;\n}\n\n.tb-widget-actions {\n    position: absolute;\n    top: 0;\n    right: 0;\n}\n\n.tb-widget-title tb-timewindow .tb-timewindow {\n    border: 1px solid rgba(0, 0, 0, 0.12);\n    border-radius: 4px;\n    padding: 8px 8px;\n    position: relative;\n}\n\n.tb-widget-title tb-timewindow .tb-timewindow span {\n    flex: 1;\n    line-height: 32px;\n}\n\n.tb-widget-title tb-timewindow .tb-timewindow::after {\n    font-family: \"Material Icons\";\n    content: 'expand_more';\n    position: absolute;\n    font-size: 24px;\n    top: 12px;\n    right: 12px;\n    z-index: -1;\n}",
          "noDataDisplayMessage": "",
          "actions": {
            "elementClick": [
              {
                "name": "go-back",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "customFunction": "var params = widgetContext.stateController.getStateParams();\nparams['selectedSupermarket'] = null;\nwidgetContext.stateController.updateState(null, params);",
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "116515c2-d9bd-80b6-7a34-97373a802806"
              },
              {
                "name": "supermarket-devices",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "openDashboardState",
                "targetDashboardStateId": "supermarket_devices",
                "setEntityId": true,
                "stateEntityParamName": "selectedSupermarket",
                "openRightLayout": false,
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "f921410a-47b7-5884-1c63-d010a39064a4"
              },
              {
                "name": "delete-supermarket",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "customFunction": "var $injector = widgetContext.$scope.$injector;\nvar dialogs = $injector.get(widgetContext.servicesMap.get('dialogs'));\nvar assetService = $injector.get(widgetContext.servicesMap.get('assetService'));\nvar entityRelationService = $injector.get(widgetContext.servicesMap.get('entityRelationService'));\nvar entityGroupService = $injector.get(widgetContext.servicesMap.get('entityGroupService'));\nlet attributeService = $injector.get(widgetContext.servicesMap.get('attributeService'));\n\nopenDeleteSupermarketDialog();\n\nfunction openDeleteSupermarketDialog() {\n  var title = 'Are you sure you want to delete the supermarket ' + entityName + '?';\n  var content = 'Be careful, after the confirmation, the supermarket will be deleted and all related devices will be unassigned!';\n  dialogs.confirm(title, content, 'Cancel', 'Delete').subscribe(\n    function(result) {\n      if (result) {\n        deleteSupermarket();\n      }\n    }\n  );\n}\n\nfunction deleteSupermarket() {\n  var customerId;\n  if (widgetContext.currentUser.authority === 'TENANT_ADMIN') {\n       customerId = widgetContext.stateController.getStateParams().entityId;\n  } else {\n       customerId = { id: widgetContext.currentUser.customerId, entityType: 'CUSTOMER'};\n  }\n  var relatedDevicesQuery = {\n      parameters: {\n          rootId: entityId.id,\n          rootType: entityId.entityType,\n          direction: 'FROM'\n      },\n      filters: [{ relationType: 'Contains', entityTypes: ['DEVICE'] }]\n  };\n  entityRelationService.findByQuery(relatedDevicesQuery).subscribe((relatedDevicesRelations) => {\n      var removeDevicesObservable;\n      if (relatedDevicesRelations.length) {\n          removeDevicesObservable = getUnassignedDevicesGroup(customerId).pipe(\n              widgetContext.rxjs.switchMap((unassignedDevicesGroup) => {\n                  var removeDevicesObservables = [];\n                  relatedDevicesRelations.forEach((deviceRelation) => {\n                     removeDevicesObservables.push(removeDevice(deviceRelation.to, unassignedDevicesGroup.id.id));\n                  });\n                  return widgetContext.rxjs.forkJoin(removeDevicesObservables);\n              })\n          );\n      } else {\n          removeDevicesObservable = widgetContext.rxjs.of(null);\n      }\n      removeDevicesObservable.subscribe(() => {\n          assetService.deleteAsset(entityId.id).subscribe(\n            function() {\n                widgetContext.updateAliases();\n            }\n          );\n      });\n  });\n}\n\nfunction removeDevice(deviceId, unassignedDevicesGroupId) {\n    return widgetContext.rxjs.forkJoin([\n        entityGroupService.addEntityToEntityGroup(unassignedDevicesGroupId, deviceId.id),\n        deleteSupermarketToDeviceRelation(deviceId),\n        removePositionAttributes(deviceId)\n    ]);\n}\n\nfunction getUnassignedDevicesGroup(customerId) {\n    return entityGroupService.getEntityGroupsByOwnerId(customerId.entityType, customerId.id, 'DEVICE').pipe(\n        widgetContext.rxjs.switchMap((deviceEntityGroups) => {\n            return getOrCreateUnassignedDevicesGroup(customerId, deviceEntityGroups);\n        })\n    );\n}\n\nfunction getOrCreateUnassignedDevicesGroup(customerId, groups) {\n  var unassignedDevicesGroup = groups.find(group => group.name === 'Unassigned Supermarket Devices');\n  if (unassignedDevicesGroup) {\n      return widgetContext.rxjs.of(unassignedDevicesGroup);\n  } else {\n      unassignedDevicesGroup = {\n          type: 'DEVICE',\n          name: 'Unassigned Supermarket Devices',\n          ownerId: customerId\n      };\n      return entityGroupService.saveEntityGroup(unassignedDevicesGroup);\n  }\n}\n\nfunction deleteSupermarketToDeviceRelation(deviceId) {\n    return entityRelationService.deleteRelation(entityId, 'Contains', deviceId);\n}\n\nfunction removePositionAttributes(entityId) {\n    return attributeService.deleteEntityAttributes(entityId, \"SERVER_SCOPE\", [{key: 'xPos'},{key: 'yPos'}]);\n}",
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "1af63269-0a95-b82e-0703-86bd8daf9356"
              }
            ],
            "headerButton": []
          }
        },
        "row": 0,
        "col": 0,
        "id": "ab845ee8-ff10-b684-3652-cb49e2d9acbe",
        "typeFullFqn": "system.cards.markdown_card"
      },
      "980bd0c3-44e9-a1f9-c8f9-3dc533011fde": {
        "type": "latest",
        "sizeX": 7.5,
        "sizeY": 3,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "name": null,
              "entityAliasId": "7add11d8-cbf7-fd15-6b12-d5df058f11fa",
              "filterId": null,
              "dataKeys": [
                {
                  "name": "address",
                  "type": "attribute",
                  "label": "address",
                  "color": "#2196f3",
                  "settings": {},
                  "_hash": 0.7546586070710162
                }
              ]
            }
          ],
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideQuickInterval": false
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1678197897861,
                "endTimeMs": 1678284297861
              },
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideFixedInterval": false,
              "hideQuickInterval": false
            },
            "aggregation": {
              "type": "AVG",
              "limit": 25000
            }
          },
          "showTitle": false,
          "backgroundColor": "#fff",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "0px",
          "settings": {
            "showResultMessage": false,
            "showLabel": true,
            "isRequired": true,
            "labelValue": "Address",
            "requiredErrorMessage": "Address is required"
          },
          "title": "New Update server string attribute",
          "dropShadow": false,
          "enableFullscreen": false,
          "enableDataExport": false,
          "widgetStyle": {},
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400
          },
          "useDashboardTimewindow": true,
          "showLegend": false,
          "actions": {},
          "showTitleIcon": false,
          "titleTooltip": "",
          "widgetCss": "",
          "noDataDisplayMessage": ""
        },
        "row": 0,
        "col": 0,
        "id": "980bd0c3-44e9-a1f9-c8f9-3dc533011fde",
        "typeFullFqn": "system.input_widgets.update_server_string_attribute"
      },
      "00041a85-d8fe-09f2-4aab-1c86d8a7444d": {
        "type": "latest",
        "sizeX": 5,
        "sizeY": 3.5,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "name": null,
              "entityAliasId": "7add11d8-cbf7-fd15-6b12-d5df058f11fa",
              "filterId": null,
              "dataKeys": []
            }
          ],
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideQuickInterval": false
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1678197897861,
                "endTimeMs": 1678284297861
              },
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideFixedInterval": false,
              "hideQuickInterval": false
            },
            "aggregation": {
              "type": "AVG",
              "limit": 25000
            }
          },
          "showTitle": false,
          "backgroundColor": "#fff",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "0px",
          "settings": {
            "markdownTextFunction": "return '# Some title\\n - Entity name: ' + data[0]['entityName'];",
            "useMarkdownTextFunction": false,
            "markdownTextPattern": "<div class=\"attribute-update-form flex size-full flex-row\" style=\"padding: 0 8px;\">\n  <div class=\"flex flex-1 flex-col\">\n    <mat-form-field class=\"mat-block\" style=\"width: 100%;\">\n      <mat-label>Title</mat-label>\n      <input #titleInput #titleInputCtrl=\"ngModel\" required matInput [(ngModel)]=\"titleInput.value\"\n             value=\"${entityName}\" (keyUp.enter)=\"titleInput.value !== '${entityName}' ? saveTitleButton._elementRef.nativeElement.click() : return;\"\n             (keyUp.escape)=\"titleInput.value = '${entityName}';\"/>\n      <mat-error *ngIf=\"!titleInputCtrl.valid\">Title is required</mat-error>\n    </mat-form-field>\n  </div>\n  <div class=\"input-buttons\">\n    <button #saveTitleButton id=\"save-title\" [disabled]=\"titleInput.value === '${entityName}' || !titleInputCtrl.valid\" [attr.data-title]=\"titleInput.value\" type=\"button\" mat-icon-button>\n      <mat-icon>check</mat-icon>\n    </button>\n    <button [disabled]=\"titleInput.value === '${entityName}'\" type=\"button\" mat-icon-button (click)=\"titleInput.value = '${entityName}';\">\n      <mat-icon>close</mat-icon>\n    </button>\n  </div>\n</div>\n",
            "markdownCss": ".tb-markdown-view > div {\n    padding: 0;\n}\n\n.tb-markdown-view  .grid__element:last-child {\n    margin-top: 19px;\n    margin-left: 7px;\n}\n\n.tb-markdown-view  .attribute-update-form .mat-icon-button {\n    width: 32px;\n    min-width: 32px;\n    height: 32px;\n    min-height: 32px;\n    padding: 0 !important;\n    margin: 0 !important;\n    line-height: 20px;\n}\n\n.tb-markdown-view  .attribute-update-form .mat-icon-button mat-icon {\n    width: 20px;\n    min-width: 20px;\n    height: 20px;\n    min-height: 20px;\n    font-size: 20px;\n}\n\n.tb-markdown-view .attribute-update-form .input-buttons {\n    margin-top: 19px;\n    margin-left: 7px;\n    display: flex;\n}"
          },
          "title": "New Markdown/HTML Card",
          "showTitleIcon": false,
          "iconColor": "rgba(0, 0, 0, 0.87)",
          "iconSize": "24px",
          "titleTooltip": "",
          "dropShadow": false,
          "enableFullscreen": false,
          "widgetStyle": {},
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400
          },
          "showLegend": false,
          "enableDataExport": false,
          "widgetCss": "",
          "noDataDisplayMessage": "",
          "actions": {
            "elementClick": [
              {
                "name": "save-title",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "customFunction": "const targetElement = $($event.target).closest('#save-title', widgetContext.$container[0]);\n\nvar title = $(targetElement).attr('data-title');\n\nwidgetContext.assetService.getAsset(entityId.id, {ignoreLoading: true}).subscribe((supermarket) => {\n    supermarket.name = title;\n    widgetContext.assetService.saveAsset(supermarket, null, {ignoreLoading: true}).subscribe(() => {\n       widgetContext.stateController.getStateParams().selectedSupermarket.entityName = title;\n       widgetContext.updateAliases();\n    });\n});\n",
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "088a4799-8551-7ab4-892f-2a08d6d40a7c"
              }
            ]
          }
        },
        "row": 0,
        "col": 0,
        "id": "00041a85-d8fe-09f2-4aab-1c86d8a7444d",
        "typeFullFqn": "system.cards.markdown_card"
      },
      "59df0b6f-17dd-3c4c-a484-69c0836246da": {
        "type": "latest",
        "sizeX": 7.5,
        "sizeY": 3.5,
        "config": {
          "datasources": [
            {
              "type": "entity",
              "name": null,
              "entityAliasId": "7add11d8-cbf7-fd15-6b12-d5df058f11fa",
              "filterId": null,
              "dataKeys": [
                {
                  "name": "floorplan",
                  "type": "attribute",
                  "label": "floorplan",
                  "color": "#2196f3",
                  "settings": {},
                  "_hash": 0.5234606901361916
                }
              ]
            }
          ],
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideQuickInterval": false
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1678197897861,
                "endTimeMs": 1678284297861
              },
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideFixedInterval": false,
              "hideQuickInterval": false
            },
            "aggregation": {
              "type": "AVG",
              "limit": 25000
            }
          },
          "showTitle": true,
          "backgroundColor": "#fff",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "0px",
          "settings": {
            "showResultMessage": false,
            "displayPreview": true,
            "displayClearButton": false,
            "widgetTitle": "Floor plan",
            "displayApplyButton": false,
            "displayDiscardButton": true
          },
          "title": "Floor plan",
          "dropShadow": false,
          "enableFullscreen": false,
          "enableDataExport": false,
          "widgetStyle": {},
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400
          },
          "useDashboardTimewindow": true,
          "showLegend": false,
          "actions": {},
          "showTitleIcon": false,
          "titleTooltip": "",
          "widgetCss": "",
          "noDataDisplayMessage": ""
        },
        "row": 0,
        "col": 0,
        "id": "59df0b6f-17dd-3c4c-a484-69c0836246da",
        "typeFullFqn": "system.input_widgets.update_server_image_attribute"
      },
      "7a671e82-7171-d1e2-75cc-565f67598090": {
        "type": "latest",
        "sizeX": 5,
        "sizeY": 3.5,
        "config": {
          "datasources": [],
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideQuickInterval": false
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1678197897861,
                "endTimeMs": 1678284297861
              },
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideFixedInterval": false,
              "hideQuickInterval": false
            },
            "aggregation": {
              "type": "AVG",
              "limit": 25000
            }
          },
          "showTitle": false,
          "backgroundColor": "#fff",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "8px",
          "settings": {
            "markdownTextFunction": "return '# Some title\\n - Entity name: ' + data[0]['entityName'];",
            "useMarkdownTextFunction": false,
            "markdownCss": ".tb-markdown-view .tb-progress-cover, .tb-markdown-view .mat-drawer-container {\n    background-color: #fff;\n}\n\n.tb-markdown-view div, .tb-markdown-view p {\n    line-height: normal;\n}\n\n.tb-markdown-view > div {\n    padding: 0;\n}\n\n.market-layout {\n    position: relative;\n}\n\n.market-title {\n    font-size: 26px;\n    padding-bottom: 16px;\n    padding-left: 10px;\n    padding-top: 5px;\n}\n\n",
            "markdownTextPattern": "<div class=\"market-layout flex size-full flex-col\" style=\"padding: 0;\">\n  <div class=\"flex flex-row items-start justify-center\" style=\"width: 100%; height: 60px;\">\n    <h5 class=\"market-title flex-1\">Supermarkets</h5>\n    <button id=\"add-supermarket\" mat-raised-button color=\"primary\"><mat-icon class=\"tb-mat-20\">add</mat-icon><span>Add supermarket</span></button>\n  </div>\n  <div class=\"flex flex-1 flex-col\" style=\"position: relative;\">\n    <tb-dashboard-state class=\"flex-1\" [ctx]=\"ctx\" [syncParentStateParams]=\"true\" stateId=\"supermarkets_map\"></tb-dashboard-state>\n  </div>\n</div>"
          },
          "title": "New Markdown/HTML Card",
          "showTitleIcon": false,
          "iconColor": "rgba(0, 0, 0, 0.87)",
          "iconSize": "24px",
          "titleTooltip": "",
          "dropShadow": true,
          "enableFullscreen": false,
          "widgetStyle": {},
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400
          },
          "showLegend": false,
          "enableDataExport": false,
          "widgetCss": ".tb-widget-container .tb-widget .tb-multiple-input {\n    background-color: #FAFAFA;\n    border-radius: 4px;\n}\n\n.tb-widget-container .tb-widget .tb-multiple-input .input-field {\n    padding-right: 30px;\n}\n\n.tb-widget-container .tb-widget .tb-multiple-input mat-slide-toggle {\n    margin-top: 15px !important;\n    margin-bottom: 0 !important;\n}\n\n.tb-widget-container .tb-widget .tb-multiple-input .mat-slide-toggle-content {\n    width: 120px;\n}\n\n.tb-widget-container .tb-widget .mat-slide-toggle-bar {\n    width: 42px;\n    height: 24px;\n    border-radius: 16px;\n}\n\n.tb-widget-container .tb-widget .mat-slide-toggle-thumb-container {\n    top: 2px;\n    left: 2px;\n}\n\n.tb-widget-container .tb-widget .mat-slide-toggle.mat-checked .mat-slide-toggle-thumb-container {\n    transform: translate3d(18px, 0, 0);\n}\n\n.tb-widget-container .tb-widget .mat-slide-toggle-thumb {\n    background-color: #fafafa;\n}\n\n.tb-widget-container .tb-widget .mat-slide-toggle.mat-checked .mat-slide-toggle-bar {\n    background-color: #F2994A;\n}\n",
          "noDataDisplayMessage": "",
          "actions": {
            "elementClick": [
              {
                "name": "add-supermarket",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "customPretty",
                "customHtml": "<form #addEntityForm=\"ngForm\" [formGroup]=\"addSupermarketFormGroup\"\n      (ngSubmit)=\"save()\" class=\"add-entity-form\" style=\"width: 350px;\">\n  <mat-toolbar class=\"flex flex-row\" color=\"primary\">\n    <h2>Add supermarket</h2>\n    <span class=\"flex-1\"></span>\n    <button mat-icon-button (click)=\"cancel()\" type=\"button\">\n      <mat-icon class=\"material-icons\">close</mat-icon>\n    </button>\n  </mat-toolbar>\n  <mat-progress-bar color=\"warn\" mode=\"indeterminate\" *ngIf=\"isLoading$ | async\">\n  </mat-progress-bar>\n  <div style=\"height: 4px;\" *ngIf=\"!(isLoading$ | async)\"></div>\n  <div mat-dialog-content class=\"flex flex-col\">\n    <div class=\"flex flex-row gap-2 xs:flex-col xs:gap-0\">\n      <mat-form-field class=\"mat-block flex-1\">\n        <mat-label>Supermarket title</mat-label>\n        <input matInput formControlName=\"name\" required>\n        <mat-error *ngIf=\"addSupermarketFormGroup.get('name').hasError('required')\">\n          Supermarket title is required.\n        </mat-error>\n      </mat-form-field>\n    </div>\n  </div>\n  <div mat-dialog-actions class=\"flex flex-row items-center justify-end\">\n    <button mat-button color=\"primary\"\n            type=\"button\"\n            [disabled]=\"(isLoading$ | async)\"\n            (click)=\"cancel()\" cdkFocusInitial>\n      Cancel\n    </button>\n    <button mat-button mat-raised-button color=\"primary\"\n            type=\"submit\"\n            [disabled]=\"(isLoading$ | async) || addSupermarketFormGroup.invalid || !addSupermarketFormGroup.dirty\">\n      Add supermarket\n    </button>\n  </div>\n</form>\n",
                "customCss": "/*=======================================================================*/\n/*==========  There are two examples: for edit and add entity  ==========*/\n/*=======================================================================*/\n/*========================  Edit entity example  ========================*/\n/*=======================================================================*/\n/*\n.edit-entity-form .boolean-value-input {\n    padding-left: 5px;\n}\n\n.edit-entity-form .boolean-value-input .checkbox-label {\n    margin-bottom: 8px;\n    color: rgba(0,0,0,0.54);\n    font-size: 12px;\n}\n\n.relations-list .header {\n    padding-right: 5px;\n    padding-bottom: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .header .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n    font-size: 12px;\n    font-weight: 700;\n    color: rgba(0, 0, 0, .54);\n    white-space: nowrap;\n}\n\n.relations-list .mat-form-field-infix {\n    width: auto !important;\n}\n\n.relations-list .body {\n    padding-right: 5px;\n    padding-bottom: 15px;\n    padding-left: 5px;\n}\n\n.relations-list .body .row {\n    padding-top: 5px;\n}\n\n.relations-list .body .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .body .md-button {\n    margin: 0;\n}\n*/\n/*========================================================================*/\n/*=========================  Add entity example  =========================*/\n/*========================================================================*/\n/*\n.add-entity-form .boolean-value-input {\n    padding-left: 5px;\n}\n\n.add-entity-form .boolean-value-input .checkbox-label {\n    margin-bottom: 8px;\n    color: rgba(0,0,0,0.54);\n    font-size: 12px;\n}\n\n.relations-list .header {\n    padding-right: 5px;\n    padding-bottom: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .header .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n    font-size: 12px;\n    font-weight: 700;\n    color: rgba(0, 0, 0, .54);\n    white-space: nowrap;\n}\n\n.relations-list .mat-form-field-infix {\n    width: auto !important;\n}\n\n.relations-list .body {\n    padding-right: 5px;\n    padding-bottom: 15px;\n    padding-left: 5px;\n}\n\n.relations-list .body .row {\n    padding-top: 5px;\n}\n\n.relations-list .body .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .body .md-button {\n    margin: 0;\n}\n*/\n",
                "customFunction": "let $injector = widgetContext.$scope.$injector;\nlet customDialog = $injector.get(widgetContext.servicesMap.get('customDialog'));\nlet assetService = $injector.get(widgetContext.servicesMap.get('assetService'));\nlet entityGroupService = $injector.get(widgetContext.servicesMap.get('entityGroupService'));\nlet attributeService = $injector.get(widgetContext.servicesMap.get('attributeService'));\nlet entityRelationService = $injector.get(widgetContext.servicesMap.get('entityRelationService'));\n\nopenAddSupermarketDialog();\n\nfunction openAddSupermarketDialog() {\n  customDialog.customDialog(htmlTemplate, AddSupermarketDialogController).subscribe();\n}\n\nfunction AddSupermarketDialogController(instance) {\n  let vm = instance;\n\n  vm.addSupermarketFormGroup = vm.fb.group({\n    name: ['', [vm.validators.required]]\n  });\n\n  vm.cancel = function () {\n    vm.dialogRef.close(null);\n  };\n  \n  vm.save = function () {\n    var customerId;\n    if (widgetContext.currentUser.authority === 'TENANT_ADMIN') {\n        customerId = widgetContext.stateController.getStateParams().entityId;\n    } else {\n        customerId = { id: widgetContext.currentUser.customerId, entityType: 'CUSTOMER'};\n    }\n    vm.addSupermarketFormGroup.markAsPristine();\n    saveSupermarketObservable(customerId).subscribe(\n      function (supermarket) {\n          widgetContext.rxjs.forkJoin([\n              saveCustomerToSupermarketRelation(customerId, supermarket.id),\n              saveAttributes(supermarket.id)\n          ]).subscribe(\n              function () {\n                var params = widgetContext.stateController.getStateParams();\n                var selectedSupermarket = params['selectedSupermarket'];\n                params['selectedSupermarket'] = { entityId: supermarket.id, entityName: supermarket.name, entityLabel: '' };\n                widgetContext.updateAliases();\n                vm.dialogRef.close(null);\n              }\n        );\n      }\n    );\n  };\n\n  function saveSupermarketObservable(customerId) {\n    return getSupermarketsGroup(customerId).pipe(\n        widgetContext.rxjs.switchMap((supermarketsGroup) => {\n            const formValues = vm.addSupermarketFormGroup.value;\n            let supermarket = {\n              name: formValues.name,\n              type: 'supermarket',\n              customerId: customerId\n            };\n            return assetService.saveAsset(supermarket, supermarketsGroup.id.id)\n        })\n    );\n  }\n  \n  function getSupermarketsGroup(customerId) {\n      return entityGroupService.getEntityGroupsByOwnerId(customerId.entityType, customerId.id, 'ASSET').pipe(\n          widgetContext.rxjs.switchMap((entityGroups) => {\n              var supermarketsGroup = entityGroups.find(group => group.name === 'Supermarkets');\n              if (supermarketsGroup) {\n                  return widgetContext.rxjs.of(supermarketsGroup);\n              } else {\n                  supermarketsGroup = {\n                      type: 'ASSET',\n                      name: 'Supermarkets',\n                      ownerId: customerId\n                  };\n                  return entityGroupService.saveEntityGroup(supermarketsGroup);\n              }\n          })\n      );\n  }\n\n  function saveCustomerToSupermarketRelation(customerId, supermarketId) {\n      var relation = {\n          from: customerId,\n          to: supermarketId,\n          typeGroup: 'COMMON',\n          type: 'Owns'\n      };\n      return entityRelationService.saveRelation(relation);\n  }\n  \n  function saveAttributes(entityId) {\n    let attributesArray = [\n        {\n            key: 'latitude',\n            value: 37.780108\n        },\n        {\n            key: 'longitude',\n            value: -122.447053\n        },\n        {\n            key: 'address',\n            value: 'N/A'\n        },\n        {\n            key: 'state',\n            value: 'normal'\n        },\n        {\n            key: 'floorplan',\n            value: 'data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KPCEtLSBDcmVhdGVkIHdpdGggSW5rc2NhcGUgKGh0dHA6Ly93d3cuaW5rc2NhcGUub3JnLykgLS0+Cjxzdmcgd2lkdGg9IjMwMCIgaGVpZ2h0PSIzMDAiIHZlcnNpb249IjEuMSIgdmlld0JveD0iMCAwIDc5LjM3NSA3OS4zNzUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CiA8cmVjdCB4PSIyLjcwMTkiIHk9IjIuNzAxOSIgd2lkdGg9IjczLjk3MSIgaGVpZ2h0PSI3My45NzEiIGZpbGw9IiNmZmYiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIiBzdHJva2Utd2lkdGg9Ii4xMTIxIiBzdHlsZT0icGFpbnQtb3JkZXI6bWFya2VycyBmaWxsIHN0cm9rZSIvPgogPGcgdHJhbnNmb3JtPSJtYXRyaXgoLjI2NDU4IDAgMCAuMjY0NTggMi42MzUgLTIuODgzNCkiIHN0cm9rZS13aWR0aD0iMXB4IiBzdHlsZT0ic2hhcGUtaW5zaWRlOnVybCgjcmVjdDQ4MzYpO3doaXRlLXNwYWNlOnByZSIgYXJpYS1sYWJlbD0iICAgTm8gcGxhbiBjb25maWd1cmVkIj4KICA8cGF0aCBkPSJtMTAxLjY3IDExOC4yOXYyOC40MzhoLTMuNzg5MWwtMTQuMzE2LTIxLjkzNHYyMS45MzRoLTMuNzY5NXYtMjguNDM4aDMuNzY5NWwxNC4zNzUgMjEuOTkydi0yMS45OTJ6Ii8+CiAgPHBhdGggZD0ibTEwNi44MyAxMzUuOTVxMC00LjU4OTggMi41NzgxLTcuNjU2MiAyLjU3ODEtMy4wODU5IDcuMDExNy0zLjA4NTl0Ny4wMTE3IDMuMDI3M3EyLjU3ODEgMy4wMDc4IDIuNjM2NyA3LjUxOTV2MC42NDQ1M3EwIDQuNTg5OC0yLjU5NzcgNy42NTYyLTIuNTc4MSAzLjA2NjQtNy4wMTE3IDMuMDY2NC00LjQ1MzEgMC03LjA1MDgtMy4wNjY0LTIuNTc4MS0zLjA2NjQtMi41NzgxLTcuNjU2MnptMy42MTMzIDAuNDQ5MjJxMCAzLjE0NDUgMS40ODQ0IDUuNDQ5MiAxLjUwMzkgMi4zMDQ3IDQuNTMxMiAyLjMwNDcgMi45NDkyIDAgNC40NTMxLTIuMjY1NiAxLjUwMzktMi4yODUyIDEuNTIzNC01LjQyOTd2LTAuNTA3ODFxMC0zLjEwNTUtMS41MDM5LTUuNDI5Ny0xLjUwMzktMi4zNDM4LTQuNTExNy0yLjM0MzgtMi45ODgzIDAtNC40OTIyIDIuMzQzOC0xLjQ4NDQgMi4zMjQyLTEuNDg0NCA1LjQyOTd6Ii8+CiAgPHBhdGggZD0ibTE1MC4xNyAxNDcuMTJxLTMuODA4NiAwLTYuMDM1Mi0yLjQ0MTR2MTAuMTc2aC0zLjYzMjh2LTI5LjI1OGgzLjMyMDNsMC4xNzU3OCAyLjMyNDJxMi4yMjY2LTIuNzE0OCA2LjExMzMtMi43MTQ4IDQuMDAzOSAwIDYuMTMyOCAyLjk2ODggMi4xMjg5IDIuOTY4OCAyLjEyODkgNy44MTI1djAuNDEwMTZxMCA0LjYyODktMi4xNDg0IDcuNjc1OC0yLjEyODkgMy4wNDY5LTYuMDU0NyAzLjA0Njl6bS0xLjExMzMtMTguODY3cS0zLjI4MTIgMC00LjkyMTkgMi45MTAydjEwLjExN3ExLjY2MDIgMi44NzExIDQuOTYwOSAyLjg3MTEgMi45Mjk3IDAgNC4yNzczLTIuMzA0NyAxLjM2NzItMi4zMDQ3IDEuMzY3Mi01LjQ0OTJ2LTAuNDEwMTZxMC0zLjE0NDUtMS4zNjcyLTUuNDI5Ny0xLjM0NzYtMi4zMDQ3LTQuMzE2NC0yLjMwNDd6Ii8+CiAgPHBhdGggZD0ibTE2Ni45MSAxMTYuNzN2MzBoLTMuNjMyOHYtMzB6Ii8+CiAgPHBhdGggZD0ibTE4NS43NSAxNDYuNzNxLTAuMzUxNTctMC43NjE3Mi0wLjUwNzgyLTIuMjI2Ni0xLjAxNTYgMS4wNzQyLTIuNTM5MSAxLjg1NTUtMS41MjM0IDAuNzYxNzItMy40NzY2IDAuNzYxNzItMy4yNDIyIDAtNS4xOTUzLTEuODE2NC0xLjk1MzEtMS44MTY0LTEuOTUzMS00LjQ1MzEgMC0zLjM5ODQgMi41NzgxLTUuMTU2MiAyLjU3ODEtMS43NzczIDYuOTMzNi0xLjc3NzNoMy41NzQydi0xLjY3OTdxMC0xLjg3NS0xLjEzMjgtMi45ODgzLTEuMTEzMy0xLjEzMjgtMy4zMjAzLTEuMTMyOC0yLjA1MDggMC0zLjMyMDMgMS4wMTU2LTEuMjUgMC45OTYxLTEuMjUgMi4zMjQyaC0zLjYxMzNxMC0yLjI2NTYgMi4yODUyLTQuMjU3OCAyLjI4NTItMS45OTIyIDYuMTEzMy0xLjk5MjIgMy40Mzc1IDAgNS42NDQ1IDEuNzU3OCAyLjIwNyAxLjc1NzggMi4yMDcgNS4zMTI1djkuNDkyMnEwIDIuOTI5NyAwLjc0MjE5IDQuNjQ4NHYwLjMxMjV6bS01Ljk5NjEtMi43NzM0cTEuOTUzMSAwIDMuMzc4OS0wLjk3NjU2IDEuNDQ1My0wLjk3NjU2IDIuMDMxMi0yLjE2OHYtNC4zNTU1aC0zLjM1OTRxLTYuMDkzOCAwLjExNzE5LTYuMDkzOCAzLjkwNjIgMCAxLjUwMzkgMS4wMTU2IDIuNTU4NiAxLjAxNTYgMS4wMzUyIDMuMDI3MyAxLjAzNTJ6Ii8+CiAgPHBhdGggZD0ibTIwMy4yMyAxMjguMjVxLTEuNzM4MyAwLTMuMDY2NCAwLjkzNzUtMS4zMjgxIDAuOTM3NS0yLjA4OTggMi40NDE0djE1LjA5OGgtMy42MTMzdi0yMS4xMzNoMy40MThsMC4xMTcxOSAyLjYzNjdxMi40MDIzLTMuMDI3MyA2LjMwODYtMy4wMjczIDMuMTA1NSAwIDQuOTIxOSAxLjczODMgMS44MzU5IDEuNzM4MyAxLjg1NTUgNS44Mzk4djEzLjk0NWgtMy42MzI4di0xMy44ODdxMC0yLjQ4MDUtMS4wOTM4LTMuNTM1Mi0xLjA3NDItMS4wNTQ3LTMuMTI1LTEuMDU0N3oiLz4KICA8cGF0aCBkPSJtNTcuOTQxIDE5NC4xNXExLjkzMzYgMCAzLjM3ODktMS4xNTIzIDEuNDY0OC0xLjE1MjMgMS42MDE2LTIuOTQ5MmgzLjQzNzVxLTAuMTM2NzIgMi44MzItMi41OTc3IDQuOTYwOS0yLjQ2MDkgMi4xMDk0LTUuODIwMyAyLjEwOTQtNC43NjU2IDAtNy4wODk4LTMuMTQ0NS0yLjMwNDctMy4xNDQ1LTIuMzA0Ny03LjQwMjN2LTAuODIwMzFxMC00LjI1NzggMi4zMDQ3LTcuNDAyNCAyLjMyNDItMy4xNDQ1IDcuMDg5OC0zLjE0NDUgMy43MTA5IDAgNS45OTYxIDIuMjA3IDIuMjg1MiAyLjE4NzUgMi40MjE5IDUuNDQ5MmgtMy40Mzc1cS0wLjEzNjcyLTEuOTUzMS0xLjQ4NDQtMy4zMjAzLTEuMzI4MS0xLjM2NzItMy40OTYxLTEuMzY3Mi0yLjIyNjYgMC0zLjQ5NjEgMS4xMzI4LTEuMjUgMS4xMzI4LTEuNzc3MyAyLjg3MTEtMC41MDc4MSAxLjczODMtMC41MDc4MSAzLjU3NDJ2MC44MjAzMXEwIDEuODU1NSAwLjUwNzgxIDMuNTkzOCAwLjUwNzgxIDEuNzM4MyAxLjc1NzggMi44NzExIDEuMjY5NSAxLjExMzMgMy41MTU2IDEuMTEzM3oiLz4KICA8cGF0aCBkPSJtNjkuNDY1IDE4NS45NXEwLTQuNTg5OCAyLjU3ODEtNy42NTYyIDIuNTc4MS0zLjA4NTkgNy4wMTE3LTMuMDg1OSA0LjQzMzYgMCA3LjAxMTcgMy4wMjczIDIuNTc4MSAzLjAwNzggMi42MzY3IDcuNTE5NXYwLjY0NDUzcTAgNC41ODk4LTIuNTk3NyA3LjY1NjItMi41NzgxIDMuMDY2NC03LjAxMTcgMy4wNjY0LTQuNDUzMSAwLTcuMDUwOC0zLjA2NjQtMi41NzgxLTMuMDY2NC0yLjU3ODEtNy42NTYyem0zLjYxMzMgMC40NDkyMnEwIDMuMTQ0NSAxLjQ4NDQgNS40NDkyIDEuNTAzOSAyLjMwNDcgNC41MzEyIDIuMzA0NyAyLjk0OTIgMCA0LjQ1MzEtMi4yNjU2IDEuNTAzOS0yLjI4NTIgMS41MjM0LTUuNDI5N3YtMC41MDc4MXEwLTMuMTA1NS0xLjUwMzktNS40Mjk3LTEuNTAzOS0yLjM0MzgtNC41MTE3LTIuMzQzOC0yLjk4ODMgMC00LjQ5MjIgMi4zNDM4LTEuNDg0NCAyLjMyNDItMS40ODQ0IDUuNDI5N3oiLz4KICA8cGF0aCBkPSJtMTAyIDE3OC4yNXEtMS43MzgzIDAtMy4wNjY0IDAuOTM3NS0xLjMyODEgMC45Mzc1LTIuMDg5OCAyLjQ0MTR2MTUuMDk4aC0zLjYxMzN2LTIxLjEzM2gzLjQxOGwwLjExNzE5IDIuNjM2N3EyLjQwMjMtMy4wMjczIDYuMzA4Ni0zLjAyNzMgMy4xMDU1IDAgNC45MjE5IDEuNzM4MyAxLjgzNTkgMS43MzgzIDEuODU1NSA1LjgzOTh2MTMuOTQ1aC0zLjYzMjh2LTEzLjg4N3EwLTIuNDgwNS0xLjA5MzgtMy41MzUyLTEuMDc0Mi0xLjA1NDctMy4xMjUtMS4wNTQ3eiIvPgogIDxwYXRoIGQ9Im0xMjQuNDYgMTc4LjM3aC00LjMxNjR2MTguMzU5aC0zLjYxMzN2LTE4LjM1OWgtMy4zMzk4di0yLjc3MzRoMy4zMzk4di0xLjgzNTlxMC0zLjU5MzggMi4wNzAzLTUuNTA3OCAyLjA3MDMtMS45MzM2IDUuNjY0MS0xLjkzMzYgMi4xODc1IDAgNS41MjczIDEuMTkxNGwtMC42MDU0NiAzLjA0NjlxLTIuNTM5MS0wLjk5NjA5LTQuNjY4LTAuOTk2MDktMi4zMjQyIDAtMy4zNTk0IDEuMDU0Ny0xLjAxNTYgMS4wMzUyLTEuMDE1NiAzLjE0NDV2MS44MzU5aDQuMzE2NHptNy4xMDk0LTIuNzczNHYyMS4xMzNoLTMuNjEzM3YtMjEuMTMzeiIvPgogIDxwYXRoIGQ9Im0xNDUuNTIgMjA1LjA3cS0xLjY0MDYgMC00LjAyMzQtMC44MDA3OC0yLjM4MjgtMC44MDA3OC0zLjgwODYtMi44NzExbDEuODk0NS0yLjE0ODRxMi4zNDM4IDIuODUxNiA1LjY2NDEgMi44NTE2IDIuNTU4NiAwIDQuMDgyLTEuNDQ1MyAxLjUyMzQtMS40MjU4IDEuNTIzNC00LjE5OTJ2LTEuODU1NXEtMi4xNDg0IDIuNTE5NS01LjkxOCAyLjUxOTUtMy44MDg2IDAtNi4wNTQ3LTMuMDQ2OS0yLjI0NjEtMy4wNDY5LTIuMjQ2MS03LjY3NTh2LTAuNDEwMTZxMC00Ljg0MzggMi4yMjY2LTcuODEyNSAyLjI0NjEtMi45Njg4IDYuMTEzMy0yLjk2ODggMy44ODY3IDAgNi4wMzUyIDIuNzM0NGwwLjE3NTc4LTIuMzQzOGgzLjI4MTJ2MjAuNjg0cTAgNC4xOTkyLTIuNSA2LjQ4NDQtMi41IDIuMzA0Ny02LjQ0NTMgMi4zMDQ3em0tNS4yNzM0LTE4LjY3MnEwIDMuMTQ0NSAxLjMwODYgNS40MTAyIDEuMzI4MSAyLjI0NjEgNC4yNTc4IDIuMjQ2MSAzLjQzNzUgMCA1LjAzOTEtMy4xMjV2LTkuNjI4OXEtMC42ODM1OS0xLjMwODYtMS44OTQ1LTIuMTY4LTEuMjEwOS0wLjg3ODktMy4xMDU1LTAuODc4OS0yLjk0OTIgMC00LjI3NzMgMi4zMDQ3LTEuMzI4MSAyLjI4NTItMS4zMjgxIDUuNDI5N3oiLz4KICA8cGF0aCBkPSJtMTczLjA2IDE5Ni43My0wLjA3ODEtMi4wODk4cS0yLjA3MDMgMi40ODA1LTYuMTcxOSAyLjQ4MDUtMy4xMDU1IDAtNS4wMTk1LTEuODM1OS0xLjkxNDEtMS44MzU5LTEuOTE0MS02LjA1NDd2LTEzLjYzM2gzLjYxMzN2MTMuNjcycTAgMi44NTE2IDEuMTkxNCAzLjgyODEgMS4yMTA5IDAuOTU3MDMgMi42OTUzIDAuOTU3MDMgNC4wODIgMCA1LjUwNzgtMy4wNjY0di0xNS4zOTFoMy42MzI4djIxLjEzM3oiLz4KICA8cGF0aCBkPSJtMTkwLjQ0IDE3OC42OHEtMy41MzUyIDAtNC44MjQyIDMuMDQ2OXYxNWgtMy42MTMzdi0yMS4xMzNoMy41MTU2bDAuMDc4MSAyLjQyMTlxMS43MzgzLTIuODEyNSA1LjAxOTUtMi44MTI1IDEuMDE1NiAwIDEuNjAxNiAwLjI3MzQ0bC0wLjAxOTUgMy4zNTk0cS0wLjgwMDc4LTAuMTU2MjUtMS43NTc4LTAuMTU2MjV6Ii8+CiAgPHBhdGggZD0ibTIxMS45MSAxOTMuMDRxLTEuMDM1MiAxLjU2MjUtMi45Mjk3IDIuODMyLTEuODk0NSAxLjI1LTUuMDE5NSAxLjI1LTQuNDE0MSAwLTcuMDcwMy0yLjg3MTEtMi42MzY3LTIuODcxMS0yLjYzNjctNy4zNDM4di0wLjgyMDMxcTAtMy40NTcgMS4zMDg2LTUuODc4OSAxLjMyODEtMi40NDE0IDMuNDM3NS0zLjcxMDkgMi4xMDk0LTEuMjg5MSA0LjQ5MjItMS4yODkxIDQuNTMxMiAwIDYuNjAxNiAyLjk2ODggMi4wODk4IDIuOTQ5MiAyLjA4OTggNy4zODI4djEuNjIxMWgtMTQuMjk3cTAuMDc4MSAyLjkxMDIgMS43MTg4IDQuOTYwOSAxLjY2MDIgMi4wMzEyIDQuNTUwOCAyLjAzMTIgMS45MTQxIDAgMy4yNDIyLTAuNzgxMjUgMS4zMjgxLTAuNzgxMjUgMi4zMjQyLTIuMDg5OHptLTguNDE4LTE0Ljg2M3EtMi4xNDg0IDAtMy42MzI4IDEuNTYyNS0xLjQ4NDQgMS41NjI1LTEuODU1NSA0LjQ5MjJoMTAuNTY2di0wLjI3MzQ0cS0wLjEzNjcyLTIuMTA5NC0xLjIzMDUtMy45NDUzLTEuMDc0Mi0xLjgzNTktMy44NDc3LTEuODM1OXoiLz4KICA8cGF0aCBkPSJtMjMwLjAzIDE5Ni43My0wLjE3NTc4LTIuMjY1NnEtMi4xNjggMi42NTYyLTYuMDM1MiAyLjY1NjItMy43MTA5IDAtNS45OTYxLTMuMDA3OC0yLjI4NTItMy4wMDc4LTIuMzI0Mi03LjU1ODZ2LTAuNTY2NDFxMC00Ljg0MzggMi4yODUyLTcuODEyNSAyLjMwNDctMi45Njg4IDYuMDc0Mi0yLjk2ODggMy43MzA1IDAgNS44NTk0IDIuNXYtMTAuOTc3aDMuNjMyOHYzMHptLTEwLjg5OC0xMC4zMzJxMCAzLjE0NDUgMS4zMjgxIDUuNDEwMiAxLjMyODEgMi4yNDYxIDQuMjU3OCAyLjI0NjEgMy4zNTk0IDAgNS0zLjA2NjR2LTkuNzI2NnEtMS42MjExLTMuMDA3OC00Ljk2MDktMy4wMDc4LTIuOTQ5MiAwLTQuMjk2OSAyLjMwNDctMS4zMjgxIDIuMjg1Mi0xLjMyODEgNS40Mjk3eiIvPgogPC9nPgo8L3N2Zz4K'\n        }\n    ];\n    return attributeService.saveEntityAttributes(entityId, \"SERVER_SCOPE\", attributesArray);\n  }\n}\n",
                "customResources": [],
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "7cad1c71-0765-4277-32a8-c87808a0c689"
              }
            ]
          }
        },
        "row": 0,
        "col": 0,
        "id": "7a671e82-7171-d1e2-75cc-565f67598090",
        "typeFullFqn": "system.cards.markdown_card"
      },
      "eac6e38e-62f2-1f91-754b-299d11e87c19": {
        "type": "latest",
        "sizeX": 7.5,
        "sizeY": 6.5,
        "config": {
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 86400000,
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideQuickInterval": false
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1678197897861,
                "endTimeMs": 1678284297861
              },
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideFixedInterval": false,
              "hideQuickInterval": false
            },
            "aggregation": {
              "type": "NONE",
              "limit": 200
            }
          },
          "showTitle": true,
          "backgroundColor": "rgb(255, 255, 255)",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "0px",
          "settings": {
            "enableSearch": true,
            "displayPagination": true,
            "defaultPageSize": 15,
            "defaultSortOrder": "Name",
            "displayEntityName": false,
            "displayEntityType": false,
            "enableSelectColumnDisplay": true,
            "enableStickyHeader": true,
            "enableStickyAction": true,
            "reserveSpaceForHiddenAction": "true",
            "displayEntityLabel": false,
            "useRowStyleFunction": false,
            "entitiesTitle": "Devices"
          },
          "title": "Devices",
          "dropShadow": true,
          "enableFullscreen": false,
          "titleStyle": {
            "fontSize": "24px",
            "fontWeight": 700,
            "padding": "5px 10px 5px 10px",
            "height": "60px"
          },
          "useDashboardTimewindow": false,
          "showLegend": false,
          "datasources": [
            {
              "type": "entity",
              "name": null,
              "entityAliasId": "984b0bbe-9a03-40ac-90f0-31db7e70dc8c",
              "filterId": null,
              "dataKeys": [
                {
                  "name": "name",
                  "type": "entityField",
                  "label": "Name",
                  "color": "#2196f3",
                  "settings": {
                    "columnWidth": "0px",
                    "useCellStyleFunction": false,
                    "cellStyleFunction": "",
                    "useCellContentFunction": false,
                    "cellContentFunction": "",
                    "defaultColumnVisibility": "visible",
                    "columnSelectionToDisplay": "enabled",
                    "columnExportOption": "onlyVisible"
                  },
                  "_hash": 0.46096251592014714
                },
                {
                  "name": "type",
                  "type": "entityField",
                  "label": "Type",
                  "color": "#4caf50",
                  "settings": {
                    "customTitle": "",
                    "columnWidth": "0px",
                    "useCellStyleFunction": false,
                    "cellStyleFunction": "",
                    "useCellContentFunction": true,
                    "useCellContentFunctionOnExport": true,
                    "cellContentFunction": {
                      "body": "var type = value;\nreturn utils.getSmartRetailDeviceCellIcon(type);",
                      "modules": {
                        "utils": "tb-resource;/api/resource/js_module/system/Smart Retail Solution JS Utils.js"
                      }
                    },
                    "defaultColumnVisibility": "visible",
                    "columnSelectionToDisplay": "enabled",
                    "columnExportOption": "onlyVisible",
                    "disableSorting": false
                  },
                  "_hash": 0.8077097060074172,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null,
                  "aggregationType": null
                },
                {
                  "name": "label",
                  "type": "entityField",
                  "label": "Label",
                  "color": "#f44336",
                  "settings": {
                    "columnWidth": "0px",
                    "useCellStyleFunction": false,
                    "cellStyleFunction": "",
                    "useCellContentFunction": false,
                    "cellContentFunction": "",
                    "defaultColumnVisibility": "visible",
                    "columnSelectionToDisplay": "enabled",
                    "columnExportOption": "onlyVisible"
                  },
                  "_hash": 0.4057433451983201
                },
                {
                  "name": "state",
                  "type": "attribute",
                  "label": "State",
                  "color": "#ffc107",
                  "settings": {
                    "columnWidth": "0px",
                    "useCellStyleFunction": false,
                    "cellStyleFunction": "",
                    "useCellContentFunction": true,
                    "defaultColumnVisibility": "visible",
                    "columnSelectionToDisplay": "enabled",
                    "columnExportOption": "onlyVisible",
                    "cellContentFunction": "var state = value;\nvar active = entity.active;\nif (active === 'false') {\n    state = 'disconnected';\n}\n\nvar stateSvg = getStateSvg(state);\nvar encodedStateSvg = encodeURIComponent(stateSvg);\nvar stateSvgUrl = 'data:image/svg+xml,' + encodedStateSvg;\nvar stateLabel = getStateLabel(state);\n\nreturn '<span>'+\n           '<img style=\"vertical-align: middle;\" class=\"mat-icon\" src=\"'+ stateSvgUrl +'\">' +\n           '<span style=\"vertical-align: middle; padding-left: 8px;\">'+ stateLabel +'</span>' +\n       '</span>';\n            \nfunction getStateSvg(state) {\n    switch (state) {\n        case 'critical':\n            return '<svg width=\"20\" height=\"20\" viewBox=\"0 0 20 20\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">' +\n                   '<circle cx=\"10\" cy=\"10\" r=\"6\" fill=\"#E64A19\"/>' +\n                   '</svg>';\n        case 'major':            \n            return '<svg width=\"20\" height=\"20\" viewBox=\"0 0 20 20\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">' +\n                   '<circle cx=\"10\" cy=\"10\" r=\"6\" fill=\"#D5C21B\"/>' +\n                   '</svg>';\n        case 'normal':            \n            return '<svg width=\"20\" height=\"20\" viewBox=\"0 0 20 20\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">' +\n                   '<circle cx=\"10\" cy=\"10\" r=\"6\" fill=\"#1F8B4D\"/>' +\n                   '</svg>';\n        case 'disconnected':\n            return '<svg width=\"20\" height=\"20\" viewBox=\"0 0 20 20\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">' +\n                   '<g clip-path=\"url(#clip0_2839_52564)\">' +\n                   '<circle cx=\"10\" cy=\"10\" r=\"6\" fill=\"#CAC1D2\"/>' +\n                   '<path d=\"M1.92896 16.728L16.0711 2.58589L17.4853 4.00011L3.34317 18.1422L1.92896 16.728Z\" fill=\"#CAC1D2\"/>' +\n                   '<path d=\"M2.10692 16.3171C1.81393 16.0241 1.81393 15.5491 2.10692 15.2561L15.1852 2.17788C15.4781 1.88489 15.9532 1.88489 16.2462 2.17788C16.5392 2.47088 16.5392 2.94591 16.2462 3.2389L3.16794 16.3171C2.87495 16.6101 2.39991 16.6101 2.10692 16.3171Z\" fill=\"white\"/>' +\n                   '</g>' +\n                   '<defs>' +\n                   '<clipPath id=\"clip0_2839_52564\">' +\n                   '<rect width=\"20\" height=\"20\" fill=\"white\"/>' +\n                   '</clipPath>' +\n                   '</defs>' +\n                   '</svg>';\n        default:\n            return '<svg width=\"20\" height=\"20\" viewBox=\"0 0 20 20\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">' +\n                   '<circle cx=\"10\" cy=\"10\" r=\"6\" fill=\"#AAAAAA\"/>' +\n                   '</svg>';\n    }\n}\n\nfunction getStateLabel(state) {\n    switch(state) {\n        case 'critical':\n            return 'Critical';\n        case 'major':\n            return 'Major';\n        case 'normal':\n            return 'Normal';\n        case 'disconnected':\n            return 'Disconnected';\n        default:\n            return state;\n    }\n}\n"
                  },
                  "_hash": 0.2718881518921066,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                },
                {
                  "name": "active",
                  "type": "attribute",
                  "label": "active",
                  "color": "#607d8b",
                  "settings": {
                    "columnWidth": "0px",
                    "useCellStyleFunction": false,
                    "cellStyleFunction": "",
                    "useCellContentFunction": false,
                    "cellContentFunction": "",
                    "defaultColumnVisibility": "hidden",
                    "columnSelectionToDisplay": "disabled",
                    "columnExportOption": "onlyVisible"
                  },
                  "_hash": 0.04680501891139488,
                  "units": null,
                  "decimals": null,
                  "funcBody": null,
                  "usePostProcessing": null,
                  "postFuncBody": null
                }
              ],
              "alarmFilterConfig": {
                "statusList": [
                  "ACTIVE"
                ]
              }
            }
          ],
          "showTitleIcon": false,
          "titleTooltip": "",
          "enableDataExport": false,
          "widgetStyle": {},
          "widgetCss": "div.tb-widget .tb-widget-title {\n    max-height: 100px !important;\n}",
          "noDataDisplayMessage": "",
          "actions": {
            "rowClick": [],
            "headerButton": [
              {
                "name": "Add device",
                "icon": "add",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "customPretty",
                "customHtml": "<form #addEntityForm=\"ngForm\" [formGroup]=\"addDeviceFormGroup\"\n      (ngSubmit)=\"save()\" class=\"add-entity-form\" style=\"width: 350px;\">\n  <mat-toolbar class=\"flex flex-row\" color=\"primary\">\n    <h2>Add device</h2>\n    <span class=\"flex-1\"></span>\n    <button mat-icon-button (click)=\"cancel()\" type=\"button\">\n      <mat-icon class=\"material-icons\">close</mat-icon>\n    </button>\n  </mat-toolbar>\n  <mat-progress-bar color=\"warn\" mode=\"indeterminate\" *ngIf=\"isLoading$ | async\">\n  </mat-progress-bar>\n  <div style=\"height: 4px;\" *ngIf=\"!(isLoading$ | async)\"></div>\n  <div mat-dialog-content class=\"flex flex-col\">\n    <mat-form-field class=\"mat-block\">\n      <mat-label>Device name</mat-label>\n      <input matInput formControlName=\"name\" required>\n      <mat-error *ngIf=\"addDeviceFormGroup.get('name').hasError('required')\">\n        Device name is required.\n      </mat-error>\n    </mat-form-field>\n    <mat-form-field class=\"mat-block\">\n      <mat-label>Device type</mat-label>\n      <mat-select formControlName=\"type\" required>\n        <mat-option *ngFor=\"let type of deviceTypes\" [value]=\"type\">\n          {{ type }}\n        </mat-option>\n      </mat-select>\n      <mat-error *ngIf=\"addDeviceFormGroup.get('type').hasError('required')\">\n        Device type is required.\n      </mat-error>\n    </mat-form-field>\n    <mat-form-field class=\"mat-block\">\n      <mat-label>Device label</mat-label>\n      <input matInput formControlName=\"label\" required>\n      <mat-error *ngIf=\"addDeviceFormGroup.get('label').hasError('required')\">\n        Device label is required.\n      </mat-error>\n    </mat-form-field>\n  </div>\n  <div mat-dialog-actions class=\"flex flex-row items-center justify-end\">\n    <button mat-button color=\"primary\"\n            type=\"button\"\n            [disabled]=\"(isLoading$ | async)\"\n            (click)=\"cancel()\" cdkFocusInitial>\n      Cancel\n    </button>\n    <button mat-button mat-raised-button color=\"primary\"\n            type=\"submit\"\n            [disabled]=\"(isLoading$ | async) || addDeviceFormGroup.invalid || !addDeviceFormGroup.dirty\">\n      Add device\n    </button>\n  </div>\n</form>\n",
                "customCss": "/*=======================================================================*/\n/*==========  There are two examples: for edit and add entity  ==========*/\n/*=======================================================================*/\n/*========================  Edit entity example  ========================*/\n/*=======================================================================*/\n/*\n.edit-entity-form .boolean-value-input {\n    padding-left: 5px;\n}\n\n.edit-entity-form .boolean-value-input .checkbox-label {\n    margin-bottom: 8px;\n    color: rgba(0,0,0,0.54);\n    font-size: 12px;\n}\n\n.relations-list .header {\n    padding-right: 5px;\n    padding-bottom: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .header .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n    font-size: 12px;\n    font-weight: 700;\n    color: rgba(0, 0, 0, .54);\n    white-space: nowrap;\n}\n\n.relations-list .mat-form-field-infix {\n    width: auto !important;\n}\n\n.relations-list .body {\n    padding-right: 5px;\n    padding-bottom: 15px;\n    padding-left: 5px;\n}\n\n.relations-list .body .row {\n    padding-top: 5px;\n}\n\n.relations-list .body .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .body .md-button {\n    margin: 0;\n}\n*/\n/*========================================================================*/\n/*=========================  Add entity example  =========================*/\n/*========================================================================*/\n/*\n.add-entity-form .boolean-value-input {\n    padding-left: 5px;\n}\n\n.add-entity-form .boolean-value-input .checkbox-label {\n    margin-bottom: 8px;\n    color: rgba(0,0,0,0.54);\n    font-size: 12px;\n}\n\n.relations-list .header {\n    padding-right: 5px;\n    padding-bottom: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .header .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n    font-size: 12px;\n    font-weight: 700;\n    color: rgba(0, 0, 0, .54);\n    white-space: nowrap;\n}\n\n.relations-list .mat-form-field-infix {\n    width: auto !important;\n}\n\n.relations-list .body {\n    padding-right: 5px;\n    padding-bottom: 15px;\n    padding-left: 5px;\n}\n\n.relations-list .body .row {\n    padding-top: 5px;\n}\n\n.relations-list .body .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .body .md-button {\n    margin: 0;\n}\n*/\n",
                "customFunction": "let $injector = widgetContext.$scope.$injector;\nlet customDialog = $injector.get(widgetContext.servicesMap.get('customDialog'));\nlet deviceService = $injector.get(widgetContext.servicesMap.get('deviceService'));\nlet entityGroupService = $injector.get(widgetContext.servicesMap.get('entityGroupService'));\nlet attributeService = $injector.get(widgetContext.servicesMap.get('attributeService'));\n\nopenAddDeviceDialog();\n\nfunction openAddDeviceDialog() {\n  customDialog.customDialog(htmlTemplate, AddDeviceDialogController).subscribe();\n}\n\nfunction AddDeviceDialogController(instance) {\n  let vm = instance;\n  \n  vm.deviceTypes = [\n      'Chiller',\n      'Door Sensor',\n      'Freezer',\n      'Liquid Level Sensor',\n      'Motion Sensor',\n      'Occupancy Sensor',\n      'Smart Bin',\n      'Smart Shelf',\n      'Smoke Sensor'\n  ];\n\n  vm.addDeviceFormGroup = vm.fb.group({\n    name: ['', [vm.validators.required]],\n    type: ['', [vm.validators.required]],\n    label: ['', [vm.validators.required]]\n  });\n\n  vm.cancel = function () {\n    vm.dialogRef.close(null);\n  };\n  \n  vm.save = function () {\n    var customerId = widgetContext.stateController.getStateParams().entityId;\n    vm.addDeviceFormGroup.markAsPristine();\n    getTargetDeviceGroups(customerId).pipe(\n        widgetContext.rxjs.switchMap((targetDevicesGroup) => {\n            var supermarketDevicesGroup = targetDevicesGroup[0];\n            var unassignedDevicesGroup = targetDevicesGroup[1];\n            return saveDeviceObservable(customerId, supermarketDevicesGroup, unassignedDevicesGroup);\n        })\n    ).subscribe(\n      function (device) {\n          saveAttributes(device.id).subscribe(\n              function () {\n                widgetContext.updateAliases();\n                vm.dialogRef.close(null);\n              }\n        );\n      }\n    );\n  };\n\n  function saveDeviceObservable(customerId, supermarketDevicesGroup, unassignedDevicesGroup) {\n        const formValues = vm.addDeviceFormGroup.value;\n        let device = {\n          name: formValues.name,\n          type: formValues.type,\n          label: formValues.label,\n          customerId: customerId\n        };\n        return deviceService.saveDevice(device, unassignedDevicesGroup.id.id).pipe(\n            widgetContext.rxjs.switchMap((savedDevice) => {\n                return entityGroupService.addEntityToEntityGroup(supermarketDevicesGroup.id.id, savedDevice.id.id).pipe(\n                    widgetContext.rxjs.map(() => {\n                      return savedDevice;  \n                    })\n                );\n            })\n        );\n  }\n  \n  function getTargetDeviceGroups(customerId) {\n      return entityGroupService.getEntityGroupsByOwnerId(customerId.entityType, customerId.id, 'DEVICE').pipe(\n          widgetContext.rxjs.switchMap((groups) => {\n              return widgetContext.rxjs.forkJoin([\n                  getOrCreateDevicesGroup(groups, 'Supermarket Devices', customerId),\n                  getOrCreateDevicesGroup(groups, 'Unassigned Supermarket Devices', customerId)\n              ]);\n          })\n      );\n  }\n  \n  function getOrCreateDevicesGroup(groups, groupName, customerId) {\n      var devicesGroup = groups.find(group => group.name === groupName);\n      if (devicesGroup) {\n          return widgetContext.rxjs.of(devicesGroup);\n      } else {\n          devicesGroup = {\n              type: 'DEVICE',\n              name: groupName,\n              ownerId: customerId\n          };\n          return entityGroupService.saveEntityGroup(devicesGroup);\n      }\n  }\n\n  function saveAttributes(entityId) {\n    let attributesArray = [\n        {\n            key: 'state',\n            value: 'normal'\n        }\n    ];\n    return attributeService.saveEntityAttributes(entityId, \"SERVER_SCOPE\", attributesArray);\n  }\n}\n",
                "customResources": [],
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "4aa70732-60f6-bfe6-616f-2ea329576769"
              }
            ],
            "actionCellButton": [
              {
                "name": "Edit device",
                "icon": "edit",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "customPretty",
                "customHtml": "<form #addEntityForm=\"ngForm\" [formGroup]=\"editDeviceFormGroup\"\n      (ngSubmit)=\"save()\" class=\"add-entity-form\" style=\"width: 350px;\">\n  <mat-toolbar class=\"flex flex-row\" color=\"primary\">\n    <h2>Edit device</h2>\n    <span class=\"flex-1\"></span>\n    <button mat-icon-button (click)=\"cancel()\" type=\"button\">\n      <mat-icon class=\"material-icons\">close</mat-icon>\n    </button>\n  </mat-toolbar>\n  <mat-progress-bar color=\"warn\" mode=\"indeterminate\" *ngIf=\"isLoading$ | async\">\n  </mat-progress-bar>\n  <div style=\"height: 4px;\" *ngIf=\"!(isLoading$ | async)\"></div>\n  <div mat-dialog-content class=\"flex flex-col\">\n    <mat-form-field class=\"mat-block\">\n      <mat-label>Device name</mat-label>\n      <input matInput formControlName=\"name\" required>\n      <mat-error *ngIf=\"editDeviceFormGroup.get('name').hasError('required')\">\n        Device name is required.\n      </mat-error>\n    </mat-form-field>\n    <mat-form-field class=\"mat-block\">\n      <mat-label>Device type</mat-label>\n      <mat-select formControlName=\"type\" required>\n        <mat-option *ngFor=\"let type of deviceTypes\" [value]=\"type\">\n          {{ type }}\n        </mat-option>\n      </mat-select>\n      <mat-error *ngIf=\"editDeviceFormGroup.get('type').hasError('required')\">\n        Device type is required.\n      </mat-error>\n    </mat-form-field>\n    <mat-form-field class=\"mat-block\">\n      <mat-label>Device label</mat-label>\n      <input matInput formControlName=\"label\" required>\n      <mat-error *ngIf=\"editDeviceFormGroup.get('label').hasError('required')\">\n        Device label is required.\n      </mat-error>\n    </mat-form-field>\n  </div>\n  <div mat-dialog-actions class=\"flex flex-row items-center justify-end\">\n    <button mat-button color=\"primary\"\n            type=\"button\"\n            [disabled]=\"(isLoading$ | async)\"\n            (click)=\"cancel()\" cdkFocusInitial>\n      Cancel\n    </button>\n    <button mat-button mat-raised-button color=\"primary\"\n            type=\"submit\"\n            [disabled]=\"(isLoading$ | async) || editDeviceFormGroup.invalid || !editDeviceFormGroup.dirty\">\n      Save device\n    </button>\n  </div>\n</form>\n",
                "customCss": "/*=======================================================================*/\n/*==========  There are two examples: for edit and add entity  ==========*/\n/*=======================================================================*/\n/*========================  Edit entity example  ========================*/\n/*=======================================================================*/\n/*\n.edit-entity-form .boolean-value-input {\n    padding-left: 5px;\n}\n\n.edit-entity-form .boolean-value-input .checkbox-label {\n    margin-bottom: 8px;\n    color: rgba(0,0,0,0.54);\n    font-size: 12px;\n}\n\n.relations-list .header {\n    padding-right: 5px;\n    padding-bottom: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .header .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n    font-size: 12px;\n    font-weight: 700;\n    color: rgba(0, 0, 0, .54);\n    white-space: nowrap;\n}\n\n.relations-list .mat-form-field-infix {\n    width: auto !important;\n}\n\n.relations-list .body {\n    padding-right: 5px;\n    padding-bottom: 15px;\n    padding-left: 5px;\n}\n\n.relations-list .body .row {\n    padding-top: 5px;\n}\n\n.relations-list .body .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .body .md-button {\n    margin: 0;\n}\n*/\n/*========================================================================*/\n/*=========================  Add entity example  =========================*/\n/*========================================================================*/\n/*\n.add-entity-form .boolean-value-input {\n    padding-left: 5px;\n}\n\n.add-entity-form .boolean-value-input .checkbox-label {\n    margin-bottom: 8px;\n    color: rgba(0,0,0,0.54);\n    font-size: 12px;\n}\n\n.relations-list .header {\n    padding-right: 5px;\n    padding-bottom: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .header .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n    font-size: 12px;\n    font-weight: 700;\n    color: rgba(0, 0, 0, .54);\n    white-space: nowrap;\n}\n\n.relations-list .mat-form-field-infix {\n    width: auto !important;\n}\n\n.relations-list .body {\n    padding-right: 5px;\n    padding-bottom: 15px;\n    padding-left: 5px;\n}\n\n.relations-list .body .row {\n    padding-top: 5px;\n}\n\n.relations-list .body .cell {\n    padding-right: 5px;\n    padding-left: 5px;\n}\n\n.relations-list .body .md-button {\n    margin: 0;\n}\n*/\n",
                "customFunction": "let $injector = widgetContext.$scope.$injector;\nlet customDialog = $injector.get(widgetContext.servicesMap.get('customDialog'));\nlet deviceService = $injector.get(widgetContext.servicesMap.get('deviceService'));\n\nopenEditDeviceDialog();\n\nfunction openEditDeviceDialog() {\n  customDialog.customDialog(htmlTemplate, EditDeviceDialogController).subscribe();\n}\n\nfunction EditDeviceDialogController(instance) {\n  let vm = instance;\n  \n  vm.deviceTypes = [\n      'Chiller',\n      'Door Sensor',\n      'Freezer',\n      'Liquid Level Sensor',\n      'Motion Sensor',\n      'Occupancy Sensor',\n      'Smart Bin',\n      'Smart Shelf',\n      'Smoke Sensor'\n  ];\n\n  vm.device = {};\n\n  vm.editDeviceFormGroup = vm.fb.group({\n    name: ['', [vm.validators.required]],\n    type: ['', [vm.validators.required]],\n    label: ['', [vm.validators.required]]\n  });\n\n  getDevice();\n\n  vm.cancel = function() {\n    vm.dialogRef.close(null);\n  };\n\n  vm.save = function() {\n    vm.editDeviceFormGroup.markAsPristine();\n    saveDevice().subscribe(\n      function () {\n        widgetContext.updateAliases();\n        vm.dialogRef.close(null);\n      }\n    );\n  };\n\n  function getDevice() {\n      deviceService.getDevice(entityId.id).subscribe(\n          function (device) {\n                vm.device = device;          \n                vm.editDeviceFormGroup.patchValue({\n                  name: vm.device.name,\n                  type: vm.device.type,\n                  label: vm.device.label\n                }, {emitEvent: false});\n              }\n    );\n  }\n\n  function saveDevice() {\n    const formValues = vm.editDeviceFormGroup.value;\n    vm.device.name = formValues.name;\n    if (vm.device.type !== formValues.type) {\n        vm.device.type = formValues.type;\n        vm.device.deviceProfileId = null;\n    }\n    vm.device.label = formValues.label;\n    return deviceService.saveDevice(vm.device);\n  }\n\n}\n",
                "customResources": [],
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "7e870fd2-9559-9a6e-d847-beefc971ecaa"
              },
              {
                "name": "Delete device",
                "icon": "delete",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "custom",
                "customFunction": "var $injector = widgetContext.$scope.$injector;\nvar dialogs = $injector.get(widgetContext.servicesMap.get('dialogs'));\nvar deviceService = $injector.get(widgetContext.servicesMap.get('deviceService'));\n\nopenDeleteDeviceDialog();\n\nfunction openDeleteDeviceDialog() {\n  var title = 'Are you sure you want to delete the device ' + entityName + '?';\n  var content = 'Be careful, after the confirmation, the device and all related data will become unrecoverable!';\n  dialogs.confirm(title, content, 'Cancel', 'Delete').subscribe(\n    function(result) {\n      if (result) {\n        deleteDevice();\n      }\n    }\n  );\n}\n\nfunction deleteDevice() {\n  deviceService.deleteDevice(entityId.id).subscribe(\n    function() {\n      widgetContext.updateAliases();\n    }\n  );\n}\n",
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "70f87b5b-3dbc-91e6-0e59-80511b0be772"
              }
            ]
          },
          "titleIcon": "devices_other",
          "iconColor": "rgba(0, 0, 0, 0.87)",
          "iconSize": "28px",
          "displayTimewindow": true
        },
        "row": 0,
        "col": 0,
        "id": "eac6e38e-62f2-1f91-754b-299d11e87c19",
        "typeFullFqn": "system.cards.entities_table"
      },
      "a5093c25-bca6-94a6-0f44-e1bb752b755e": {
        "type": "latest",
        "sizeX": 5,
        "sizeY": 3.5,
        "config": {
          "datasources": [],
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideQuickInterval": false
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1678197897861,
                "endTimeMs": 1678284297861
              },
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideFixedInterval": false,
              "hideQuickInterval": false
            },
            "aggregation": {
              "type": "AVG",
              "limit": 25000
            }
          },
          "showTitle": false,
          "backgroundColor": "#fff",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "8px",
          "settings": {
            "markdownTextFunction": "return '# Some title\\n - Entity name: ' + data[0]['entityName'];",
            "useMarkdownTextFunction": false,
            "markdownCss": ".tb-markdown-view .tb-progress-cover, .tb-markdown-view .mat-drawer-container {\n    background-color: #fff;\n}\n\n.tb-markdown-view div, .tb-markdown-view p {\n    line-height: normal;\n}\n\n.tb-markdown-view > div {\n    padding: 0;\n}\n\n.market-layout {\n    position: relative;\n}\n\n.market-title {\n    font-size: 26px;\n    padding-bottom: 16px;\n    padding-left: 10px;\n    padding-top: 5px;\n}\n\n",
            "markdownTextPattern": "<div class=\"market-layout flex size-full flex-col\" style=\"padding: 0;\">\n  <div class=\"flex flex-row items-start justify-center\" style=\"width: 100%; height: 60px;\">\n    <h5 class=\"market-title flex-1\">Devices</h5>\n    <button id=\"add-device\" mat-raised-button color=\"primary\"><mat-icon class=\"tb-mat-20\">add</mat-icon><span>Add device</span></button>\n  </div>\n  <div class=\"flex flex-1 flex-col\" style=\"position: relative;\">\n    <tb-dashboard-state class=\"flex-1\" [ctx]=\"ctx\" [syncParentStateParams]=\"true\" stateId=\"devices_plan\"></tb-dashboard-state>\n  </div>\n</div>"
          },
          "title": "New Markdown/HTML Card",
          "showTitleIcon": false,
          "iconColor": "rgba(0, 0, 0, 0.87)",
          "iconSize": "24px",
          "titleTooltip": "",
          "dropShadow": true,
          "enableFullscreen": false,
          "widgetStyle": {},
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400
          },
          "showLegend": false,
          "enableDataExport": false,
          "widgetCss": ".tb-widget-container .tb-widget .tb-multiple-input {\n    background-color: #FAFAFA;\n    border-radius: 4px;\n}\n\n.tb-widget-container .tb-widget .tb-multiple-input .input-field {\n    padding-right: 30px;\n}\n\n.tb-widget-container .tb-widget .tb-multiple-input mat-slide-toggle {\n    margin-top: 15px !important;\n    margin-bottom: 0 !important;\n}\n\n.tb-widget-container .tb-widget .tb-multiple-input .mat-slide-toggle-content {\n    width: 120px;\n}\n\n.tb-widget-container .tb-widget .mat-slide-toggle-bar {\n    width: 42px;\n    height: 24px;\n    border-radius: 16px;\n}\n\n.tb-widget-container .tb-widget .mat-slide-toggle-thumb-container {\n    top: 2px;\n    left: 2px;\n}\n\n.tb-widget-container .tb-widget .mat-slide-toggle.mat-checked .mat-slide-toggle-thumb-container {\n    transform: translate3d(18px, 0, 0);\n}\n\n.tb-widget-container .tb-widget .mat-slide-toggle-thumb {\n    background-color: #fafafa;\n}\n\n.tb-widget-container .tb-widget .mat-slide-toggle.mat-checked .mat-slide-toggle-bar {\n    background-color: #F2994A;\n}\n",
          "noDataDisplayMessage": "",
          "actions": {
            "elementClick": [
              {
                "name": "add-device",
                "icon": "more_horiz",
                "useShowWidgetActionFunction": null,
                "showWidgetActionFunction": "return true;",
                "type": "customPretty",
                "customHtml": "<form #addEntityForm=\"ngForm\" [formGroup]=\"addDeviceFormGroup\"\n      (ngSubmit)=\"save()\" class=\"add-entity-form\" style=\"width: 350px;\">\n  <mat-toolbar class=\"flex flex-row\" color=\"primary\">\n    <h2>Add device</h2>\n    <span class=\"flex-1\"></span>\n    <button mat-icon-button (click)=\"cancel()\" type=\"button\">\n      <mat-icon class=\"material-icons\">close</mat-icon>\n    </button>\n  </mat-toolbar>\n  <mat-progress-bar color=\"warn\" mode=\"indeterminate\" *ngIf=\"isLoading$ | async\">\n  </mat-progress-bar>\n  <div style=\"height: 4px;\" *ngIf=\"!(isLoading$ | async)\"></div>\n  <div mat-dialog-content class=\"flex flex-col\">\n    <mat-form-field class=\"mat-block\">\n      <mat-label>Device</mat-label>\n      <mat-select formControlName=\"device\" required>\n        <mat-select-trigger>\n          <div class=\"device-item flex flex-row\">\n            <div class=\"flex flex-1 flex-col\">\n              <div>{{addDeviceFormGroup.get('device').value?.label}}</div>\n              <div class=\"device-name\">{{addDeviceFormGroup.get('device').value?.name}}</div>\n            </div>\n            <div class=\"device-type\">{{addDeviceFormGroup.get('device').value?.type}}</div>\n          </div>\n        </mat-select-trigger>\n        <mat-option *ngFor=\"let device of availableDevices\" [value]=\"device\">\n          <div class=\"device-item flex flex-row\">\n            <div class=\"flex flex-1 flex-col\">\n              <div>{{device?.label}}</div>\n              <div class=\"device-name\">{{device?.name}}</div>\n            </div>\n            <div class=\"device-type\">{{device?.type}}</div>\n          </div>\n          <mat-divider></mat-divider>\n        </mat-option>\n        <mat-option *ngIf=\"!availableDevices?.length\" disabled [value]=\"null\">\n          <div class=\"device-item\">\n            No devices available\n          </div>\n        </mat-option>\n      </mat-select>\n      <mat-error *ngIf=\"addDeviceFormGroup.get('device').hasError('required')\">\n        Device is required.\n      </mat-error>\n    </mat-form-field>\n    <mat-form-field class=\"mat-block\">\n      <mat-label>Label</mat-label>\n      <input matInput formControlName=\"label\" required>\n      <mat-error *ngIf=\"addDeviceFormGroup.get('label').hasError('required')\">\n        Device label is required.\n      </mat-error>\n    </mat-form-field>\n  </div>\n  <div mat-dialog-actions class=\"flex flex-row items-center justify-end\">\n    <button mat-button color=\"primary\"\n            type=\"button\"\n            [disabled]=\"(isLoading$ | async)\"\n            (click)=\"cancel()\" cdkFocusInitial>\n      Cancel\n    </button>\n    <button mat-button mat-raised-button color=\"primary\"\n            type=\"submit\"\n            [disabled]=\"(isLoading$ | async) || addDeviceFormGroup.invalid || !addDeviceFormGroup.dirty\">\n      Add device\n    </button>\n  </div>\n</form>\n",
                "customCss": "\n.device-item {\n    line-height: 24px;\n    width: 100%;\n    padding-top: 8px;\n    padding-bottom: 8px;\n}\n\n.device-item .device-name {\n    font-size: 12px;\n    opacity: 0.7;\n}\n\n.device-item .device-type {\n    font-size: 14px;\n    opacity: 0.7;\n}\n\n.mat-mdc-option {\n    height: auto !important;\n    white-space: normal !important;\n}\n\n.mat-mdc-option .mdc-list-item__primary-text {\n    display: block;\n    width: 100%;\n}",
                "customFunction": "let $injector = widgetContext.$scope.$injector;\nlet customDialog = $injector.get(widgetContext.servicesMap.get('customDialog'));\nlet entityService = $injector.get(widgetContext.servicesMap.get('entityService'));\nlet deviceService = $injector.get(widgetContext.servicesMap.get('deviceService'));\nlet entityGroupService = $injector.get(widgetContext.servicesMap.get('entityGroupService'));\nlet attributeService = $injector.get(widgetContext.servicesMap.get('attributeService'));\nlet entityRelationService = $injector.get(widgetContext.servicesMap.get('entityRelationService'));\n\nopenAddDevicetDialog();\n\nfunction openAddDevicetDialog() {\n  customDialog.customDialog(htmlTemplate, AddDeviceDialogController).subscribe();\n}\n\nfunction AddDeviceDialogController(instance) {\n  let vm = instance;\n\n  vm.addDeviceFormGroup = vm.fb.group({\n    device: [null, [vm.validators.required]],\n    label:  [{value: null, disabled: true}, [vm.validators.required]]\n  });\n  \n  vm.addDeviceFormGroup.get('device').valueChanges.subscribe(\n      (device) => {\n          vm.addDeviceFormGroup.get('label').patchValue(device.label, { emitEvent: false});\n          vm.addDeviceFormGroup.get('label').enable( { emitEvent: false } );\n          vm.addDeviceFormGroup.get('label').updateValueAndValidity( { onlySelf: true } );\n      }\n  );\n\n  vm.cancel = function () {\n    vm.dialogRef.close(null);\n  };\n  \n  vm.save = function () {\n    var supermarketId = widgetContext.stateController.getStateParams().selectedSupermarket.entityId;\n    vm.addDeviceFormGroup.markAsPristine();\n    var device = vm.addDeviceFormGroup.value.device;\n    var label = vm.addDeviceFormGroup.value.label;\n    var deviceId = device.deviceId;\n    widgetContext.rxjs.forkJoin([\n        entityGroupService.removeEntityFromEntityGroup(vm.unassignedDevicesGroup.id.id, deviceId.id),\n        saveDeviceToSupermarketRelation(supermarketId, deviceId),\n        saveAttributes(deviceId),\n        updateDeviceLabel(device, label)\n    ]).subscribe(() => {\n            widgetContext.updateAliases();\n            vm.dialogRef.close(null);\n    });\n  };\n  \n  init();\n  \n  function init() {\n      vm.unassignedDevicesGroup = null;\n      vm.availableDevices = [];\n      if (widgetContext.currentUser.authority === 'TENANT_ADMIN') {\n           vm.customerId = widgetContext.stateController.getStateParams().entityId;\n      } else {\n           vm.customerId = { id: widgetContext.currentUser.customerId, entityType: 'CUSTOMER'};\n      }\n      entityGroupService.getEntityGroupsByOwnerId(vm.customerId.entityType, vm.customerId.id, 'DEVICE').subscribe((entityGroups) => {\n          vm.customerDevicesGroups = entityGroups;\n          vm.unassignedDevicesGroup = entityGroups.find(group => group.name === 'Unassigned Supermarket Devices');\n          if (vm.unassignedDevicesGroup) {\n              var query = {\n                  entityFilter: {\n                      type: 'entityGroup',\n                      groupType: 'DEVICE',\n                      entityGroup: vm.unassignedDevicesGroup.id.id\n                  },\n                  pageLink: {\n                      pageSize: 100,\n                      page: 0\n                  },\n                  entityFields: [\n                      {\n                          key: 'name',\n                          type: 'ENTITY_FIELD'\n                      },\n                      {\n                          key: 'type',\n                          type: 'ENTITY_FIELD'\n                      },\n                      {\n                          key: 'label',\n                          type: 'ENTITY_FIELD'\n                      }\n                  ]\n              };\n              entityService.findEntityDataByQuery(query).subscribe(\n                  (data) => {\n                      vm.availableDevices = data.data.map((entityData) => {\n                          return {\n                              deviceId: entityData.entityId,\n                              name: entityData.latest[\"ENTITY_FIELD\"].name.value,\n                              type: entityData.latest[\"ENTITY_FIELD\"].type.value,\n                              label: entityData.latest[\"ENTITY_FIELD\"].label.value\n                          };\n                      });\n                  }\n              );\n          }\n      });\n  }\n\n  function saveDeviceToSupermarketRelation(supermarketId, deviceId) {\n      var relation = {\n          from: supermarketId,\n          to: deviceId,\n          typeGroup: 'COMMON',\n          type: 'Contains'\n      };\n      return entityRelationService.saveRelation(relation);\n  }\n  \n  function saveAttributes(entityId) {\n    let attributesArray = [\n        {\n            key: 'xPos',\n            value: 0.5\n        },\n        {\n            key: 'yPos',\n            value: 0.5\n        }\n    ];\n    return attributeService.saveEntityAttributes(entityId, \"SERVER_SCOPE\", attributesArray);\n  }\n  \n  function updateDeviceLabel(device, label) {\n      if (device.label !== label) {\n          return deviceService.getDevice(device.deviceId.id).pipe(\n              widgetContext.rxjs.switchMap((origDevice) => {\n                  origDevice.label = label;\n                  return deviceService.saveDevice(origDevice);\n              })\n          );\n      } else {\n          return widgetContext.rxjs.of(null);\n      }\n  }\n}\n",
                "customResources": [],
                "openInSeparateDialog": false,
                "openInPopover": false,
                "id": "7cad1c71-0765-4277-32a8-c87808a0c689"
              }
            ]
          }
        },
        "row": 0,
        "col": 0,
        "id": "a5093c25-bca6-94a6-0f44-e1bb752b755e",
        "typeFullFqn": "system.cards.markdown_card"
      },
      "fbc1fe3e-2cbf-2e21-6d34-765687bd2f44": {
        "typeFullFqn": "system.map",
        "type": "latest",
        "sizeX": 8.5,
        "sizeY": 6,
        "config": {
          "datasources": [],
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideQuickInterval": false
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1742807938671,
                "endTimeMs": 1742894338671
              },
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideFixedInterval": false,
              "hideQuickInterval": false
            },
            "aggregation": {
              "type": "AVG",
              "limit": 25000
            }
          },
          "showTitle": false,
          "backgroundColor": "rgba(0, 0, 0, 0)",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "0px",
          "settings": {
            "mapType": "geoMap",
            "layers": [
              {
                "label": "{i18n:widgets.maps.layer.roadmap}",
                "provider": "openstreet",
                "layerType": "CartoDB.Positron",
                "referenceLayer": null
              },
              {
                "label": "{i18n:widgets.maps.layer.satellite}",
                "provider": "openstreet",
                "layerType": "Esri.WorldImagery"
              },
              {
                "label": "{i18n:widgets.maps.layer.hybrid}",
                "provider": "openstreet",
                "layerType": "Esri.WorldImagery",
                "referenceLayer": "openstreetmap_hybrid"
              }
            ],
            "imageSource": null,
            "markers": [
              {
                "dsType": "entity",
                "dsLabel": "",
                "dsDeviceId": null,
                "dsEntityAliasId": "1c348dad-e738-a4db-5e7e-4c0271790ab7",
                "dsFilterId": null,
                "additionalDataKeys": null,
                "label": {
                  "show": true,
                  "type": "pattern",
                  "pattern": "${entityName}"
                },
                "tooltip": {
                  "show": true,
                  "trigger": "click",
                  "autoclose": true,
                  "type": "pattern",
                  "pattern": "<b>${entityName}</b><br/><br/><link-act name='supermarket-devices'>Supermarket devices</link-act><br/><br/><link-act name='delete-supermarket'>Delete</link-act>",
                  "offsetX": 0,
                  "offsetY": -1,
                  "patternFunction": null,
                  "tagActions": [
                    {
                      "name": "supermarket-devices",
                      "type": "custom",
                      "customFunction": "var params = JSON.parse(JSON.stringify(widgetContext.stateController.getStateParams()));\nparams['selectedSupermarket'] = {\n        entityId: entityId,\n        entityName: entityName,\n        entityLabel: entityLabel,\n};\nparams['targetEntityParamName'] = 'selectedSupermarket';\nparams['selectedDevice'] = null;\n\nwidgetContext.stateController.openState('supermarket_devices', params);\t",
                      "openInSeparateDialog": false,
                      "openInPopover": false
                    },
                    {
                      "name": "delete-supermarket",
                      "type": "custom",
                      "customFunction": {
                        "body": "utils.deleteSupermarket(widgetContext, entityId, entityName);",
                        "modules": {
                          "utils": "tb-resource;/api/resource/js_module/system/Smart Retail Solution JS Utils.js"
                        }
                      },
                      "openInSeparateDialog": false,
                      "openInPopover": false
                    }
                  ]
                },
                "click": {
                  "type": "custom",
                  "customFunction": {
                    "body": "utils.onSupermarketMarkerClick(widgetContext, entityId, entityName, entityLabel);",
                    "modules": {
                      "utils": "tb-resource;/api/resource/js_module/system/Smart Retail Solution JS Utils.js"
                    }
                  },
                  "openInSeparateDialog": false,
                  "openInPopover": false
                },
                "groups": null,
                "edit": {
                  "enabledActions": [
                    "move"
                  ],
                  "attributeScope": "SERVER_SCOPE",
                  "snappable": false
                },
                "xKey": {
                  "name": "latitude",
                  "label": "latitude",
                  "type": "attribute",
                  "settings": {},
                  "color": "#2196f3"
                },
                "yKey": {
                  "name": "longitude",
                  "label": "longitude",
                  "type": "attribute",
                  "settings": {},
                  "color": "#2196f3"
                },
                "markerType": "image",
                "markerShape": {
                  "shape": "markerShape1",
                  "size": 34,
                  "color": {
                    "type": "constant",
                    "color": "#307FE5"
                  }
                },
                "markerIcon": {
                  "iconContainer": "iconContainer1",
                  "icon": "mdi:lightbulb-on",
                  "size": 48,
                  "color": {
                    "type": "constant",
                    "color": "#307FE5"
                  }
                },
                "markerImage": {
                  "type": "function",
                  "image": "/assets/markers/shape1.svg",
                  "imageSize": 34,
                  "imageFunction": {
                    "body": "return utils.getSupermarketMarker(data, dsData);\n",
                    "modules": {
                      "utils": "tb-resource;/api/resource/js_module/system/Smart Retail Solution JS Utils.js"
                    }
                  },
                  "images": null
                },
                "markerOffsetX": 0.5,
                "markerOffsetY": 1,
                "markerClustering": {
                  "enable": false,
                  "zoomOnClick": true,
                  "maxZoom": null,
                  "maxClusterRadius": 80,
                  "zoomAnimation": true,
                  "showCoverageOnHover": true,
                  "spiderfyOnMaxZoom": false,
                  "chunkedLoad": false,
                  "lazyLoad": true,
                  "useClusterMarkerColorFunction": false,
                  "clusterMarkerColorFunction": null
                }
              }
            ],
            "polygons": [],
            "circles": [],
            "additionalDataSources": [
              {
                "dsType": "entity",
                "dsLabel": "",
                "dataKeys": [
                  {
                    "name": "latitude",
                    "type": "attribute",
                    "label": "selectedSupermarket",
                    "color": "#2196f3",
                    "settings": {},
                    "_hash": 0.6559223535633514,
                    "aggregationType": null,
                    "units": null,
                    "decimals": null,
                    "funcBody": null,
                    "usePostProcessing": true,
                    "postFuncBody": "if (value) {\n    return true;\n} else {\n    return false;\n}"
                  }
                ],
                "dsEntityAliasId": "7add11d8-cbf7-fd15-6b12-d5df058f11fa"
              }
            ],
            "controlsPosition": "topleft",
            "zoomActions": [
              "scroll",
              "doubleClick",
              "controlButtons"
            ],
            "scales": [],
            "dragModeButton": false,
            "fitMapBounds": true,
            "useDefaultCenterPosition": false,
            "defaultCenterPosition": "0,0",
            "defaultZoomLevel": 14,
            "mapPageSize": 16384,
            "mapActionButtons": [],
            "background": {
              "type": "color",
              "color": "#fff",
              "overlay": {
                "enabled": false,
                "color": "rgba(255,255,255,0.72)",
                "blur": 3
              }
            },
            "padding": "0"
          },
          "title": "Map",
          "useDashboardTimewindow": true,
          "displayTimewindow": true,
          "showTitleIcon": false,
          "titleTooltip": "",
          "dropShadow": false,
          "enableFullscreen": false,
          "widgetStyle": {},
          "widgetCss": "",
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400
          },
          "pageSize": 1024,
          "noDataDisplayMessage": "",
          "configMode": "basic",
          "titleFont": null,
          "titleColor": null,
          "margin": "0px",
          "borderRadius": "",
          "iconSize": "24px",
          "titleIcon": "map",
          "iconColor": "#1F6BDD",
          "actions": {},
          "enableDataExport": false
        },
        "row": 0,
        "col": 0,
        "id": "fbc1fe3e-2cbf-2e21-6d34-765687bd2f44"
      },
      "5621a16c-0748-0b80-f99f-1715d9fe3e27": {
        "typeFullFqn": "system.map",
        "type": "latest",
        "sizeX": 8.5,
        "sizeY": 6,
        "config": {
          "datasources": [],
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideQuickInterval": false
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1742807938671,
                "endTimeMs": 1742894338671
              },
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideFixedInterval": false,
              "hideQuickInterval": false
            },
            "aggregation": {
              "type": "AVG",
              "limit": 25000
            }
          },
          "showTitle": false,
          "backgroundColor": "rgba(0, 0, 0, 0)",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "0px",
          "settings": {
            "mapType": "geoMap",
            "layers": [
              {
                "label": "{i18n:widgets.maps.layer.roadmap}",
                "provider": "openstreet",
                "layerType": "CartoDB.Positron",
                "referenceLayer": null
              },
              {
                "label": "{i18n:widgets.maps.layer.satellite}",
                "provider": "openstreet",
                "layerType": "Esri.WorldImagery"
              },
              {
                "label": "{i18n:widgets.maps.layer.hybrid}",
                "provider": "openstreet",
                "layerType": "Esri.WorldImagery",
                "referenceLayer": "openstreetmap_hybrid"
              }
            ],
            "imageSource": null,
            "markers": [
              {
                "dsType": "entity",
                "dsLabel": "",
                "dsDeviceId": null,
                "dsEntityAliasId": "7add11d8-cbf7-fd15-6b12-d5df058f11fa",
                "dsFilterId": null,
                "additionalDataKeys": null,
                "label": {
                  "show": true,
                  "type": "pattern",
                  "pattern": "${entityName}"
                },
                "tooltip": {
                  "show": false,
                  "trigger": "click",
                  "autoclose": true,
                  "type": "pattern",
                  "pattern": "",
                  "offsetX": 0,
                  "offsetY": -1,
                  "patternFunction": null,
                  "tagActions": []
                },
                "click": {
                  "type": "doNothing",
                  "openInSeparateDialog": false,
                  "openInPopover": false
                },
                "groups": null,
                "edit": {
                  "enabledActions": [
                    "move"
                  ],
                  "attributeScope": "SERVER_SCOPE",
                  "snappable": false
                },
                "xKey": {
                  "name": "latitude",
                  "label": "latitude",
                  "type": "attribute",
                  "settings": {},
                  "color": "#2196f3"
                },
                "yKey": {
                  "name": "longitude",
                  "label": "longitude",
                  "type": "attribute",
                  "settings": {},
                  "color": "#2196f3"
                },
                "markerType": "image",
                "markerShape": {
                  "shape": "markerShape1",
                  "size": 34,
                  "color": {
                    "type": "constant",
                    "color": "#307FE5"
                  }
                },
                "markerIcon": {
                  "iconContainer": "iconContainer1",
                  "icon": "mdi:lightbulb-on",
                  "size": 48,
                  "color": {
                    "type": "constant",
                    "color": "#307FE5"
                  }
                },
                "markerImage": {
                  "type": "function",
                  "image": "/assets/markers/shape1.svg",
                  "imageSize": 34,
                  "imageFunction": {
                    "body": "return utils.getSupermarketMarker(data, dsData);\n",
                    "modules": {
                      "utils": "tb-resource;/api/resource/js_module/system/Smart Retail Solution JS Utils.js"
                    }
                  },
                  "images": null
                },
                "markerOffsetX": 0.5,
                "markerOffsetY": 1,
                "markerClustering": {
                  "enable": false,
                  "zoomOnClick": true,
                  "maxZoom": null,
                  "maxClusterRadius": 80,
                  "zoomAnimation": true,
                  "showCoverageOnHover": true,
                  "spiderfyOnMaxZoom": false,
                  "chunkedLoad": false,
                  "lazyLoad": true,
                  "useClusterMarkerColorFunction": false,
                  "clusterMarkerColorFunction": null
                }
              }
            ],
            "polygons": [],
            "circles": [],
            "additionalDataSources": [],
            "controlsPosition": "topleft",
            "zoomActions": [
              "scroll",
              "doubleClick",
              "controlButtons"
            ],
            "scales": [],
            "dragModeButton": false,
            "fitMapBounds": true,
            "useDefaultCenterPosition": false,
            "defaultCenterPosition": "0,0",
            "defaultZoomLevel": 14,
            "mapPageSize": 16384,
            "mapActionButtons": [],
            "background": {
              "type": "color",
              "color": "#fff",
              "overlay": {
                "enabled": false,
                "color": "rgba(255,255,255,0.72)",
                "blur": 3
              }
            },
            "padding": "0"
          },
          "title": "Map",
          "useDashboardTimewindow": true,
          "displayTimewindow": true,
          "showTitleIcon": false,
          "titleTooltip": "",
          "dropShadow": false,
          "enableFullscreen": false,
          "widgetStyle": {},
          "widgetCss": "",
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400
          },
          "pageSize": 1024,
          "noDataDisplayMessage": "",
          "configMode": "basic",
          "titleFont": null,
          "titleColor": null,
          "margin": "0px",
          "borderRadius": "",
          "iconSize": "24px",
          "titleIcon": "map",
          "iconColor": "#1F6BDD",
          "actions": {},
          "enableDataExport": false
        },
        "row": 0,
        "col": 0,
        "id": "5621a16c-0748-0b80-f99f-1715d9fe3e27"
      },
      "3c60f7b9-3595-bee9-7b1c-9e74bf85ebb5": {
        "typeFullFqn": "system.image_map",
        "type": "latest",
        "sizeX": 8.5,
        "sizeY": 6,
        "config": {
          "datasources": [],
          "timewindow": {
            "displayValue": "",
            "selectedTab": 0,
            "realtime": {
              "realtimeType": 1,
              "interval": 1000,
              "timewindowMs": 60000,
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideQuickInterval": false
            },
            "history": {
              "historyType": 0,
              "interval": 1000,
              "timewindowMs": 60000,
              "fixedTimewindow": {
                "startTimeMs": 1742808925372,
                "endTimeMs": 1742895325372
              },
              "quickInterval": "CURRENT_DAY",
              "hideInterval": false,
              "hideLastInterval": false,
              "hideFixedInterval": false,
              "hideQuickInterval": false
            },
            "aggregation": {
              "type": "AVG",
              "limit": 25000
            }
          },
          "showTitle": false,
          "backgroundColor": "rgba(0, 0, 0, 0)",
          "color": "rgba(0, 0, 0, 0.87)",
          "padding": "0px",
          "settings": {
            "mapType": "image",
            "layers": [
              {
                "label": "{i18n:widgets.maps.layer.roadmap}",
                "provider": "openstreet",
                "layerType": "OpenStreetMap.Mapnik"
              },
              {
                "label": "{i18n:widgets.maps.layer.satellite}",
                "provider": "openstreet",
                "layerType": "Esri.WorldImagery"
              },
              {
                "label": "{i18n:widgets.maps.layer.hybrid}",
                "provider": "openstreet",
                "layerType": "Esri.WorldImagery",
                "referenceLayer": "openstreetmap_hybrid"
              }
            ],
            "imageSource": {
              "sourceType": "entityKey",
              "url": null,
              "entityAliasId": "7add11d8-cbf7-fd15-6b12-d5df058f11fa",
              "entityKey": {
                "name": "floorplan",
                "type": "attribute",
                "label": "floorplan",
                "color": "#2196f3",
                "settings": {},
                "_hash": 0.6007402253004313
              }
            },
            "markers": [
              {
                "dsType": "entity",
                "dsLabel": "",
                "dsDeviceId": null,
                "dsEntityAliasId": "d13f6078-0d81-ec59-529c-64acbbcaf470",
                "dsFilterId": null,
                "additionalDataKeys": [
                  {
                    "name": "active",
                    "type": "attribute",
                    "label": "active",
                    "color": "#2196f3",
                    "settings": {},
                    "_hash": 0.6901039024215496
                  },
                  {
                    "name": "name",
                    "type": "entityField",
                    "label": "Name",
                    "color": "#2196f3",
                    "settings": {},
                    "_hash": 0.29589718996392245
                  },
                  {
                    "name": "label",
                    "type": "entityField",
                    "label": "Label",
                    "color": "#2196f3",
                    "settings": {},
                    "_hash": 0.10177062502875911
                  },
                  {
                    "name": "type",
                    "type": "entityField",
                    "label": "Type",
                    "color": "#2196f3",
                    "settings": {},
                    "_hash": 0.10585281981559169
                  },
                  {
                    "name": "weight",
                    "type": "timeseries",
                    "label": "weight",
                    "color": "#2196f3",
                    "settings": {},
                    "_hash": 0.5183510387547576
                  },
                  {
                    "name": "temperature",
                    "type": "timeseries",
                    "label": "temperature",
                    "color": "#2196f3",
                    "settings": {},
                    "_hash": 0.7873455975890793
                  }
                ],
                "label": {
                  "show": true,
                  "type": "pattern",
                  "pattern": "<div style=\"position: relative; white-space: nowrap; text-align: center; font-size: 12px; top: -5px;\"><span style=\"margin-left: -500%;\"></span><span style=\"border-radius: 10px; color: #fff; background-color: #666; padding-left: 5px; padding-right: 5px; padding-top: 3px; padding-bottom: 3px;\">${entityLabel}</span><span style=\"margin-right: -500%;\"></span></div>",
                  "patternFunction": null
                },
                "tooltip": {
                  "show": true,
                  "trigger": "click",
                  "autoclose": true,
                  "type": "pattern",
                  "pattern": "<b>${entityLabel}</b><br/><span>${entityName}</span><br/><br/><link-act name='update-label'>Update label</link-act><br/><br/><link-act name='remove-device'>Remove device</link-act>",
                  "offsetX": 0,
                  "offsetY": -0.5,
                  "patternFunction": "",
                  "tagActions": [
                    {
                      "name": "remove-device",
                      "type": "custom",
                      "customFunction": {
                        "body": "utils.deleteSmartRetailDevice(widgetContext, entityId, entityName);",
                        "modules": {
                          "utils": "tb-resource;/api/resource/js_module/system/Smart Retail Solution JS Utils.js"
                        }
                      },
                      "openInSeparateDialog": false,
                      "openInPopover": false
                    },
                    {
                      "name": "update-label",
                      "type": "custom",
                      "customFunction": {
                        "body": "utils.updateSmartRetailDeviceLabel(widgetContext, entityId);",
                        "modules": {
                          "utils": "tb-resource;/api/resource/js_module/system/Smart Retail Solution JS Utils.js"
                        }
                      },
                      "openInSeparateDialog": false,
                      "openInPopover": false
                    }
                  ]
                },
                "click": {
                  "type": "doNothing",
                  "openInSeparateDialog": false,
                  "openInPopover": false
                },
                "groups": null,
                "edit": {
                  "enabledActions": [
                    "move"
                  ],
                  "attributeScope": "SERVER_SCOPE",
                  "snappable": false
                },
                "xKey": {
                  "name": "xPos",
                  "label": "xPos",
                  "type": "attribute",
                  "settings": {},
                  "color": "#2196f3"
                },
                "yKey": {
                  "name": "yPos",
                  "label": "yPos",
                  "type": "attribute",
                  "settings": {},
                  "color": "#2196f3"
                },
                "markerType": "image",
                "markerShape": {
                  "shape": "markerShape1",
                  "size": 34,
                  "color": {
                    "type": "constant",
                    "color": "#307FE5"
                  }
                },
                "markerIcon": {
                  "iconContainer": "iconContainer1",
                  "icon": "mdi:lightbulb-on",
                  "size": 48,
                  "color": {
                    "type": "constant",
                    "color": "#307FE5"
                  }
                },
                "markerImage": {
                  "type": "function",
                  "image": "/assets/markers/shape1.svg",
                  "imageSize": 34,
                  "imageFunction": {
                    "body": "return utils.getSmartRetailDeviceMarker(data, dsData);",
                    "modules": {
                      "utils": "tb-resource;/api/resource/js_module/system/Smart Retail Solution JS Utils.js"
                    }
                  },
                  "images": null
                },
                "markerOffsetX": 0.5,
                "markerOffsetY": 0.5,
                "positionFunction": "return {x: origXPos, y: origYPos};",
                "markerClustering": {
                  "enable": false,
                  "zoomOnClick": true,
                  "maxZoom": null,
                  "maxClusterRadius": 80,
                  "zoomAnimation": true,
                  "showCoverageOnHover": true,
                  "spiderfyOnMaxZoom": false,
                  "chunkedLoad": false,
                  "lazyLoad": true,
                  "useClusterMarkerColorFunction": false,
                  "clusterMarkerColorFunction": null
                }
              }
            ],
            "polygons": [],
            "circles": [],
            "additionalDataSources": [],
            "controlsPosition": "topleft",
            "zoomActions": [
              "scroll",
              "doubleClick",
              "controlButtons"
            ],
            "scales": [],
            "dragModeButton": false,
            "fitMapBounds": true,
            "useDefaultCenterPosition": false,
            "defaultCenterPosition": "0,0",
            "defaultZoomLevel": null,
            "mapPageSize": 16384,
            "mapActionButtons": [],
            "background": {
              "type": "color",
              "color": "#fff",
              "overlay": {
                "enabled": false,
                "color": "rgba(255,255,255,0.72)",
                "blur": 3
              }
            },
            "padding": "0"
          },
          "title": "Image Map",
          "useDashboardTimewindow": true,
          "displayTimewindow": true,
          "showTitleIcon": false,
          "titleTooltip": "",
          "dropShadow": false,
          "enableFullscreen": false,
          "widgetStyle": {},
          "widgetCss": "",
          "titleStyle": {
            "fontSize": "16px",
            "fontWeight": 400
          },
          "pageSize": 1024,
          "noDataDisplayMessage": "",
          "configMode": "basic",
          "titleFont": null,
          "titleColor": null,
          "margin": "0px",
          "borderRadius": "",
          "iconSize": "24px",
          "titleIcon": "map",
          "iconColor": "#1F6BDD",
          "actions": {},
          "enableDataExport": false
        },
        "row": 0,
        "col": 0,
        "id": "3c60f7b9-3595-bee9-7b1c-9e74bf85ebb5"
      }
    },
    "states": {
      "default": {
        "name": "Smart Supermarket Administration",
        "root": true,
        "layouts": {
          "main": {
            "widgets": {
              "c2559a58-e82d-3250-7e35-f520ced0d916": {
                "sizeX": 24,
                "sizeY": 11,
                "row": 0,
                "col": 0
              }
            },
            "gridSettings": {
              "backgroundColor": "#ffffff",
              "columns": 24,
              "margin": 0,
              "backgroundSizeMode": "100%",
              "autoFillHeight": true,
              "backgroundImageUrl": null,
              "mobileAutoFillHeight": true,
              "mobileRowHeight": 70,
              "outerMargin": true,
              "layoutType": "default"
            }
          }
        }
      },
      "retail_companies": {
        "name": "Retail companies",
        "root": false,
        "layouts": {
          "main": {
            "widgets": {
              "777ded27-e3b8-d901-ca42-3079a23f7a12": {
                "sizeX": 24,
                "sizeY": 12,
                "row": 0,
                "col": 0
              }
            },
            "gridSettings": {
              "backgroundColor": "#eeeeee",
              "columns": 24,
              "margin": 10,
              "backgroundSizeMode": "100%",
              "autoFillHeight": true,
              "backgroundImageUrl": null,
              "mobileAutoFillHeight": true,
              "mobileRowHeight": 70,
              "outerMargin": true,
              "layoutType": "default"
            }
          }
        }
      },
      "supermarkets": {
        "name": "${entityName}: Supermarkets",
        "root": false,
        "layouts": {
          "main": {
            "widgets": {
              "ab845ee8-ff10-b684-3652-cb49e2d9acbe": {
                "sizeX": 9,
                "sizeY": 12,
                "row": 0,
                "col": 16
              },
              "7a671e82-7171-d1e2-75cc-565f67598090": {
                "sizeX": 16,
                "sizeY": 12,
                "row": 0,
                "col": 0
              }
            },
            "gridSettings": {
              "backgroundColor": "#eeeeee",
              "columns": 24,
              "margin": 10,
              "backgroundSizeMode": "100%",
              "autoFillHeight": true,
              "backgroundImageUrl": null,
              "mobileAutoFillHeight": false,
              "mobileRowHeight": 70,
              "outerMargin": true,
              "layoutType": "default"
            }
          }
        }
      },
      "edit_supermarket_card": {
        "name": "Edit supermarket card",
        "root": false,
        "layouts": {
          "main": {
            "widgets": {
              "28303a0b-d427-6d9e-0ee1-ae2c3f344769": {
                "sizeX": 24,
                "sizeY": 11,
                "row": 0,
                "col": 0
              }
            },
            "gridSettings": {
              "backgroundColor": "#ffffff",
              "columns": 24,
              "margin": 0,
              "backgroundSizeMode": "100%",
              "autoFillHeight": true,
              "backgroundImageUrl": null,
              "mobileAutoFillHeight": true,
              "mobileRowHeight": 70,
              "outerMargin": true,
              "layoutType": "default"
            }
          }
        }
      },
      "supermarkets_card": {
        "name": "Supermarkets card",
        "root": false,
        "layouts": {
          "main": {
            "widgets": {
              "4a524a3c-2b87-903c-6256-47a5df398ba5": {
                "sizeX": 24,
                "sizeY": 12,
                "row": 0,
                "col": 0
              }
            },
            "gridSettings": {
              "backgroundColor": "#ffffff",
              "columns": 24,
              "margin": 0,
              "backgroundSizeMode": "100%",
              "autoFillHeight": true,
              "backgroundImageUrl": null,
              "mobileAutoFillHeight": true,
              "mobileRowHeight": 70,
              "outerMargin": true,
              "layoutType": "default"
            }
          }
        }
      },
      "supermarket_devices": {
        "name": "${selectedSupermarket:entityName}: Devices",
        "root": false,
        "layouts": {
          "main": {
            "widgets": {
              "a5093c25-bca6-94a6-0f44-e1bb752b755e": {
                "sizeX": 24,
                "sizeY": 12,
                "row": 0,
                "col": 0
              }
            },
            "gridSettings": {
              "backgroundColor": "#eeeeee",
              "columns": 24,
              "margin": 10,
              "backgroundSizeMode": "100%",
              "autoFillHeight": true,
              "backgroundImageUrl": null,
              "mobileAutoFillHeight": false,
              "mobileRowHeight": 70,
              "outerMargin": true,
              "layoutType": "default"
            }
          }
        }
      },
      "edit_supermarket_address": {
        "name": "Edit supermarket address",
        "root": false,
        "layouts": {
          "main": {
            "widgets": {
              "980bd0c3-44e9-a1f9-c8f9-3dc533011fde": {
                "sizeX": 24,
                "sizeY": 11,
                "row": 0,
                "col": 0
              }
            },
            "gridSettings": {
              "backgroundColor": "#ffffff",
              "columns": 24,
              "margin": 0,
              "backgroundSizeMode": "100%",
              "autoFillHeight": true,
              "backgroundImageUrl": null,
              "mobileAutoFillHeight": true,
              "mobileRowHeight": 70,
              "outerMargin": true,
              "layoutType": "default"
            }
          }
        }
      },
      "edit_supermarket_location": {
        "name": "Edit supermarket location",
        "root": false,
        "layouts": {
          "main": {
            "widgets": {
              "5621a16c-0748-0b80-f99f-1715d9fe3e27": {
                "sizeX": 24,
                "sizeY": 12,
                "row": 0,
                "col": 0
              }
            },
            "gridSettings": {
              "backgroundColor": "#ffffff",
              "columns": 24,
              "margin": 0,
              "backgroundSizeMode": "100%",
              "autoFillHeight": true,
              "backgroundImageUrl": null,
              "mobileAutoFillHeight": true,
              "mobileRowHeight": 70,
              "outerMargin": true,
              "layoutType": "default"
            }
          }
        }
      },
      "edit_supermarket_floorplan": {
        "name": "Edit supermarket floorplan",
        "root": false,
        "layouts": {
          "main": {
            "widgets": {
              "59df0b6f-17dd-3c4c-a484-69c0836246da": {
                "sizeX": 24,
                "sizeY": 3,
                "row": 0,
                "col": 0
              }
            },
            "gridSettings": {
              "backgroundColor": "#ffffff",
              "columns": 24,
              "margin": 0,
              "backgroundSizeMode": "100%",
              "autoFillHeight": true,
              "backgroundImageUrl": null,
              "mobileAutoFillHeight": true,
              "mobileRowHeight": 70,
              "outerMargin": true,
              "layoutType": "default"
            }
          }
        }
      },
      "edit_supermarket_title": {
        "name": "edit_supermarket_title",
        "root": false,
        "layouts": {
          "main": {
            "widgets": {
              "00041a85-d8fe-09f2-4aab-1c86d8a7444d": {
                "sizeX": 24,
                "sizeY": 11,
                "row": 0,
                "col": 0
              }
            },
            "gridSettings": {
              "backgroundColor": "#ffffff",
              "columns": 24,
              "margin": 0,
              "backgroundSizeMode": "100%",
              "autoFillHeight": true,
              "backgroundImageUrl": null,
              "mobileAutoFillHeight": true,
              "mobileRowHeight": 70,
              "outerMargin": true,
              "layoutType": "default"
            }
          }
        }
      },
      "supermarkets_map": {
        "name": "Supermarkets map",
        "root": false,
        "layouts": {
          "main": {
            "widgets": {
              "fbc1fe3e-2cbf-2e21-6d34-765687bd2f44": {
                "sizeX": 24,
                "sizeY": 12,
                "row": 0,
                "col": 0
              }
            },
            "gridSettings": {
              "backgroundColor": "#ffffff",
              "columns": 24,
              "margin": 0,
              "backgroundSizeMode": "100%",
              "autoFillHeight": true,
              "backgroundImageUrl": null,
              "mobileAutoFillHeight": true,
              "mobileRowHeight": 70,
              "outerMargin": true,
              "layoutType": "default"
            }
          }
        }
      },
      "devices": {
        "name": "${entityName}: Devices",
        "root": false,
        "layouts": {
          "main": {
            "widgets": {
              "eac6e38e-62f2-1f91-754b-299d11e87c19": {
                "sizeX": 24,
                "sizeY": 11,
                "row": 0,
                "col": 0
              }
            },
            "gridSettings": {
              "backgroundColor": "#eeeeee",
              "columns": 24,
              "margin": 10,
              "backgroundSizeMode": "100%",
              "autoFillHeight": true,
              "backgroundImageUrl": null,
              "mobileAutoFillHeight": true,
              "mobileRowHeight": 70,
              "outerMargin": true,
              "layoutType": "default"
            }
          }
        }
      },
      "devices_plan": {
        "name": "Devices plan",
        "root": false,
        "layouts": {
          "main": {
            "widgets": {
              "3c60f7b9-3595-bee9-7b1c-9e74bf85ebb5": {
                "sizeX": 24,
                "sizeY": 12,
                "row": 0,
                "col": 0
              }
            },
            "gridSettings": {
              "backgroundColor": "#ffffff",
              "columns": 24,
              "margin": 0,
              "backgroundSizeMode": "100%",
              "autoFillHeight": true,
              "backgroundImageUrl": null,
              "mobileAutoFillHeight": true,
              "mobileRowHeight": 70,
              "outerMargin": true,
              "layoutType": "default"
            }
          }
        }
      }
    },
    "entityAliases": {
      "1c348dad-e738-a4db-5e7e-4c0271790ab7": {
        "id": "1c348dad-e738-a4db-5e7e-4c0271790ab7",
        "alias": "Supermarkets",
        "filter": {
          "type": "assetSearchQuery",
          "resolveMultiple": true,
          "rootStateEntity": true,
          "stateEntityParamName": null,
          "defaultStateEntity": {
            "entityType": "CURRENT_USER_OWNER",
            "id": "13814000-1dd2-11b2-8080-808080808080"
          },
          "rootEntity": null,
          "direction": "FROM",
          "maxLevel": 1,
          "fetchLastLevelOnly": false,
          "relationType": "Owns",
          "assetTypes": [
            "supermarket"
          ]
        }
      },
      "d13f6078-0d81-ec59-529c-64acbbcaf470": {
        "id": "d13f6078-0d81-ec59-529c-64acbbcaf470",
        "alias": "Supermarket Devices",
        "filter": {
          "type": "deviceSearchQuery",
          "resolveMultiple": true,
          "rootStateEntity": true,
          "stateEntityParamName": "selectedSupermarket",
          "defaultStateEntity": null,
          "rootEntity": null,
          "direction": "FROM",
          "maxLevel": 1,
          "fetchLastLevelOnly": false,
          "relationType": "Contains",
          "deviceTypes": [
            "Smart Shelf",
            "Chiller",
            "Door Sensor",
            "Freezer",
            "Liquid Level Sensor",
            "Motion Sensor",
            "Occupancy Sensor",
            "Smart Bin",
            "Smoke Sensor"
          ]
        }
      },
      "04917190-aea7-e407-e308-4598f1671a71": {
        "id": "04917190-aea7-e407-e308-4598f1671a71",
        "alias": "Retail companies",
        "filter": {
          "type": "entitiesByGroupName",
          "resolveMultiple": true,
          "groupStateEntity": false,
          "stateEntityParamName": null,
          "groupType": "CUSTOMER",
          "entityGroupNameFilter": "Smart Retail"
        }
      },
      "7add11d8-cbf7-fd15-6b12-d5df058f11fa": {
        "id": "7add11d8-cbf7-fd15-6b12-d5df058f11fa",
        "alias": "Selected Supermarket",
        "filter": {
          "type": "stateEntity",
          "resolveMultiple": false,
          "stateEntityParamName": "selectedSupermarket",
          "defaultStateEntity": null
        }
      },
      "984b0bbe-9a03-40ac-90f0-31db7e70dc8c": {
        "id": "984b0bbe-9a03-40ac-90f0-31db7e70dc8c",
        "alias": "Customer Supermarket Devices",
        "filter": {
          "type": "entitiesByGroupName",
          "resolveMultiple": true,
          "groupStateEntity": true,
          "stateEntityParamName": null,
          "groupType": "DEVICE",
          "entityGroupNameFilter": "Supermarket Devices"
        }
      }
    },
    "filters": {},
    "timewindow": {
      "displayValue": "",
      "hideAggregation": false,
      "hideAggInterval": false,
      "hideTimezone": false,
      "selectedTab": 0,
      "realtime": {
        "realtimeType": 0,
        "interval": 1000,
        "timewindowMs": 60000,
        "quickInterval": "CURRENT_DAY"
      },
      "history": {
        "historyType": 0,
        "interval": 1000,
        "timewindowMs": 60000,
        "fixedTimewindow": {
          "startTimeMs": 1639908545606,
          "endTimeMs": 1639994945606
        },
        "quickInterval": "CURRENT_DAY"
      },
      "aggregation": {
        "type": "AVG",
        "limit": 25000
      }
    },
    "settings": {
      "stateControllerId": "entity",
      "showTitle": false,
      "showDashboardsSelect": true,
      "showEntitiesSelect": false,
      "showDashboardTimewindow": false,
      "showDashboardExport": true,
      "toolbarAlwaysOpen": true,
      "titleColor": "rgba(0,0,0,0.870588)",
      "showDashboardLogo": false,
      "dashboardLogoUrl": null,
      "hideToolbar": false,
      "showFilters": false,
      "showUpdateDashboardImage": false,
      "dashboardCss": ".tb-widget-container > .tb-widget {\n    border-radius: 8px;\n}\n\ngridster-item:not(.tb-noselect) > .tb-widget-container > .tb-widget {\n    cursor: default !important;\n}\n\n.tb-widget-container > .tb-widget .tb-table-widget .mat-mdc-row {\n    cursor: pointer;\n}\n\n.tb-widget-container > .tb-widget .tb-legend-keys {\n    cursor: pointer;\n}"
    }
  },
  "name": "Smart Supermarket Administration",
  "resources": [
    {
      "link": "/api/resource/js_module/system/Smart Retail Solution JS Utils.js",
      "title": "Smart Retail Solution JS Utils",
      "type": "JS_MODULE",
      "subType": "MODULE",
      "resourceKey": "Smart Retail Solution JS Utils.js",
      "fileName": "Smart Retail Solution JS Utils.js",
      "mediaType": "application/javascript",
      "data": "CmV4cG9ydCBmdW5jdGlvbiBnZXRTbWFydFJldGFpbERldmljZVRvb2x0aXAoZGF0YSkgewogICAgdmFyIGNvbnRlbnQgPSAnPGRpdiBzdHlsZT0iZm9udC1mYW1pbHk6IFJvYm90bzsiPicgKwogICAgICAgICAgICAgICAgICc8ZGl2IHN0eWxlPSJmb250LXNpemU6IDE0cHg7IGZvbnQtd2VpZ2h0OiA1MDA7IHBhZGRpbmctYm90dG9tOiA4cHg7Ij4ke2VudGl0eUxhYmVsfTwvZGl2Pic7CiAgICAgICAgICAgICAgICAgCiAgICB2YXIgZGV2aWNlVHlwZSA9IGRhdGFbJ1R5cGUnXTsKICAgIGlmICh0eXBlb2YgZGV2aWNlVHlwZSAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgY29udGVudCArPSAnPGRpdiBzdHlsZT0iZm9udC1zaXplOiAxMnB4OyBmb250LXdlaWdodDogbm9ybWFsOyI+JyArIGdldEluZm9CeURldmljZVR5cGUoZGV2aWNlVHlwZSkgKyAnPC9kaXY+JzsKICAgIH0KICAgIGNvbnRlbnQgKz0gJzwvZGl2Pic7CiAgICByZXR1cm4gY29udGVudDsKICAgIAogICAgZnVuY3Rpb24gZ2V0SW5mb0J5RGV2aWNlVHlwZSh0eXBlKSB7CiAgICAgICAgc3dpdGNoICh0eXBlKSB7CiAgICAgICAgICAgIGNhc2UgJ1NtYXJ0IFNoZWxmJzoKICAgICAgICAgICAgICAgIHJldHVybiAnV2VpZ2h0OiAke3dlaWdodDoxfSBLZyc7CiAgICAgICAgICAgIGNhc2UgJ0NoaWxsZXInOgogICAgICAgICAgICBjYXNlICdGcmVlemVyJzogICAgCiAgICAgICAgICAgICAgICByZXR1cm4gJ1RlbXBlcmF0dXJlOiAke3RlbXBlcmF0dXJlOjF9IFx1MDBCMEMnOwogICAgICAgICAgICBjYXNlICdTbWFydCBCaW4nOgogICAgICAgICAgICAgICAgcmV0dXJuICdGdWxsbmVzczogJHtsZXZlbDowfSUnOwogICAgICAgICAgICBjYXNlICdMaXF1aWQgTGV2ZWwgU2Vuc29yJzoKICAgICAgICAgICAgICAgIHJldHVybiAnTGlxdWlkIGxldmVsOiAke2xldmVsOjB9JSc7CiAgICAgICAgICAgIGNhc2UgJ0Rvb3IgU2Vuc29yJzoKICAgICAgICAgICAgICAgIHZhciBvcGVuID0gZGF0YVsnb3BlbiddID09PSAndHJ1ZSc7CiAgICAgICAgICAgICAgICByZXR1cm4gJ1N0YXRlOiAnICsgKG9wZW4gPyAnT3BlbicgOiAnQ2xvc2VkJyk7CiAgICAgICAgICAgIGNhc2UgJ01vdGlvbiBTZW5zb3InOgogICAgICAgICAgICAgICAgdmFyIG1vdmVtZW50ID0gZGF0YVsnbW92ZW1lbnQnXSA9PT0gJ3RydWUnOwogICAgICAgICAgICAgICAgcmV0dXJuICdNb3ZlbWVudCBkZXRlY3Rpb246ICcgKyAobW92ZW1lbnQgPyAnRGV0ZWN0ZWQnIDogJ05vbmUnKTsKICAgICAgICAgICAgY2FzZSAnT2NjdXBhbmN5IFNlbnNvcic6CiAgICAgICAgICAgICAgICB2YXIgb2NjdXBpZWQgPSBkYXRhWydvY2N1cGllZCddID09PSAndHJ1ZSc7CiAgICAgICAgICAgICAgICByZXR1cm4gJ1N0YXRlOiAnICsgKG9jY3VwaWVkID8gJ09jY3VwaWVkJyA6ICdWYWNhbnQnKTsKICAgICAgICAgICAgY2FzZSAnU21va2UgU2Vuc29yJzoKICAgICAgICAgICAgICAgIHZhciBhbGFybSA9IGRhdGFbJ2FsYXJtJ10gPT09ICd0cnVlJzsKICAgICAgICAgICAgICAgIHJldHVybiAnRmlyZSBhbGFybTogJyArIChhbGFybSA/ICdBbGFybScgOiAnTm9uZScpOwogICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgcmV0dXJuICdUT0RPJzsKICAgICAgICB9CiAgICB9Cn0KCmV4cG9ydCBmdW5jdGlvbiBnZXRTbWFydFJldGFpbERldmljZU1hcmtlcihkYXRhLCBkc0RhdGEpIHsKCiAgICB2YXIgdHlwZSA9IGRhdGFbJ1R5cGUnXTsKICAgIHZhciBhY3RpdmUgPSBkYXRhWydhY3RpdmUnXTsKICAgIHZhciBzdGF0ZSA9IGRhdGFbJ3N0YXRlJ107CiAgICAKICAgIHZhciBzZWxlY3RlZERldmljZSA9IGRzRGF0YS5zb21lKGQgPT4gZFsnc2VsZWN0ZWREZXZpY2UnXSA9PT0gdHJ1ZSAmJiBkLmVudGl0eUlkID09PSBkYXRhLmVudGl0eUlkKTsKICAgIHZhciBzZWxlY3RlZE1vZGUgPSBkc0RhdGEuc29tZShkID0+IGRbJ3NlbGVjdGVkRGV2aWNlJ10gPT09IHRydWUpOwogICAgCiAgICB2YXIgc3RhdHVzID0gc3RhdGU7CiAgICBpZiAoYWN0aXZlID09PSAnZmFsc2UnKSB7CiAgICAgICAgc3RhdHVzID0gJ2Rpc2Nvbm5lY3RlZCc7CiAgICB9CiAgICAKICAgIHZhciB0ZXh0ID0gZ2V0RGV2aWNlVGV4dCh0eXBlLCBzdGF0dXMsIGRhdGEpOwogICAgCiAgICB2YXIgbWFya2VyV2lkdGggPSBkZWZhdWx0TWFya2VyV2lkdGg7CgogICAgdmFyIHdpZHRoID0gbWFya2VyV2lkdGggKyBnZXRUZXh0V2lkdGgodGV4dCk7CiAgICAKICAgIHZhciBzdmdTdHIgPSBnZXREZXZpY2VTdmcodHlwZSwgc3RhdHVzLCB3aWR0aCwgdGV4dCwgc2VsZWN0ZWREZXZpY2UsIHNlbGVjdGVkTW9kZSwgc2VsZWN0ZWREZXZpY2UpOwogICAgCiAgICB2YXIgZW5jb2RlZFN2ZyA9IGVuY29kZVVSSUNvbXBvbmVudChzdmdTdHIpOwogICAgCiAgICB2YXIgc3ZnVXJsID0gJ2RhdGE6aW1hZ2Uvc3ZnK3htbCwnICsgZW5jb2RlZFN2ZzsKICAgIAogICAgCiAgICBpZiAoc2VsZWN0ZWREZXZpY2UpIHsKICAgICAgICB3aWR0aCArPSA4OwogICAgICAgIG1hcmtlcldpZHRoICs9IDg7CiAgICB9CiAgICAKICAgIHJldHVybiB7CiAgICAgICAgdXJsOiBzdmdVcmwsCiAgICAgICAgc2l6ZTogd2lkdGgsCiAgICAgICAgbWFya2VyT2Zmc2V0OiBbbWFya2VyV2lkdGggLyAyLCBtYXJrZXJXaWR0aCAvIDJdLAogICAgICAgIHRvb2x0aXBPZmZzZXQ6IFt3aWR0aCAqIDAuNSAtIG1hcmtlcldpZHRoIC8gMiwgLSAobWFya2VyV2lkdGggLyAyKV0KICAgIH07CiAgICAKfQoKZXhwb3J0IGZ1bmN0aW9uIGdldFNtYXJ0UmV0YWlsRGV2aWNlQ2VsbEljb24odHlwZSkgewogICAgdmFyIHR5cGVTdmcgPSBnZXRTbWFydFJldGFpbERldmljZVN2Z0ljb24odHlwZSk7CiAgICB2YXIgZW5jb2RlZFR5cGVTdmcgPSBlbmNvZGVVUklDb21wb25lbnQodHlwZVN2Zyk7CiAgICB2YXIgdHlwZVN2Z1VybCA9ICdkYXRhOmltYWdlL3N2Zyt4bWwsJyArIGVuY29kZWRUeXBlU3ZnOwoKICAgIHJldHVybiAnPHNwYW4+JysKICAgICAgICAgICAgICAgICc8aW1nIHN0eWxlPSJ2ZXJ0aWNhbC1hbGlnbjogbWlkZGxlOyIgY2xhc3M9Im1hdC1pY29uIiBzcmM9IicrIHR5cGVTdmdVcmwgKyciPicgKwogICAgICAgICAgICAgICAgJzxzcGFuIHN0eWxlPSJ2ZXJ0aWNhbC1hbGlnbjogbWlkZGxlOyBwYWRkaW5nLWxlZnQ6IDhweDsiPicrIHR5cGUgKyc8L3NwYW4+JyArCiAgICAgICAgICAgICc8L3NwYW4+JzsKfQoKZXhwb3J0IGZ1bmN0aW9uIG9uU21hcnRSZXRhaWxEZXZpY2VNYXJrZXJDbGljayh3aWRnZXRDb250ZXh0LCBlbnRpdHlJZCkgewogICAgdmFyIHBhcmFtcyA9IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkod2lkZ2V0Q29udGV4dC5zdGF0ZUNvbnRyb2xsZXIuZ2V0U3RhdGVQYXJhbXMoKSkpOwogICAgdmFyIHNlbGVjdGVkRGV2aWNlID0gcGFyYW1zWydzZWxlY3RlZERldmljZSddOwogICAgaWYgKHNlbGVjdGVkRGV2aWNlICYmIHNlbGVjdGVkRGV2aWNlLmVudGl0eUlkLmlkID09PSBlbnRpdHlJZC5pZCkgewogICAgICAgIHBhcmFtc1snc2VsZWN0ZWREZXZpY2UnXSA9IG51bGw7CiAgICB9IGVsc2UgewogICAgICAgIHBhcmFtc1snc2VsZWN0ZWREZXZpY2UnXSA9IHsgZW50aXR5SWQ6IGVudGl0eUlkIH07CiAgICB9CiAgICB3aWRnZXRDb250ZXh0LnN0YXRlQ29udHJvbGxlci51cGRhdGVTdGF0ZShudWxsLCBwYXJhbXMpOwp9CgpleHBvcnQgZnVuY3Rpb24gZ2V0U3VwZXJtYXJrZXRNYXJrZXIoZGF0YSwgZHNEYXRhKSB7CiAgICB2YXIgc3RhdGUgPSBkYXRhWydzdGF0ZSddOwogICAgdmFyIHNlbGVjdGVkU3VwZXJtYXJrZXQgPSBkc0RhdGEuc29tZShkID0+IGRbJ3NlbGVjdGVkU3VwZXJtYXJrZXQnXSA9PT0gdHJ1ZSAmJiBkLmVudGl0eUlkID09PSBkYXRhLmVudGl0eUlkKTsKICAgIHZhciBzZWxlY3RlZE1vZGUgPSBkc0RhdGEuc29tZShkID0+IGRbJ3NlbGVjdGVkU3VwZXJtYXJrZXQnXSA9PT0gdHJ1ZSk7CiAgICAKICAgIHZhciBzdGF0dXMgPSBzdGF0ZTsKICAgIHZhciB3aWR0aCA9IDMwOwogICAgdmFyIHN2Z1N0ciA9IGdldFN1cGVybWFya2V0U3ZnKHN0YXR1cywgd2lkdGgsIHNlbGVjdGVkU3VwZXJtYXJrZXQsIHNlbGVjdGVkTW9kZSk7CiAgICB2YXIgZW5jb2RlZFN2ZyA9IGVuY29kZVVSSUNvbXBvbmVudChzdmdTdHIpOwogICAgdmFyIHN2Z1VybCA9ICdkYXRhOmltYWdlL3N2Zyt4bWwsJyArIGVuY29kZWRTdmc7CiAgICAKICAgIGlmIChzZWxlY3RlZFN1cGVybWFya2V0KSB7CiAgICAgICAgd2lkdGggKz0gODsKICAgIH0KICAgIAogICAgcmV0dXJuIHsKICAgICAgICB1cmw6IHN2Z1VybCwKICAgICAgICBzaXplOiB3aWR0aCwKICAgICAgICBtYXJrZXJPZmZzZXQ6IFt3aWR0aCAvIDIsIHdpZHRoIC8gMl0sCiAgICAgICAgdG9vbHRpcE9mZnNldDogW3dpZHRoICogMC41IC0gd2lkdGggLyAyLCAtICh3aWR0aCAvIDIpXQogICAgfTsKfQoKZXhwb3J0IGZ1bmN0aW9uIG9uU3VwZXJtYXJrZXRNYXJrZXJDbGljayh3aWRnZXRDb250ZXh0LCBlbnRpdHlJZCwgZW50aXR5TmFtZSwgZW50aXR5TGFiZWwpIHsKICAgIHZhciBwYXJhbXMgPSB3aWRnZXRDb250ZXh0LnN0YXRlQ29udHJvbGxlci5nZXRTdGF0ZVBhcmFtcygpOwogICAgdmFyIHNlbGVjdGVkU3VwZXJtYXJrZXQgPSBwYXJhbXNbJ3NlbGVjdGVkU3VwZXJtYXJrZXQnXTsKICAgIGlmIChzZWxlY3RlZFN1cGVybWFya2V0ICYmIHNlbGVjdGVkU3VwZXJtYXJrZXQuZW50aXR5SWQuaWQgPT09IGVudGl0eUlkLmlkKSB7CiAgICAgICAgcGFyYW1zWydzZWxlY3RlZFN1cGVybWFya2V0J10gPSBudWxsOwogICAgfSBlbHNlIHsKICAgICAgICBwYXJhbXNbJ3NlbGVjdGVkU3VwZXJtYXJrZXQnXSA9IHsgZW50aXR5SWQ6IGVudGl0eUlkLCBlbnRpdHlOYW1lOiBlbnRpdHlOYW1lLCBlbnRpdHlMYWJlbDogZW50aXR5TGFiZWwgfTsKICAgIH0KICAgIHdpZGdldENvbnRleHQuc3RhdGVDb250cm9sbGVyLnVwZGF0ZVN0YXRlKG51bGwsIHBhcmFtcyk7Cn0KCmNvbnN0IGRlZmF1bHRNYXJrZXJXaWR0aCA9IDMwOwoKCmZ1bmN0aW9uIGdldERldmljZVRleHQodHlwZSwgc3RhdHVzLCBkYXRhKSB7CiAgICBzd2l0Y2goc3RhdHVzKSB7CiAgICAgICAgY2FzZSAnZGlzY29ubmVjdGVkJzoKICAgICAgICAgICAgcmV0dXJuICdOTyBDT05OJzsKICAgICAgICBjYXNlICdub3JtYWwnOgogICAgICAgIGRlZmF1bHQ6ICAgIAogICAgICAgICAgICBzd2l0Y2godHlwZSkgewogICAgICAgICAgICAgICAgY2FzZSAnRnJlZXplcic6CiAgICAgICAgICAgICAgICBjYXNlICdDaGlsbGVyJzoKICAgICAgICAgICAgICAgICAgICB2YXIgdGVtcGVyYXR1cmUgPSBOdW1iZXIoZGF0YVsndGVtcGVyYXR1cmUnXSk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRlbXBlcmF0dXJlICsgJyBcdTAwQjBDJzsKICAgICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICcnOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGJyZWFrOyAgICAgICAgCiAgICB9Cn0KCmZ1bmN0aW9uIGdldFRleHRXaWR0aCh0ZXh0KSB7CiAgICB2YXIgd2lkdGggPSAwOwogICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0ZXh0Lmxlbmd0aDsgaSsrKSB7CiAgICAgICAgdmFyIGNoYXJXaWR0aDsKICAgICAgICB2YXIgY2hhcmFjdGVyID0gdGV4dC5jaGFyQXQoaSk7CiAgICAgICAgaWYgKGNoYXJhY3RlciA9PT0gJyAnKSB7CiAgICAgICAgICAgIGNoYXJXaWR0aCA9IDg7CiAgICAgICAgfSBlbHNlIGlmIChjaGFyYWN0ZXIgPT09ICctJykgewogICAgICAgICAgICBjaGFyV2lkdGggPSA3OwogICAgICAgIH0gZWxzZSBpZiAoY2hhcmFjdGVyID09PSAnXHUwMEIwJykgewogICAgICAgICAgICBjaGFyV2lkdGggPSA1OwogICAgICAgIH0gZWxzZSBpZiAoIWlzTmFOKGNoYXJhY3RlciAqIDEpKXsKICAgICAgICAgICAgY2hhcldpZHRoID0gOTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAvLyBVcHBlciBjYXNlCiAgICAgICAgICAgIGlmIChjaGFyYWN0ZXIgPT09IGNoYXJhY3Rlci50b1VwcGVyQ2FzZSgpKSB7CiAgICAgICAgICAgICAgICBjaGFyV2lkdGggPSAxMjsKICAgICAgICAgICAgLy8gTG93ZXIgY2FzZSAgICAKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGNoYXJXaWR0aCA9IDEwOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHdpZHRoICs9IGNoYXJXaWR0aDsKICAgIH0KICAgIHJldHVybiB3aWR0aDsKfQoKCmZ1bmN0aW9uIGdldERldmljZVN2Zyh0eXBlLCBzdGF0dXMsIHdpZHRoLCB0ZXh0LCBpc1NlbGVjdGVkLCBzZWxlY3RlZE1vZGUsIHNlbGVjdGVkRGV2aWNlKSB7CiAgICB2YXIgc2hhcGUgPSBnZXREZXZpY2VTaGFwZSh0eXBlKTsKICAgIHZhciBjb2xvciA9IGdldERldmljZUJhY2tncm91bmRDb2xvcih0eXBlLCBzdGF0dXMpOwogICAgdmFyIGJhY2tncm91bmQgPSBnZXREZXZpY2VCYWNrZ3JvdW5kKGNvbG9yLCB3aWR0aCk7CiAgICB2YXIgc3ZnV2lkdGggPSBpc1NlbGVjdGVkID8gKHdpZHRoICsgOCkgOiB3aWR0aDsKICAgIHZhciBzdmdIZWlnaHQgPSBpc1NlbGVjdGVkID8gMzggOiAzMDsKICAgIAogICAgdmFyIG9wYWNpdHkgPSBzZWxlY3RlZE1vZGUgJiYgIXNlbGVjdGVkRGV2aWNlID8gMC40IDogMTsKICAgIAogICAgdmFyIGRldmljZVN2ZyA9ICc8c3ZnIG9wYWNpdHk9IicgKyBvcGFjaXR5ICsgJyIgd2lkdGg9IicgKyBzdmdXaWR0aCArICciIGhlaWdodD0iJyArIHN2Z0hlaWdodCArICciIHZpZXdCb3g9IjAgMCAnICsgc3ZnV2lkdGggKyAnICcgKyBzdmdIZWlnaHQgKyAnIiBmaWxsPSJub25lIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPicgKwogICAgICAgICAgICAgICAgICAgIHdyYXBJZlNlbGVjdGVkKGJhY2tncm91bmQgKyBzaGFwZSwgaXNTZWxlY3RlZCk7CiAgICBpZiAoc3RhdHVzID09PSAnZGlzY29ubmVjdGVkJykgewogICAgICAgIGRldmljZVN2ZyArPSB3cmFwSWZTZWxlY3RlZCgnPHBhdGggZD0iTTYuOTI4OTYgMjEuNzI4TDIxLjA3MTEgNy41ODU4OUwyMi40ODUzIDkuMDAwMTFMOC4zNDMxNyAyMy4xNDIyTDYuOTI4OTYgMjEuNzI4WiIgZmlsbD0iJyArIGNvbG9yICsgJyIvPicgKwogICAgICAgICAgICAgICAgICAgICAnPHBhdGggZD0iTTcuMTA2OTIgMjEuMzE3MUM2LjgxMzkzIDIxLjAyNDEgNi44MTM5MyAyMC41NDkxIDcuMTA2OTIgMjAuMjU2MUwyMC4xODUyIDcuMTc3ODhDMjAuNDc4MSA2Ljg4NDg5IDIwLjk1MzIgNi44ODQ4OSAyMS4yNDYyIDcuMTc3ODhWNy4xNzc4OEMyMS41MzkyIDcuNDcwODggMjEuNTM5MiA3Ljk0NTkxIDIxLjI0NjIgOC4yMzg5TDguMTY3OTQgMjEuMzE3MUM3Ljg3NDk1IDIxLjYxMDEgNy4zOTk5MSAyMS42MTAxIDcuMTA2OTIgMjEuMzE3MVYyMS4zMTcxWiIgZmlsbD0id2hpdGUiLz4nLCBpc1NlbGVjdGVkKTsKICAgIH0KICAgIGlmICh0ZXh0ICE9PSAnJykgewogICAgICAgIHZhciB0cmFuc2Zvcm0gPSBpc1NlbGVjdGVkID8gJzM0IDEwJyA6ICczMCA2JzsKICAgICAgICBkZXZpY2VTdmcgKz0gJzx0ZXh0IHRyYW5zZm9ybT0idHJhbnNsYXRlKCcgKyB0cmFuc2Zvcm0gKyAnKSIgZmlsbD0id2hpdGUiIHhtbDpzcGFjZT0icHJlc2VydmUiIHN0eWxlPSJ3aGl0ZS1zcGFjZTogcHJlIiBmb250LWZhbWlseT0iUm9ib3RvIiBmb250LXNpemU9IjE1LjQiIGZvbnQtd2VpZ2h0PSI1MDAiIGxldHRlci1zcGFjaW5nPSIwZW0iPjx0c3BhbiB4PSIwLjEwNjY0IiB5PSIxNC4yNjM3Ij4nICsgdGV4dCArICc8L3RzcGFuPjwvdGV4dD4nOwogICAgfQogICAgaWYgKHNlbGVjdGVkRGV2aWNlKSB7CiAgICAgICAgZGV2aWNlU3ZnICs9IGdldERldmljZVNlbGVjdGlvblN0cm9rZSh3aWR0aCk7CiAgICB9CiAgICBkZXZpY2VTdmcgKz0gJzwvc3ZnPic7CiAgICByZXR1cm4gZGV2aWNlU3ZnOyAgICAKfQoKZnVuY3Rpb24gZ2V0U3VwZXJtYXJrZXRTdmcoc3RhdHVzLCB3aWR0aCwgaXNTZWxlY3RlZCwgc2VsZWN0ZWRNb2RlKSB7CiAgICB2YXIgc2hhcGUgPSAnPHBhdGggZD0ibTE4LjYzNiAxNS44YzAuNTk5NzggMCAxLjEyNzYtMC4zMjc4OCAxLjM5OTUtMC44MjM2OWwyLjg2MjktNS4xOTAxYzAuMjk1ODktMC41Mjc4LTAuMDg3OTYtMS4xODM2LTAuNjk1NzQtMS4xODM2aC0xMS44MzZsLTAuNzUxNzItMS41OTk0aC0yLjYxNXYxLjU5OTRoMS41OTk0bDIuODc4OSA2LjA2OTctMS4wNzk2IDEuOTUxM2MtMC41ODM3OCAxLjA3MTYgMC4xODM5MyAyLjM3NTEgMS4zOTk1IDIuMzc1MWg5LjU5NjR2LTEuNTk5NGgtOS41OTY0bDAuODc5NjctMS41OTk0em0tNy41MDkyLTUuNTk3OWg5LjcxNjRsLTIuMjA3MiAzLjk5ODVoLTUuNjEzOXptMC42NzE3NSA5LjU5NjRjLTAuODc5NjcgMC0xLjU5MTQgMC43MTk3My0xLjU5MTQgMS41OTk0czAuNzExNzQgMS41OTk0IDEuNTkxNCAxLjU5OTQgMS41OTk0LTAuNzE5NzMgMS41OTk0LTEuNTk5NC0wLjcxOTczLTEuNTk5NC0xLjU5OTQtMS41OTk0em03Ljk5NyAwYy0wLjg3OTY3IDAtMS41OTE0IDAuNzE5NzMtMS41OTE0IDEuNTk5NHMwLjcxMTc0IDEuNTk5NCAxLjU5MTQgMS41OTk0YzAuODc5NjcgMCAxLjU5OTQtMC43MTk3MyAxLjU5OTQtMS41OTk0cy0wLjcxOTczLTEuNTk5NC0xLjU5OTQtMS41OTk0eiIgZmlsbD0id2hpdGUiIHN0cm9rZS13aWR0aD0iLjc5OTciLz4nOwogICAgdmFyIGNvbG9yID0gZ2V0U3VwZXJtYXJrZXRCYWNrZ3JvdW5kQ29sb3Ioc3RhdHVzKTsKICAgIHZhciBiYWNrZ3JvdW5kID0gZ2V0U3VwZXJtYXJrZXRCYWNrZ3JvdW5kKGNvbG9yKTsKICAgIHZhciBzdmdXaWR0aCA9IGlzU2VsZWN0ZWQgPyAod2lkdGggKyA4KSA6IHdpZHRoOwogICAgdmFyIHN2Z0hlaWdodCA9IGlzU2VsZWN0ZWQgPyAzOCA6IDMwOwogICAgCiAgICB2YXIgb3BhY2l0eSA9IHNlbGVjdGVkTW9kZSAmJiAhaXNTZWxlY3RlZCA/IDAuNCA6IDE7CiAgICAKICAgIHZhciBzdXBlcm1hcmtldFN2ZyA9ICc8c3ZnIG9wYWNpdHk9IicgKyBvcGFjaXR5ICsgJyIgd2lkdGg9IicgKyBzdmdXaWR0aCArICciIGhlaWdodD0iJyArIHN2Z0hlaWdodCArICciIHZpZXdCb3g9IjAgMCAnICsgc3ZnV2lkdGggKyAnICcgKyBzdmdIZWlnaHQgKyAnIiBmaWxsPSJub25lIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPicgKwogICAgICAgICAgICAgICAgICAgIHdyYXBJZlNlbGVjdGVkKGJhY2tncm91bmQgKyBzaGFwZSwgaXNTZWxlY3RlZCk7CiAgICBpZiAoaXNTZWxlY3RlZCkgewogICAgICAgIHN1cGVybWFya2V0U3ZnICs9IGdldFN1cGVybWFya2V0U2VsZWN0aW9uU3Ryb2tlKCk7CiAgICB9CiAgICBzdXBlcm1hcmtldFN2ZyArPSAnPC9zdmc+JzsKICAgIHJldHVybiBzdXBlcm1hcmtldFN2ZzsgICAgCn0KCmZ1bmN0aW9uIHdyYXBJZlNlbGVjdGVkKHN2ZywgaXNTZWxlY3RlZCkgewogICAgaWYgKGlzU2VsZWN0ZWQpIHsKICAgICAgICByZXR1cm4gJzxnIHRyYW5zZm9ybT0idHJhbnNsYXRlKDQgNCkiPicgKyBzdmcgKyAnPC9nPic7CiAgICB9IGVsc2UgewogICAgICAgIHJldHVybiBzdmc7CiAgICB9Cn0KCmZ1bmN0aW9uIGdldERldmljZUJhY2tncm91bmQoY29sb3IsIHdpZHRoKSB7CiAgICAgaWYgKHdpZHRoID09PSAzMCkgewogICAgICAgICByZXR1cm4gJzxjaXJjbGUgY3g9IjE1IiBjeT0iMTUiIHI9IjE1IiBmaWxsPSInKyBjb2xvciArJyIvPic7CiAgICAgfSBlbHNlIHsKICAgICAgICAgcmV0dXJuICc8Y2lyY2xlIGN4PSIxNSIgY3k9IjE1IiByPSIxNSIgZmlsbD0iJysgY29sb3IgKyciLz4nICsgCiAgICAgICAgICAgICAgICAnPGNpcmNsZSBjeD0iJyArICh3aWR0aCAtIDE1KSArICciIGN5PSIxNSIgcj0iMTUiIGZpbGw9IicrIGNvbG9yICsnIi8+JyArCiAgICAgICAgICAgICAgICAnPHJlY3QgeD0iMTUiIHk9IjAiIHdpZHRoPSInICsgKHdpZHRoIC0gMzApICsgJyIgaGVpZ2h0PSIzMCIgcng9IjEiIGZpbGw9IicrIGNvbG9yICsnIi8+JzsKICAgICB9Cn0KCmZ1bmN0aW9uIGdldERldmljZVNlbGVjdGlvblN0cm9rZSh3aWR0aCkgewogICAgIGlmICh3aWR0aCA9PT0gMzApIHsKICAgICAgICAgcmV0dXJuICc8Y2lyY2xlIGN4PSIxOSIgY3k9IjE5IiByPSIxOCIgc3Ryb2tlPSIjRDVDMjFCIiBzdHJva2Utd2lkdGg9IjIiLz4nOwogICAgIH0gZWxzZSB7CiAgICAgICAgIHZhciByZWN0V2lkdGggPSB3aWR0aCArIDY7CiAgICAgICAgIHJldHVybiAnPHJlY3QgeD0iMSIgeT0iMSIgd2lkdGg9IicgKyByZWN0V2lkdGggKyAnIiBoZWlnaHQ9IjM2IiByeD0iMTgiIHN0cm9rZT0iI0Q1QzIxQiIgc3Ryb2tlLXdpZHRoPSIyIi8+JzsKICAgICB9Cn0KCmZ1bmN0aW9uIGdldERldmljZUJhY2tncm91bmRDb2xvcih0eXBlLCBzdGF0dXMpIHsKICAgIHN3aXRjaChzdGF0dXMpIHsKICAgICAgICBjYXNlICdtYWpvcic6CiAgICAgICAgICAgIHJldHVybiAnI0Q1QzIxQic7CiAgICAgICAgY2FzZSAnY3JpdGljYWwnOiAgIAogICAgICAgICAgICByZXR1cm4gJyNFNjRBMTknOwogICAgICAgIGNhc2UgJ2Rpc2Nvbm5lY3RlZCc6CiAgICAgICAgICAgIHJldHVybiAnI0NBQzFEMic7CiAgICAgICAgY2FzZSAnbm9ybWFsJzoKICAgICAgICBkZWZhdWx0OiAgICAKICAgICAgICAgICAgc3dpdGNoKHR5cGUpIHsKICAgICAgICAgICAgICAgIGNhc2UgJ0ZyZWV6ZXInOgogICAgICAgICAgICAgICAgY2FzZSAnQ2hpbGxlcic6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICcjNEE4QUVDJzsKICAgICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICcjMUY4QjREJzsKICAgICAgICAgICAgfQogICAgfQp9CgpmdW5jdGlvbiBnZXRTdXBlcm1hcmtldEJhY2tncm91bmQoY29sb3IpIHsKICAgICByZXR1cm4gJzxjaXJjbGUgY3g9IjE1IiBjeT0iMTUiIHI9IjE1IiBmaWxsPSInKyBjb2xvciArJyIvPic7Cn0KCmZ1bmN0aW9uIGdldFN1cGVybWFya2V0U2VsZWN0aW9uU3Ryb2tlKCkgewogICAgIHJldHVybiAnPGNpcmNsZSBjeD0iMTkiIGN5PSIxOSIgcj0iMTgiIHN0cm9rZT0iI0Q1QzIxQiIgc3Ryb2tlLXdpZHRoPSIyIi8+JzsKfQoKZnVuY3Rpb24gZ2V0U3VwZXJtYXJrZXRCYWNrZ3JvdW5kQ29sb3Ioc3RhdHVzKSB7CiAgICBzd2l0Y2goc3RhdHVzKSB7CiAgICAgICAgY2FzZSAnbWFqb3InOgogICAgICAgICAgICByZXR1cm4gJyNENUMyMUInOwogICAgICAgIGNhc2UgJ2NyaXRpY2FsJzogICAKICAgICAgICAgICAgcmV0dXJuICcjRTY0QTE5JzsKICAgICAgICBjYXNlICdub3JtYWwnOgogICAgICAgIGRlZmF1bHQ6ICAgIAogICAgICAgICAgICByZXR1cm4gJyMxRjhCNEQnOwogICAgfQp9CgoKZnVuY3Rpb24gZ2V0RGV2aWNlU2hhcGUodHlwZSkgewogICAgc3dpdGNoICh0eXBlKSB7CiAgICAgICAgY2FzZSAnU21hcnQgU2hlbGYnOgogICAgICAgICAgICByZXR1cm4gJzxwYXRoIGZpbGwtcnVsZT0iZXZlbm9kZCIgY2xpcC1ydWxlPSJldmVub2RkIiBkPSJNNy41IDdDNy4yMjM4NiA3IDcgNy4yMjM4NiA3IDcuNVYyMi41QzcgMjIuNzc2MSA3LjIyMzg2IDIzIDcuNSAyM0M3Ljc3NjE0IDIzIDggMjIuNzc2MSA4IDIyLjVWMjJIMjJWMjIuNUMyMiAyMi43NzYxIDIyLjIyMzkgMjMgMjIuNSAyM0MyMi43NzYxIDIzIDIzIDIyLjc3NjEgMjMgMjIuNVY3LjVDMjMgNy4yMjM4NiAyMi43NzYxIDcgMjIuNSA3QzIyLjIyMzkgNyAyMiA3LjIyMzg2IDIyIDcuNVYxM0gxOUMxOS41NTIzIDEzIDIwIDEyLjU1MjMgMjAgMTJWOUMyMCA4LjQ0NzcyIDE5LjU1MjMgOCAxOSA4SDE2QzE1LjQ0NzcgOCAxNSA4LjQ0NzcyIDE1IDlWMTJDMTUgMTIuNTUyMyAxNS40NDc3IDEzIDE2IDEzSDEyQzEyLjU1MjMgMTMgMTMgMTIuNTUyMyAxMyAxMlYxMUMxMyAxMC40NDc3IDEyLjU1MjMgMTAgMTIgMTBIMTFDMTAuNDQ3NyAxMCAxMCAxMC40NDc3IDEwIDExVjEyQzEwIDEyLjU1MjMgMTAuNDQ3NyAxMyAxMSAxM0g4VjcuNUM4IDcuMjIzODYgNy43NzYxNCA3IDcuNSA3Wk0yMiAyMVYxNEg4VjIxSDExQzEwLjQ0NzcgMjEgMTAgMjAuNTUyMyAxMCAyMFYxN0MxMCAxNi40NDc3IDEwLjQ0NzcgMTYgMTEgMTZIMTRDMTQuNTUyMyAxNiAxNSAxNi40NDc3IDE1IDE3VjIwQzE1IDIwLjU1MjMgMTQuNTUyMyAyMSAxNCAyMUgxN0MxNi40NDc3IDIxIDE2IDIwLjU1MjMgMTYgMjBWMThDMTYgMTcuNDQ3NyAxNi40NDc3IDE3IDE3IDE3SDE5QzE5LjU1MjMgMTcgMjAgMTcuNDQ3NyAyMCAxOFYyMEMyMCAyMC41NTIzIDE5LjU1MjMgMjEgMTkgMjFIMjJaIiBmaWxsPSJ3aGl0ZSIvPic7CiAgICAgICAgY2FzZSAnU21hcnQgQmluJzoKICAgICAgICAgICAgcmV0dXJuICc8cGF0aCBkPSJNMTEuNzE4NSAxOUMxMC4xNTI0IDE5IDkuMTkzOTQgMTcuMjgxNiAxMC4wMTY5IDE1Ljk0OTFMMTAuMDk4MiAxNS44MTc1QzEwLjE3OCAxNS44MzI3IDEwLjI2MDkgMTUuODM4MyAxMC4zNDU3IDE1LjgzMzJDMTAuODk3IDE1LjgwMDEgMTEuMzE3MSAxNS4zMjY0IDExLjI4NCAxNC43NzUxTDExLjIxNzEgMTMuNjU5MUMxMS4xOTg0IDEzLjM0OCAxMS4wMzU3IDEzLjA2MzMgMTAuNzc3MSAxMi44ODkzQzEwLjUxODYgMTIuNzE1MyAxMC4xOTM2IDEyLjY3MTggOS44OTg0IDEyLjc3MTdMOC45MzIzNyAxMy4wOTg1QzguNDA5MjEgMTMuMjc1NSA4LjEyODU4IDEzLjg0MzEgOC4zMDU1NiAxNC4zNjYyQzguMzQyMzcgMTQuNDc1IDguMzk2MDggMTQuNTczNCA4LjQ2Mjc4IDE0LjY1OTNMOC4zMTUyMyAxNC44OTgyQzYuNjY5MzkgMTcuNTYzMSA4LjU4NjMzIDIxIDExLjcxODUgMjFIMTIuODM0OUMxMy4zODcxIDIxIDEzLjgzNDkgMjAuNTUyMyAxMy44MzQ5IDIwQzEzLjgzNDkgMTkuNDQ3OCAxMy4zODcxIDE5IDEyLjgzNDkgMTlMMTEuNzE4NSAxOVoiIGZpbGw9IndoaXRlIi8+JyArCiAgICAgICAgICAgICAgICAgICAnPHBhdGggZD0iTTE4LjMxMzUgMTguODQwOUMxOS44Nzg5IDE4Ljg4NzMgMjAuODg3OSAxNy4xOTggMjAuMTA0OCAxNS44NDE4TDE5LjU0NjcgMTQuODc1QzE5LjI3MDUgMTQuMzk2NyAxOS40MzQ0IDEzLjc4NTEgMTkuOTEyNyAxMy41MDg5QzIwLjM5MSAxMy4yMzI4IDIxLjAwMjYgMTMuMzk2NyAyMS4yNzg3IDEzLjg3NUwyMS44MzY5IDE0Ljg0MThDMjMuNDAzIDE3LjU1NDMgMjEuMzg0OSAyMC45MzI5IDE4LjI1NDIgMjAuODRMMTcuOTczNSAyMC44MzE3QzE3LjkzMjQgMjAuOTMyNCAxNy44NzQxIDIxLjAyODEgMTcuNzk4MyAyMS4xMTQzQzE3LjQzMzcgMjEuNTI5MiAxNi44MDE5IDIxLjU2OTkgMTYuMzg3IDIxLjIwNTRMMTUuNjIxIDIwLjUzMjJDMTUuMzg2OSAyMC4zMjY0IDE1LjI2MjEgMjAuMDIzMyAxNS4yODM1IDE5LjcxMjNDMTUuMzA0OSAxOS40MDE0IDE1LjQ3IDE5LjExODIgMTUuNzMwMSAxOC45NDY1TDE2LjY2MzIgMTguMzMwNUMxNy4xMjQgMTguMDI2MiAxNy43NDQ0IDE4LjE1MzEgMTguMDQ4NyAxOC42MTRDMTguMDk1NSAxOC42ODQ5IDE4LjEzMjEgMTguNzU5NiAxOC4xNTg4IDE4LjgzNjNMMTguMzEzNSAxOC44NDA5WiIgZmlsbD0id2hpdGUiLz4nICsKICAgICAgICAgICAgICAgICAgICc8cGF0aCBkPSJNMTYuNjY5NiAxMC4yMUMxNS45MjcyIDguODMxMTMgMTMuOTU5NyA4LjgwMTk1IDEzLjE3NjYgMTAuMTU4MkwxMi42MTg1IDExLjEyNUMxMi4zNDIzIDExLjYwMzMgMTEuNzMwNyAxMS43NjcyIDExLjI1MjQgMTEuNDkxQzEwLjc3NDEgMTEuMjE0OSAxMC42MTAzIDEwLjYwMzMgMTAuODg2NCAxMC4xMjVMMTEuNDQ0NiA5LjE1ODIxQzEzLjAxMDcgNi40NDU2OCAxNi45NDU2IDYuNTA0MDQgMTguNDMwNiA5LjI2MTgzTDE4LjU2MzcgOS41MDkwN0MxOC42NzE1IDkuNDk0MjUgMTguNzgzNSA5LjQ5NjkgMTguODk2MSA5LjUxOTQzQzE5LjQzNzcgOS42Mjc3NCAxOS43ODg5IDEwLjE1NDYgMTkuNjgwNiAxMC42OTYxTDE5LjQ4MDYgMTEuNjk2MUMxOS40MTk1IDEyLjAwMTcgMTkuMjE5MyAxMi4yNjE0IDE4LjkzOTMgMTIuMzk4M0MxOC42NTk0IDEyLjUzNTMgMTguMzMxNSAxMi41MzM4IDE4LjA1MjggMTIuMzk0NEwxNy4wNTI4IDExLjg5NDRDMTYuNTU4OCAxMS42NDc0IDE2LjM1ODYgMTEuMDQ2OCAxNi42MDU2IDEwLjU1MjhDMTYuNjQzNiAxMC40NzY4IDE2LjY4OTkgMTAuNDA3OCAxNi43NDMgMTAuMzQ2MkwxNi42Njk2IDEwLjIxWiIgZmlsbD0id2hpdGUiLz4nOwogICAgICAgIGNhc2UgJ0ZyZWV6ZXInOgogICAgICAgICAgICByZXR1cm4gJzxyZWN0IHg9IjE0IiB5PSI3IiB3aWR0aD0iMiIgaGVpZ2h0PSIxNiIgcng9IjEiIGZpbGw9IndoaXRlIi8+JyArCiAgICAgICAgICAgICAgICAgICAnPHBhdGggZD0iTTE3LjUgOC41TDE1IDExTDEyLjUgOC41TTE3LjUgMjEuNUwxNSAxOUwxMi41IDIxLjUiIHN0cm9rZT0id2hpdGUiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIvPicgKwogICAgICAgICAgICAgICAgICAgJzxwYXRoIGQ9Ik0yMS44NzkyIDEzLjkxNTFMMTguNDY0MSAxM0wxOS4zNzkyIDkuNTg0OTZNMTAuNjIwOCAyMC40MTUxTDExLjUzNTkgMTdMOC4xMjA4MiAxNi4wODUiIHN0cm9rZT0id2hpdGUiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIvPicgKwogICAgICAgICAgICAgICAgICAgJzxwYXRoIGQ9Ik0xMC42MjA4IDkuNTg0OTFMMTEuNTM1OSAxM0w4LjEyMDg1IDEzLjkxNU0yMS44NzkyIDE2LjA4NDlMMTguNDY0MSAxN0wxOS4zNzkyIDIwLjQxNSIgc3Ryb2tlPSJ3aGl0ZSIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIi8+JyArCiAgICAgICAgICAgICAgICAgICAnPHJlY3QgeD0iMjEuNDI4MiIgeT0iMTAuMTMzOCIgd2lkdGg9IjIiIGhlaWdodD0iMTYiIHJ4PSIxIiB0cmFuc2Zvcm09InJvdGF0ZSg2MCAyMS40MjgyIDEwLjEzMzgpIiBmaWxsPSJ3aGl0ZSIvPicgKwogICAgICAgICAgICAgICAgICAgJzxyZWN0IHg9IjcuNTcxNzgiIHk9IjExLjg2NjIiIHdpZHRoPSIyIiBoZWlnaHQ9IjE2IiByeD0iMSIgdHJhbnNmb3JtPSJyb3RhdGUoLTYwIDcuNTcxNzggMTEuODY2MikiIGZpbGw9IndoaXRlIi8+JzsKICAgICAgICBjYXNlICdDaGlsbGVyJzoKICAgICAgICAgICAgcmV0dXJuICc8cGF0aCBmaWxsLXJ1bGU9ImV2ZW5vZGQiIGNsaXAtcnVsZT0iZXZlbm9kZCIgZD0iTTE4LjAwMDEgMTIuNDk5OUMxOC4wMDAxIDEzLjUzNzEgMTcuMjY2MSAxNC4yNTE2IDE2LjQ0NTQgMTQuNjQzM0MxNi4yODA3IDE0LjcyMTkgMTYuMTE4NSAxNC43NTA2IDE1Ljk2NTcgMTQuNzM4N0MxNS45ODgxIDE0LjgyMiAxNi4wMDAxIDE0LjkwOTYgMTYuMDAwMSAxNC45OTk5QzE2LjAwMDEgMTUuMDMwNCAxNS45OTg4IDE1LjA2MDUgMTUuOTk2MSAxNS4wOTAyQzE2LjE1MTEgMTUuMDMyMiAxNi4zMjIgMTQuOTk5OSAxNi41MDAxIDE0Ljk5OTlMMTcuNTAwMSAxNC45OTk5TDE4LjUgMTQuOTk5OUMxOS4zMjg1IDE0Ljk5OTkgMjAuMDAwMyAxNS42OTc1IDE5LjY0MzUgMTYuNDQ1MkMxOS4yNTE3IDE3LjI2NTggMTguNTM3MyAxNy45OTk5IDE3LjUwMDEgMTcuOTk5OUMxNi40NjI5IDE3Ljk5OTkgMTUuNzQ4NCAxNy4yNjU4IDE1LjM1NjcgMTYuNDQ1MkMxNS4yNzgxIDE2LjI4MDUgMTUuMjQ5NCAxNi4xMTg0IDE1LjI2MTMgMTUuOTY1NUMxNS4xNzggMTUuOTg4IDE1LjA5MDUgMTUuOTk5OSAxNS4wMDAxIDE1Ljk5OTlDMTQuOTY5NyAxNS45OTk5IDE0LjkzOTUgMTUuOTk4NiAxNC45MDk3IDE1Ljk5NTlDMTQuOTY3OCAxNi4xNTA5IDE1IDE2LjMyMTggMTUgMTYuNUwxNSAxNy40OTk5TDE1IDE4LjQ5OTlDMTUuMDAwMSAxOS4zMjg0IDE0LjMwMjUgMjAuMDAwMiAxMy41NTQ4IDE5LjY0MzNDMTIuNzM0MSAxOS4yNTE2IDEyLjAwMDEgMTguNTM3MSAxMi4wMDAxIDE3LjQ5OTlDMTIuMDAwMSAxNi40NjI3IDEyLjczNDEgMTUuNzQ4MyAxMy41NTQ4IDE1LjM1NjZDMTMuNzE5NSAxNS4yNzggMTMuODgxNyAxNS4yNDkzIDE0LjAzNDYgMTUuMjYxMUMxNC4wMTIxIDE1LjE3NzkgMTQuMDAwMSAxNS4wOTAzIDE0LjAwMDEgMTQuOTk5OUMxNC4wMDAxIDE0Ljk2OTUgMTQuMDAxNSAxNC45Mzk0IDE0LjAwNDIgMTQuOTA5NkMxMy44NDkyIDE0Ljk2NzcgMTMuNjc4NCAxNC45OTk5IDEzLjUwMDMgMTQuOTk5OUwxMi41MDAzIDE0Ljk5OTlMMTEuNTAwMyAxNC45OTk5QzEwLjY3MTkgMTQuOTk5OSAxMC4wMDAxIDE0LjMwMjMgMTAuMzU2OSAxMy41NTQ3QzEwLjc0ODYgMTIuNzM0IDExLjQ2MzEgMTEuOTk5OSAxMi41MDAzIDExLjk5OTlDMTMuNTM3NSAxMS45OTk5IDE0LjI1MiAxMi43MzQgMTQuNjQzNyAxMy41NTQ3QzE0LjcyMjMgMTMuNzE5MyAxNC43NTEgMTMuODgxNSAxNC43MzkxIDE0LjAzNDNDMTQuODIyMyAxNC4wMTE5IDE0LjkwOTggMTMuOTk5OSAxNS4wMDAxIDEzLjk5OTlDMTUuMDMwNiAxMy45OTk5IDE1LjA2MDcgMTQuMDAxMyAxNS4wOTA1IDE0LjAwNEMxNS4wMzI0IDEzLjg0OSAxNS4wMDAyIDEzLjY3ODEgMTUuMDAwMiAxMy40OTk5TDE1LjAwMDIgMTIuNDk5OUwxNS4wMDAyIDExLjVDMTUuMDAwMSAxMC42NzE1IDE1LjY5NzcgOS45OTk2OSAxNi40NDU0IDEwLjM1NjZDMTcuMjY2MSAxMC43NDgzIDE4LjAwMDEgMTEuNDYyNyAxOC4wMDAxIDEyLjQ5OTlaIiBmaWxsPSJ3aGl0ZSIvPicgKwogICAgICAgICAgICAgICAgICAgICc8Y2lyY2xlIGN4PSIxNSIgY3k9IjE1IiByPSI4IiBzdHJva2U9IndoaXRlIiBzdHJva2Utd2lkdGg9IjIiLz4nOwogICAgICAgIGNhc2UgJ0Rvb3IgU2Vuc29yJzoKICAgICAgICAgICAgcmV0dXJuICc8cGF0aCBmaWxsLXJ1bGU9ImV2ZW5vZGQiIGNsaXAtcnVsZT0iZXZlbm9kZCIgZD0iTTE5IDlIMTFWMjFIMTlWOVpNMTMgMTdDMTMuNTUyMyAxNyAxNCAxNi41NTIzIDE0IDE2QzE0IDE1LjQ0NzcgMTMuNTUyMyAxNSAxMyAxNUMxMi40NDc3IDE1IDEyIDE1LjQ0NzcgMTIgMTZDMTIgMTYuNTUyMyAxMi40NDc3IDE3IDEzIDE3WiIgZmlsbD0id2hpdGUiLz4nICsKICAgICAgICAgICAgICAgICAgICc8cGF0aCBmaWxsLXJ1bGU9ImV2ZW5vZGQiIGNsaXAtcnVsZT0iZXZlbm9kZCIgZD0iTTIxIDIyVjhDMjEgNy40NDc3MiAyMC41NTIzIDcgMjAgN0gxMEM5LjQ0NzcyIDcgOSA3LjQ0NzcyIDkgOFYyMkg4LjVDOC4yMjM4NiAyMiA4IDIyLjIyMzkgOCAyMi41QzggMjIuNzc2MSA4LjIyMzg2IDIzIDguNSAyM0gyMS41QzIxLjc3NjEgMjMgMjIgMjIuNzc2MSAyMiAyMi41QzIyIDIyLjIyMzkgMjEuNzc2MSAyMiAyMS41IDIySDIxWk0yMCA4SDEwTDEwIDIySDIwVjhaIiBmaWxsPSJ3aGl0ZSIvPic7CiAgICAgICAgY2FzZSAnTGlxdWlkIExldmVsIFNlbnNvcic6CiAgICAgICAgICAgIHJldHVybiAnPHBhdGggZD0iTTE5LjYzNjMgNS40NTMyMUMxOS44MjI4IDUuMjEwMjYgMjAuMTc3MiA1LjIxMDI2IDIwLjM2MzcgNS40NTMyMUMyMC45NDA0IDYuMjA0NCAyMiA3LjczMDU3IDIyIDguODAzNzNDMjIgMTAuMDI3MiAyMS4xMTQzIDEwLjk5OTggMjAgMTAuOTk5OEMxOC44ODU3IDEwLjk5OTggMTggMTAuMDI3MiAxOCA4LjgwMzczQzE4IDcuNzMwNTcgMTkuMDU5NiA2LjIwNDQgMTkuNjM2MyA1LjQ1MzIxWiIgZmlsbD0id2hpdGUiLz4nICsKICAgICAgICAgICAgICAgICAgICc8cGF0aCBkPSJNMTMuMzAxNyA3Ljc2MDczQzEzLjY3NzkgNy4zMzc5OCAxNC4zMjIxIDcuMzM3OTggMTQuNjk4MyA3Ljc2MDczQzE2LjI4MDEgOS41MzgzMiAyMCAxNC4wNDc5IDIwIDE3LjE0MzdDMjAgMjAuNDA2NCAxNy4zNDI3IDIzIDE0IDIzQzEwLjY1NzMgMjMgOCAyMC40MDY0IDggMTcuMTQzN0M4IDE0LjA0NzkgMTEuNzE5OSA5LjUzODMyIDEzLjMwMTcgNy43NjA3M1oiIGZpbGw9IndoaXRlIi8+JzsKICAgICAgICBjYXNlICdNb3Rpb24gU2Vuc29yJzoKICAgICAgICAgICAgcmV0dXJuICc8cGF0aCBkPSJNNy41IDEwQzcuMjIzODYgMTAgNyAxMC4yMjM5IDcgMTAuNUM3IDEwLjc3NjEgNy4yMjM4NiAxMSA3LjUgMTFIOUM5IDExLjU1MjMgOS40NDc3MiAxMiAxMCAxMkgyMEMyMC41NTIzIDEyIDIxIDExLjU1MjMgMjEgMTFIMjIuNUMyMi43NzYxIDExIDIzIDEwLjc3NjEgMjMgMTAuNUMyMyAxMC4yMjM5IDIyLjc3NjEgMTAgMjIuNSAxMEg3LjVaIiBmaWxsPSJ3aGl0ZSIvPicgKwogICAgICAgICAgICAgICAgICAgJzxwYXRoIGQ9Ik0xNy4wMDAxIDE3QzE3LjU1MjQgMTcgMTguMDAwMSAxNi41NTIzIDE4LjAwMDEgMTZDMTguMDAwMSAxNS40NDc3IDE3LjU1MjQgMTUgMTcuMDAwMSAxNUMxNi40NDc4IDE1IDE2LjAwMDEgMTUuNDQ3NyAxNi4wMDAxIDE2QzE2LjAwMDEgMTYuNTUyMyAxNi40NDc4IDE3IDE3LjAwMDEgMTdaIiBmaWxsPSJ3aGl0ZSIvPicgKwogICAgICAgICAgICAgICAgICAgJzxwYXRoIGZpbGwtcnVsZT0iZXZlbm9kZCIgY2xpcC1ydWxlPSJldmVub2RkIiBkPSJNMTUuMDAwMSAyMUMxOS4wODA0IDIxIDIyLjQ0NzIgMTcuOTQ1MyAyMi45Mzg0IDEzLjk5OEMyMy4wMDY2IDEzLjQ1IDIyLjU1MjQgMTMgMjIuMDAwMSAxM0g4LjAwMDA5QzcuNDQ3OCAxMyA2Ljk5MzUzIDEzLjQ1IDcuMDYxNzMgMTMuOTk4QzcuNTUyOTUgMTcuOTQ1MyAxMC45MTk4IDIxIDE1LjAwMDEgMjFaTTE3LjAwMDEgMThDMTguMTA0NyAxOCAxOS4wMDAxIDE3LjEwNDYgMTkuMDAwMSAxNkMxOS4wMDAxIDE0Ljg5NTQgMTguMTA0NyAxNCAxNy4wMDAxIDE0QzE1Ljg5NTUgMTQgMTUuMDAwMSAxNC44OTU0IDE1LjAwMDEgMTZDMTUuMDAwMSAxNy4xMDQ2IDE1Ljg5NTUgMTggMTcuMDAwMSAxOFoiIGZpbGw9IndoaXRlIi8+JzsKICAgICAgICBjYXNlICdPY2N1cGFuY3kgU2Vuc29yJzoKICAgICAgICAgICAgcmV0dXJuICc8cGF0aCBkPSJNMTIgOC41QzEyIDkuMzI4NDMgMTEuMzI4NCAxMCAxMC41IDEwQzkuNjcxNTcgMTAgOSA5LjMyODQzIDkgOC41QzkgNy42NzE1NyA5LjY3MTU3IDcgMTAuNSA3QzExLjMyODQgNyAxMiA3LjY3MTU3IDEyIDguNVoiIGZpbGw9IndoaXRlIi8+JyArCiAgICAgICAgICAgICAgICAgICAnPHBhdGggZD0iTTEwIDIyTDEwIDE5SDExTDExIDIyQzExIDIyLjU1MjMgMTEuNDQ3NyAyMyAxMiAyM0MxMi41NTIzIDIzIDEzIDIyLjU1MjMgMTMgMjJWMTdDMTMuNTUyMyAxNyAxNCAxNi41NTIzIDE0IDE2VjEyLjg4NjVDMTQgMTEuODQ0NiAxMy4xNTU0IDExIDEyLjExMzUgMTFDMTIuMDk0NyAxMSAxMi4wNzYgMTEuMDAwNSAxMi4wNTc0IDExLjAwMTZDMTIuMDM4NCAxMS4wMDA1IDEyLjAxOTMgMTEgMTIgMTFMOSAxMUM4Ljk4MDcyIDExIDguOTYxNTcgMTEuMDAwNSA4Ljk0MjU1IDExLjAwMTZDOC45MjQwMyAxMS4wMDA1IDguOTA1MzUgMTEgOC44ODY1MiAxMUM3Ljg0NDYyIDExIDcgMTEuODQ0NiA3IDEyLjg4NjVWMTZDNyAxNi41NTIzIDcuNDQ3NzIgMTcgOCAxN1YyMkM4IDIyLjU1MjMgOC40NDc3MiAyMyA5IDIzQzkuNTUyMjkgMjMgMTAgMjIuNTUyMyAxMCAyMloiIGZpbGw9IndoaXRlIi8+JyArCiAgICAgICAgICAgICAgICAgICAnPHBhdGggZD0iTTIxIDIzQzIwLjQ0NzcgMjMgMjAgMjIuNTUyMyAyMCAyMlYxOUgxOVYyMkMxOSAyMi41NTIzIDE4LjU1MjMgMjMgMTggMjNDMTcuNDQ3NyAyMyAxNyAyMi41NTIzIDE3IDIyVjE5SDE1LjcyMTVDMTUuMzcyNCAxOSAxNS4xMzA4IDE4LjY1MTMgMTUuMjUzMyAxOC4zMjQ0TDE3LjQ3MzMgMTIuNDA0NUMxNy43OTAxIDExLjU1OTcgMTguNTk3NyAxMSAxOS41IDExQzIwLjQwMjMgMTEgMjEuMjA5OSAxMS41NTk3IDIxLjUyNjcgMTIuNDA0NUwyMy43NDY3IDE4LjMyNDRDMjMuODY5MiAxOC42NTEzIDIzLjYyNzYgMTkgMjMuMjc4NSAxOUgyMlYyMkMyMiAyMi41NTIzIDIxLjU1MjMgMjMgMjEgMjNaIiBmaWxsPSJ3aGl0ZSIvPicgKwogICAgICAgICAgICAgICAgICAgJzxwYXRoIGQ9Ik0xOS41IDEwQzIwLjMyODQgMTAgMjEgOS4zMjg0MyAyMSA4LjVDMjEgNy42NzE1NyAyMC4zMjg0IDcgMTkuNSA3QzE4LjY3MTYgNyAxOCA3LjY3MTU3IDE4IDguNUMxOCA5LjMyODQzIDE4LjY3MTYgMTAgMTkuNSAxMFoiIGZpbGw9IndoaXRlIi8+JzsKICAgICAgICBjYXNlICdTbW9rZSBTZW5zb3InOgogICAgICAgICAgICByZXR1cm4gJzxwYXRoIGZpbGwtcnVsZT0iZXZlbm9kZCIgY2xpcC1ydWxlPSJldmVub2RkIiBkPSJNMTQuNjQ0OSA3LjA4MzE5QzE0LjQ4NDQgNi45ODg4IDE0LjI4NDggNi45OTEzOCAxNC4xMjY4IDcuMDg5ODhDMTMuOTY4OSA3LjE4ODM5IDEzLjg3ODcgNy4zNjY1IDEzLjg5MjggNy41NTIxM0MxMy45ODE3IDguNzE4NzYgMTMuNzg4IDkuNTk0MyAxMy40NTM2IDEwLjMwNDhDMTMuMTE2MSAxMS4wMjIyIDEyLjYyMjEgMTEuNjAwMSAxMi4wNjM5IDEyLjE1N0MxMS44ODQgMTIuMzM2NCAxMS42OTAxIDEyLjUyMDEgMTEuNDkyMSAxMi43MDc2QzExLjEwMiAxMy4wNzcyIDEwLjY5NjIgMTMuNDYxNiAxMC4zNTE5IDEzLjg1NzJDOS44MTExMyAxNC40Nzg1IDkuMzUwODIgMTUuMTk4MiA5LjE1NzQxIDE2LjEzMUM4LjM1NDc4IDIwLjAwMjMgMTEuNDM5NSAyMy4xNjQ5IDE1LjM2MSAyMi45ODIyQzE1LjQxIDIyLjk4MDYgMTUuNDU5MiAyMi45Nzc5IDE1LjUwODggMjIuOTc0MUwxNS41NSAyMi45NzA4TDE1LjU2NzMgMjIuOTY5NUMxNS42NjM1IDIyLjk2MjIgMTUuNzU4NSAyMi45NTMyIDE1Ljg1MjMgMjIuOTQyN0MxNS44OTcgMjIuOTQyNyAxNS45NDIyIDIyLjk0MDkgMTUuOTg3OCAyMi45Mzc1QzE2LjEzNjkgMjIuOTI2MSAxNi4yNzM1IDIyLjkwMDIgMTYuMzk3NiAyMi44NjE0QzE3LjkwMjggMjIuNTc4NyAxOS4wNTcxIDIxLjg1ODEgMTkuODM2IDIwLjgzMDJDMjAuNzQ1MyAxOS42MzAzIDIxLjEwMzYgMTguMDY0NiAyMC45NzgxIDE2LjQxNTFDMjAuNzI3NSAxMy4xMjE1IDE4LjU0NzMgOS4zNzg2NiAxNC42NDQ5IDcuMDgzMTlaTTE3LjEzNzIgMjAuNTMyNkMxNy4xNDg3IDIwLjUyNjkgMTcuMTYwMSAyMC41MjEgMTcuMTcxNCAyMC41MTUyQzE3LjIyMjcgMjAuMjcwNiAxNy4yMzkzIDIwLjAwMDMgMTcuMjE3MiAxOS43MTAxQzE3LjEzNTMgMTguNjM0NCAxNi41MjQzIDE3LjM3NTIgMTUuMzkxMiAxNi40Mjk4QzE1LjM0NDMgMTYuNjc0MyAxNS4yNzExIDE2Ljg5NzkgMTUuMTc2NyAxNy4xMDQ1QzE0Ljk3MjUgMTcuNTUxNSAxNC42ODEyIDE3Ljg5MTUgMTQuNDA0NSAxOC4xNzQ4QzE0LjI5MTggMTguMjkwMiAxNC4xODk3IDE4LjM4OTEgMTQuMDk0NiAxOC40ODEyQzEzLjkzNjcgMTguNjM0MSAxMy43OTggMTguNzY4NCAxMy42NjI0IDE4LjkyODRDMTMuNDY2OSAxOS4xNTkxIDEzLjMzNTkgMTkuMzgzOSAxMy4yODEyIDE5LjY1NzVDMTMuMjA5IDIwLjAxOCAxMy4yMzM2IDIwLjM2MzQgMTMuMzM2IDIwLjY3MjVDMTMuNjk1MyAyMC44MTg2IDE0LjA4ODQgMjAuOTE4NSAxNC41MDk1IDIwLjk2MzNDMTQuNjI2NiAyMC43NjQgMTQuNzk5OCAyMC42MDM2IDE0Ljk3NzggMjAuNDM4OUMxNS4zNTA1IDIwLjA5MzggMTUuNzQzOSAxOS43Mjk3IDE1LjY4NDQgMTguOTQ5QzE2LjM5MjkgMTkuMzU1OCAxNi44ODEzIDE5LjkzOCAxNy4xMzcyIDIwLjUzMjZaTTE4LjIxNDMgMTkuNjM0M0wxOC4yMTU5IDE5LjY1NjNMMTguMjQyMSAxOS42MjIyQzE4Ljc5MDcgMTguODk4MyAxOS4wODE2IDE3Ljg1MDMgMTguOTgzOSAxNi41NjY4QzE4LjgzMDEgMTQuNTQ0NSAxNy43MTM4IDEyLjE1NDYgMTUuNjA5NyAxMC4yNTU0QzE1LjUxNDMgMTAuNTcwMiAxNS4zOTgxIDEwLjg2OTkgMTUuMjYzNCAxMS4xNTYzQzE0Ljc4MSAxMi4xODE2IDE0LjA5ODcgMTIuOTUyMSAxMy40NzY1IDEzLjU3MjhDMTMuMjA4OSAxMy44Mzk5IDEyLjk3NjkgMTQuMDU4NSAxMi43NjYxIDE0LjI1NzJDMTIuNDMwNiAxNC41NzM1IDEyLjE0ODUgMTQuODM5NCAxMS44NjA2IDE1LjE3MDFDMTEuNDU3NCAxNS42MzM0IDExLjIxNjggMTYuMDUwMiAxMS4xMTU5IDE2LjUzN0MxMC44MzU1IDE3Ljg4OTQgMTEuMjkzMSAxOS4xNjE2IDEyLjIzOTUgMTkuOTk3MUMxMi4yNDQyIDE5LjgyMjIgMTIuMjY0MiAxOS42NDMyIDEyLjMwMDYgMTkuNDYxM0MxMi4zOTkyIDE4Ljk2ODcgMTIuNjM1NiAxOC41OTMzIDEyLjg5OTUgMTguMjgxOUMxMy4wNjM3IDE4LjA4ODIgMTMuMjY2NiAxNy44OTA4IDEzLjQ0OTIgMTcuNzEzMUMxMy41MzU4IDE3LjYyODggMTMuNjE3OSAxNy41NDkgMTMuNjg5MSAxNy40NzYxQzEzLjkzMzUgMTcuMjI1OCAxNC4xMzI5IDE2Ljk4MjYgMTQuMjY3MSAxNi42ODlDMTQuMzk4NCAxNi40MDE2IDE0LjQ3OTYgMTYuMDM3OSAxNC40NDEyIDE1LjUzMzdDMTQuNDI3IDE1LjM0NyAxNC41MTg0IDE1LjE2OCAxNC42Nzc5IDE1LjA2OThDMTQuODM3NCAxNC45NzE3IDE1LjAzODQgMTQuOTcxIDE1LjE5ODYgMTUuMDY4QzE3LjA0NTEgMTYuMTg1MSAxOC4wOTA2IDE4LjAwODIgMTguMjE0MyAxOS42MzQzWiIgZmlsbD0id2hpdGUiLz4nOwogICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgIHJldHVybiAnJzsKICAgIH0KfQoKZXhwb3J0IGZ1bmN0aW9uIGdldFNtYXJ0UmV0YWlsRGV2aWNlU3ZnSWNvbih0eXBlKSB7CiAgICB2YXIgdHlwZVN2ZzsKICAgIHN3aXRjaCAodHlwZSkgewogICAgICAgIGNhc2UgJ1NtYXJ0IFNoZWxmJzoKICAgICAgICAgICAgdHlwZVN2ZyA9ICc8cGF0aCBmaWxsLXJ1bGU9ImV2ZW5vZGQiIGNsaXAtcnVsZT0iZXZlbm9kZCIgZD0iTTIuNSAyQzIuMjIzODYgMiAyIDIuMjIzODYgMiAyLjVWMTcuNUMyIDE3Ljc3NjEgMi4yMjM4NiAxOCAyLjUgMThDMi43NzYxNCAxOCAzIDE3Ljc3NjEgMyAxNy41VjE3SDE3VjE3LjVDMTcgMTcuNzc2MSAxNy4yMjM5IDE4IDE3LjUgJyArCiAgICAgICAgICAgICAgICAgICAgICAnMThDMTcuNzc2MSAxOCAxOCAxNy43NzYxIDE4IDE3LjVWMi41QzE4IDIuMjIzODYgMTcuNzc2MSAyIDE3LjUgMkMxNy4yMjM5IDIgMTcgMi4yMjM4NiAxNyAyLjVWOEgxNEMxNC41NTIzIDggMTUgNy41NTIyOCAxNSA3VjRDMTUgMy40NDc3MiAxNC41NTIzIDMgMTQgM0gxMUMxMC40NDc3IDMgMTAgMy40NDc3MiAxMCA0VjdDMTAgJyArCiAgICAgICAgICAgICAgICAgICAgICAnNy41NTIyOCAxMC40NDc3IDggMTEgOEg3QzcuNTUyMjggOCA4IDcuNTUyMjggOCA3VjZDOCA1LjQ0NzcyIDcuNTUyMjggNSA3IDVINkM1LjQ0NzcyIDUgNSA1LjQ0NzcyIDUgNlY3QzUgNy41NTIyOCA1LjQ0NzcyIDggNiA4SDNWMi41QzMgMi4yMjM4NiAyLjc3NjE0IDIgMi41IDJaTTE3IDE2VjlIM1YxNkg2QzUuNDQ3NzIgMTYgJyArCiAgICAgICAgICAgICAgICAgICAgICAnNSAxNS41NTIzIDUgMTVWMTJDNSAxMS40NDc3IDUuNDQ3NzIgMTEgNiAxMUg5QzkuNTUyMjggMTEgMTAgMTEuNDQ3NyAxMCAxMlYxNUMxMCAxNS41NTIzIDkuNTUyMjggMTYgOSAxNkgxMkMxMS40NDc3IDE2IDExIDE1LjU1MjMgMTEgMTVWMTNDMTEgMTIuNDQ3NyAxMS40NDc3IDEyIDEyIDEySDE0QzE0LjU1MjMgMTIgMTUgJyArCiAgICAgICAgICAgICAgICAgICAgICAnMTIuNDQ3NyAxNSAxM1YxNUMxNSAxNS41NTIzIDE0LjU1MjMgMTYgMTQgMTZIMTdaIiBmaWxsPSIjMjEyMTIxIi8+JzsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAnRnJlZXplcic6ICAgICAgICAgICAgCiAgICAgICAgICAgIHR5cGVTdmcgPSAnPHJlY3QgeD0iOSIgeT0iMiIgd2lkdGg9IjIiIGhlaWdodD0iMTYiIHJ4PSIxIiBmaWxsPSIjMjEyMTIxIi8+JyArCiAgICAgICAgICAgICAgICAgICAgICAnPHBhdGggZD0iTTEyLjUgMy41TDEwIDZMNy41IDMuNU0xMi41IDE2LjVMMTAgMTRMNy41IDE2LjUiIHN0cm9rZT0iIzIxMjEyMSIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIi8+JyArCiAgICAgICAgICAgICAgICAgICAgICAnPHBhdGggZD0iTTE2Ljg3OTIgOC45MTUwOUwxMy40NjQxIDguMDAwMDJMMTQuMzc5MiA0LjU4NDk2TTUuNjIwODIgMTUuNDE1MUw2LjUzNTg4IDEyTDMuMTIwODIgMTEuMDg1IiBzdHJva2U9IiMyMTIxMjEiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIvPicgKwogICAgICAgICAgICAgICAgICAgICAgJzxwYXRoIGQ9Ik01LjYyMDg1IDQuNTg0OTFMNi41MzU5MSA3Ljk5OTk4TDMuMTIwODUgOC45MTUwNE0xNi44NzkyIDExLjA4NDlMMTMuNDY0MSAxMkwxNC4zNzkyIDE1LjQxNSIgc3Ryb2tlPSIjMjEyMTIxIiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiLz4nICsKICAgICAgICAgICAgICAgICAgICAgICc8cmVjdCB4PSIxNi40MjgyIiB5PSI1LjEzMzc5IiB3aWR0aD0iMiIgaGVpZ2h0PSIxNiIgcng9IjEiIHRyYW5zZm9ybT0icm90YXRlKDYwIDE2LjQyODIgNS4xMzM3OSkiIGZpbGw9IiMyMTIxMjEiLz4nICsKICAgICAgICAgICAgICAgICAgICAgICc8cmVjdCB4PSIyLjU3MTc4IiB5PSI2Ljg2NjIxIiB3aWR0aD0iMiIgaGVpZ2h0PSIxNiIgcng9IjEiIHRyYW5zZm9ybT0icm90YXRlKC02MCAyLjU3MTc4IDYuODY2MjEpIiBmaWxsPSIjMjEyMTIxIi8+JzsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAnQ2hpbGxlcic6ICAgICAgICAgICAgCiAgICAgICAgICAgIHR5cGVTdmcgPSAnPHBhdGggZmlsbC1ydWxlPSJldmVub2RkIiBjbGlwLXJ1bGU9ImV2ZW5vZGQiIGQ9Ik0xMy4wMDAxIDcuNDk5OTRDMTMuMDAwMSA4LjUzNzE0IDEyLjI2NjEgOS4yNTE2IDExLjQ0NTQgOS42NDMzM0MxMS4yODA3IDkuNzIxOTEgMTEuMTE4NSA5Ljc1MDYxIDEwLjk2NTcgOS43Mzg3NEMxMC45ODgxIDkuODIyMDEgJyArCiAgICAgICAgICAgICAgICAgICAgICAnMTEuMDAwMSA5LjkwOTU3IDExLjAwMDEgOS45OTk5NEMxMS4wMDAxIDEwLjAzMDQgMTAuOTk4OCAxMC4wNjA1IDEwLjk5NjEgMTAuMDkwMkMxMS4xNTExIDEwLjAzMjIgMTEuMzIyIDkuOTk5OTMgMTEuNTAwMSA5Ljk5OTkzTDEyLjUwMDEgOS45OTk5NEwxMy41IDkuOTk5OTNDMTQuMzI4NSA5Ljk5OTkyIDE1LjAwMDMgJyArCiAgICAgICAgICAgICAgICAgICAgICAnMTAuNjk3NSAxNC42NDM1IDExLjQ0NTJDMTQuMjUxNyAxMi4yNjU4IDEzLjUzNzMgMTIuOTk5OSAxMi41MDAxIDEyLjk5OTlDMTEuNDYyOSAxMi45OTk5IDEwLjc0ODQgMTIuMjY1OCAxMC4zNTY3IDExLjQ0NTJDMTAuMjc4MSAxMS4yODA1IDEwLjI0OTQgMTEuMTE4NCAxMC4yNjEzIDEwLjk2NTVDMTAuMTc4IDEwLjk4OCAnICsKICAgICAgICAgICAgICAgICAgICAgICcxMC4wOTA1IDEwLjk5OTkgMTAuMDAwMSAxMC45OTk5QzkuOTY5NjUgMTAuOTk5OSA5LjkzOTQ5IDEwLjk5ODYgOS45MDk3MSAxMC45OTU5QzkuOTY3NzkgMTEuMTUwOSAxMCAxMS4zMjE4IDEwIDExLjVMMTAgMTIuNDk5OUwxMCAxMy40OTk5QzEwLjAwMDEgMTQuMzI4NCA5LjMwMjQ2IDE1LjAwMDIgOC41NTQ4MiAnICsKICAgICAgICAgICAgICAgICAgICAgICcxNC42NDMzQzcuNzM0MTMgMTQuMjUxNiA3LjAwMDA2IDEzLjUzNzEgNy4wMDAwNiAxMi40OTk5QzcuMDAwMDYgMTEuNDYyNyA3LjczNDEzIDEwLjc0ODMgOC41NTQ4MiAxMC4zNTY2QzguNzE5NDggMTAuMjc4IDguODgxNyAxMC4yNDkzIDkuMDM0NTkgMTAuMjYxMUM5LjAxMjEyIDEwLjE3NzkgOS4wMDAxMyAxMC4wOTAzICcgKwogICAgICAgICAgICAgICAgICAgICAgJzkuMDAwMTMgOS45OTk5NEM5LjAwMDEzIDkuOTY5NSA5LjAwMTQ5IDkuOTM5MzggOS4wMDQxNiA5LjkwOTYzQzguODQ5MjEgOS45Njc2NiA4LjY3ODM3IDkuOTk5OSA4LjUwMDI5IDkuOTk5ODlMNy41MDAzMSA5Ljk5OTg4TDYuNTAwMzMgOS45OTk4OUM1LjY3MTg5IDkuOTk5OSA1LjAwMDA2IDkuMzAyMyA1LjM1NjkyICcgKwogICAgICAgICAgICAgICAgICAgICAgJzguNTU0NjdDNS43NDg2NSA3LjczMzk3IDYuNDYzMTEgNi45OTk5MSA3LjUwMDMxIDYuOTk5OTFDOC41Mzc1IDYuOTk5OTEgOS4yNTE5NyA3LjczMzk3IDkuNjQzNyA4LjU1NDY3QzkuNzIyMjcgOC43MTkyOSA5Ljc1MDk4IDguODgxNDkgOS43MzkxMSA5LjAzNDM1QzkuODIyMzIgOS4wMTE5MSA5LjkwOTgzIDguOTk5OTQgJyArCiAgICAgICAgICAgICAgICAgICAgICAnMTAuMDAwMSA4Ljk5OTk0QzEwLjAzMDYgOC45OTk5NCAxMC4wNjA3IDkuMDAxMyAxMC4wOTA1IDkuMDAzOTdDMTAuMDMyNCA4Ljg0ODk4IDEwLjAwMDIgOC42NzgwNyAxMC4wMDAyIDguNDk5OTJMMTAuMDAwMiA3LjQ5OTk0TDEwLjAwMDIgNi40OTk5NkMxMC4wMDAxIDUuNjcxNTMgMTAuNjk3NyA0Ljk5OTY5IDExLjQ0NTQgJyArCiAgICAgICAgICAgICAgICAgICAgICAnNS4zNTY1NUMxMi4yNjYxIDUuNzQ4MjggMTMuMDAwMSA2LjQ2Mjc0IDEzLjAwMDEgNy40OTk5NFoiIGZpbGw9IiMyMTIxMjEiLz4nICsKICAgICAgICAgICAgICAgICAgICAgICc8Y2lyY2xlIGN4PSIxMCIgY3k9IjEwIiByPSI4IiBzdHJva2U9IiMyMTIxMjEiIHN0cm9rZS13aWR0aD0iMiIvPic7CiAgICAgICAgICAgIGJyZWFrOyAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICBjYXNlICdTbWFydCBCaW4nOgogICAgICAgICAgICB0eXBlU3ZnID0gJzxwYXRoIGQ9Ik02LjcxODQ5IDE0QzUuMTUyNDEgMTQgNC4xOTM5NCAxMi4yODE2IDUuMDE2ODYgMTAuOTQ5MUw1LjA5ODE2IDEwLjgxNzVDNS4xNzc5NyAxMC44MzI3IDUuMjYwOTQgMTAuODM4MyA1LjM0NTc1IDEwLjgzMzJDNS44OTcwNCAxMC44MDAxIDYuMzE3MTMgMTAuMzI2NCA2LjI4NDA0IDkuNzc1MDlMNi4yMTcwNSA4LjY1OTA2QzYuMTk4MzggOC4zNDc5NSA2LjAzNTcxIDguMDYzMzMgNS43NzcxNCA3Ljg4OTMzQzUuNTE4NTYgNy43MTUzMyA1LjE5MzYzIDcuNjcxODQgNC44OTg0IDcuNzcxNzFMMy45MzIzNyA4LjA5ODUxQzMuNDA5MjEgOC4yNzU0OSAzLjEyODU4IDguODQzMDYgMy4zMDU1NiA5LjM2NjIyQzMuMzQyMzcgOS40NzUwNCAzLjM5NjA4IDkuNTczMzcgMy40NjI3OCA5LjY1OTI3TDMuMzE1MjMgOS44OTgxOEMxLjY2OTM5IDEyLjU2MzEgMy41ODYzMyAxNiA2LjcxODQ5IDE2SDcuODM0ODVDOC4zODcxNCAxNiA4LjgzNDg1IDE1LjU1MjMgOC44MzQ4NSAxNUM4LjgzNDg1IDE0LjQ0NzggOC4zODcxNCAxNCA3LjgzNDg1IDE0TDYuNzE4NDkgMTRaIiBmaWxsPSIjMjEyMTIxIi8+JyArCiAgICAgICAgICAgICAgICAgICAgICAnPHBhdGggZD0iTTEzLjMxMzUgMTMuODQwOUMxNC44Nzg5IDEzLjg4NzMgMTUuODg3OSAxMi4xOTggMTUuMTA0OCAxMC44NDE4TDE0LjU0NjcgOS44NzQ5NUMxNC4yNzA1IDkuMzk2NjYgMTQuNDM0NCA4Ljc4NTA3IDE0LjkxMjcgOC41MDg5M0MxNS4zOTEgOC4yMzI3OSAxNi4wMDI2IDguMzk2NjYgMTYuMjc4NyA4Ljg3NDk1TDE2LjgzNjkgOS44NDE3NUMxOC40MDMgMTIuNTU0MyAxNi4zODQ5IDE1LjkzMjkgMTMuMjU0MiAxNS44NEwxMi45NzM1IDE1LjgzMTdDMTIuOTMyNCAxNS45MzI0IDEyLjg3NDEgMTYuMDI4MSAxMi43OTgzIDE2LjExNDNDMTIuNDMzNyAxNi41MjkyIDExLjgwMTkgMTYuNTY5OSAxMS4zODcgMTYuMjA1NEwxMC42MjEgMTUuNTMyMkMxMC4zODY5IDE1LjMyNjQgMTAuMjYyMSAxNS4wMjMzIDEwLjI4MzUgMTQuNzEyM0MxMC4zMDQ5IDE0LjQwMTQgMTAuNDcgMTQuMTE4MiAxMC43MzAxIDEzLjk0NjVMMTEuNjYzMiAxMy4zMzA1QzEyLjEyNCAxMy4wMjYyIDEyLjc0NDQgMTMuMTUzMSAxMy4wNDg3IDEzLjYxNEMxMy4wOTU1IDEzLjY4NDkgMTMuMTMyMSAxMy43NTk2IDEzLjE1ODggMTMuODM2M0wxMy4zMTM1IDEzLjg0MDlaIiBmaWxsPSIjMjEyMTIxIi8+JyArCiAgICAgICAgICAgICAgICAgICAgICAnPHBhdGggZD0iTTExLjY2OTYgNS4yMTAwMkMxMC45MjcyIDMuODMxMTMgOC45NTk2OCAzLjgwMTk1IDguMTc2NjQgNS4xNTgyMUw3LjYxODQ2IDYuMTI1MDFDNy4zNDIzMiA2LjYwMzMgNi43MzA3MyA2Ljc2NzE4IDYuMjUyNDQgNi40OTEwNEM1Ljc3NDE0IDYuMjE0ODkgNS42MTAyNyA1LjYwMzMgNS44ODY0MSA1LjEyNTAxTDYuNDQ0NTkgNC4xNTgyMUM4LjAxMDY3IDEuNDQ1NjggMTEuOTQ1NiAxLjUwNDA0IDEzLjQzMDYgNC4yNjE4M0wxMy41NjM3IDQuNTA5MDdDMTMuNjcxNSA0LjQ5NDI1IDEzLjc4MzUgNC40OTY5IDEzLjg5NjEgNC41MTk0M0MxNC40Mzc3IDQuNjI3NzQgMTQuNzg4OSA1LjE1NDU3IDE0LjY4MDYgNS42OTYxM0wxNC40ODA2IDYuNjk2MTNDMTQuNDE5NSA3LjAwMTc1IDE0LjIxOTMgNy4yNjEzOSAxMy45MzkzIDcuMzk4MzNDMTMuNjU5NCA3LjUzNTI2IDEzLjMzMTUgNy41MzM4MiAxMy4wNTI4IDcuMzk0NDRMMTIuMDUyOCA2Ljg5NDQ0QzExLjU1ODggNi42NDc0NSAxMS4zNTg2IDYuMDQ2NzggMTEuNjA1NiA1LjU1MjhDMTEuNjQzNiA1LjQ3NjgxIDExLjY4OTkgNS40MDc3NyAxMS43NDMgNS4zNDYyNEwxMS42Njk2IDUuMjEwMDJaIiBmaWxsPSIjMjEyMTIxIi8+JzsKICAgICAgICAgICAgYnJlYWs7ICAgICAgICAgIAogICAgICAgIGNhc2UgJ0Rvb3IgU2Vuc29yJzoKICAgICAgICAgICAgdHlwZVN2ZyA9ICc8cGF0aCBmaWxsLXJ1bGU9ImV2ZW5vZGQiIGNsaXAtcnVsZT0iZXZlbm9kZCIgZD0iTTE0IDRINlYxNkgxNFY0Wk04IDEyQzguNTUyMjggMTIgOSAxMS41NTIzIDkgMTFDOSAxMC40NDc3IDguNTUyMjggMTAgOCAxMEM3LjQ0NzcyIDEwIDcgMTAuNDQ3NyA3IDExQzcgMTEuNTUyMyA3LjQ0NzcyIDEyIDggMTJaIiBmaWxsPSIjMjEyMTIxIi8+JyArCiAgICAgICAgICAgICAgICAgICAgICAnPHBhdGggZmlsbC1ydWxlPSJldmVub2RkIiBjbGlwLXJ1bGU9ImV2ZW5vZGQiIGQ9Ik0xNiAxN1YzQzE2IDIuNDQ3NzIgMTUuNTUyMyAyIDE1IDJINUM0LjQ0NzcyIDIgNCAyLjQ0NzcyIDQgM1YxN0gzLjVDMy4yMjM4NiAxNyAzIDE3LjIyMzkgMyAxNy41QzMgMTcuNzc2MSAzLjIyMzg2IDE4IDMuNSAxOEgxNi41QzE2Ljc3NjEgMTggMTcgMTcuNzc2MSAxNyAxNy41QzE3IDE3LjIyMzkgMTYuNzc2MSAxNyAxNi41IDE3SDE2Wk0xNSAzSDVMNSAxN0gxNVYzWiIgZmlsbD0iIzIxMjEyMSIvPic7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgJ0xpcXVpZCBMZXZlbCBTZW5zb3InOgogICAgICAgICAgICB0eXBlU3ZnID0gJzxwYXRoIGQ9Ik0xNC42MzYzIDAuNDUzMjEyQzE0LjgyMjggMC4yMTAyNTcgMTUuMTc3MiAwLjIxMDI1NyAxNS4zNjM3IDAuNDUzMjEzQzE1Ljk0MDQgMS4yMDQ0IDE3IDIuNzMwNTcgMTcgMy44MDM3M0MxNyA1LjAyNzIzIDE2LjExNDMgNS45OTk4MiAxNSA1Ljk5OTgyQzEzLjg4NTcgNS45OTk4MiAxMyA1LjAyNzIzIDEzIDMuODAzNzNDMTMgMi43MzA1NyAxNC4wNTk2IDEuMjA0NCAxNC42MzYzIDAuNDUzMjEyWiIgZmlsbD0iIzIxMjEyMSIvPicgKwogICAgICAgICAgICAgICAgICAgICAgJzxwYXRoIGQ9Ik04LjMwMTcgMi43NjA3M0M4LjY3Nzg4IDIuMzM3OTggOS4zMjIxMiAyLjMzNzk4IDkuNjk4MyAyLjc2MDczQzExLjI4MDEgNC41MzgzMiAxNSA5LjA0NzkgMTUgMTIuMTQzN0MxNSAxNS40MDY0IDEyLjM0MjcgMTggOSAxOEM1LjY1NzI1IDE4IDMgMTUuNDA2NCAzIDEyLjE0MzdDMyA5LjA0NzkgNi43MTk5NCA0LjUzODMyIDguMzAxNyAyLjc2MDczWiIgZmlsbD0iIzIxMjEyMSIvPic7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgJ01vdGlvbiBTZW5zb3InOgogICAgICAgICAgICB0eXBlU3ZnID0gJzxwYXRoIGQ9Ik0yLjUgNUMyLjIyMzg2IDUgMiA1LjIyMzg2IDIgNS41QzIgNS43NzYxNCAyLjIyMzg2IDYgMi41IDZINEM0IDYuNTUyMjggNC40NDc3MiA3IDUgN0gxNUMxNS41NTIzIDcgMTYgNi41NTIyOCAxNiA2SDE3LjVDMTcuNzc2MSA2IDE4IDUuNzc2MTQgMTggNS41QzE4IDUuMjIzODYgMTcuNzc2MSA1IDE3LjUgNUgyLjVaIiBmaWxsPSIjMjEyMTIxIi8+JyArCiAgICAgICAgICAgICAgICAgICAgICAnPHBhdGggZD0iTTEyLjAwMDEgMTJDMTIuNTUyNCAxMiAxMy4wMDAxIDExLjU1MjMgMTMuMDAwMSAxMUMxMy4wMDAxIDEwLjQ0NzcgMTIuNTUyNCAxMCAxMi4wMDAxIDEwQzExLjQ0NzggMTAgMTEuMDAwMSAxMC40NDc3IDExLjAwMDEgMTFDMTEuMDAwMSAxMS41NTIzIDExLjQ0NzggMTIgMTIuMDAwMSAxMloiIGZpbGw9IiMyMTIxMjEiLz4nICsKICAgICAgICAgICAgICAgICAgICAgICc8cGF0aCBmaWxsLXJ1bGU9ImV2ZW5vZGQiIGNsaXAtcnVsZT0iZXZlbm9kZCIgZD0iTTEwLjAwMDEgMTZDMTQuMDgwNCAxNiAxNy40NDcyIDEyLjk0NTMgMTcuOTM4NCA4Ljk5ODAxQzE4LjAwNjYgOC40NDk5NiAxNy41NTI0IDggMTcuMDAwMSA4SDMuMDAwMDlDMi40NDc4IDggMS45OTM1MyA4LjQ0OTk2IDIuMDYxNzMgOC45OTgwMUMyLjU1Mjk1IDEyLjk0NTMgNS45MTk3OCAxNiAxMC4wMDAxIDE2Wk0xMi4wMDAxIDEzQzEzLjEwNDcgMTMgMTQuMDAwMSAxMi4xMDQ2IDE0LjAwMDEgMTFDMTQuMDAwMSA5Ljg5NTQzIDEzLjEwNDcgOSAxMi4wMDAxIDlDMTAuODk1NSA5IDEwLjAwMDEgOS44OTU0MyAxMC4wMDAxIDExQzEwLjAwMDEgMTIuMTA0NiAxMC44OTU1IDEzIDEyLjAwMDEgMTNaIiBmaWxsPSIjMjEyMTIxIi8+JzsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAnT2NjdXBhbmN5IFNlbnNvcic6CiAgICAgICAgICAgIHR5cGVTdmcgPSAnPHBhdGggZD0iTTcgMy41QzcgNC4zMjg0MyA2LjMyODQzIDUgNS41IDVDNC42NzE1NyA1IDQgNC4zMjg0MyA0IDMuNUM0IDIuNjcxNTcgNC42NzE1NyAyIDUuNSAyQzYuMzI4NDMgMiA3IDIuNjcxNTcgNyAzLjVaIiBmaWxsPSIjMjEyMTIxIi8+JyArCiAgICAgICAgICAgICAgICAgICAgICAnPHBhdGggZD0iTTMgMTJDMi40NDc3MiAxMiAyIDExLjU1MjMgMiAxMUwyIDcuODg2NTJDMiA2Ljg0NDYyIDIuODQ0NjIgNiAzLjg4NjUyIDZDMy45MDUzNSA2IDMuOTI0MDMgNi4wMDA1NSAzLjk0MjU1IDYuMDAxNjJDMy45NjE1NyA2LjAwMDU1IDMuOTgwNzIgNiA0IDZIN0M3LjAxOTI4IDYgNy4wMzg0MyA2LjAwMDU1IDcuMDU3NDUgNi4wMDE2MkM3LjA3NTk3IDYuMDAwNTUgNy4wOTQ2NSA2IDcuMTEzNDggNkM4LjE1NTM4IDYgOSA2Ljg0NDYyIDkgNy44ODY1MlYxMUM5IDExLjU1MjMgOC41NTIyOSAxMiA4IDEyVjE3QzggMTcuNTUyMyA3LjU1MjI4IDE4IDcgMThDNi40NDc3MiAxOCA2IDE3LjU1MjMgNiAxN0w2IDE0SDVWMTdDNSAxNy41NTIzIDQuNTUyMjggMTggNCAxOEMzLjQ0NzcyIDE4IDMgMTcuNTUyMyAzIDE3VjEyWiIgZmlsbD0iIzIxMjEyMSIvPicgKwogICAgICAgICAgICAgICAgICAgICAgJzxwYXRoIGQ9Ik0xNiAxOEMxNS40NDc3IDE4IDE1IDE3LjU1MjMgMTUgMTdWMTRIMTRWMTdDMTQgMTcuNTUyMyAxMy41NTIzIDE4IDEzIDE4QzEyLjQ0NzcgMTggMTIgMTcuNTUyMyAxMiAxN1YxNEgxMC43MjE1QzEwLjM3MjQgMTQgMTAuMTMwOCAxMy42NTEzIDEwLjI1MzMgMTMuMzI0NEwxMi40NzMzIDcuNDA0NDlDMTIuNzkwMSA2LjU1OTY4IDEzLjU5NzcgNiAxNC41IDZDMTUuNDAyMyA2IDE2LjIwOTkgNi41NTk2OCAxNi41MjY3IDcuNDA0NDlMMTguNzQ2NyAxMy4zMjQ0QzE4Ljg2OTIgMTMuNjUxMyAxOC42Mjc2IDE0IDE4LjI3ODUgMTRIMTdWMTdDMTcgMTcuNTUyMyAxNi41NTIzIDE4IDE2IDE4WiIgZmlsbD0iIzIxMjEyMSIvPicgKwogICAgICAgICAgICAgICAgICAgICAgJzxwYXRoIGQ9Ik0xNC41IDVDMTUuMzI4NCA1IDE2IDQuMzI4NDMgMTYgMy41QzE2IDIuNjcxNTcgMTUuMzI4NCAyIDE0LjUgMkMxMy42NzE2IDIgMTMgMi42NzE1NyAxMyAzLjVDMTMgNC4zMjg0MyAxMy42NzE2IDUgMTQuNSA1WiIgZmlsbD0iIzIxMjEyMSIvPic7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgJ1Ntb2tlIFNlbnNvcic6CiAgICAgICAgICAgIHR5cGVTdmcgPSAnPHBhdGggZmlsbC1ydWxlPSJldmVub2RkIiBjbGlwLXJ1bGU9ImV2ZW5vZGQiIGQ9Ik05LjY0NDkxIDIuMDgzMTlDOS40ODQ0NCAxLjk4ODggOS4yODQ4MiAxLjk5MTM4IDkuMTI2ODUgMi4wODk4OEM4Ljk2ODg3IDIuMTg4MzkgOC44Nzg3MSAyLjM2NjUgOC44OTI4NSAyLjU1MjEzQzguOTgxNjkgMy43MTg3NiA4Ljc4Nzk1IDQuNTk0MyA4LjQ1MzYzIDUuMzA0ODNDOC4xMTYwNyA2LjAyMjI1IDcuNjIyMDkgNi42MDAwOCA3LjA2Mzg3IDcuMTU3QzYuODg0MDEgNy4zMzY0NCA2LjY5MDA4IDcuNTIwMTMgNi40OTIxNCA3LjcwNzYzQzYuMTAxOTcgOC4wNzcyMSA1LjY5NjE4IDguNDYxNTggNS4zNTE4OSA4Ljg1NzE4QzQuODExMTMgOS40Nzg1MyA0LjM1MDgyIDEwLjE5ODIgNC4xNTc0MSAxMS4xMzFDMy4zNTQ3OCAxNS4wMDIzIDYuNDM5NTIgMTguMTY0OSAxMC4zNjEgMTcuOTgyMkMxMC40MSAxNy45ODA2IDEwLjQ1OTIgMTcuOTc3OSAxMC41MDg4IDE3Ljk3NDFMMTAuNTUgMTcuOTcwOEwxMC41NjczIDE3Ljk2OTVDMTAuNjYzNSAxNy45NjIyIDEwLjc1ODUgMTcuOTUzMiAxMC44NTIzIDE3Ljk0MjdDMTAuODk3IDE3Ljk0MjcgMTAuOTQyMiAxNy45NDA5IDEwLjk4NzggMTcuOTM3NUMxMS4xMzY5IDE3LjkyNjEgMTEuMjczNSAxNy45MDAyIDExLjM5NzYgMTcuODYxNEMxMi45MDI4IDE3LjU3ODcgMTQuMDU3MSAxNi44NTgxIDE0LjgzNiAxNS44MzAyQzE1Ljc0NTMgMTQuNjMwMyAxNi4xMDM2IDEzLjA2NDYgMTUuOTc4MSAxMS40MTUxQzE1LjcyNzUgOC4xMjE1IDEzLjU0NzMgNC4zNzg2NiA5LjY0NDkxIDIuMDgzMTlaTTEyLjEzNzIgMTUuNTMyNkMxMi4xNDg3IDE1LjUyNjkgMTIuMTYwMSAxNS41MjEgMTIuMTcxNCAxNS41MTUyQzEyLjIyMjcgMTUuMjcwNiAxMi4yMzkzIDE1LjAwMDMgMTIuMjE3MiAxNC43MTAxQzEyLjEzNTMgMTMuNjM0NCAxMS41MjQzIDEyLjM3NTIgMTAuMzkxMiAxMS40Mjk4QzEwLjM0NDMgMTEuNjc0MyAxMC4yNzExIDExLjg5NzkgMTAuMTc2NyAxMi4xMDQ1QzkuOTcyNDggMTIuNTUxNSA5LjY4MTE2IDEyLjg5MTUgOS40MDQ1MSAxMy4xNzQ4QzkuMjkxOCAxMy4yOTAyIDkuMTg5NyAxMy4zODkxIDkuMDk0NjEgMTMuNDgxMkM4LjkzNjY2IDEzLjYzNDEgOC43OTgwNCAxMy43Njg0IDguNjYyNDEgMTMuOTI4NEM4LjQ2Njk0IDE0LjE1OTEgOC4zMzU5NSAxNC4zODM5IDguMjgxMTkgMTQuNjU3NUM4LjIwOTA0IDE1LjAxOCA4LjIzMzU3IDE1LjM2MzQgOC4zMzU5NSAxNS42NzI1QzguNjk1MjYgMTUuODE4NiA5LjA4ODQ0IDE1LjkxODUgOS41MDk0OCAxNS45NjMzQzkuNjI2NTUgMTUuNzY0IDkuNzk5ODEgMTUuNjAzNiA5Ljk3Nzc3IDE1LjQzODlDMTAuMzUwNSAxNS4wOTM4IDEwLjc0MzkgMTQuNzI5NyAxMC42ODQ0IDEzLjk0OUMxMS4zOTI5IDE0LjM1NTggMTEuODgxMyAxNC45MzggMTIuMTM3MiAxNS41MzI2Wk0xMy4yMTQzIDE0LjYzNDNMMTMuMjE1OSAxNC42NTYzTDEzLjI0MjEgMTQuNjIyMkMxMy43OTA3IDEzLjg5ODMgMTQuMDgxNiAxMi44NTAzIDEzLjk4MzkgMTEuNTY2OEMxMy44MzAxIDkuNTQ0NSAxMi43MTM4IDcuMTU0NTkgMTAuNjA5NyA1LjI1NTQxQzEwLjUxNDMgNS41NzAyMSAxMC4zOTgxIDUuODY5OTMgMTAuMjYzNCA2LjE1NjI4QzkuNzgwOTggNy4xODE1NyA5LjA5ODY5IDcuOTUyMSA4LjQ3NjUyIDguNTcyODJDOC4yMDg4NSA4LjgzOTg2IDcuOTc2OTQgOS4wNTg0NyA3Ljc2NjEyIDkuMjU3MTlDNy40MzA1OCA5LjU3MzQ4IDcuMTQ4NDYgOS44Mzk0MSA2Ljg2MDY1IDEwLjE3MDFDNi40NTc0MiAxMC42MzM0IDYuMjE2NzggMTEuMDUwMiA2LjExNTg1IDExLjUzN0M1LjgzNTQ2IDEyLjg4OTQgNi4yOTMxMyAxNC4xNjE2IDcuMjM5NDUgMTQuOTk3MUM3LjI0NDIzIDE0LjgyMjIgNy4yNjQyMiAxNC42NDMyIDcuMzAwNjQgMTQuNDYxM0M3LjM5OTIxIDEzLjk2ODcgNy42MzU2NCAxMy41OTMzIDcuODk5NTEgMTMuMjgxOUM4LjA2MzY3IDEzLjA4ODIgOC4yNjY2MSAxMi44OTA4IDguNDQ5MTkgMTIuNzEzMUM4LjUzNTg0IDEyLjYyODggOC42MTc5MiAxMi41NDkgOC42ODkwNyAxMi40NzYxQzguOTMzNDcgMTIuMjI1OCA5LjEzMjk1IDExLjk4MjYgOS4yNjcxMyAxMS42ODlDOS4zOTg0NCAxMS40MDE2IDkuNDc5NjQgMTEuMDM3OSA5LjQ0MTI0IDEwLjUzMzdDOS40MjcwMiAxMC4zNDcgOS41MTgzNSAxMC4xNjggOS42Nzc4OCAxMC4wNjk4QzkuODM3NDEgOS45NzE3NCAxMC4wMzg0IDkuOTcxMDEgMTAuMTk4NiAxMC4wNjhDMTIuMDQ1MSAxMS4xODUxIDEzLjA5MDYgMTMuMDA4MiAxMy4yMTQzIDE0LjYzNDNaIiBmaWxsPSIjMjEyMTIxIi8+JzsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgdHlwZVN2ZyA9ICc8Y2lyY2xlIGN4PSIxMCIgY3k9IjEwIiByPSIxMCIgZmlsbD0iI0FBQUFBQSIvPic7CiAgICB9CiAgICAKICAgIHJldHVybiAnPHN2ZyB3aWR0aD0iMjAiIGhlaWdodD0iMjAiIHZpZXdCb3g9IjAgMCAyMCAyMCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4nICsgCiAgICAgICAgICAgdHlwZVN2ZyArCiAgICAgICAgICAgJzwvc3ZnPic7Cn0gCgovLyBTbWFydCByZXRhaWwgYWRtaW4KCmV4cG9ydCBmdW5jdGlvbiBkZWxldGVTdXBlcm1hcmtldCh3aWRnZXRDb250ZXh0LCBlbnRpdHlJZCwgZW50aXR5TmFtZSkgewogICAgdmFyICRpbmplY3RvciA9IHdpZGdldENvbnRleHQuJHNjb3BlLiRpbmplY3RvcjsKICAgIHZhciBkaWFsb2dzID0gJGluamVjdG9yLmdldCh3aWRnZXRDb250ZXh0LnNlcnZpY2VzTWFwLmdldCgnZGlhbG9ncycpKTsKICAgIHZhciBhc3NldFNlcnZpY2UgPSAkaW5qZWN0b3IuZ2V0KHdpZGdldENvbnRleHQuc2VydmljZXNNYXAuZ2V0KCdhc3NldFNlcnZpY2UnKSk7CiAgICB2YXIgZW50aXR5UmVsYXRpb25TZXJ2aWNlID0gJGluamVjdG9yLmdldCh3aWRnZXRDb250ZXh0LnNlcnZpY2VzTWFwLmdldCgnZW50aXR5UmVsYXRpb25TZXJ2aWNlJykpOwogICAgdmFyIGVudGl0eUdyb3VwU2VydmljZSA9ICRpbmplY3Rvci5nZXQod2lkZ2V0Q29udGV4dC5zZXJ2aWNlc01hcC5nZXQoJ2VudGl0eUdyb3VwU2VydmljZScpKTsKICAgIGxldCBhdHRyaWJ1dGVTZXJ2aWNlID0gJGluamVjdG9yLmdldCh3aWRnZXRDb250ZXh0LnNlcnZpY2VzTWFwLmdldCgnYXR0cmlidXRlU2VydmljZScpKTsKICAgIAogICAgb3BlbkRlbGV0ZVN1cGVybWFya2V0RGlhbG9nKCk7CiAgICAKICAgIGZ1bmN0aW9uIG9wZW5EZWxldGVTdXBlcm1hcmtldERpYWxvZygpIHsKICAgICAgdmFyIHRpdGxlID0gJ0FyZSB5b3Ugc3VyZSB5b3Ugd2FudCB0byBkZWxldGUgdGhlIHN1cGVybWFya2V0ICcgKyBlbnRpdHlOYW1lICsgJz8nOwogICAgICB2YXIgY29udGVudCA9ICdCZSBjYXJlZnVsLCBhZnRlciB0aGUgY29uZmlybWF0aW9uLCB0aGUgc3VwZXJtYXJrZXQgd2lsbCBiZSBkZWxldGVkIGFuZCBhbGwgcmVsYXRlZCBkZXZpY2VzIHdpbGwgYmUgdW5hc3NpZ25lZCEnOwogICAgICBkaWFsb2dzLmNvbmZpcm0odGl0bGUsIGNvbnRlbnQsICdDYW5jZWwnLCAnRGVsZXRlJykuc3Vic2NyaWJlKAogICAgICAgIGZ1bmN0aW9uKHJlc3VsdCkgewogICAgICAgICAgaWYgKHJlc3VsdCkgewogICAgICAgICAgICBkZWxldGVTdXBlcm1hcmtldCgpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgKTsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gZGVsZXRlU3VwZXJtYXJrZXQoKSB7CiAgICAgIHZhciBjdXN0b21lcklkOwogICAgICBpZiAod2lkZ2V0Q29udGV4dC5jdXJyZW50VXNlci5hdXRob3JpdHkgPT09ICdURU5BTlRfQURNSU4nKSB7CiAgICAgICAgICAgY3VzdG9tZXJJZCA9IHdpZGdldENvbnRleHQuc3RhdGVDb250cm9sbGVyLmdldFN0YXRlUGFyYW1zKCkuZW50aXR5SWQ7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgY3VzdG9tZXJJZCA9IHsgaWQ6IHdpZGdldENvbnRleHQuY3VycmVudFVzZXIuY3VzdG9tZXJJZCwgZW50aXR5VHlwZTogJ0NVU1RPTUVSJ307CiAgICAgIH0KICAgICAgdmFyIHJlbGF0ZWREZXZpY2VzUXVlcnkgPSB7CiAgICAgICAgICBwYXJhbWV0ZXJzOiB7CiAgICAgICAgICAgICAgcm9vdElkOiBlbnRpdHlJZC5pZCwKICAgICAgICAgICAgICByb290VHlwZTogZW50aXR5SWQuZW50aXR5VHlwZSwKICAgICAgICAgICAgICBkaXJlY3Rpb246ICdGUk9NJwogICAgICAgICAgfSwKICAgICAgICAgIGZpbHRlcnM6IFt7IHJlbGF0aW9uVHlwZTogJ0NvbnRhaW5zJywgZW50aXR5VHlwZXM6IFsnREVWSUNFJ10gfV0KICAgICAgfTsKICAgICAgZW50aXR5UmVsYXRpb25TZXJ2aWNlLmZpbmRCeVF1ZXJ5KHJlbGF0ZWREZXZpY2VzUXVlcnkpLnN1YnNjcmliZSgocmVsYXRlZERldmljZXNSZWxhdGlvbnMpID0+IHsKICAgICAgICAgIHZhciByZW1vdmVEZXZpY2VzT2JzZXJ2YWJsZTsKICAgICAgICAgIGlmIChyZWxhdGVkRGV2aWNlc1JlbGF0aW9ucy5sZW5ndGgpIHsKICAgICAgICAgICAgICByZW1vdmVEZXZpY2VzT2JzZXJ2YWJsZSA9IGdldFVuYXNzaWduZWREZXZpY2VzR3JvdXAoY3VzdG9tZXJJZCkucGlwZSgKICAgICAgICAgICAgICAgICAgd2lkZ2V0Q29udGV4dC5yeGpzLnN3aXRjaE1hcCgodW5hc3NpZ25lZERldmljZXNHcm91cCkgPT4gewogICAgICAgICAgICAgICAgICAgICAgdmFyIHJlbW92ZURldmljZXNPYnNlcnZhYmxlcyA9IFtdOwogICAgICAgICAgICAgICAgICAgICAgcmVsYXRlZERldmljZXNSZWxhdGlvbnMuZm9yRWFjaCgoZGV2aWNlUmVsYXRpb24pID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgIHJlbW92ZURldmljZXNPYnNlcnZhYmxlcy5wdXNoKHJlbW92ZURldmljZShkZXZpY2VSZWxhdGlvbi50bywgY3VzdG9tZXJJZCwgdW5hc3NpZ25lZERldmljZXNHcm91cC5pZC5pZCkpOwogICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gd2lkZ2V0Q29udGV4dC5yeGpzLmZvcmtKb2luKHJlbW92ZURldmljZXNPYnNlcnZhYmxlcyk7CiAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgcmVtb3ZlRGV2aWNlc09ic2VydmFibGUgPSB3aWRnZXRDb250ZXh0LnJ4anMub2YobnVsbCk7CiAgICAgICAgICB9CiAgICAgICAgICByZW1vdmVEZXZpY2VzT2JzZXJ2YWJsZS5zdWJzY3JpYmUoKCkgPT4gewogICAgICAgICAgICAgIGFzc2V0U2VydmljZS5kZWxldGVBc3NldChlbnRpdHlJZC5pZCkuc3Vic2NyaWJlKAogICAgICAgICAgICAgICAgZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgd2lkZ2V0Q29udGV4dC51cGRhdGVBbGlhc2VzKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgKTsKICAgICAgICAgIH0pOwogICAgICB9KTsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gcmVtb3ZlRGV2aWNlKGRldmljZUlkLCBjdXN0b21lcklkLCB1bmFzc2lnbmVkRGV2aWNlc0dyb3VwSWQpIHsKICAgICAgICByZXR1cm4gd2lkZ2V0Q29udGV4dC5yeGpzLmZvcmtKb2luKFsKICAgICAgICAgICAgZW50aXR5R3JvdXBTZXJ2aWNlLmFkZEVudGl0eVRvRW50aXR5R3JvdXAodW5hc3NpZ25lZERldmljZXNHcm91cElkLCBkZXZpY2VJZC5pZCksCiAgICAgICAgICAgIGRlbGV0ZVN1cGVybWFya2V0VG9EZXZpY2VSZWxhdGlvbihkZXZpY2VJZCksCiAgICAgICAgICAgIHJlbW92ZVBvc2l0aW9uQXR0cmlidXRlcyhkZXZpY2VJZCkKICAgICAgICBdKTsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gZ2V0VW5hc3NpZ25lZERldmljZXNHcm91cChjdXN0b21lcklkKSB7CiAgICAgICAgcmV0dXJuIGVudGl0eUdyb3VwU2VydmljZS5nZXRFbnRpdHlHcm91cHNCeU93bmVySWQoY3VzdG9tZXJJZC5lbnRpdHlUeXBlLCBjdXN0b21lcklkLmlkLCAnREVWSUNFJykucGlwZSgKICAgICAgICAgICAgd2lkZ2V0Q29udGV4dC5yeGpzLnN3aXRjaE1hcCgoZGV2aWNlRW50aXR5R3JvdXBzKSA9PiB7CiAgICAgICAgICAgICAgICByZXR1cm4gZ2V0T3JDcmVhdGVVbmFzc2lnbmVkRGV2aWNlc0dyb3VwKGN1c3RvbWVySWQsIGRldmljZUVudGl0eUdyb3Vwcyk7CiAgICAgICAgICAgIH0pCiAgICAgICAgKTsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gZ2V0T3JDcmVhdGVVbmFzc2lnbmVkRGV2aWNlc0dyb3VwKGN1c3RvbWVySWQsIGdyb3VwcykgewogICAgICB2YXIgdW5hc3NpZ25lZERldmljZXNHcm91cCA9IGdyb3Vwcy5maW5kKGdyb3VwID0+IGdyb3VwLm5hbWUgPT09ICdVbmFzc2lnbmVkIFN1cGVybWFya2V0IERldmljZXMnKTsKICAgICAgaWYgKHVuYXNzaWduZWREZXZpY2VzR3JvdXApIHsKICAgICAgICAgIHJldHVybiB3aWRnZXRDb250ZXh0LnJ4anMub2YodW5hc3NpZ25lZERldmljZXNHcm91cCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgICB1bmFzc2lnbmVkRGV2aWNlc0dyb3VwID0gewogICAgICAgICAgICAgIHR5cGU6ICdERVZJQ0UnLAogICAgICAgICAgICAgIG5hbWU6ICdVbmFzc2lnbmVkIFN1cGVybWFya2V0IERldmljZXMnLAogICAgICAgICAgICAgIG93bmVySWQ6IGN1c3RvbWVySWQKICAgICAgICAgIH07CiAgICAgICAgICByZXR1cm4gZW50aXR5R3JvdXBTZXJ2aWNlLnNhdmVFbnRpdHlHcm91cCh1bmFzc2lnbmVkRGV2aWNlc0dyb3VwKTsKICAgICAgfQogICAgfQogICAgCiAgICBmdW5jdGlvbiBkZWxldGVTdXBlcm1hcmtldFRvRGV2aWNlUmVsYXRpb24oZGV2aWNlSWQpIHsKICAgICAgICByZXR1cm4gZW50aXR5UmVsYXRpb25TZXJ2aWNlLmRlbGV0ZVJlbGF0aW9uKGVudGl0eUlkLCAnQ29udGFpbnMnLCBkZXZpY2VJZCk7CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIHJlbW92ZVBvc2l0aW9uQXR0cmlidXRlcyhlbnRpdHlJZCkgewogICAgICAgIHJldHVybiBhdHRyaWJ1dGVTZXJ2aWNlLmRlbGV0ZUVudGl0eUF0dHJpYnV0ZXMoZW50aXR5SWQsICJTRVJWRVJfU0NPUEUiLCBbe2tleTogJ3hQb3MnfSx7a2V5OiAneVBvcyd9XSk7CiAgICB9Cn0KCmV4cG9ydCBmdW5jdGlvbiBkZWxldGVTbWFydFJldGFpbERldmljZSh3aWRnZXRDb250ZXh0LCBlbnRpdHlJZCwgZW50aXR5TmFtZSkgewogICAgdmFyICRpbmplY3RvciA9IHdpZGdldENvbnRleHQuJHNjb3BlLiRpbmplY3RvcjsKICAgIHZhciBkaWFsb2dzID0gJGluamVjdG9yLmdldCh3aWRnZXRDb250ZXh0LnNlcnZpY2VzTWFwLmdldCgnZGlhbG9ncycpKTsKICAgIHZhciBlbnRpdHlSZWxhdGlvblNlcnZpY2UgPSAkaW5qZWN0b3IuZ2V0KHdpZGdldENvbnRleHQuc2VydmljZXNNYXAuZ2V0KCdlbnRpdHlSZWxhdGlvblNlcnZpY2UnKSk7CiAgICB2YXIgZW50aXR5R3JvdXBTZXJ2aWNlID0gJGluamVjdG9yLmdldCh3aWRnZXRDb250ZXh0LnNlcnZpY2VzTWFwLmdldCgnZW50aXR5R3JvdXBTZXJ2aWNlJykpOwogICAgbGV0IGF0dHJpYnV0ZVNlcnZpY2UgPSAkaW5qZWN0b3IuZ2V0KHdpZGdldENvbnRleHQuc2VydmljZXNNYXAuZ2V0KCdhdHRyaWJ1dGVTZXJ2aWNlJykpOwogICAgCiAgICBvcGVuUmVtb3ZlRGV2aWNlRGlhbG9nKCk7CiAgICAKICAgIGZ1bmN0aW9uIG9wZW5SZW1vdmVEZXZpY2VEaWFsb2coKSB7CiAgICAgIHZhciB0aXRsZSA9ICdBcmUgeW91IHN1cmUgeW91IHdhbnQgdG8gcmVtb3ZlIHRoZSBkZXZpY2UgJyArIGVudGl0eU5hbWUgKyAnPyc7CiAgICAgIHZhciBjb250ZW50ID0gJ0FmdGVyIHRoZSBjb25maXJtYXRpb24sIHRoZSBkZXZpY2Ugd2lsbCBiZSB1bmFzc2lnbmVkIGZyb20gdGhlIGN1cnJlbnQgc3VwZXJtYXJrZXQhJzsKICAgICAgZGlhbG9ncy5jb25maXJtKHRpdGxlLCBjb250ZW50LCAnQ2FuY2VsJywgJ1JlbW92ZSBmcm9tIHN1cGVybWFya2V0Jykuc3Vic2NyaWJlKAogICAgICAgIGZ1bmN0aW9uKHJlc3VsdCkgewogICAgICAgICAgaWYgKHJlc3VsdCkgewogICAgICAgICAgICBkb1JlbW92ZURldmljZSgpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgKTsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gZG9SZW1vdmVEZXZpY2UoKSB7CiAgICAgIHZhciBjdXN0b21lcklkOwogICAgICBpZiAod2lkZ2V0Q29udGV4dC5jdXJyZW50VXNlci5hdXRob3JpdHkgPT09ICdURU5BTlRfQURNSU4nKSB7CiAgICAgICAgICAgY3VzdG9tZXJJZCA9IHdpZGdldENvbnRleHQuc3RhdGVDb250cm9sbGVyLmdldFN0YXRlUGFyYW1zKCkuZW50aXR5SWQ7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgY3VzdG9tZXJJZCA9IHsgaWQ6IHdpZGdldENvbnRleHQuY3VycmVudFVzZXIuY3VzdG9tZXJJZCwgZW50aXR5VHlwZTogJ0NVU1RPTUVSJ307CiAgICAgIH0KICAgICAgdmFyIHN1cGVybWFya2V0SWQgPSB3aWRnZXRDb250ZXh0LnN0YXRlQ29udHJvbGxlci5nZXRTdGF0ZVBhcmFtcygpLnNlbGVjdGVkU3VwZXJtYXJrZXQuZW50aXR5SWQ7CiAgICAgIHJlbW92ZURldmljZShlbnRpdHlJZCwgc3VwZXJtYXJrZXRJZCwgY3VzdG9tZXJJZCkuc3Vic2NyaWJlKCgpID0+IHsKICAgICAgICAgIHdpZGdldENvbnRleHQudXBkYXRlQWxpYXNlcygpOwogICAgICB9KTsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gcmVtb3ZlRGV2aWNlKGRldmljZUlkLCBzdXBlcm1hcmtldElkLCBjdXN0b21lcklkKSB7CiAgICAgICAgcmV0dXJuIGdldFVuYXNzaWduZWREZXZpY2VzR3JvdXAoY3VzdG9tZXJJZCkucGlwZSgKICAgICAgICAgICAgd2lkZ2V0Q29udGV4dC5yeGpzLnN3aXRjaE1hcCgodW5hc3NpZ25lZERldmljZXNHcm91cCkgPT4gewogICAgICAgICAgICAgICAgcmV0dXJuIHdpZGdldENvbnRleHQucnhqcy5mb3JrSm9pbihbCiAgICAgICAgICAgICAgICAgICAgZW50aXR5R3JvdXBTZXJ2aWNlLmFkZEVudGl0eVRvRW50aXR5R3JvdXAodW5hc3NpZ25lZERldmljZXNHcm91cC5pZC5pZCwgZGV2aWNlSWQuaWQpLAogICAgICAgICAgICAgICAgICAgIGRlbGV0ZVN1cGVybWFya2V0VG9EZXZpY2VSZWxhdGlvbihzdXBlcm1hcmtldElkLCBkZXZpY2VJZCksCiAgICAgICAgICAgICAgICAgICAgcmVtb3ZlUG9zaXRpb25BdHRyaWJ1dGVzKGRldmljZUlkKQogICAgICAgICAgICAgICAgXSk7CiAgICAgICAgICAgIH0pCiAgICAgICAgKTsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gZ2V0VW5hc3NpZ25lZERldmljZXNHcm91cChjdXN0b21lcklkKSB7CiAgICAgICAgcmV0dXJuIGVudGl0eUdyb3VwU2VydmljZS5nZXRFbnRpdHlHcm91cHNCeU93bmVySWQoY3VzdG9tZXJJZC5lbnRpdHlUeXBlLCBjdXN0b21lcklkLmlkLCAnREVWSUNFJykucGlwZSgKICAgICAgICAgICAgd2lkZ2V0Q29udGV4dC5yeGpzLnN3aXRjaE1hcCgoZGV2aWNlRW50aXR5R3JvdXBzKSA9PiB7CiAgICAgICAgICAgICAgICByZXR1cm4gZ2V0T3JDcmVhdGVVbmFzc2lnbmVkRGV2aWNlc0dyb3VwKGN1c3RvbWVySWQsIGRldmljZUVudGl0eUdyb3Vwcyk7CiAgICAgICAgICAgIH0pCiAgICAgICAgKTsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gZ2V0T3JDcmVhdGVVbmFzc2lnbmVkRGV2aWNlc0dyb3VwKGN1c3RvbWVySWQsIGdyb3VwcykgewogICAgICB2YXIgdW5hc3NpZ25lZERldmljZXNHcm91cCA9IGdyb3Vwcy5maW5kKGdyb3VwID0+IGdyb3VwLm5hbWUgPT09ICdVbmFzc2lnbmVkIFN1cGVybWFya2V0IERldmljZXMnKTsKICAgICAgaWYgKHVuYXNzaWduZWREZXZpY2VzR3JvdXApIHsKICAgICAgICAgIHJldHVybiB3aWRnZXRDb250ZXh0LnJ4anMub2YodW5hc3NpZ25lZERldmljZXNHcm91cCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgICB1bmFzc2lnbmVkRGV2aWNlc0dyb3VwID0gewogICAgICAgICAgICAgIHR5cGU6ICdERVZJQ0UnLAogICAgICAgICAgICAgIG5hbWU6ICdVbmFzc2lnbmVkIFN1cGVybWFya2V0IERldmljZXMnLAogICAgICAgICAgICAgIG93bmVySWQ6IGN1c3RvbWVySWQKICAgICAgICAgIH07CiAgICAgICAgICByZXR1cm4gZW50aXR5R3JvdXBTZXJ2aWNlLnNhdmVFbnRpdHlHcm91cCh1bmFzc2lnbmVkRGV2aWNlc0dyb3VwKTsKICAgICAgfQogICAgfQogICAgCiAgICBmdW5jdGlvbiBkZWxldGVTdXBlcm1hcmtldFRvRGV2aWNlUmVsYXRpb24oc3VwZXJtYXJrZXRJZCwgZGV2aWNlSWQpIHsKICAgICAgICByZXR1cm4gZW50aXR5UmVsYXRpb25TZXJ2aWNlLmRlbGV0ZVJlbGF0aW9uKHN1cGVybWFya2V0SWQsICdDb250YWlucycsIGRldmljZUlkKTsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gcmVtb3ZlUG9zaXRpb25BdHRyaWJ1dGVzKGRldmljZUlkKSB7CiAgICAgICAgcmV0dXJuIGF0dHJpYnV0ZVNlcnZpY2UuZGVsZXRlRW50aXR5QXR0cmlidXRlcyhkZXZpY2VJZCwgIlNFUlZFUl9TQ09QRSIsIFt7a2V5OiAneFBvcyd9LHtrZXk6ICd5UG9zJ31dKTsKICAgIH0KfQoKZXhwb3J0IGZ1bmN0aW9uIHVwZGF0ZVNtYXJ0UmV0YWlsRGV2aWNlTGFiZWwod2lkZ2V0Q29udGV4dCwgZW50aXR5SWQpIHsKICAgIGxldCAkaW5qZWN0b3IgPSB3aWRnZXRDb250ZXh0LiRzY29wZS4kaW5qZWN0b3I7CiAgICBsZXQgY3VzdG9tRGlhbG9nID0gJGluamVjdG9yLmdldCh3aWRnZXRDb250ZXh0LnNlcnZpY2VzTWFwLmdldCgnY3VzdG9tRGlhbG9nJykpOwogICAgbGV0IGRldmljZVNlcnZpY2UgPSAkaW5qZWN0b3IuZ2V0KHdpZGdldENvbnRleHQuc2VydmljZXNNYXAuZ2V0KCdkZXZpY2VTZXJ2aWNlJykpOwogICAgCiAgICBvcGVuRWRpdERldmljZURpYWxvZygpOwogICAgCiAgICBmdW5jdGlvbiBvcGVuRWRpdERldmljZURpYWxvZygpIHsKIAogICAgICBjb25zdCBlZGl0RGV2aWNlSHRtbFRlbXBsYXRlID0gICc8Zm9ybSAjYWRkRW50aXR5Rm9ybT0ibmdGb3JtIiBbZm9ybUdyb3VwXT0iZWRpdERldmljZUZvcm1Hcm91cCJcbicgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICcgICAgICAobmdTdWJtaXQpPSJzYXZlKCkiIGNsYXNzPSJhZGQtZW50aXR5LWZvcm0iIHN0eWxlPSJ3aWR0aDogMzUwcHg7Ij5cbicgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICcgIDxtYXQtdG9vbGJhciBjbGFzcz0iZmxleCBmbGV4LXJvdyIgY29sb3I9InByaW1hcnkiPlxuJyArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJyAgICA8aDI+VXBkYXRlIGxhYmVsPC9oMj5cbicgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICcgICAgPHNwYW4gY2xhc3M9ImZsZXgtMSI+PC9zcGFuPlxuJyArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJyAgICA8YnV0dG9uIG1hdC1pY29uLWJ1dHRvbiAoY2xpY2spPSJjYW5jZWwoKSIgdHlwZT0iYnV0dG9uIj5cbicgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICcgICAgICA8bWF0LWljb24gY2xhc3M9Im1hdGVyaWFsLWljb25zIj5jbG9zZTwvbWF0LWljb24+XG4nICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnICAgIDwvYnV0dG9uPlxuJyArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJyAgPC9tYXQtdG9vbGJhcj5cbicgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICcgIDxtYXQtcHJvZ3Jlc3MtYmFyIGNvbG9yPSJ3YXJuIiBtb2RlPSJpbmRldGVybWluYXRlIiAqbmdJZj0iaXNMb2FkaW5nJCB8IGFzeW5jIj5cbicgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICcgIDwvbWF0LXByb2dyZXNzLWJhcj5cbicgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICcgIDxkaXYgc3R5bGU9ImhlaWdodDogNHB4OyIgKm5nSWY9IiEoaXNMb2FkaW5nJCB8IGFzeW5jKSI+PC9kaXY+XG4nICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnICA8ZGl2IG1hdC1kaWFsb2ctY29udGVudCBjbGFzcz0iZmxleCBmbGV4LWNvbCI+XG4nICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnICAgIDxtYXQtZm9ybS1maWVsZCBjbGFzcz0ibWF0LWJsb2NrIj5cbicgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICcgICAgICA8bWF0LWxhYmVsPk5ldyBsYWJlbDwvbWF0LWxhYmVsPlxuJyArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJyAgICAgIDxpbnB1dCBtYXRJbnB1dCBmb3JtQ29udHJvbE5hbWU9ImxhYmVsIiByZXF1aXJlZD5cbicgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICcgICAgICA8bWF0LWVycm9yICpuZ0lmPSJlZGl0RGV2aWNlRm9ybUdyb3VwLmdldChcJ2xhYmVsXCcpLmhhc0Vycm9yKFwncmVxdWlyZWRcJykiPlxuJyArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJyAgICAgICAgRGV2aWNlIGxhYmVsIGlzIHJlcXVpcmVkLlxuJyArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJyAgICAgIDwvbWF0LWVycm9yPlxuJyArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJyAgICA8L21hdC1mb3JtLWZpZWxkPlxuJyArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJyAgPC9kaXY+XG4nICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnICA8ZGl2IG1hdC1kaWFsb2ctYWN0aW9ucyBjbGFzcz0iZmxleCBmbGV4LXJvdyBpdGVtcy1jZW50ZXIganVzdGlmeS1lbmQiPlxuJyArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJyAgICA8YnV0dG9uIG1hdC1idXR0b24gY29sb3I9InByaW1hcnkiXG4nICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnICAgICAgICAgICAgdHlwZT0iYnV0dG9uIlxuJyArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJyAgICAgICAgICAgIFtkaXNhYmxlZF09Iihpc0xvYWRpbmckIHwgYXN5bmMpIlxuJyArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJyAgICAgICAgICAgIChjbGljayk9ImNhbmNlbCgpIiBjZGtGb2N1c0luaXRpYWw+XG4nICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnICAgICAgQ2FuY2VsXG4nICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnICAgIDwvYnV0dG9uPlxuJyArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJyAgICA8YnV0dG9uIG1hdC1idXR0b24gbWF0LXJhaXNlZC1idXR0b24gY29sb3I9InByaW1hcnkiXG4nICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnICAgICAgICAgICAgdHlwZT0ic3VibWl0IlxuJyArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJyAgICAgICAgICAgIFtkaXNhYmxlZF09Iihpc0xvYWRpbmckIHwgYXN5bmMpIHx8IGVkaXREZXZpY2VGb3JtR3JvdXAuaW52YWxpZCB8fCAhZWRpdERldmljZUZvcm1Hcm91cC5kaXJ0eSI+XG4nICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnICAgICAgVXBkYXRlIGxhYmVsXG4nICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnICAgIDwvYnV0dG9uPlxuJyArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJyAgPC9kaXY+XG4nICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnPC9mb3JtPlxuJzsgICAgICAgCiAgICAgICAgIAogICAgICBjdXN0b21EaWFsb2cuY3VzdG9tRGlhbG9nKGVkaXREZXZpY2VIdG1sVGVtcGxhdGUsIEVkaXREZXZpY2VEaWFsb2dDb250cm9sbGVyKS5zdWJzY3JpYmUoKTsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gRWRpdERldmljZURpYWxvZ0NvbnRyb2xsZXIoaW5zdGFuY2UpIHsKICAgICAgbGV0IHZtID0gaW5zdGFuY2U7CiAgICAgIAogICAgICB2bS5kZXZpY2UgPSB7fTsKICAgIAogICAgICB2bS5lZGl0RGV2aWNlRm9ybUdyb3VwID0gdm0uZmIuZ3JvdXAoewogICAgICAgIGxhYmVsOiBbJycsIFt2bS52YWxpZGF0b3JzLnJlcXVpcmVkXV0KICAgICAgfSk7CiAgICAKICAgICAgZ2V0RGV2aWNlKCk7CiAgICAKICAgICAgdm0uY2FuY2VsID0gZnVuY3Rpb24oKSB7CiAgICAgICAgdm0uZGlhbG9nUmVmLmNsb3NlKG51bGwpOwogICAgICB9OwogICAgCiAgICAgIHZtLnNhdmUgPSBmdW5jdGlvbigpIHsKICAgICAgICB2bS5lZGl0RGV2aWNlRm9ybUdyb3VwLm1hcmtBc1ByaXN0aW5lKCk7CiAgICAgICAgc2F2ZURldmljZSgpLnN1YnNjcmliZSgKICAgICAgICAgIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgd2lkZ2V0Q29udGV4dC51cGRhdGVBbGlhc2VzKCk7CiAgICAgICAgICAgIHZtLmRpYWxvZ1JlZi5jbG9zZShudWxsKTsKICAgICAgICAgIH0KICAgICAgICApOwogICAgICB9OwogICAgCiAgICAgIGZ1bmN0aW9uIGdldERldmljZSgpIHsKICAgICAgICAgIGRldmljZVNlcnZpY2UuZ2V0RGV2aWNlKGVudGl0eUlkLmlkKS5zdWJzY3JpYmUoCiAgICAgICAgICAgICAgZnVuY3Rpb24gKGRldmljZSkgewogICAgICAgICAgICAgICAgICAgIHZtLmRldmljZSA9IGRldmljZTsgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgdm0uZWRpdERldmljZUZvcm1Hcm91cC5wYXRjaFZhbHVlKHsKICAgICAgICAgICAgICAgICAgICAgIGxhYmVsOiB2bS5kZXZpY2UubGFiZWwKICAgICAgICAgICAgICAgICAgICB9LCB7ZW1pdEV2ZW50OiBmYWxzZX0pOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgKTsKICAgICAgfQogICAgCiAgICAgIGZ1bmN0aW9uIHNhdmVEZXZpY2UoKSB7CiAgICAgICAgY29uc3QgZm9ybVZhbHVlcyA9IHZtLmVkaXREZXZpY2VGb3JtR3JvdXAudmFsdWU7CiAgICAgICAgdm0uZGV2aWNlLmxhYmVsID0gZm9ybVZhbHVlcy5sYWJlbDsKICAgICAgICByZXR1cm4gZGV2aWNlU2VydmljZS5zYXZlRGV2aWNlKHZtLmRldmljZSk7CiAgICAgIH0KICAgIAogICAgfQoKfQoK",
      "public": false
    }
  ]
}